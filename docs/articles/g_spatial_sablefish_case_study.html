<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Setting up a Spatial Model (Alaska Sablefish) â€¢ SPoCK</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Setting up a Spatial Model (Alaska Sablefish)">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPoCK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_model_dimensions.html">Description of Model and Data Dimensions</a>
    </li>
    <li>
      <a href="../articles/b_model_parameters.html">Description of Model Parameters</a>
    </li>
    <li>
      <a href="../articles/c_model_equations.html">Description of Model Equations</a>
    </li>
    <li>
      <a href="../articles/d_model_diagnostics.html">Conducting Model Diagnostics</a>
    </li>
    <li>
      <a href="../articles/e_single_region_sablefish_case_study.html">Setting up a Single Region Model (Alaska Sablefish)</a>
    </li>
    <li>
      <a href="../articles/f_single_region_bsai_pollock_case_study.html">Setting up a Single Region Model (BSAI Pollock)</a>
    </li>
    <li>
      <a href="../articles/g_spatial_sablefish_case_study.html">Setting up a Spatial Model (Alaska Sablefish)</a>
    </li>
    <li>
      <a href="../articles/h_simulation_self_test.html">Conducting a Simulation Self-Test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Setting up a Spatial Model (Alaska
Sablefish)</h1>
            
      

      <div class="hidden name"><code>g_spatial_sablefish_case_study.Rmd</code></div>

    </div>

    
    
<p>The <code>SPoCK</code> package can be further generalized from a
single region assessment into a spatial assessment. Here, we will
demonstrate how a spatial stock assessment model might be set up.
Similar to previous vignettes, the spatial stock assessment illustrated
here uses various helper functions to facilitate setting it up. The
spatial stock assessment is a 5-region model and encompasses the Bering
Sea (BS), Aleutian Islands (AI), Western Gulf of Alaska (WGOA), Central
Gulf of Alaska (CGOA), and Eastern Gulf of Alaska (EGOA). A total of 30
ages are modeled, along with 2 sexes. Additionally, two fishery fleets
are modeled (fixed-gear and trawl) both of which operate across the
entire spatial domain defined. Two survey fleets are also modeled
(cooperative Japanese and domestic longline), which operates annually in
the Gulf of Alaska, and biennially between the BS and AI regions. Let us
first load in the necessary packages and data files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPoCK</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">)</span> <span class="co"># load in data</span></span></code></pre></div>
<div class="section level2">
<h2 id="setup-model-dimensions">Setup Model Dimensions<a class="anchor" aria-label="anchor" href="#setup-model-dimensions"></a>
</h2>
<p>To initially set the model up, an input list containing a data list,
parameter list, and a mapping list needs to be constructed. This is
aided with the function <code>Setup_Mod_Dim</code>, where users specify
a vector of years, ages, and lengths. Additionally, users need to
specify the number of regions modeled (n_regions), number of sexes
modelled (n_sexes), number of fishery fleets (n_fish_fleets), and number
of survey fleets (n_srv_fleets)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Dim.html">Setup_Mod_Dim</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, </span>
<span>                            <span class="co"># vector of years (1 - 62)</span></span>
<span>                            ages <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ages</span>,</span>
<span>                            <span class="co"># vector of ages (1 - 30)</span></span>
<span>                            lens <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">lens</span>, </span>
<span>                            <span class="co"># number of lengths (41 - 99)</span></span>
<span>                            n_regions <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_regions</span>, </span>
<span>                            <span class="co"># number of regions (5)</span></span>
<span>                            n_sexes <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_sexes</span>, </span>
<span>                            <span class="co"># number of sexes (2)</span></span>
<span>                            n_fish_fleets <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span>,</span>
<span>                            <span class="co"># number of fishery fleet (2)</span></span>
<span>                            n_srv_fleets <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">n_srv_fleets</span>,</span>
<span>                            <span class="co"># number of survey fleets (2)</span></span>
<span>                            verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-recruitment-dynamics">Setup Recruitment Dynamics<a class="anchor" aria-label="anchor" href="#setup-recruitment-dynamics"></a>
</h2>
<p>Following the initialization of <code>input_list</code>, we can pass
the created object into the next function (<code>Setup_Mod_Rec</code>)
to parameterize recruitment dynamics. In the case of the spatial model
for Alaska sablefish, recruitment is parameterized as such:</p>
<ol style="list-style-type: decimal">
<li>Mean Recruitment, with no stock recruitment relationship
assumed,</li>
<li>A recruitment bias ramp is not used
(<code>do_bias_ramp = 1</code>),</li>
<li>Two values for <code>sigmaR</code> are used, the first value
represents an early period <code>sigmaR</code>, which is fixed at 0.4,
while the second value represents a late period <code>sigmaR</code>,
which is fixed at a value of 1.2.</li>
<li>Recruitment deviations are estimated in a penalized likelihood
framework,</li>
<li>Recruitment deviations are estimated for all years and regions,
except for the terminal year,</li>
<li>Recruitment sex-ratios are fixed at 0.5 for each sex,</li>
<li>Initial age structure is derived by iterating the age structure to
equilibrium, and</li>
<li>Initial age deviations are shared across regions to facilitate model
convergence</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Rec.html">Setup_Mod_Rec</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>, <span class="co"># input data list from above</span></span>
<span>                            do_rec_bias_ramp <span class="op">=</span> <span class="fl">0</span>, <span class="co"># not using bias ramp</span></span>
<span>                            sigmaR_switch <span class="op">=</span> <span class="fl">16</span>, <span class="co"># switch to using late sigma in year 16</span></span>
<span>                            dont_est_recdev_last <span class="op">=</span> <span class="fl">1</span>, <span class="co"># don't estimate last rec dev</span></span>
<span>                            sexratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="co"># fix sex ratio at 0.5</span></span>
<span></span>
<span>                            <span class="co"># Model options</span></span>
<span>                            rec_model <span class="op">=</span> <span class="st">"mean_rec"</span>, <span class="co"># recruitment model</span></span>
<span>                            sigmaR_spec <span class="op">=</span> <span class="st">"fix"</span>, <span class="co"># fixing</span></span>
<span>                            InitDevs_spec <span class="op">=</span> <span class="st">"est_shared_r"</span>, </span>
<span>                            <span class="co"># initial deviations are shared across regions,</span></span>
<span>                            <span class="co"># but recruitment deviations are region specific</span></span>
<span>                            ln_sigmaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                            <span class="co"># values to fix sigmaR at, or starting values</span></span>
<span>                            ln_global_R0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>                            <span class="co"># starting value for global R0</span></span>
<span>                            R0_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                                            dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>                            <span class="co"># starting value for R0 proportions in multinomial logit space</span></span>
<span>                            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-biological-dynamics">Setup Biological Dynamics<a class="anchor" aria-label="anchor" href="#setup-biological-dynamics"></a>
</h2>
<p>Passing on the <code>input_list</code> that was updated in the
previous helper function, we can then parameterize the biological
dynamics of the model. The <code>Setup_Mod_Biologicals</code> requires
data inputs for weight-at-age (<code>WAA</code>) and maturity-at-age
(<code>MatAA</code>), both of which are dimensioned by
<code>n_regions</code>, <code>n_years</code>, <code>n_ages</code>,
<code>n_sexes</code>. Optional model inputs include a single
ageing-error matrix <code>AgeingError</code>, dimensioned by
<code>n_ages</code>, <code>n_ages</code>, and a size-age transition
matrix, whichn is dimensioned by <code>n_regions</code>,
<code>n_years</code>, <code>n_lens</code>, <code>n_ages</code>,
<code>n_sexes</code>. In this case, we are supplying both an ageing
error matrix and a size-age transition matrix, given that the spatial
sablefish model incorporates ageing error and also fits to length
composition data (<code>fit_lengths = 1</code>). Given that spatial
models are heavily parameterized and natural mortality is often poorly
estimated, we are fixing natural mortality <code>M_spec = "fix"</code>
at a value of <code>0.104884</code>, which is specified to be
sex-invariant.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Biologicals.html">Setup_Mod_Biologicals</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                    WAA <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">WAA</span>, <span class="co"># weight at age</span></span>
<span>                                    MatAA <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">MatAA</span>, <span class="co"># maturity at age</span></span>
<span>                                    AgeingError <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">AgeingError</span>, </span>
<span>                                    <span class="co"># ageing error matrix</span></span>
<span>                                    fit_lengths <span class="op">=</span> <span class="fl">1</span>, <span class="co"># fitting lengths</span></span>
<span>                                    SizeAgeTrans <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">SizeAgeTrans</span>, </span>
<span>                                    <span class="co"># size age transition matrix</span></span>
<span>                                    M_spec <span class="op">=</span> <span class="st">"fix"</span>, <span class="co"># fix natural mortality</span></span>
<span>                                    ln_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.104884</span><span class="op">)</span> <span class="co"># value to fix natural mortality at</span></span>
<span>                                    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-movement-and-tagging-dynamics">Setup Movement and Tagging Dynamics<a class="anchor" aria-label="anchor" href="#setup-movement-and-tagging-dynamics"></a>
</h2>
<p>Various options are available for parameterizing movement dynamics.
In particular, users can specify any number of age, year, and sex blocks
for movement. If users wish to specify blocks for the aforementioned
partitions, a list needs to be supplied detailing the blocking
structure, where the number of elements in the list represents the
number of blocks to estiamte, and the elements within the list should
specify the range of the block. For instance, the spatial model for
sablefish estimates 3 age blocks,
(<code>Movement_ageblk_spec = list(c(1:6), c(7:15), c(16:30))</code>),
where the first element specifies the first age block, which ranges from
ages 1 - 6, the second element specifies the second age block, which
ranges from ages 7 - 15, and the third element specifies the third age
block, which ranges from ages 16 - 30. No year and sex blocks are
specified for this application. Thus, both
<code>Movement_yearblk_spec</code> and <code>Movement_sexblk_spec</code>
are set at <code>"constant"</code>. Additionally, recruits are not
allowed to move, given the potential for severe confounding between
recruitment and movement if this is allowed
(<code>do_recruits_move = 0</code>). Fixed movement is not used in this
case (<code>use_fixed_movement = 0</code>) and a vague Dirichlet prior
for movement (<code>Use_Movement_Prior = 1</code> and
<code>Movement_prior = 1.75</code>) is used to penalize movement away
from the extremes (i.e, away from 0s and 1s).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Movement.html">Setup_Mod_Movement</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                 <span class="co"># Model options</span></span>
<span>                                 Movement_ageblk_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                 <span class="co"># estimating movement in 3 age blocks</span></span>
<span>                                 <span class="co"># (ages 1-6, ages 7-15, ages 16-30)</span></span>
<span>                                 Movement_yearblk_spec <span class="op">=</span> <span class="st">"constant"</span>, <span class="co"># time-invariant movement</span></span>
<span>                                 Movement_sexblk_spec <span class="op">=</span> <span class="st">"constant"</span>, <span class="co"># sex-invariant movement</span></span>
<span>                                 do_recruits_move <span class="op">=</span> <span class="fl">0</span>, <span class="co"># recruits do not move</span></span>
<span>                                 use_fixed_movement <span class="op">=</span> <span class="fl">0</span>, <span class="co"># estimating movement</span></span>
<span>                                 Use_Movement_Prior <span class="op">=</span> <span class="fl">1</span>, <span class="co"># priors used for movement</span></span>
<span>                                 Movement_prior <span class="op">=</span> <span class="fl">1.75</span> </span>
<span>                                 <span class="co"># vague prior to penalize movement away from the extremes</span></span>
<span>                                 <span class="op">)</span></span></code></pre></div>
<p>Specification of tagging dynamics can be a bit cumbersome given the
myriad of options available. In the current application, tagging data
from a longline survey are utilized <code>UseTagging = 1</code> and a
maximum tag liberty of 15 years is specified
<code>max_tag_liberty = 15</code> for tag cohort tracking. This cut off
is used to minimize computational demands, while providing a reasonable
level of movement information. Next, we need to specify some data
inputs. These primarily include:</p>
<ol style="list-style-type: decimal">
<li>
<code>tag_release_indicator</code>, which indicates the release year
and release region of a given tag cohort,</li>
<li>
<code>Tagged_Fish</code>, which contains the number of tagged fish
in each tag cohort, and</li>
<li>
<code>Obs_Tag_Recap</code>, which contains the observed tag
recaptures</li>
</ol>
<p>Following the specification of our data inputs, we can then specify
several model options. Here, can specify the likelihood type utilized
for tagging data (<code>Tag_LikeType = "NegBin"</code>), which is
specified as a negative binomial, with an overdispersion parameter
estimated. We can also specify a tag mixing period
(<code>mixing_period = 2</code>), which indicates to the model to not
fit tag recapture data until <code>release_year + 1</code>, given that
tagged individuals have not fully mixed. Additionally, the function also
takes a time at tagging argument <code>t_tagging</code>, which is
specified at a value of 0.5 to indicate that tagging happens midway
through the year, and movement does not occur in the tag release year.
Users can also specify how tagging fishing and natural mortality occurs.
In this application, tagging fishing mortality / selectivity is
specified as <code>tag_selex = "SexSp_AllFleet"</code>, which indicates
that the selectivity curve utilized to fit to tag data is sex-specific
is derived by a weighting fishery fleet-specific selectivity by fishing
mortality. The option <code>tag_natmort = "AgeSp_SexSp"</code> specifies
that tagged individuals experience age-and sex-specific natural
mortality. For more options, users can inspect
<code><a href="../reference/Setup_Mod_Tagging.html">?Setup_Mod_Tagging</a></code>.</p>
<p>Next, we can specify whether tag reporting rate priors are used
(<code>Use_TagRep_Prior = 1</code>) and the type of prior used
(<code>TagRep_PriorType = 0</code>). Here, tag reporting priors are in
fact used, and a symmetric beta prior is specified. Given that, the
symmetric beta prior does not require an input for a mean value for tag
reporting (<code>TagRep_mu = NA</code>), but does require an input for
the standard deviation (<code>TagRep_sd = 5</code>), where larger values
penalize the extremes more. We then specify the
<code>move_age_tag_pool</code> and <code>move_sex_tag_pool</code>
arguments which indicate to the model how tagging data should be fit. In
this case, we are fitting tag data by their respective age and
sex-blocks to reduce computational demand. If users wish to fit tag data
by their individual ages and sexes, <code>move_age_tag_pool</code> would
be specified as <code>list(1,2,3,4 ..., n_ages)</code> and
<code>move_sex_tag_pool</code> would be <code>list(1,2)</code>.</p>
<p>Because initial tagging mortality and chronic tag shedding are often
confounded with other mortality processes and difficult to estiamte, we
will fix these parameters in this application
(<code>Init_Tag_Mort_spec = "fix"</code> and
<code>Tag_Shed_spec = "fix"</code>). Lastly, we will specify the
estimation of tag reporting rates, which are time-varying (estimated as
2 blocks; see input supplied to the <code>Tag_Reporting_blocks</code>
argument) but are shared across regions
(<code>TagRep_spec = "est_shared_r"</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Tagging.html">Setup_Mod_Tagging</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                UseTagging <span class="op">=</span> <span class="fl">1</span>, <span class="co"># using tagging data</span></span>
<span>                                max_tag_liberty <span class="op">=</span> <span class="fl">15</span>, <span class="co"># maximum number of years to track a cohort</span></span>
<span></span>
<span>                                <span class="co"># Data Inputs</span></span>
<span>                                tag_release_indicator <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">tag_release_indicator</span>,</span>
<span>                                <span class="co"># tag release indicator (first col = tag region, </span></span>
<span>                                <span class="co"># second col = tag year),</span></span>
<span>                                <span class="co"># total number of rows = number of tagged cohorts</span></span>
<span>                                Tagged_Fish <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">Tagged_Fish</span>, <span class="co"># Released fish</span></span>
<span>                                <span class="co"># dimensioned by total number of tagged cohorts, (implicitly</span></span>
<span>                                <span class="co"># tracks the release year and region), age, and sex</span></span>
<span>                                Obs_Tag_Recap <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">Obs_Tag_Recap</span>,</span>
<span>                                <span class="co"># dimensioned by max tag liberty, tagged cohorts, regions,</span></span>
<span>                                <span class="co"># ages, and sexes</span></span>
<span></span>
<span>                                <span class="co"># Model options</span></span>
<span>                                Tag_LikeType <span class="op">=</span> <span class="st">"NegBin"</span>, <span class="co"># Negative Binomial</span></span>
<span>                                mixing_period <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Don't fit tagging until release year + 1</span></span>
<span>                                t_tagging <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># tagging happens midway through the year,</span></span>
<span>                                <span class="co"># movement does not occur within that year</span></span>
<span>                                tag_selex <span class="op">=</span> <span class="st">"SexSp_AllFleet"</span>, <span class="co"># tagging recapture selectivity</span></span>
<span>                                <span class="co"># is a weighted average of fishery selectivity of two fleets</span></span>
<span>                                tag_natmort <span class="op">=</span> <span class="st">"AgeSp_SexSp"</span>, <span class="co"># tagging natural mortality is</span></span>
<span>                                <span class="co"># age and sex-specific</span></span>
<span>                                Use_TagRep_Prior <span class="op">=</span> <span class="fl">1</span>, <span class="co"># tag reporting rate priors are used</span></span>
<span>                                TagRep_PriorType <span class="op">=</span> <span class="fl">0</span>, <span class="co"># symmetric beta is used </span></span>
<span>                                <span class="co"># for tag reporting prior</span></span>
<span>                                TagRep_mu <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># Tag reporting mean</span></span>
<span>                                TagRep_sd <span class="op">=</span> <span class="fl">5</span>, <span class="co"># tag reporting sd controlling symmetric beta</span></span>
<span>                                move_age_tag_pool <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>, <span class="co"># whether or</span></span>
<span>                                <span class="co"># not to pool tagging data when fitting (for computational cost)</span></span>
<span>                                move_sex_tag_pool <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="co"># whether or not to pool</span></span>
<span>                                <span class="co"># sex-specific data when fitting</span></span>
<span>                                Init_Tag_Mort_spec <span class="op">=</span> <span class="st">"fix"</span>, <span class="co"># fixing initial tag mortality</span></span>
<span>                                Tag_Shed_spec <span class="op">=</span> <span class="st">"fix"</span>, <span class="co"># fixing chronic shedding</span></span>
<span>                                TagRep_spec <span class="op">=</span> <span class="st">"est_shared_r"</span>, <span class="co"># tag reporting rates are </span></span>
<span>                                <span class="co"># not region specific</span></span>
<span>                                <span class="co"># Time blocks for tag reporting rates</span></span>
<span>                                Tag_Reporting_blocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Block_1_Year_1-35_Region_"</span>, </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Block_2_Year_36-62_Region_"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span>                                  <span class="op">)</span>,</span>
<span></span>
<span>                                <span class="co"># Specify starting values or fixing values</span></span>
<span>                                ln_Init_Tag_Mort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="co"># fixing initial tag mortality</span></span>
<span>                                ln_Tag_Shed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.02</span><span class="op">)</span>,  <span class="co"># fixing tag shedding</span></span>
<span>                                ln_tag_theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                                <span class="co"># starting value for tagging overdispersion</span></span>
<span>                                Tag_Reporting_Pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                           dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>                                <span class="co"># starting values for tag reporting pars</span></span>
<span></span>
<span>                                <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-catch-and-fishing-mortality">Setup Catch and Fishing Mortality<a class="anchor" aria-label="anchor" href="#setup-catch-and-fishing-mortality"></a>
</h2>
<p>In general, specifying catch and fishing mortality is relatively
straightforward. Users need to supply several data inputs, which include
an array of observed catches <code>ObsCatch</code>, the catch type
(<code>Catch_Type</code>), which indicates if we gave region-specific or
region-aggregated catch, and <code>UseCatch</code>, which indicates
whether or not to fit to catch data in a given region and year. Users
can inspect the <code>mlt_rg_sable_data</code> data object to further
understand the dimensions of data inputs, or refer to the Description of
Model and Data Dimensions vignette. Given that we are going to be using
TMB-style likelihoods, we are also specifying that the sigma for catch
is fixed (<code>sigmaC_spec = 'fix'</code>) at a value of 0.02 for all
fleets and regions
(<code>ln_sigmaC = array(log(0.02), dim = c(input_list$data$n_regions, input_list$data$n_fish_fleets))</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Catch_and_F.html">Setup_Mod_Catch_and_F</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                    <span class="co"># Data inputs</span></span>
<span>                                    ObsCatch <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsCatch</span>,</span>
<span>                                    Catch_Type <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">Catch_Type</span>,</span>
<span>                                    UseCatch <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseCatch</span>,</span>
<span>                                    <span class="co"># Model options</span></span>
<span>                                    Use_F_pen <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    <span class="co"># whether to use f penalty, == 0 don't use, == 1 use</span></span>
<span>                                    sigmaC_spec <span class="op">=</span> <span class="st">'fix'</span>,</span>
<span>                                    ln_sigmaC <span class="op">=</span></span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.02</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                               <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    <span class="co"># fixing catch sd at small value</span></span>
<span>                                    ln_F_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                                  <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>                                    <span class="co"># some starting values for fishing mortality</span></span>
<span>                                    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-index-and-composition-data-fishery-and-survey">Setup Index and Composition Data (Fishery and Survey)<a class="anchor" aria-label="anchor" href="#setup-index-and-composition-data-fishery-and-survey"></a>
</h2>
<p>Setting up fishery (and survey) index and composition data can
similarly be a bit cumbersome, given the number of data inputs that may
be required. Users can inspect the <code>mlt_rg_sable_data</code> data
object to further understand the dimensions of data inputs, or refer to
the Description of Model and Data Dimensions vignette. These data inputs
include the following: 1. <code>ObsFishIdx</code> and
<code>ObsSrvIdx</code>, which specifies the observed indices 2.
<code>ObsFishIdx_SE</code> and <code>ObsSrvIdx_SE</code>, which
specifies the standard errors of the observed indices 3.
<code>UseFishIdx</code> and <code>UseSrvIdx</code>, which indicate
whether or not indices are fit to 4. <code>ObsFishAgeComps</code> and
<code>ObsSrvAgeComps</code> contains the observed age compositions 5.
<code>UseFishAgeComps</code> and <code>UseSrvAgeComps</code> indicates
whether or not age compositions are fit to 6.
<code>ISS_FishAgeComps</code> and <code>ISS_SrvAgeComps</code> indicates
the input sample sizes used to weight age compositions 7.
<code>ObsFishLenComps</code> and <code>ObsSrvLenComps</code> contains
the observed length compositions 8. <code>UseFishLenComps</code> and
<code>UseSrvLenComps</code> indicates whether or not length compositions
are fit to 9. <code>ISS_FishLenComps</code> and
<code>ISS_SrvLenComps</code> indicates the input sample sizes used to
weight length compositions</p>
<p>Model options available are similar to those described in the Setting
up a Single Region Model (Alaska Sablefish) vignette. In the case of
fishery indices, <code>fish_idx_type</code> is specified at
<code>none</code> given that these are not used. Age composition
likelihoods are specified as
<code>FishAgeComps_LikeType = c("Multinomial", "none")</code>,
indicating that the first fleet uses a Multinomial and the second fleet
does not have age compositions. Fishery length compositions are
specified as Multinomial for both fleets. With respect to
<code>FishAgeComps_Type</code> and <code>FishLenComps_Type</code>, these
are both specified as <code>spltRjntS</code> when they are availiable to
indicate that compositions sum to 1 jointly across sexes, split by a
given region.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fishery Indices and Compositions</span></span>
<span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_FishIdx_and_Comps.html">Setup_Mod_FishIdx_and_Comps</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                          <span class="co"># data inputs</span></span>
<span>                                          ObsFishIdx <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishIdx</span>,</span>
<span>                                          ObsFishIdx_SE <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishIdx_SE</span>,</span>
<span>                                          UseFishIdx <span class="op">=</span>  <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseFishIdx</span>,</span>
<span>                                          ObsFishAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishAgeComps</span>,</span>
<span>                                          UseFishAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseFishAgeComps</span>,</span>
<span>                                          ISS_FishAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ISS_FishAgeComps</span>,</span>
<span>                                          ObsFishLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishLenComps</span>,</span>
<span>                                          UseFishLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseFishLenComps</span>,</span>
<span>                                          ISS_FishLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ISS_FishLenComps</span>,</span>
<span></span>
<span>                                          <span class="co"># Model options</span></span>
<span>                                          fish_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># fishery indices not used</span></span>
<span>                                          FishAgeComps_LikeType <span class="op">=</span> </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># age comp likelihoods for fishery fleet 1 and 2</span></span>
<span>                                          FishLenComps_LikeType <span class="op">=</span></span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># length comp likelihoods for fishery fleet 1 and 2</span></span>
<span>                                          FishAgeComps_Type <span class="op">=</span></span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spltRjntS_Year_1-62_Fleet_1"</span>,</span>
<span>                                              <span class="st">"none_Year_1-62_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># age comp structure for fishery fleet 1 and 2</span></span>
<span>                                          FishLenComps_Type <span class="op">=</span></span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spltRjntS_Year_1-62_Fleet_1"</span>,</span>
<span>                                              <span class="st">"spltRjntS_Year_1-62_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># length comp structure for fishery fleet 1 and 2</span></span>
<span>                                          FishAge_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                          FishLen_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span></span>
<span>                                          <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                          <span class="op">)</span></span></code></pre></div>
<p>The same arguments are expected for survey indices and compositions.
Here, 2 survey fleets are specified, where they are abundance based for
both fleets. Age compositions for both fleets are joint by sex, but
split by region, while length compositions are not used. All
compositions for the survey fleets assume a Mulinomial likelihood.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_SrvIdx_and_Comps.html">Setup_Mod_SrvIdx_and_Comps</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                         <span class="co"># data inputs</span></span>
<span>                                         ObsSrvIdx <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvIdx</span>,</span>
<span>                                         ObsSrvIdx_SE <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvIdx_SE</span>,</span>
<span>                                         UseSrvIdx <span class="op">=</span>  <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvIdx</span>,</span>
<span>                                         ObsSrvAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvAgeComps</span>,</span>
<span>                                         ISS_SrvAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ISS_SrvAgeComps</span>,</span>
<span>                                         UseSrvAgeComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvAgeComps</span>,</span>
<span>                                         ObsSrvLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvLenComps</span>,</span>
<span>                                         UseSrvLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvLenComps</span>,</span>
<span>                                         ISS_SrvLenComps <span class="op">=</span> <span class="va">mlt_rg_sable_data</span><span class="op">$</span><span class="va">ISS_SrvLenComps</span>,</span>
<span></span>
<span>                                         <span class="co"># Model options</span></span>
<span>                                         srv_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abd"</span>, <span class="st">"abd"</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># abundance and biomass for survey fleet 1 and 2</span></span>
<span>                                         SrvAgeComps_LikeType <span class="op">=</span></span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># survey age composition likelihood for survey fleet</span></span>
<span>                                         <span class="co"># 1, and 2</span></span>
<span>                                         SrvLenComps_LikeType <span class="op">=</span></span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                                         <span class="co">#  no length compositions used for survey</span></span>
<span>                                         SrvAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spltRjntS_Year_1-62_Fleet_1"</span>,</span>
<span>                                                              <span class="st">"spltRjntS_Year_1-62_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># survey age comp type</span></span>
<span>                                         SrvLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Year_1-62_Fleet_1"</span>,</span>
<span>                                                              <span class="st">"none_Year_1-62_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># survey length comp type</span></span>
<span>                                         SrvAge_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                         SrvLen_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>                                         <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                         <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-selectivity-and-catchability-fishery-and-survey">Setup Selectivity and Catchability (Fishery and Survey)<a class="anchor" aria-label="anchor" href="#setup-selectivity-and-catchability-fishery-and-survey"></a>
</h2>
<p>In the spatial sablefish application, all fishery/survey selectivity
and catchability processes are assumed to be spatially-invariant.
Similar to the single region case, users will need to specify several
selectivity options, which include:</p>
<ol style="list-style-type: decimal">
<li>Whether we have continuous time-varying selectivity processes
(<code>cont_tv_fish_sel</code> or <code>cont_tv_srv_sel</code>). For
this case study, continuous time-varying selectivity is not used and is
specified as <code>none_Fleet_x</code>,</li>
<li>Whether we have selectivity blocks (<code>fish_sel_blocks</code> or
<code>srv_sel_blocks</code>). This application assumes 2 time-blocks for
the fixed-gear fleet and time-invariant selectivity for the trawl
fishery,</li>
<li>The type of parametric selectivity form to specify for the different
fleets (<code>fish_sel_model</code> or <code>srv_sel_model</code>).
Here, we assume <code>logist1</code> for the fixed-gear fleet (logistic
specified as <code>a50</code> and <code>k</code>), and
<code>gamma</code> dome-shaped selectivity for the trawl fleet,</li>
<li>The number of catchability blocks specified
(<code>fish_q_blocks</code> or <code>srv_q_blocks</code>). Given that no
fishery indices are used, fishery catchability has no blocks are
estimated
(<code>fish_q_blocks = c("none_Fleet_1", "none_Fleet_2")</code>),</li>
<li>How fishery or survey selectivity parameters should be estimated
(<code>fish_fixed_sel_pars</code>). In the case of sablefish, we are
first specifying that all selectivity parameters (by regions,
time-blocks, sexes) should be estimated. However, there are some more
nuanced parameter sharing across regions, sexes, and time-blocks that
are used to help stabilize the model (last part of this code chunk), and
cannot be easily generalized. Thus, users can manually extract the
<code>map</code> list from the updated <code>input_list</code> object to
modify how parameters should be fixed or shared,</li>
<li>Lastly, how fishery or survey catchability should be estimated
(<code>fish_q_spec</code> or <code>srv_q_spec</code>). For the fishery,
catchability is not estimated as no fishery indices are utilized
(<code>fix</code>).</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Fishsel_and_Q.html">Setup_Mod_Fishsel_and_Q</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>                                      <span class="co"># Model options</span></span>
<span>                                      cont_tv_fish_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                      <span class="co"># fishery selectivity, whether continuous time-varying</span></span>
<span></span>
<span>                                      <span class="co"># fishery selectivity blocks</span></span>
<span>                                      fish_sel_blocks <span class="op">=</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Block_1_Year_1-56_Fleet_1"</span>,</span>
<span>                                          <span class="co"># block 1, fishery ll selex</span></span>
<span>                                          <span class="st">"Block_2_Year_57-62_Fleet_1"</span>,</span>
<span>                                          <span class="co"># block 3 fishery ll selex</span></span>
<span>                                          <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                      <span class="co"># no blocks for trawl fishery</span></span>
<span></span>
<span>                                      <span class="co"># fishery selectivity form</span></span>
<span>                                      fish_sel_model <span class="op">=</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist1_Fleet_1"</span>,</span>
<span>                                          <span class="st">"gamma_Fleet_2"</span><span class="op">)</span>,</span>
<span></span>
<span>                                      <span class="co"># fishery catchability blocks</span></span>
<span>                                      fish_q_blocks <span class="op">=</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>,</span>
<span>                                          <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                      <span class="co"># no blocks since q is not estimated</span></span>
<span></span>
<span>                                      <span class="co"># whether to estimate all fixed effects</span></span>
<span>                                      <span class="co"># for fishery selectivity and later modify</span></span>
<span>                                      <span class="co"># to fix and share parameters</span></span>
<span>                                      fish_fixed_sel_pars <span class="op">=</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="st">"est_all"</span><span class="op">)</span>,</span>
<span></span>
<span>                                      <span class="co"># whether to estimate all fixed effects</span></span>
<span>                                      <span class="co"># for fishery catchability</span></span>
<span>                                      fish_q_spec <span class="op">=</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fix"</span>, <span class="st">"fix"</span><span class="op">)</span></span>
<span>                                      <span class="co"># fix fishery q since not used</span></span>
<span>                                      <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Custom parameter sharing for fishery selectivity</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_fish_fixed_sel_pars</span> <span class="co"># mapping fishery selectivity</span></span>
<span></span>
<span><span class="co"># Fixed gear fleet, unique parameters for each sex (time block 1)</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># a50, female, time block 1, fixed gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, female, time block 1, fixed gear </span></span>
<span><span class="co"># (shared with time block 2 and sex)</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># a50, male, time block 1, fixed gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, male, time block 1, fixed gear</span></span>
<span><span class="co"># (shared with time block 2 and sex)</span></span>
<span></span>
<span><span class="co"># time block 2, fixed gear fishery</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="co"># a50, female, time block 2, fixed gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, female, time block 2, fixed gear </span></span>
<span><span class="co"># (shared with time block 1 and sex)</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># a50, male, time block 2, fixed gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, male, time block 2, fixed gear </span></span>
<span><span class="co"># (shared with time block 1 and sex)</span></span>
<span></span>
<span><span class="co"># time block 1 and 2, trawl gear fishery</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">6</span> <span class="co"># amax, female, time block 1, trawl gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">7</span> <span class="co"># delta, female, time block 1, trawl gear </span></span>
<span><span class="co"># (shared by sex)</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">8</span> <span class="co"># amax, male, time block 1, trawl gear</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">7</span> <span class="co"># delta, male, time block 1, trawl gear </span></span>
<span><span class="co"># (shared by sex)</span></span>
<span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">[</span>,,<span class="fl">2</span>,,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># no parameters estimated for time block 2 trawl gear</span></span>
<span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">ln_fish_fixed_sel_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">map_ln_fish_fixed_sel_pars</span><span class="op">)</span> <span class="co"># input into map list</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_fish_fixed_sel_pars</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="co"># some more inforamtive starting values</span></span></code></pre></div>
<p>Again, the same arguments are expected for setting up survey
selectivity, and there are similarly some nuanced parameter fixing and
sharing to help facilitate model stability.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Srvsel_and_Q.html">Setup_Mod_Srvsel_and_Q</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>                                     <span class="co"># Model options</span></span>
<span>                                     <span class="co"># survey selectivity, whether continuous time-varying</span></span>
<span>                                     cont_tv_srv_sel <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>,</span>
<span>                                         <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># survey selectivity blocks</span></span>
<span>                                     srv_sel_blocks <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>,</span>
<span>                                         <span class="st">"none_Fleet_2"</span></span>
<span>                                       <span class="op">)</span>, <span class="co"># no blocks for jp and domestic survey</span></span>
<span></span>
<span>                                     <span class="co"># survey selectivity form</span></span>
<span>                                     srv_sel_model <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist1_Fleet_1"</span>,</span>
<span>                                         <span class="st">"logist1_Fleet_2"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># survey catchability blocks</span></span>
<span>                                     srv_q_blocks <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>,</span>
<span>                                         <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># whether to estiamte all fixed effects</span></span>
<span>                                     <span class="co"># for survey selectivity and later</span></span>
<span>                                     <span class="co"># modify to fix/share parameters</span></span>
<span>                                     srv_fixed_sel_pars_spec <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>,</span>
<span>                                         <span class="st">"est_all"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># whether to estiamte all</span></span>
<span>                                     <span class="co"># fixed effects for survey catchability</span></span>
<span>                                     <span class="co"># spatially-invariant q</span></span>
<span>                                     srv_q_spec <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_shared_r"</span>,</span>
<span>                                         <span class="st">"est_shared_r"</span><span class="op">)</span>,</span>
<span>                                     </span>
<span>                                     <span class="co"># Starting values for survey catchability</span></span>
<span>                                     ln_srv_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">9</span>,</span>
<span>                                                      dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">1</span>,</span>
<span>                                                              <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>                                     <span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom mapping survey selectivity stuff</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span> <span class="co"># set up mapping factor stuff</span></span>
<span></span>
<span><span class="co"># Coop survey (japanese)</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># a50, coop survey, time block 1, female</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, coop survey, time block 1, female </span></span>
<span><span class="co"># (sharing with domestic survey)</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># a50, coop survey, time block 1, male</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="co"># delta, coop survey, time block 1, male </span></span>
<span><span class="co"># (sharing with domestic survey)</span></span>
<span></span>
<span><span class="co"># domestic survey</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># a50, domestic survey, time block 1, female</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># delta, domestic survey, time block 1, female </span></span>
<span><span class="co"># (sharing with coop survey)</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">6</span> <span class="co"># a50, domestic survey, time block 1, male</span></span>
<span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">[</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="co"># delta, domestic survey, time block 1, male</span></span>
<span><span class="co"># (sharing with coop survey)</span></span>
<span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">map_ln_srv_fixed_sel_pars</span><span class="op">)</span>  <span class="co"># input into map list</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="co"># some more informative starting values</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-model-weighting">Setup Model Weighting<a class="anchor" aria-label="anchor" href="#setup-model-weighting"></a>
</h2>
<p>Finally, we can specify how we want model weighting to be conducted.
In this case, we are using TMB-style likelihoods
(<code>likelihoods = 1</code>) such that all data sources are weighted
with user specified sigmas or standard errors. Thus, the remaining
arguments of <code>Wt_Catch</code>, <code>Wt_FishIdx</code>,
<code>Wt_SrvIdx</code>, <code>Wt_Rec</code>, and <code>Wt_F</code> are
specified at 1. Additionally, Francis re-weighting is not used in this
case study and composition weights are similarly specified at values of
1 (<code>Wt_FishAgeComps</code>, <code>Wt_FishLenComps</code>,
<code>Wt_SrvAgeComps</code>, and <code>Wt_SrvLenComps</code>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Weighting.html">Setup_Mod_Weighting</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                  sablefish_ADMB <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                  <span class="co"># don't use sablefish single region ADMB quirks</span></span>
<span>                                  likelihoods <span class="op">=</span> <span class="fl">1</span>, <span class="co"># using TMB-style likelihoods,</span></span>
<span>                                  <span class="co"># and weight using sigmas, instead of lambdas </span></span>
<span>                                  <span class="co"># and sigmas together</span></span>
<span>                                  Wt_Catch <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  Wt_FishIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  Wt_SrvIdx <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  Wt_Rec <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  Wt_F <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  <span class="co"># Composition model weighting</span></span>
<span>                                  Wt_FishAgeComps <span class="op">=</span></span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  Wt_FishLenComps <span class="op">=</span></span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  Wt_SrvAgeComps <span class="op">=</span></span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  Wt_SrvLenComps <span class="op">=</span></span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>,</span>
<span>                                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span></span>
<span>                                  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-model-and-plot">Fit Model and Plot<a class="anchor" aria-label="anchor" href="#fit-model-and-plot"></a>
</h2>
<p>We are done with the setup! Now, we can run our model. This is aided
by the <code>fit_model</code> function, which expects a
<code>data</code>, <code>mapping</code>, and <code>parameters</code>
list and uses the <code>MakeADFUN</code> function internally. These
lists can be extracted from the <code>input_list</code> constructed. The
report file is extracted out internally from <code>fit_model</code> and
standard errors can then be extracted using the
<code>RTMB::sdreport</code> function. As a word of caution, this could
take a while to run!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract out lists updated with helper functions</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">map</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">sabie_rtmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                              <span class="va">parameters</span>,</span>
<span>                              <span class="va">mapping</span>,</span>
<span>                              random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              newton_loops <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                              silent <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                              <span class="op">)</span></span>
<span></span>
<span><span class="co"># Get standard error report</span></span>
<span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">sd_rep</span> <span class="op">&lt;-</span> <span class="fu">RTMB</span><span class="fu">::</span><span class="fu">sdreport</span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">)</span></span></code></pre></div>
<p>Inspecting results from our spatial model, it appears that the
highest spawning biomass occurs in the CGOA, followed by the EGOA.
Western regions generally demonstrate relatively comparable levels of
spawning biomass. By contrast, western regions (BS and AI) along with
the CGOA appear to exhibit the highest recruitment levels.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get recruitment time-series</span></span>
<span><span class="va">rec_series</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rec_series</span><span class="op">$</span><span class="va">Par</span> <span class="op">&lt;-</span> <span class="st">"Recruitment"</span></span>
<span></span>
<span><span class="co"># Get SSB time-series</span></span>
<span><span class="va">ssb_series</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ssb_series</span><span class="op">$</span><span class="va">Par</span> <span class="op">&lt;-</span> <span class="st">"Spawning Biomass"</span></span>
<span></span>
<span><span class="va">ts_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ssb_series</span>,<span class="va">rec_series</span><span class="op">)</span> <span class="co"># bind together</span></span>
<span></span>
<span><span class="co"># Do some data munging here</span></span>
<span><span class="va">ts_df</span> <span class="op">&lt;-</span> <span class="va">ts_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">Var1</span>, Year <span class="op">=</span> <span class="va">Var2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">'BS'</span>,</span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">'AI'</span>,</span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">'WGOA'</span>,</span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">~</span> <span class="st">'CGOA'</span>,</span>
<span>    <span class="va">Region</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">'EGOA'</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Region</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BS"</span>, <span class="st">"AI"</span>, <span class="st">"WGOA"</span>, <span class="st">"CGOA"</span>, <span class="st">"EGOA"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Year <span class="op">=</span> <span class="va">Year</span> <span class="op">+</span> <span class="fl">1959</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot!</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">Par</span><span class="op">~</span><span class="va">Region</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/colorblind.html" class="external-link">scale_color_colorblind</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="g_spatial_sablefish_case_study_files/figure-html/unnamed-chunk-3-1.png" width="1152"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matthew Cheng.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
