<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Setting up a Single Region Model (Alaska Sablefish) • SPoCK</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Setting up a Single Region Model (Alaska Sablefish)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SPoCK</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a_model_dimensions.html">Description of Model and Data Dimensions</a></li>
    <li><a class="dropdown-item" href="../articles/b_model_parameters.html">Description of Model Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/c_model_equations.html">Description of Model Equations</a></li>
    <li><a class="dropdown-item" href="../articles/d_model_report.html">Description of Model Report</a></li>
    <li><a class="dropdown-item" href="../articles/e_single_region_sablefish_case_study.html">Setting up a Single Region Model (Alaska Sablefish)</a></li>
    <li><a class="dropdown-item" href="../articles/f_single_region_bsai_pollock_case_study.html">Setting up a Single Region Model (BSAI Pollock)</a></li>
    <li><a class="dropdown-item" href="../articles/g_spatial_sablefish_case_study.html">Setting up a Spatial Model (Alaska Sablefish)</a></li>
    <li><a class="dropdown-item" href="../articles/h_closed_loop_simulations.html">Run Closed Loop Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/i_reference_points.html">Deriving Reference Points, Catch Advice, and Projections</a></li>
    <li><a class="dropdown-item" href="../articles/j_starting_mapping.html">Starting Values and Fixing (and Sharing) Parameters</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Setting up a Single Region Model (Alaska Sablefish)</h1>
            
      

      <div class="d-none name"><code>e_single_region_sablefish_case_study.Rmd</code></div>
    </div>

    
    
<p>The <code>SPoCK</code> package utilizes several helper functions to
facilitate the set up of an age-structured assessment model. In this
vignette, we will demonstrate how these helper functions might be used
to set up a single-region model for Alaska sablefish. The vignette sets
up the model following the parameterization of the 2024 federal Alaska
sablefish stock assessment and compares model outputs from
<code>SPoCK</code> to the existing ADMB model. The 2024 federal Alaska
sablefish stock assessment is assessed on an Alaska-wide scale (from the
Bering Sea to Eastern Gulf of Alaska) as a panmictic single-region
model, with 2 sexes (females and males), 2 fishery fleets (fixed-gear
and trawl), and 3 survey fleets (domestic longline, Japanese longline,
and a domestic trawl survey).</p>
<p>First, let us load in any necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://chengmatt.github.io/SPoCK">SPoCK</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/RTMB" class="external-link">RTMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sgl_rg_sable_data"</span><span class="op">)</span> <span class="co"># load in data</span></span></code></pre></div>
<div class="section level2">
<h2 id="setup-model-dimensions">Setup Model Dimensions<a class="anchor" aria-label="anchor" href="#setup-model-dimensions"></a>
</h2>
<p>To initially set the model up, an input list containing a data list,
parameter list, and a mapping list needs to be constructed. This is
aided with the function <code>Setup_Mod_Dim</code>, where users specify
a vector of years, ages, and lengths. Additionally, users need to
specify the number of regions modelled (n_regions), number of sexes
modelled (n_sexes), number of fishery fleets (n_fish_fleets), and number
of survey fleets (n_srv_fleets)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Dim.html">Setup_Mod_Dim</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, <span class="co"># vector of years </span></span>
<span>                            <span class="co"># (corresponds to year 1960 - 2024)</span></span>
<span>                            ages <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ages</span><span class="op">)</span>, <span class="co"># vector of ages</span></span>
<span>                            lens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">41</span>,<span class="fl">99</span>,<span class="fl">2</span><span class="op">)</span>, <span class="co"># number of lengths</span></span>
<span>                            n_regions <span class="op">=</span> <span class="fl">1</span>, <span class="co"># number of regions</span></span>
<span>                            n_sexes <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_sexes</span>, <span class="co"># number of sexes == 1,</span></span>
<span>                            <span class="co"># female, == 2 male</span></span>
<span>                            n_fish_fleets <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_fish_fleets</span>, <span class="co"># number of fishery</span></span>
<span>                            <span class="co"># fleet == 1, fixed gear, == 2 trawl gear</span></span>
<span>                            n_srv_fleets <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">n_srv_fleets</span>, <span class="co"># number of survey fleets</span></span>
<span>                            verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-recruitment-dynamics">Setup Recruitment Dynamics<a class="anchor" aria-label="anchor" href="#setup-recruitment-dynamics"></a>
</h2>
<p>Following the initialization of <code>input_list</code>, we can pass
the created object into the next function (<code>Setup_Mod_Rec</code>)
to parameterize recruitment dynamics. In the case of Alaska sablefish,
recruitment is parameterized as such:</p>
<ol style="list-style-type: decimal">
<li>Mean Recruitment, with no stock recruitment relationship
assumed,</li>
<li>A recruitment bias ramp is used, following the methods of Methot and
Taylor 2011 (<code>do_bias_ramp = 1</code>),</li>
<li>Two values for <code>sigmaR</code> are used, the first value
represents an early period <code>sigmaR</code>, which is fixed at 0.4,
while the second value represents a late period <code>sigmaR</code>,
which is freely estimated (although should be fixed).</li>
<li>Recruitment deviations are estimated in a penalized likelihood
framework,</li>
<li>Recruitment deviations are estimated for all years, except for the
terminal year,</li>
<li>Recruitment sex-ratios are fixed at 0.5 for each sex,</li>
<li>Initial age structure is derived by assuming a geometric series
(<code>init_age_strc = 1</code>; the alternative is iterating age
structure to some equilibrium <code>init_age_strc = 0</code>), and</li>
<li>A 10% fraction of the mean fishing mortality rate is assumed for
initalizing the age structure.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Rec.html">Setup_Mod_Rec</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>, <span class="co"># input data list from above</span></span>
<span>                            <span class="co"># Model options</span></span>
<span>                            do_rec_bias_ramp <span class="op">=</span> <span class="fl">1</span>, <span class="co"># do bias ramp </span></span>
<span>                            <span class="co"># (0 == don't do bias ramp, 1 == do bias ramp)</span></span>
<span>                            <span class="co"># breakpoints for bias ramp </span></span>
<span>                            <span class="co"># (1 == no bias ramp - 1960 - 1980, </span></span>
<span>                            <span class="co"># 2 == ascending limb of bias ramp - 1980 - 1990,</span></span>
<span>                            <span class="co"># 3 == full bias correction - 1990 - 2022, == 4 </span></span>
<span>                            <span class="co"># no bias correction - terminal year of </span></span>
<span>                            <span class="co"># recruitment estimate)</span></span>
<span>                            bias_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">1960</span><span class="op">:</span><span class="fl">1979</span><span class="op">)</span>,</span>
<span>                                          <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">1960</span><span class="op">:</span><span class="fl">1989</span><span class="op">)</span>, </span>
<span>                                          <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">1960</span><span class="op">:</span><span class="fl">2023</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>                                          <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">1960</span><span class="op">:</span><span class="fl">2024</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>                            sigmaR_switch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fl">1960</span><span class="op">:</span><span class="fl">1975</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                            <span class="co"># when to switch from early to late sigmaR</span></span>
<span>                            dont_est_recdev_last <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                            <span class="co"># don't estimate last recruitment deviate</span></span>
<span>                            ln_sigmaR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            rec_model <span class="op">=</span> <span class="st">"mean_rec"</span>, <span class="co"># recruitment model</span></span>
<span>                            sigmaR_spec <span class="op">=</span> <span class="st">"fix_early_est_late"</span>, </span>
<span>                            <span class="co"># fix early sigmaR, estiamte late sigmaR</span></span>
<span>                            sexratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                            <span class="co"># recruitment sex ratio</span></span>
<span>                            init_age_strc <span class="op">=</span> <span class="fl">1</span>, <span class="co"># how to derive inital age strc</span></span>
<span>                            init_F_prop <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># fraction of mean F from </span></span>
<span>                            <span class="co"># dominant fleet to apply to initial age strc</span></span>
<span>                            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-biological-dynamics">Setup Biological Dynamics<a class="anchor" aria-label="anchor" href="#setup-biological-dynamics"></a>
</h2>
<p>Passing on the <code>input_list</code> that was updated in the
previous helper function, we can then parameterize the biological
dynamics of the model. The <code>Setup_Mod_Biologicals</code> requires
data inputs for weight-at-age (<code>WAA</code>) and maturity-at-age
(<code>MatAA</code>), both of which are dimensioned by
<code>n_regions</code>, <code>n_years</code>, <code>n_ages</code>,
<code>n_sexes</code>. Optional model inputs include a single
ageing-error matrix <code>AgeingError</code>, dimensioned by
<code>n_ages</code>, <code>n_ages</code>. This can be left as NULL if no
ageing-error matrix is available, and the model will assume an identity
matrix for the ageing-error for age-composition data. Additionally, a
size-age transition matrix can be supplied if length data are being fit
to <code>fit_lengths = 1</code>, which are dimensioned by
<code>n_regions</code>, <code>n_years</code>, <code>n_lens</code>,
<code>n_ages</code>, <code>n_sexes</code>. Because natural mortality is
often poorly estimated, Alaska sablefish utilizes priors for natural
mortality, which can be specifed using the <code>Use_M_prior = 1</code>
argument in conjunction with the <code>M_prior</code> argument. The
<code>M_prior</code> argument expects a vector of length 2, where the
first value represents the mean prior value and the second value
represents the standard deviation of the prior (lognormal). The
<code>M_spec</code> argument specifies how natural mortality should be
estimated, where several options are included. In this case, we are
estimating the log natural mortality for females, and fixing the natural
mortlaity offset parameter for males (accidentally jittered in the
original assessment). Starting values and fixed parameters can be
specified using the <code>...</code>, where the parameter name is
supplied, and the values provided to the parameter name represent the
starting value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Biologicals.html">Setup_Mod_Biologicals</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                    </span>
<span>                                    <span class="co"># Data inputs</span></span>
<span>                                    WAA <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">WAA</span>, </span>
<span>                                    <span class="co"># weight-at-age</span></span>
<span>                                    MatAA <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">MatAA</span>, </span>
<span>                                    <span class="co"># maturity at age</span></span>
<span>                                    AgeingError <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">age_error</span><span class="op">)</span>,</span>
<span>                                    <span class="co"># ageing error</span></span>
<span>                                    SizeAgeTrans <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">SizeAgeTrans</span>, </span>
<span>                                    <span class="co"># size age transition matrix</span></span>
<span>                                    </span>
<span>                                    <span class="co"># Model options</span></span>
<span>                                    fit_lengths <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                    <span class="co"># fitting length compositions</span></span>
<span>                                    Use_M_prior <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                    <span class="co"># use natural mortality prior</span></span>
<span>                                    M_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                                    <span class="co"># mean and sd for M prior</span></span>
<span>                                    M_spec <span class="op">=</span> <span class="st">"est_ln_M_only"</span>,</span>
<span>                                    ln_M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1143034</span><span class="op">)</span>, <span class="co"># starting value for M</span></span>
<span>                                    M_offset <span class="op">=</span> <span class="op">-</span><span class="fl">0.00819813327864</span> </span>
<span>                                    <span class="co"># starting value / </span></span>
<span>                                    <span class="co"># fixing Male M offset (accidently jittered </span></span>
<span>                                    <span class="co"># from original assessment)</span></span>
<span>                                    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-movement-and-tagging-dynamics">Setup Movement and Tagging Dynamics<a class="anchor" aria-label="anchor" href="#setup-movement-and-tagging-dynamics"></a>
</h2>
<p>Given that the Alaska sablefish assessment is a single region model,
no movement dynamics are specified. However, users will still need to
define how movement dynamics are parameterized. In this case, the
following code chunk specifies that movement is not estimated
(<code>use_fixed_movement = 1</code>), movement is an identity matrix
(<code>Fixed_Movement = NA</code>), and recruits do not move
(<code>do_recruits_move = 0</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Movement.html">Setup_Mod_Movement</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                 use_fixed_movement <span class="op">=</span> <span class="fl">1</span>, <span class="co"># don't est move</span></span>
<span>                                 Fixed_Movement <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># use identity move</span></span>
<span>                                 do_recruits_move <span class="op">=</span> <span class="fl">0</span> <span class="co"># recruits don't move</span></span>
<span>                                 <span class="op">)</span></span></code></pre></div>
<p>Specification of tagging dynamics will follow a similar fashion since
this is a single-region model. All that is necessary is updating the
<code>input_list</code> and setting the <code>UseTagging</code> argument
to a value of 0.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Tagging.html">Setup_Mod_Tagging</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                UseTagging <span class="op">=</span> <span class="fl">0</span></span>
<span>                                <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-catch-and-fishing-mortality">Setup Catch and Fishing Mortality<a class="anchor" aria-label="anchor" href="#setup-catch-and-fishing-mortality"></a>
</h2>
<p>Following the parameterization of biological dynamics, fishery
dynamics can then be specified and set up using the
<code>Setup_Mod_Catch_and_F</code> function. Again, the input_list that
gets updated from previous helper functions. Users will need to supply
the function with an array of observed catches <code>ObsCatch</code>,
which are dimensioned as <code>n_regions</code>, <code>n_years</code>,
and <code>n_fish_fleets</code>. Similarly, users will also need to
specify the catch type of these observations with the
<code>Catch_Type</code> argument. This argument expects a matrix
dimensioned by <code>n_years</code> and <code>n_fish_fleets</code>, and
is really only applicable in a spatial model (values of 0 indicate that
catch is aggregated across regions in some periods and fleets, while
values of 1 indicate catch is specific to each region in all periods and
fleets). Thus, in a single region model, values of <code>1</code> should
always be supplied. The function also expects the <code>UseCatch</code>
argument to be specified, which is dimensioned as
<code>n_regions</code>, <code>n_years</code>, and
<code>n_fish_fleets</code>. Essentially, users will need to fill out
whether catch is fit to for those particular partitions. Most use cases
of this argument are scenarios in which catch is observed to be a value
of 0, where the helper function automatically turns off the estimation
of fishing mortality deviations for those partitions. Additional model
options specified for this case study include: 1) whether fishing
mortality penalties are utilized to help estimate deviations
<code>Use_F_pen = 1</code>, to fix the standard deviation for catches
(<code>sigmaC_spec = 'fix'</code>), and any constants to add to catch
<code>Catch_Constant = c(0.01, 0.8)</code>, which has a length of
<code>n_fish_fleets</code>. Ideally, the <code>Catch_Constant</code>
argument is not needed, since it is not necessary to fit to catch values
of 0. In such cases, users can leave this argument as NULL, and the
function will automatically populate this with
<code>Catch_Constant &lt;- rep(0, input_list$data$n_fish_fleets)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Catch_and_F.html">Setup_Mod_Catch_and_F</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                    <span class="co"># Data inputs</span></span>
<span>                                    ObsCatch <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsCatch</span>,</span>
<span>                                    Catch_Type <span class="op">=</span> </span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, </span>
<span>                                                       <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    UseCatch <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseCatch</span>,</span>
<span>                                    <span class="co"># Model options</span></span>
<span>                                    Use_F_pen <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                    <span class="co"># whether to use f penalty, == 0 don't use, == 1 use</span></span>
<span>                                    sigmaC_spec <span class="op">=</span> <span class="st">'fix'</span>,</span>
<span>                                    Catch_Constant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span>                                    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-index-and-composition-data-fishery-and-survey">Setup Index and Composition Data (Fishery and Survey)<a class="anchor" aria-label="anchor" href="#setup-index-and-composition-data-fishery-and-survey"></a>
</h2>
<p>Some of the more involved helper functions used to set up the single
region model are the <code>Setup_Mod_FishIdx_and_Comps</code>,
<code>Setup_Mod_SrvIdx_and_Comps</code>,
<code>Setup_Mod_Fishsel_and_Q</code>, and
<code>Setup_Mod_Srvsel_and_Q</code> functions. These helper functions
essentially facilitate the parameterization of selectivity and
catchability for both the fishery and survey, compositional likelihood
types, how composition data are structured, and the types of indices
used (biomass vs. abundance). The fishery and survey helper functions
described in the following sections are essentially equivalent with
respect to data arguments and inputs that are expected, but are
specified independently for fisheries and surveys.</p>
<p>To set up fishery indices and composition data, users will need to
supply arrays of observed fishery indices and their associated standard
errors (<code>ObsFishIdx</code> and <code>ObsFishIdx_SE</code>), which
are dimensioned by by <code>n_regions</code>, <code>n_years</code>,
<code>n_fish_fleets</code>. If fleets do not have data, this can be
input as <code>NA</code> and the <code>UseFishIdx</code> argument (also
dimensioned by <code>n_regions</code>, <code>n_years</code>,
<code>n_fish_fleets</code>) can be used to ensure that these data are
not fit to. Similarly, users will need to supply both fishery age
composition data and length composition data. Both
<code>ObsFishAgeComps</code> and <code>ObsFishLenComps</code> are
dimensioned by <code>n_regions</code>, <code>n_years</code>,
<code>n_bins (n_ages | n_lens)</code>, <code>n_sexes</code>,
<code>n_fish_fleets</code>. Data inputs are also required to denote
whether composition data are used or available for thos regions, years,
and fleets. This can be specified using both
<code>UseFishAgeComps</code> and <code>UseFishLenComps</code>, which
expects values of 0 (don’t fit) or 1 (fit), and are dimensioned by
<code>n_regions</code>, <code>n_years</code>, and
<code>n_fish_fleets</code>. Users can optionally supply
<code>ISS_FishAgeComps</code> and <code>ISS_FishLenComps</code> data
inputs which specify the input sample size for these composition data,
and are dimensioned by <code>n_regions</code>, <code>n_years</code>,
<code>n_sexes</code>, and <code>n_fish_fleets</code>. If this is not
specified (i.e., left NULL), the helper function will automatically sum
up the <code>ObsFishAgeComps</code> and <code>ObsFishLenComps</code> by
their partitions and use the those sums as the input sample size. Thus,
if observed composition data are input as proportions, the model will
potentially incorrectly assume an input sample size of 1 for these
data.</p>
<p>For Alaska sablefish, fishery indices are currently utilized for the
fixed-gear fleet (dominant fleet), which are biomass based, while the
trawl fleet does not fit to fishery indices. This can be specified using
the <code>fish_idx_type</code> argument, where <code>biom</code>
represents biomass indices, and <code>none</code> indicates not fishery
indices are available. Multinomial likelihoods are also assumed for
fishery ages, which are specified with
<code>FishAgeComps_LikeType</code>. However, only the fixed-gear fleet
has fishery age compositions available. Thus, the
<code>FishAgeComps_LikeType</code> is specified as
<code>c("Multinomial", "none")</code>. Fishery length compositions
<code>FishLenComps_LikeType</code> are available for both fleets and are
specified as Multinomial. Currently, Alaska sablefish is a
sex-structured model but age-compositions are not sex-specific. This is
specified using
<code>FishAgeComps_Type = c("agg_Year_1-terminal_Fleet_1", "none_Year_1-terminal_Fleet_2")</code>,
which indicates to the model that these data should be fit to as
aggregated across sexes for all years and for fleet 1 (fixed-gear)
(i.e., the Multinomial expected proportions are summed across sexes).
The <code>none_Year_1-terminal_Fleet_2</code> character indicates to not
do anything with the age compositions for the trawl fishery, since these
are not availiable. For fishery length compositions, these are specified
as
<code>FishLenComps_Type = c("spltRspltS_Year_1-terminal_Fleet_1", "spltRspltS_Year_1-terminal_Fleet_2")</code>
because both fleets have length composition data that are sex-specific.
Here, the <code>spltRspltS</code> character indicates to the model that
these data sum to 1 for each sex and each region, and no implicit
sex-ratios can be inferred using these composition data from the model.
Lastly, there are some ADMB aggregation quirks specific to Alaska
sablefish that can be ignored by the user (and will be removed in later
version of the model).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_FishIdx_and_Comps.html">Setup_Mod_FishIdx_and_Comps</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                          <span class="co"># data inputs</span></span>
<span>                                          ObsFishIdx <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishIdx</span>,</span>
<span>                                          ObsFishIdx_SE <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishIdx_SE</span>,</span>
<span>                                          UseFishIdx <span class="op">=</span>  <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseFishIdx</span>,</span>
<span>                                          ObsFishAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishAgeComps</span>,</span>
<span>                                          UseFishAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseFishAgeComps</span>,</span>
<span>                                          ISS_FishAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ISS_FishAgeComps</span>,</span>
<span>                                          ObsFishLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsFishLenComps</span>,</span>
<span>                                          UseFishLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseFishLenComps</span>,</span>
<span>                                          ISS_FishLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ISS_FishLenComps</span>,</span>
<span></span>
<span>                                          <span class="co"># Model options</span></span>
<span>                                          fish_idx_type <span class="op">=</span> </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biom"</span>, <span class="st">"none"</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># biomass indices for fishery fleet 1 and 2</span></span>
<span>                                          FishAgeComps_LikeType <span class="op">=</span> </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"none"</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># age comp likelihoods for fishery fleet 1 and 2</span></span>
<span>                                          FishLenComps_LikeType <span class="op">=</span> </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># length comp likelihoods for fishery fleet 1 and 2</span></span>
<span>                                          FishAgeComps_Type <span class="op">=</span>  </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_Year_1-terminal_Fleet_1"</span>,</span>
<span>                                              <span class="st">"none_Year_1-terminal_Fleet_2"</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># age comp structure for fishery fleet 1 and 2</span></span>
<span>                                          FishLenComps_Type <span class="op">=</span>  </span>
<span>                                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spltRspltS_Year_1-terminal_Fleet_1"</span>,</span>
<span>                                              <span class="st">"spltRspltS_Year_1-terminal_Fleet_2"</span><span class="op">)</span>,  </span>
<span>                                          <span class="co"># length comp structure for fishery fleet 1 and 2</span></span>
<span>                                          FishAge_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="cn">NA</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                          FishLen_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> </span>
<span>                                          <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                          <span class="op">)</span></span></code></pre></div>
<p>The same arguments are expected for survey indices and compositions.
Here, 3 survey fleets are specified, where they are abundance based for
survey fleet 1 and 3, and biomass based for survey fleet 2. Age
compositions are aggregated by sex for survey fleet 1 and 3, and are not
availiable for survey fleet 2, while length compositions are split by
sex for all survey fleets. All compositions for the survey fleets assume
a Mulinomial likelihood.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_SrvIdx_and_Comps.html">Setup_Mod_SrvIdx_and_Comps</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                         <span class="co"># data inputs</span></span>
<span>                                         ObsSrvIdx <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvIdx</span>,</span>
<span>                                         ObsSrvIdx_SE <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvIdx_SE</span>,</span>
<span>                                         UseSrvIdx <span class="op">=</span>  <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvIdx</span>,</span>
<span>                                         ObsSrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvAgeComps</span>,</span>
<span>                                         ISS_SrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ISS_SrvAgeComps</span>,</span>
<span>                                         UseSrvAgeComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvAgeComps</span>,</span>
<span>                                         ObsSrvLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ObsSrvLenComps</span>,</span>
<span>                                         UseSrvLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">UseSrvLenComps</span>,</span>
<span>                                         ISS_SrvLenComps <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">ISS_SrvLenComps</span>,</span>
<span></span>
<span>                                         <span class="co"># Model options</span></span>
<span>                                         srv_idx_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abd"</span>, <span class="st">"biom"</span>, <span class="st">"abd"</span><span class="op">)</span>,</span>
<span>                                         <span class="co"># abundance and biomass for survey fleet 1, 2, and 3</span></span>
<span>                                         SrvAgeComps_LikeType <span class="op">=</span> </span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"none"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>, </span>
<span>                                         <span class="co"># survey age composition likelihood for survey fleet </span></span>
<span>                                         <span class="co"># 1, 2, and 3</span></span>
<span>                                         SrvLenComps_LikeType <span class="op">=</span> </span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span>, <span class="st">"Multinomial"</span><span class="op">)</span>, </span>
<span>                                         <span class="co">#  survey length composition likelihood for survey fleet </span></span>
<span>                                         <span class="co"># 1, 2, and 3</span></span>
<span>                                         SrvAgeComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agg_Year_1-terminal_Fleet_1"</span>,</span>
<span>                                                              <span class="st">"none_Year_1-terminal_Fleet_2"</span>,</span>
<span>                                                              <span class="st">"agg_Year_1-terminal_Fleet_3"</span><span class="op">)</span>, </span>
<span>                                         <span class="co"># survey age comp type</span></span>
<span>                                         SrvLenComps_Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spltRspltS_Year_1-terminal_Fleet_1"</span>,</span>
<span>                                                              <span class="st">"spltRspltS_Year_1-terminal_Fleet_2"</span>,</span>
<span>                                                              <span class="st">"spltRspltS_Year_1-terminal_Fleet_3"</span><span class="op">)</span>, </span>
<span>                                         <span class="co"># survey length comp type</span></span>
<span>                                         SrvAge_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="cn">NA</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>                                         <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span>                                         SrvLen_comp_agg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span></span>
<span>                                         <span class="co"># ADMB aggregation quirks, ideally get rid of this</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-selectivity-and-catchability-fishery-and-survey">Setup Selectivity and Catchability (Fishery and Survey)<a class="anchor" aria-label="anchor" href="#setup-selectivity-and-catchability-fishery-and-survey"></a>
</h2>
<p>Specifying fishery/survey selectivity and catchability options (the
function arguments are the same for both the fishery and survey) can be
a bit involved as well. In <code>SPoCK</code>, there are several
selectivity options, which include:</p>
<ol style="list-style-type: decimal">
<li>Whether we have continuous time-varying selectivity processes
(<code>cont_tv_fish_sel</code> or <code>cont_tv_srv_sel</code>). For
sablefish, continuous time-varying selectivity is not used and is
specified as <code>none_Fleet_x</code>,</li>
<li>Whether we have selectivity blocks (<code>fish_sel_blocks</code> or
<code>srv_sel_blocks</code>). Sablefish assumes 3 time-blocks for the
fixed-gear fleet and time-invariant selectivity for the trawl fishery.
In general, time-blocks can be specified as
<code>Block_v_Year_x-y_Fleet_z</code>, where <code>Block_v</code>
represents the block number, <code>Year_x-y</code> represents the year
range (<code>x-y</code>) for which the block number applies to, and
<code>Fleet_z</code> represents the fleet to time-block for. If no
time-blocks are specified, this can be left as
<code>none_Fleet_z</code>,</li>
<li>The type of parametric selectivity form to specify for the different
fleets (<code>fish_sel_model</code> or <code>srv_sel_model</code>).
Sablefish assumes <code>logist1</code> for the fixed-gear fleet
(logistic specified as <code>a50</code> and <code>k</code>), and
<code>gamma</code> dome-shaped selectivity for the trawl fleet,</li>
<li>The number of catchability blocks specified
(<code>fish_q_blocks</code> or <code>srv_q_blocks</code>). This is
specified in an identical manner as selectivity blocks (point 2),</li>
<li>How fishery or survey selectivity parameters should be estimated
(<code>fish_fixed_sel_pars</code>). In the case of sablefish, we are
first specifying that all selectivity parameters (by time-blocks and
sexes) should be estimated. However, there are some more nuanced
parameter sharing across sexes and time-blocks that are used for
sablefish to help stabilize the model (last part of this code chunk),
and cannot be easily generalized. Thus, users can manually extract the
<code>map</code> list from the updated <code>input_list</code> object to
modify how parameters should be fixed or shared,</li>
<li>Lastly, how fishery or survey catchability should be estimated
(<code>fish_q_spec</code> or <code>srv_q_spec</code>). For the fishery,
catchability is estimated for all regions (<code>est_all</code>, since
this is a single-region model) for the fixed-gear fleet, and specified
as <code>fix</code> for the trawl fishery (since no indices are
available).</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Fishsel_and_Q.html">Setup_Mod_Fishsel_and_Q</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                      </span>
<span>                                      <span class="co"># Model options</span></span>
<span>                                      cont_tv_fish_sel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                      <span class="co"># fishery selectivity, whether continuous time-varying</span></span>
<span></span>
<span>                                      <span class="co"># fishery selectivity blocks</span></span>
<span>                                      fish_sel_blocks <span class="op">=</span> </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Block_1_Year_1-35_Fleet_1"</span>, </span>
<span>                                          <span class="co"># block 1, fishery ll selex</span></span>
<span>                                          <span class="st">"Block_2_Year_36-56_Fleet_1"</span>, </span>
<span>                                          <span class="co"># block 2 fishery ll selex</span></span>
<span>                                          <span class="st">"Block_3_Year_57-terminal_Fleet_1"</span>,  </span>
<span>                                          <span class="co"># block 3 fishery ll selex</span></span>
<span>                                          <span class="st">"none_Fleet_2"</span><span class="op">)</span>, </span>
<span>                                          <span class="co"># no blocks for trawl fishery</span></span>
<span></span>
<span>                                      <span class="co"># fishery selectivity form</span></span>
<span>                                      fish_sel_model <span class="op">=</span> </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist1_Fleet_1"</span>, </span>
<span>                                          <span class="st">"gamma_Fleet_2"</span><span class="op">)</span>,</span>
<span></span>
<span>                                      <span class="co"># fishery catchability blocks</span></span>
<span>                                      fish_q_blocks <span class="op">=</span> </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Block_1_Year_1-35_Fleet_1"</span>, </span>
<span>                                          <span class="co"># block 1, fishery ll selex</span></span>
<span>                                          <span class="st">"Block_2_Year_36-56_Fleet_1"</span>, </span>
<span>                                          <span class="co"># block 2 fishery ll selex</span></span>
<span>                                          <span class="st">"Block_3_Year_57-terminal_Fleet_1"</span>,  </span>
<span>                                          <span class="co"># block 3 fishery ll selex</span></span>
<span>                                          <span class="st">"none_Fleet_2"</span><span class="op">)</span>,</span>
<span>                                          <span class="co"># no blocks for trawl fishery</span></span>
<span></span>
<span>                                      <span class="co"># whether to estimate all fixed effects </span></span>
<span>                                      <span class="co"># for fishery selectivity and later modify</span></span>
<span>                                      <span class="co"># to fix and share parameters </span></span>
<span>                                      fish_fixed_sel_pars_spec <span class="op">=</span> </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="st">"est_all"</span><span class="op">)</span>,</span>
<span></span>
<span>                                      <span class="co"># whether to estimate all fixed effects </span></span>
<span>                                      <span class="co"># for fishery catchability</span></span>
<span>                                      fish_q_spec <span class="op">=</span> </span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, <span class="st">"fix"</span><span class="op">)</span> </span>
<span>                                      <span class="co"># estimate fishery q for fleet 1, not for fleet 2</span></span>
<span>                                      <span class="op">)</span></span>
<span></span>
<span><span class="co"># additional mapping for fishery selectivity</span></span>
<span><span class="co"># sharing delta across sexes from early domestic fishery (first time block)</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">ln_fish_fixed_sel_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">2</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">11</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">12</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">13</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Again, the same arguments are expected for setting up survey
selectivity, and there are similarly some nuanced parameter fixing and
sharing to help facilitate model stability.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Srvsel_and_Q.html">Setup_Mod_Srvsel_and_Q</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span></span>
<span>                                     <span class="co"># Model options</span></span>
<span>                                     <span class="co"># survey selectivity, whether continuous time-varying</span></span>
<span>                                     cont_tv_srv_sel <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, </span>
<span>                                         <span class="st">"none_Fleet_2"</span>, </span>
<span>                                         <span class="st">"none_Fleet_3"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># survey selectivity blocks</span></span>
<span>                                     srv_sel_blocks <span class="op">=</span> </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Block_1_Year_1-56_Fleet_1"</span>, </span>
<span>                                         <span class="co"># block 1 for domestic ll survey</span></span>
<span>                                         <span class="st">"Block_2_Year_57-terminal_Fleet_1"</span>, </span>
<span>                                         <span class="co"># block 2 for domestic ll survey</span></span>
<span>                                         <span class="st">"none_Fleet_2"</span>,</span>
<span>                                         <span class="st">"none_Fleet_3"</span></span>
<span>                                         <span class="op">)</span>, <span class="co"># no blocks for trawl and jp survey</span></span>
<span></span>
<span>                                     <span class="co"># survey selectivity form</span></span>
<span>                                     srv_sel_model <span class="op">=</span> </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logist1_Fleet_1"</span>,</span>
<span>                                         <span class="st">"exponential_Fleet_2"</span>, </span>
<span>                                         <span class="st">"logist1_Fleet_3"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># survey catchability blocks</span></span>
<span>                                     srv_q_blocks <span class="op">=</span> </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none_Fleet_1"</span>, </span>
<span>                                         <span class="st">"none_Fleet_2"</span>, </span>
<span>                                         <span class="st">"none_Fleet_3"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># whether to estiamte all fixed effects </span></span>
<span>                                     <span class="co"># for survey selectivity and later</span></span>
<span>                                     <span class="co"># modify to fix/share parameters</span></span>
<span>                                     srv_fixed_sel_pars_spec <span class="op">=</span> </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, </span>
<span>                                         <span class="st">"est_all"</span>, </span>
<span>                                         <span class="st">"est_all"</span><span class="op">)</span>,</span>
<span></span>
<span>                                     <span class="co"># whether to estiamte all </span></span>
<span>                                     <span class="co"># fixed effects for survey catchability</span></span>
<span>                                     srv_q_spec <span class="op">=</span> </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est_all"</span>, </span>
<span>                                         <span class="st">"est_all"</span>, </span>
<span>                                         <span class="st">"est_all"</span><span class="op">)</span></span>
<span>                                     <span class="op">)</span></span>
<span></span>
<span><span class="co"># ll survey, share delta female (index 2) across time blocks and to the coop jp ll survey delta</span></span>
<span><span class="co"># ll survey, share delta male (index 5) across time blocks and to the coop jp ll survey delta</span></span>
<span><span class="co"># coop jp survey does not estimate parameters and shares deltas with longline survey</span></span>
<span><span class="co"># single time block with trawl survey and only one parameter hence, </span></span>
<span><span class="co"># only one parameter estimated across blocks (indices 7 and 8)</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">map</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">4</span><span class="op">)</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coop JP Survey (Logistic) Single time block (these estimates are fixed!)</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span><span class="op">[</span><span class="fl">1</span>,,,<span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.980660760456</span>, <span class="fl">0.9295241</span><span class="op">)</span></span>
<span><span class="va">input_list</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">ln_srv_fixed_sel_pars</span><span class="op">[</span><span class="fl">1</span>,,,<span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.22224502478</span>, <span class="fl">0.8821623</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-model-weighting">Setup Model Weighting<a class="anchor" aria-label="anchor" href="#setup-model-weighting"></a>
</h2>
<p>The last helper function that needs to be utilized to setup and run
the model is the <code>Setup_Mod_Weighting</code> function. This
function helps specify how the different data sources are weighted and
whether ADMB (<code>likelihoods = 0</code>) or TMB-style likelihoods are
used (<code>likelihoods = 1</code>). In general, if ADMB-style
likelihoods are used, data sources are weighted with a combination of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
(which weights the entiree data source likelihood, e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>*</mo><mi>C</mi><mi>a</mi><mi>t</mi><mi>c</mi><msub><mi>h</mi><mrow><mi>n</mi><mi>L</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\lambda*Catch_{nLL}</annotation></semantics></math>)
and the specified “observed” standard errors / input sample sizes . In
the context of composition data, these
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
values are determined using Francis reweighting to right-weight these
data. If Francis-reweighting is not used, then values of 1 can be input
for the weights of these data. Moreover, when using ADMB-style
likelihoods, standard errors of indices are expected to be
(i.e.,<code>ObsFishIdx_SE</code> and <code>ObsSrvIdx_SE</code>):
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>2</mn><mo>*</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>S</mi><msub><mi>E</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>f</mi></mrow></msub><mi>/</mi><mi>O</mi><mi>b</mi><mi>s</mi><mi>I</mi><mi>d</mi><msub><mi>x</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>f</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(2 * (SE_{r,y,f}/ ObsIdx_{r,y,f})^2</annotation></semantics></math>.
Fitting to catch data using ADMB-style likelihoods assumes a sum of
squares calculation between observed and predicted catch, following a
large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
value applied to the overall catch data source to ensure that these data
closely fit to.</p>
<p>In the context of TMB-style likelihoods
(<code>likelihoods = 1</code>), data sources should ideally only be
weighted using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
values, and not in conjunction with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
values. Thus, users can leave the arguments <code>Wt_Catch</code>,
<code>Wt_FishIdx</code>, <code>Wt_SrvIdx</code>, <code>Wt_Rec</code>,
and <code>Wt_F</code> blank (NULL), which get automatically filled in as
1. If Francis-reweighting is conducted using TMB-style likelihoods, it
is the same process described above, where users will need to fill in
the weights determined by Francis-reweighitng. If not, users can specify
a value of 1. Thus, in contrast to ADMB-style likelihoods, indices are
weighted as:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>*</mo><mi>S</mi><msub><mi>E</mi><mrow><mi>r</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>f</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><annotation encoding="application/x-tex">(2 * SE_{r,y,f})^2</annotation></semantics></math>.
Moreover, it is not recommended to fit to catch data with a high
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
value when using TMB-style likelihoods (i.e., <code>Wt_Catch</code>
should be set to 1) and users should weight catch data using the
<code>sigmaC_spec</code> and <code>ln_sigmaC</code> arguments in the
<code>Setup_Mod_Catch_and_F</code> function. The single region pollock
vignette demonstrates use of TMB-style likelihoods. Finally,
<code>sablefish_ADMB</code> is specific to Alaska sablefish and
specifies the order of operations for size-age transition matrices, as
well as how indices should be calculated (e.g., using mid-year mortality
vs not). In the following iterations of this package, this option will
most likely be removed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set up data weighting stuff</span></span>
<span><span class="va">Wt_FishAgeComps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>,</span>
<span>                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, </span>
<span>                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># weights for fishery age comps</span></span>
<span><span class="va">Wt_FishAgeComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.826107286513784</span></span>
<span><span class="co"># Weight for fixed gear age comps</span></span>
<span></span>
<span><span class="co"># Fishery length comps</span></span>
<span><span class="va">Wt_FishLenComps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, </span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, </span>
<span>                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, </span>
<span>                                     <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_fish_fleets</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">Wt_FishLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4.1837057381917</span> </span>
<span><span class="co"># Weight for fixed gear len comps females</span></span>
<span><span class="va">Wt_FishLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4.26969350917589</span> </span>
<span><span class="co"># Weight for fixed gear len comps males</span></span>
<span><span class="va">Wt_FishLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.316485920691651</span></span>
<span><span class="co"># Weight for trawl gear len comps females</span></span>
<span><span class="va">Wt_FishLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.229396580680981</span> </span>
<span><span class="co"># Weight for trawl gear len comps males</span></span>
<span></span>
<span><span class="co"># survey age comps</span></span>
<span><span class="va">Wt_SrvAgeComps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, </span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, </span>
<span>                                    <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, </span>
<span>                                    <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># weights for survey age comps</span></span>
<span><span class="va">Wt_SrvAgeComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3.79224544725927</span> </span>
<span><span class="co"># Weight for domestic survey ll gear age comps</span></span>
<span><span class="va">Wt_SrvAgeComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.31681114024037</span></span>
<span><span class="co"># Weight for coop jp survey ll gear age comps</span></span>
<span></span>
<span><span class="co"># Survey length comps</span></span>
<span><span class="va">Wt_SrvLenComps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_regions</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">years</span><span class="op">)</span>, </span>
<span>                                   <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_sexes</span>, </span>
<span>                                   <span class="va">input_list</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">n_srv_fleets</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.43792019016567</span> </span>
<span><span class="co"># Weight for domestic ll survey len comps females</span></span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.07053763450712</span></span>
<span><span class="co"># Weight for domestic ll survey len comps males</span></span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.670883273592302</span> </span>
<span><span class="co"># Weight for domestic trawl survey len comps females</span></span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.465207132450763</span></span>
<span><span class="co"># Weight for domestic trawl survey len comps males</span></span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.27772810174693</span></span>
<span><span class="co"># Weight for coop jp ll survey len comps females</span></span>
<span><span class="va">Wt_SrvLenComps</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.857519546948587</span> </span>
<span><span class="co"># Weight for coop jp ll survey len comps males</span></span>
<span></span>
<span><span class="va">input_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Setup_Mod_Weighting.html">Setup_Mod_Weighting</a></span><span class="op">(</span>input_list <span class="op">=</span> <span class="va">input_list</span>,</span>
<span>                                  sablefish_ADMB <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  likelihoods <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  Wt_Catch <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                  Wt_FishIdx <span class="op">=</span> <span class="fl">0.448</span>,</span>
<span>                                  Wt_SrvIdx <span class="op">=</span> <span class="fl">0.448</span>,</span>
<span>                                  Wt_Rec <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                                  Wt_F <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                  Wt_Tagging <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  Wt_FishAgeComps <span class="op">=</span> <span class="va">Wt_FishAgeComps</span>,</span>
<span>                                  Wt_FishLenComps <span class="op">=</span> <span class="va">Wt_FishLenComps</span>,</span>
<span>                                  Wt_SrvAgeComps <span class="op">=</span> <span class="va">Wt_SrvAgeComps</span>,</span>
<span>                                  Wt_SrvLenComps <span class="op">=</span> <span class="va">Wt_SrvLenComps</span></span>
<span>                                  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-model-and-plot">Fit Model and Plot<a class="anchor" aria-label="anchor" href="#fit-model-and-plot"></a>
</h2>
<p>We are finally done with the setup! Now, we can run our model. This
is aided by the <code>fit_model</code> function, which expects a
<code>data</code>, <code>mapping</code>, and <code>parameters</code>
list and uses the <code>MakeADFUN</code> function internally. These
lists can be extracted from the <code>input_list</code> constructed. If
users want to utilize and integrate random effects out using Laplace
Approximation, they can supply a character vector to the
<code>random</code> argument. For instance, if we wanted to integrate
recruitment deviations out, we would set:
<code>random = c("ln_RecDevs")</code>. The <code>newton_loops</code>
argument indicates whether or not the user wants to take additional
newton steps to ensure that the model has achieved a local minimum, and
uses both the Hessian and gradients to compute this (and thus, serves as
an additional check for model convergence). The report file is extracted
out internally from <code>fit_model</code> and standard errors can then
be extracted using the <code>RTMB::sdreport</code> function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract out lists updated with helper functions</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">mapping</span> <span class="op">&lt;-</span> <span class="va">input_list</span><span class="op">$</span><span class="va">map</span></span>
<span></span>
<span><span class="co"># Fit model</span></span>
<span><span class="va">sabie_rtmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_model.html">fit_model</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                              <span class="va">parameters</span>,</span>
<span>                              <span class="va">mapping</span>,</span>
<span>                              random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              newton_loops <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                              silent <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                              <span class="op">)</span></span>
<span></span>
<span><span class="co"># Get standard error report</span></span>
<span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">sd_rep</span> <span class="op">&lt;-</span> <span class="fu">RTMB</span><span class="fu">::</span><span class="fu">sdreport</span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can compare outputs from ADMB to RTMB. For brevity, we
will only show comparisons of spawning biomass and recruitment between
the two models.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get recruitment time-series</span></span>
<span><span class="va">rec_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Par <span class="op">=</span> <span class="st">"Recruitment"</span>,</span>
<span>                         Year <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">2024</span>,</span>
<span>                         RTMB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">Rec</span><span class="op">)</span>,</span>
<span>                         ADMB <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">admb_recr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get SSB time-series</span></span>
<span><span class="va">ssb_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Par <span class="op">=</span> <span class="st">"SSB"</span>,</span>
<span>                         Year <span class="op">=</span> <span class="fl">1960</span><span class="op">:</span><span class="fl">2024</span>,</span>
<span>                         RTMB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sabie_rtmb_model</span><span class="op">$</span><span class="va">rep</span><span class="op">$</span><span class="va">SSB</span><span class="op">)</span>,</span>
<span>                         ADMB <span class="op">=</span> <span class="va">sgl_rg_sable_data</span><span class="op">$</span><span class="va">admb_spbiom</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ts_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ssb_series</span>,<span class="va">rec_series</span><span class="op">)</span> <span class="co"># bind together</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">RTMB</span> <span class="op">-</span> <span class="va">ADMB</span><span class="op">)</span> <span class="op">/</span> <span class="va">ADMB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Par</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative difference (%)"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">SPoCK</span><span class="fu">::</span><span class="fu"><a href="../reference/theme_sablefish.html">theme_sablefish</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/e_ts_comparison_re.png"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="va">ts_df</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">RTMB</span>, color <span class="op">=</span> <span class="st">'RTMB'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.3</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="va">ts_df</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>, y <span class="op">=</span> <span class="va">ADMB</span>, color <span class="op">=</span> <span class="st">'ADMB'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.3</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Par</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'RTMB'</span> <span class="op">=</span> <span class="st">'black'</span>, <span class="st">'ADMB'</span> <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, color <span class="op">=</span> <span class="st">'Model'</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">SPoCK</span><span class="fu">::</span><span class="fu"><a href="../reference/theme_sablefish.html">theme_sablefish</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/e_ts_comparison.png"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
