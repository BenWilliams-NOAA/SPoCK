[{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"process-models-and-equations","dir":"Articles","previous_headings":"","what":"Process Models and Equations","title":"Description of Model Equations","text":"SPoCK assumes annual time-step, following processes applied order: Recruitment tag releases initially occur (tag releases occur tagging data used), Markovian movement individuals occurs, Total mortality, chronic tag loss (applicable), ageing processes take place, aforementioned processes applied four main population partitions, include region (rr), year (yy), age (aa +a_+, latter indicates plus group), sex (ss). Although SPoCK can accommodate spatial process, equations described vignette can collapse generalized single region (.e., r=1r = 1).","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"recruitment-processes","dir":"Articles","previous_headings":"Process Models and Equations","what":"Recruitment Processes","title":"Description of Model Equations","text":"Recruitment processes occur beginning year can described either mean recruitment Beverton-Holt stock recruitment relationship. Annual recruitment generated mean recruitment relationship governed following equation: Recr,y,s=μRecexp(ϵr,yRec−σRec22by)ψsζr Rec_{r,y,s} = \\mu^{Rec}\\exp\\left(\\epsilon_{r,y}^{Rec}-\\frac{\\sigma^2_{Rec}}{2}b_y\\right)\\psi_s\\zeta_r Recr,y,sRec_{r,y,s} represents recruitment across regions, years, sexes. μRec\\mu^{Rec} represents mean recruitment parameter, ϵr,yRec\\epsilon_{r,y}^{Rec} recruitment deviations constrained normal distribution. byb_y represents values determined recruitment bias correction ramp, ψs\\psi_s recruitment sex ratio, ζr\\zeta_r recruitment apportionment parameters. Recruitment parameterized Beverton-Holt relationship assuming localized density-dependence can expressed : Recr,y,s=4R0ζrhrSSBr,y−RecLag(1−hr)SSB0r+5(hr−1)SSBr,y−RecLagexp(ϵr,yRec−σRec22by)ψs Rec_{r,y,s} = \\frac{4R0\\zeta_rh_rSSB_{r,y-\\text{RecLag}}}{(1-h_r)SSB0_r+5(h_r-1)SSB_{r,y-\\text{RecLag}}}\\exp\\left(\\epsilon_{r,y}^{Rec}-\\frac{\\sigma^2_{Rec}}{2}b_y\\right)\\psi_s R0R0 virgin unfished recruitment, hrh_r steepness parameter representing fraction R0ζrR0\\zeta_r produced 20% SSB0rSSB0_r. steepness parameter constrained values 0.2 1 estimated bounded logit space: hr=0.2+(1−0.2)exp(hr′)1+exp(hr′) h_r = 0.2 + (1 - 0.2) \\frac{\\exp(h^{'}_r)}{1 + \\exp(h^{'}_r)} hr′h^{'}_r steepness parameter bounded logit space. SSB0rSSB0_r represents unfished spawning stock biomass computed spawning biomass per recruit multiplied R0ζrR0\\zeta_r RecLagRecLag represents delay spawning recruits enter population. RecLag>yRecLag > y, model utilizes SSB0rSSB0_r instead SSB(r,y−RecLag)SSB_(r,y-RecLag) compute deterministic recruitment. SSB(r,y)SSB_(r,y) spawning stock biomass, computed : SSBr,y=∑aa+Nr,y,,s=1Wr,y,,s=1Matr,y,,s=1 SSB_{r,y} = \\sum_a^{+} N_{r,y,,s=1}W_{r,y,,s=1}Mat_{r,y,,s=1} Nr,y,,s=1N_{r,y,,s=1} represents numbers age across regions years females (s=1s = 1), Wr,y,,s=1W_{r,y,,s=1} values weight age females, Matr,y,,s=1Mat_{r,y,,s=1} values maturity age. single-sex model, SSBr,ySSB_{r,y} simply computed : SSBr,y=∑aa+Nr,y,,s=1Wr,y,,s=1⋅0.5SSB_{r,y} = \\sum_a^{+} N_{r,y,,s=1}W_{r,y,,s=1} \\cdot 0.5. spatial model, regional recruitment apportionment parameters ζr\\zeta_r derived using multinomial logit transformation. also additional options can specified recruitment processes spatial model. particular, users can also specify whether recruitment occurs globally instead locally. case, Beverton-Holt relatinoship rewritten : Recr,y,s=4R0h∑rSSBr,y−RecLag(1−h)SSB0+5(h−1)∑rSSBr,y−RecLagexp(ϵyRec−σRec22by)ψsζr Rec_{r,y,s} = \\frac{4R0h\\sum_rSSB_{r,y-\\text{RecLag}}}{(1-h)SSB0+5(h-1)\\sum_rSSB_{r,y-\\text{RecLag}}}\\exp\\left(\\epsilon_{y}^{Rec}-\\frac{\\sigma^2_{Rec}}{2}b_y\\right)\\psi_s\\zeta_r SSBSSB summed across regions, recruitment apportionment parameters applied overall deterministic recruitment relationship (opposed R0R0 numerator), recruitment deviations estimated globally.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"population-projection","dir":"Articles","previous_headings":"Process Models and Equations","what":"Population Projection","title":"Description of Model Equations","text":"Following recruitment processes, population can projected forward. Movement processes first occur: 𝐍y,,s=(𝐍y,,s)T𝐌y,,s \\boldsymbol{N}{_{y,,s}} = (\\boldsymbol{N}{_{y,,s}})^T \\boldsymbol{M}{_{y,,s}} 𝐌y,,s\\boldsymbol{M}{_{y,,s}} first-order Markov matrix representing movement. single-region case, movement occurs (.e., 𝐌y,,s\\boldsymbol{M}{_{y,,s}} identity matrix). Movement given year, age, sex combination constrained multinomial logit transformation: Mk,j,y,,s=exp(ωk,j,y,,s)∑k=1Jexp(ωk,j,y,,s),ωj,1,y,,s=0 M_{k,j,y,,s} = \\frac{\\exp(\\omega_{k,j,y,,s})}{\\sum_{k=1}^J\\exp(\\omega_{k,j,y,,s})}, \\omega_{j,1,y,,s} = 0 ωk,j,y,,s\\omega_{k,j,y,,s} movement parameters multinomial logit space. Given movement parameters must sum 1 across rows, nr−1n_r - 1 movement parameters estiamted given year, age, sex combination. population undergoes movement, individuals experience mortality ageing processes following exponential mortality model: Nr,y+1,+1,s=Nr,y,,sexp(−Zr,y,,s),1≤<+Nr,y+1,,s=Nr,y,−1,sexp(−Zr,y,−1,s)+Nr,y,,sexp(−Zr,y,,s),=+ \\begin{aligned} N_{r,y+1,+1,s} = N_{r,y,,s}\\exp(-Z_{r,y,,s}), \\quad \\text{} 1 \\leq < a_+ \\\\ N_{r,y+1,,s} = N_{r,y,-1,s}\\exp(-Z_{r,y,-1,s}) + N_{r,y,,s}\\exp(-Z_{r,y,,s}), \\quad \\text{} = a_+ \\end{aligned} , Zr,y,,sZ_{r,y,,s} denotes total instantaneous mortality: Zr,y,,s=Natmortr,y,,s+∑fFmortr,y,fSelr,y,,s,fFsh Z_{r,y,,s} = Natmort_{r,y,,s} + \\sum_{f} Fmort_{r,y,f} Sel_{r,y,,s,f}^{Fsh} Natmortr,y,,sNatmort_{r,y,,s} instantaneous natural mortality rate, Fmortr,y,fFmort_{r,y,f} annual instantaneous fishing mortality rate fishery fleet ff, Selr,y,,s,fFshSel_{r,y,,s,f}^{Fsh}represents fishery selectivity processes. Fmortr,y,fFmort_{r,y,f} determined : Fmortr,y,f=μr,fFmort⋅exp(ϵr,y,fFishMort) Fmort_{r,y,f} = \\mu^{Fmort}_{r,f} \\cdot exp(\\epsilon_{r,y,f}^{FishMort}) μr,fFmort\\mu^{Fmort}_{r,f} mean fishing mortality parameters given region fleet, ϵr,y,fFishMort\\epsilon_{r,y,f}^{FishMort} deviations mean, constrained normal distribution.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"population-initialization","dir":"Articles","previous_headings":"Process Models and Equations","what":"Population Initialization","title":"Description of Model Equations","text":"Several options available initializing population age structure. first approach, initial population age structure derived iterating population equilibrium: Zr,,sInit=Natmortr,1,,s+Fmort,InitProp⋅μf=1⋅Selr,1,,s,f=1Fsh,<+cumsumZr,,sInit=∑′=1aZr,′,sInit \\begin{aligned} Z_{r,,s}^{\\text{Init}} &= \\text{Natmort}_{r,1,,s} + F_{\\text{mort,InitProp}} \\cdot \\mu_{f=1} \\cdot \\text{Sel}^{\\text{Fsh}}_{r,1,,s,f=1}, \\quad \\text{} < a_+ \\\\ \\text{cumsum}_{Z_{r,,s}^{\\text{Init}}} &= \\sum_{'=1}^{} Z_{r,',s}^{\\text{Init}} \\end{aligned} Zr,,sInitZ_{r,,s}^{Init} initial instantaneous total mortality rate determined sum natural mortality inital fishing mortality rate. initial instantaneous fishing mortality rate user-specified value FmortInitPropFmort_{InitProp}, represents proportion μf=1\\mu_{f=1} apply initial age structure. SPoCK, generally recommended structure associated data inptus fishery fleet 1 represent dominant fishery fleet. cumsumZr,,sInitcumsum_{Z_{r,,s}^{Init}} cumulative sum initial total mortality rate initially applied equilibrium age structure following exponential motality model: Nr,,sInit={R0ψsζr,=1R0exp(−cumsumZr,,sInit)ψsζr,>1 N_{r,,s}^{Init} = \\begin{cases} R0 \\psi_s \\zeta_r, & \\text{} = 1 \\\\ R0 \\exp\\left(-cumsum_{Z_{r,,s}^{Init}}\\right)\\psi_s\\zeta_r, & \\text{} > 1 \\end{cases} mean recruitment dynamics assumed, R0R0 equation can simply replaced μrRec\\mu^{Rec}_{r}. Following determination equilibrium age structure, initial population iterated na⋅5n_a \\cdot 5 times movement first applied, followed mortality ageing processes. general, users might want iterate equilibrium age structure movement processes occur given simple closed form solution derive plus-group population movement occurs. Conversely, users can also specify initial age structure determined geometric series solution: Nr,,sInit={R0exp(−(−1)(Natmortr,1,,s+Fmortinitμf=1Selr,1,,s,f=1Fsh))ψsζr,2≤<+R0exp(−(+−1)(Natmortr,1,,s+FmortInitProp⋅μf=1Selr,1,,s,f=1Fsh))1−exp(−(Natmortr,1,,s+Fmortinitμf=1Selr,1,,s,f=1Fsh))ψsζr,=+ N_{r,,s}^{Init} = \\begin{cases} R0 \\exp\\left(-(-1)(Natmort_{r,1,,s} + Fmort_{init}\\mu_{f=1}Sel^{Fsh}_{r,1,,s,f=1})\\right)\\psi_s\\zeta_r, & \\text{} 2 \\leq < a_+ \\\\ \\frac{R0 \\exp\\left(-(a_+ - 1)(Natmort_{r,1,,s} + Fmort_{InitProp} \\cdot \\mu_{f=1}Sel^{Fsh}_{r,1,,s,f=1})\\right)}{1 - \\exp\\left(-(Natmort_{r,1,,s} + Fmort_{init}\\mu_{f=1}Sel^{Fsh}_{r,1,,s,f=1})\\right)}\\psi_s\\zeta_r, & \\text{} = a_+ \\end{cases} approach generally appropriate movement occur among regions, given closed form solution can easily derived plus-group. Initial age deviations can applied equilibrium age structure: Nr,,sInit=Nr,,sInitexp(ϵr,yInit) N_{r,,s}^{Init} = N_{r,,s}^{Init} \\exp(\\epsilon_{r,y}^{Init}) ϵr,yInit\\epsilon_{r,y}^{Init} initial age deviations constrained normal distribution.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"selforms","dir":"Articles","previous_headings":"Process Models and Equations","what":"Selectivity Processes (Fishery and Survey)","title":"Description of Model Equations","text":"Currently, several options available parameterizing fishery survey selectivity. Two forms logistic selectivity can specified. first form : Sela=11+exp[−k(−a50)] Sel_{} = \\frac{1}{1 + \\exp[-k(- ^{50})]} kk regulates slope/steepness logistic curve a50a^{50} age--50% selection. second logistic form expressed : Sela=11+19(a50−aa95) Sel_{} = \\frac{1}{1 + 19^{\\left(\\frac{^{50} - }{^{95}}\\right)}} , a50a^{50} age--50% selection a95a^{95} age--95% selection. Selectivity can also parameterized gamma dome-shaped function: p=0.5[(,fmax)2+4γs,f2−,fmax]Sela=(aas,fmax)(,fmaxp)e(,fmax−ap) \\begin{aligned} p = 0.5 \\left[ \\sqrt{(a_{s,f}^{\\text{max}})^2 + 4\\gamma_{s,f}^2} - a_{s,f}^{\\text{max}} \\right] \\\\ Sel_{} = \\left( \\frac{}{a_{s,f}^{\\text{max}}} \\right)^{\\left(\\frac{a_{s,f}^{\\text{max}}}{p}\\right)} e^{\\left( \\frac{a_{s,f}^{\\text{max}} - }{p} \\right)} \\end{aligned} pp derived power parameter, γ\\gamma shape parameter describes steepness descending limb, amaxa^{max} estimated parameter describing age--maximum selection. dome-shaped functional availiable power function: Sela=1aϕ Sel_{} = \\frac{1}{^{\\phi}} ϕ\\phi power parameter determining descending limb (larger values steeper) addition various functional forms can specified describe selectivity processes, several parameterizations time-varying processes can specified. simplest form, time-varying selectivity can specified time blocks, new selectivity parameters estimated arbitrary number user-specified periods. Several options also available specifying continuous time-varying selectivity, deviations restricted vary parametrically (.e., deviations applied parameters given selectivity form) semi-parametrically (.e., deviations applied values selectivity form). example, logistic selectivity specified deviations parametric, following expression invoked: Sely,=11+exp[−ky(−ay50)]ky=kexp(ϵy,1Sel)ay50=a50exp(ϵy,2Sel) \\begin{aligned} Sel_{y,} = \\frac{1}{1 + \\exp[-k_{y}(- a_{y}^{50})]} \\\\ k_{y} = k \\exp(\\epsilon_{y,1}^{Sel}) \\\\ a_{y}^{50} = ^{50} \\exp(\\epsilon_{y,2}^{Sel})  \\end{aligned} parameters logistic form allowed vary time. contrast, case semi-parametric deviations logistic selectivity, following expression used: Sely,=11+exp[−k(−a50)]exp(ϵy,aSel)Sely,=Sely,amean(𝐒𝐞𝐥) \\begin{aligned} Sel_{y,} = \\frac{1}{1 + \\exp[-k(- ^{50})]} \\exp(\\epsilon_{y,}^{Sel}) \\\\ Sel_{y,} = \\frac{Sel_{y,}}{mean(\\boldsymbol{Sel})} \\end{aligned} deviations placed parametric form selectivity values log mean standardized aid interpretability. details options available, see selectivity process error section.","code":""},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishery-observation-model","dir":"Articles","previous_headings":"Observation Models and Equations","what":"Fishery Observation Model","title":"Description of Model Equations","text":"fishery observation model describes expected catch--age, catch--length, catch (units biomass), fishery indices. Expected catch--age (Cr,y,,s,faC^a_{r,y,,s,f}) calculated using Baranov’s catch equation: Cr,y,,s,fa=Fmortr,y,fSelr,y,,s,fFshZr,y,,sNr,y,,s[1−exp(−Zr,y,,s)] C^a_{r,y,,s,f} = \\frac{Fmort_{r,y,f}Sel^{Fsh}_{r,y,,s,f}}{Z_{r,y,,s}} N_{r,y,,s} \\left[1-\\exp(-Z_{r,y,,s})\\right] Catch--length (Cr,y,l,s,flC^l_{r,y,l,s,f}) can derived using catch--age (Cr,y,,s,faC^a_{r,y,,s,f}) size-age transition matrix (𝐀r,y,sl\\boldsymbol{}^l_{r,y,s}): Cr,y,l,s,fl=(𝐀r,y,sl)T𝐂𝐚r,y,s,f C^l_{r,y,l,s,f} = (\\boldsymbol{}^l_{r,y,s})^T \\boldsymbol{C^}_{r,y,s,f} 𝐀r,y,sl\\boldsymbol{}^l_{r,y,s} data input derived external assessment model required users fitting length composition data, matrix represents probability length bin, given age. Expected catch (Catchr,y,f\\text{Catch}_{r,y,f}) derived simply taking summation expected catch--age across ages sexes, multiplied respective weights--age: Catchr,y,f=∑aa+∑snsCr,y,,s,faWr,y,,s \\text{Catch}_{r,y,f} = \\sum_a^{a_+} \\sum_s^{n_s} C^a_{r,y,,s,f} W_{r,y,,s} Fishery indices (FshIdxr,y,f\\text{FshIdx}_{r,y,f}) can specified either abundance-based (first equation ) biomass-based (second equation ): FshIdxr,y,f=qr,y,fFsh∑aa+∑snsNr,y,,sexp(−Zr,y,,s0.5)Selr,y,,s,fFshFshIdxr,y,f=qr,y,fFsh∑aa+∑snsNr,y,,sexp(−Zr,y,,s0.5)Selr,y,,s,fFshWr,y,,s \\begin{aligned} \\text{FshIdx}_{r,y,f} = q^{Fsh}_{r,y,f} \\sum_a^{a_+} \\sum_s^{n_s} N_{r,y,,s} \\exp(-Z_{r,y,,s}0.5) Sel_{r,y,,s,f}^{Fsh} \\\\ \\text{FshIdx}_{r,y,f} = q^{Fsh}_{r,y,f} \\sum_a^{a_+} \\sum_s^{n_s} N_{r,y,,s} \\exp(-Z_{r,y,,s}0.5) Sel_{r,y,,s,f}^{Fsh} W_{r,y,,s} \\end{aligned} qr,y,fFshq^{Fsh}_{r,y,f} catchability coefficient given fishery value 0.5 represents fraction year fishery index computed . Currently, fishery catchability coefficients can vary time time blocks.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"survey-observation-model","dir":"Articles","previous_headings":"Observation Models and Equations","what":"Survey Observation Model","title":"Description of Model Equations","text":"survey observation model describes expected survey catch--age, survey catch--length, survey indices. Expected survey catch--age (Ir,y,,s,sfaI^a_{r,y,,s,sf}) calculated using following equation: Ir,y,,s,sfa=Nr,y,,sexp(−Zr,y,,s0.5)Selr,y,,s,sfSrv ^a_{r,y,,s,sf} = N_{r,y,,s} \\exp(-Z_{r,y,,s}0.5) Sel_{r,y,,s,sf}^{Srv} Selr,y,,s,sfSrvSel_{r,y,,s,sf}^{Srv} survey selectivity pattern. Expected survey catch--length (Ir,y,l,s,sflI^l_{r,y,l,s,sf}) can derived : Ir,y,l,s,sfl=(𝐀r,y,sl)T𝐈𝐚r,y,s,f ^l_{r,y,l,s,sf} = (\\boldsymbol{}^l_{r,y,s})^T \\boldsymbol{^}_{r,y,s,f} , survey indices (SrvIdxr,y,sf\\text{SrvIdx}_{r,y,sf}) can computed either abundance-based (first equation ), biomass-based (second equation ): SrvIdxr,y,sf=qr,y,sfSrv∑aa+∑snsIr,y,,s,sfaSrvIdxr,y,sf=qr,y,sfSrv∑aa+∑snsIr,y,,s,sfaWr,y,,s \\begin{aligned} \\text{SrvIdx}_{r,y,sf} = q^{Srv}_{r,y,sf} \\sum_a^{a_+} \\sum_s^{n_s} ^a_{r,y,,s,sf} \\\\  \\text{SrvIdx}_{r,y,sf} = q^{Srv}_{r,y,sf} \\sum_a^{a_+} \\sum_s^{n_s} ^a_{r,y,,s,sf} W_{r,y,,s} \\end{aligned} qr,y,sfSrvq^{Srv}_{r,y,sf} survey catchability coefficient. Currently, survey catchability coefficients can vary time time blocks.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"tagging-observation-model","dir":"Articles","previous_headings":"Observation Models and Equations","what":"Tagging Observation Model","title":"Description of Model Equations","text":"Tag cohorts (Tr,y,,skT^k_{r,y,,s}) dimensioned regions, years, ages, sexes, index kk denotes unique tag cohort (release region release year combination). Tag cohorts tracked user-specific maximum duration (maximum tag liberty; nLn_L), calculations tag cohort longer computed. done help computation time. Additionally, tag cohorts also option undergo fraction mortality year release, given cohort released middle year, mortality processes discounted. mortality discounting specified, movement occur year release. general, process dynamics tagged cohort mimics specified overall population. Immediately following release, tag cohorts decremented initial tag-induced mortality rate: Tr,y,,sk=Tr,y,,skexp(−τ) T^k_{r,y,,s} = T^k_{r,y,,s} \\exp(-\\tau) τ\\tau initial tag-induced mortality rate, can either estimated freely fixed user-specified value. practice, parameter often cofounded mortality processes needs fixed. tagged cohorts released beginning calendar year, Markovian movement occurs (movement occur otherwise): 𝐓y,,sk=(𝐓y,,sk)T𝐌y,,s \\boldsymbol{T}^k_{y,,s} = (\\boldsymbol{T}^k_{y,,s})^T \\boldsymbol{M}_{y,,s} Mortality ageing tagged cohort occurs: Tr,y+1,+1,sk=Tr,y,,skexp(−Zr,y,,sTag),1≤<+Tr,y+1,,sk=Tr,y,−1,skexp(−Zr,y,−1,sTag)+Tr,y,,skexp(−Zr,y,,sTag),=+ \\begin{aligned} T^k_{r,y+1,+1,s} = T^k_{r,y,,s}\\exp(-Z^{Tag}_{r,y,,s}), \\quad \\text{} 1 \\leq < a_+ \\\\ T^k_{r,y+1,,s} =T^k_{r,y,-1,s}\\exp(-Z^{Tag}_{r,y,-1,s}) + T^k_{r,y,,s}\\exp(-Z^{Tag}_{r,y,,s}), \\quad \\text{} = a_+ \\end{aligned} tagged cohorts follow exponential mortality model, accumulation individuals plus-group. Total mortality tagged cohort can specified : Zr,y,,sTag=(κ+NatMortr,y,,sTag+FishMortr,y,,sTag) Z^{Tag}_{r,y,,s} = (\\kappa + NatMort^{Tag}_{r,y,,s} + FishMort^{Tag}_{r,y,,s}) κ\\kappa parameter describing chronic tag loss, can estimated model. However, parameter fixed practice, given confounding mortality processes. Natural mortality tagged individuals can derived several ways: Natural mortality applied tagged cohorts averaged across ages sexes, Natural mortality applied tagged cohorts averaged across sexes, age-specific, Natural mortality applied tagged cohorts averaged across ages, sex-specific, Natural mortality age-sex-specific: NatMortr,y,,sTag=∑∑sNatMortr,y,,snansNatMortr,y,,sTag=∑sNatMortr,y,,snsNatMortr,y,,sTag=∑aNatMortr,y,,snaNatMortr,y,,sTag=NatMortr,y,,s \\begin{aligned} NatMort^{Tag}_{r,y,,s} = \\frac{\\sum_a\\sum_s NatMort_{r,y,,s}}{n_an_s} \\\\ NatMort^{Tag}_{r,y,,s} = \\frac{\\sum_s NatMort_{r,y,,s}}{n_s} \\\\  NatMort^{Tag}_{r,y,,s} = \\frac{\\sum_a NatMort_{r,y,,s}}{n_a} \\\\  NatMort^{Tag}_{r,y,,s} = NatMort_{r,y,,s} \\end{aligned} different calculations natural mortality applied tagged cohorts might used observed tagging data age-sex-specific calculations observed expected values consistent nature tag recapture data (e.g., tagging data age-sex-specific, one might use option 1). Similarly, fishing mortality experienced tagged cohorts can also specified multitude ways: Fishing mortality age sex fleet 1 applied ages sexes uniform selectivity, Fishing mortality age sex fleet 1 multiplied sex-averaged selectivity values, Fishing mortality age sex fleet 1 multiplied sex-specific selectivity values, Fishing mortality age sex derived taking weighted sum annual fishing mortality across fleets sex-averaged selectivity values, Fishing mortality age sex derived taking weighted sum annual fishing mortality across fleets sex-specific selectivity values: FishMortr,y,,sTag=Fmortr,y,f=1FishMortr,y,,sTag=Fmortr,y,f=1⋅∑sSelr,y,,s,f=1FshnsFishMortr,y,,sTag=Fmortr,y,f=1⋅Selr,y,,s,f=1FshFishMortr,y,,sTag=∑fnfFmortr,y,fFishMortr,y,,sTag=∑f=1[Fmortr,y,f⋅∑sSelr,y,,s,fFshns]FishMortr,y,,sTag=∑f=1[Fmortr,y,f⋅Selr,y,,s,fFsh] \\begin{aligned} FishMort^{Tag}_{r,y,,s} = Fmort_{r,y,f=1} \\\\ FishMort^{Tag}_{r,y,,s} = Fmort_{r,y,f=1} \\cdot \\frac{\\sum_s Sel_{r,y,,s,f=1}^{Fsh}}{n_s} \\\\ FishMort^{Tag}_{r,y,,s} = Fmort_{r,y,f=1} \\cdot Sel_{r,y,,s,f=1}^{Fsh} \\\\ FishMort^{Tag}_{r,y,,s} = \\sum_f^{n_f} Fmort_{r,y,f} \\\\ FishMort^{Tag}_{r,y,,s} = \\sum_{f=1} \\left[Fmort_{r,y,f} \\cdot \\frac{\\sum_s Sel_{r,y,,s,f}^{Fsh}}{n_s} \\right] \\\\ FishMort^{Tag}_{r,y,,s} = \\sum_{f=1} \\left[Fmort_{r,y,f} \\cdot Sel_{r,y,,s,f}^{Fsh} \\right]  \\end{aligned} , users might specify different options depending nature observed recapture data. instance, sex-specific information available, one might specify option 2 4 (sex-averaged selectivity values). derive expected number recaptures, modified version Baranov’s catch equation used: Recapr,y,,sk=βr,yFishMortr,y,,sTagZr,y,,sTagTr,y,,sk[1−exp(−Zr,y,,sTag)] \\text{Recap}^k_{r,y,,s} = \\beta_{r,y} \\frac{FishMort^{Tag}_{r,y,,s}}{Z^{Tag}_{r,y,,s}} T^k_{r,y,,s} \\left[1-\\exp(-Z^{Tag}_{r,y,,s})\\right] βr,y\\beta_{r,y} represents tag reporting rate parameter can vary across space time. Currently, time-variation βr,y\\beta_{r,y} can specified time-block. Additionally, βr,y\\beta_{r,y} estimated logit variable: βr,y=exp(βr,y′)1+exp(βr,y′) \\beta_{r,y} = \\frac{\\exp(\\beta^{'}_{r,y})}{1 + \\exp(\\beta^{'}_{r,y})} βr,y′\\beta^{'}_{r,y} represents tag reporting parameter logit space.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"observation-likelihoods","dir":"Articles","previous_headings":"Observation Models and Equations","what":"Observation Likelihoods","title":"Description of Model Equations","text":"Currently, generalized assessment model capability fit variety data sources, include: fishery catches, fishery indices, fishery age compositions, fishery length compositions, survey indices, survey age compositions, survey length compositions, tagging data data sources fit using statistical likelihood, likelihood component summed together compute joint negative log likelihood. Therefore, joint negative log likelihood represents function minimized.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishery-catches","dir":"Articles","previous_headings":"Observation Models and Equations > Observation Likelihoods","what":"Fishery Catches","title":"Description of Model Equations","text":"Fishery catches can fit using lognormal likelihood, given following: L(log(ObsCatchr,y,f))=λObsCatch12πσObsCatchexp(−[log(ObsCatchr,y,f)−log(Catchr,y,f)]22σ2ObsCatch) L(log(\\text{ObsCatch}_{r,y,f})) = \\lambda_{\\text{ObsCatch}} \\frac{1}{\\sqrt{2\\pi} \\sigma^{\\text{ObsCatch}}} \\exp(-\\frac{[log(\\text{ObsCatch}_{r,y,f}) - log(\\text{Catch}_{r,y,f})]^2}{2\\sigma^{2^{\\text{ObsCatch}}}}) ObsCatchr,y,f\\text{ObsCatch}_{r,y,f} represent observed catches σ2ObsCatch\\sigma^{2^{\\text{ObsCatch}}} standard deviation catch. general, σ2ObsCatch\\sigma^{2^{\\text{ObsCatch}}} estimable fixed small value (e.g., 1e-02) catch assumed known. λObsCatch\\lambda_{\\text{ObsCatch}} case represents likelihood weight apply catch data (generally recommended use set 1). case spatially-aggregated catches available period time, model option switch aggregated likelihood defined periods: L(log(ObsCatchy,f))=λObsCatch12πσObsCatchexp(−[log(ObsCatchy,f)−log(∑rCatchr,y,f)]22σ2ObsCatch) L(log(\\text{ObsCatch}_{y,f})) = \\lambda_{\\text{ObsCatch}} \\frac{1}{\\sqrt{2\\pi} \\sigma^{\\text{ObsCatch}}} \\exp(-\\frac{[log(\\text{ObsCatch}_{y,f}) - log(\\sum_r \\text{Catch}_{r,y,f})]^2}{2\\sigma^{2^{\\text{ObsCatch}}}}) lognormal likelihood still assumed, expected catches summed across regions derive spatially-aggregated catch.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishery-and-survey-indices","dir":"Articles","previous_headings":"Observation Models and Equations > Observation Likelihoods","what":"Fishery and Survey Indices","title":"Description of Model Equations","text":"Fishery indices can fit assuming lognormal likelihood: L(log(ObsFshIdxr,y,f))=λObsFshIdx12πσObsFshIdxexp(−[log(ObsFshIdxr,y,f)−log(FshIdxr,y,f)]22σ2ObsFshIdx) L(log(\\text{ObsFshIdx}_{r,y,f})) = \\lambda_{\\text{ObsFshIdx}} \\frac{1}{\\sqrt{2\\pi} \\sigma^{\\text{ObsFshIdx}}} \\exp(-\\frac{[log(\\text{ObsFshIdx}_{r,y,f}) - log(\\text{FshIdx}_{r,y,f})]^2}{2\\sigma^{2^{\\text{ObsFshIdx}}}}) ObsFshIdxr,y,f\\text{ObsFshIdx}_{r,y,f} observed fishery indices σ2ObsFshIdx\\sigma^{2^{\\text{ObsFshIdx}}} describes variance fishery index (can estimated theoretically known). λObsFshIdx\\lambda_{\\text{ObsFshIdx}} represents likelihood weight applied fishery indices (ideally used set value 1 allow model objectively weight data sources using specified variance). Similarly, survey indices fit assuming lognormal likelihod: L(log(ObsSrvIdxr,y,sf))=λObsSrvIdx12πσObsSrvIdxexp(−[log(ObsSrvIdxr,y,sf)−log(SrvIdxr,y,sf)]22σ2ObsSrvIdx) L(log(\\text{ObsSrvIdx}_{r,y,sf})) = \\lambda_{\\text{ObsSrvIdx}} \\frac{1}{\\sqrt{2\\pi} \\sigma^{\\text{ObsSrvIdx}}} \\exp(-\\frac{[log(\\text{ObsSrvIdx}_{r,y,sf}) - log(\\text{SrvIdx}_{r,y,sf})]^2}{2\\sigma^{2^{\\text{ObsSrvIdx}}}}) ObsSrvIdxr,y,sf\\text{ObsSrvIdx}_{r,y,sf} observed survey indices σ2ObsSrvIdx\\sigma^{2^{\\text{ObsSrvIdx}}} describes variance survey index (can estimated theoretically known). λObsSrvIdx\\lambda_{\\text{ObsSrvIdx}} represents likelihood weight applied survey indices (ideally used set value 1 allow model objectively weight data sources using specified variance).","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishery-and-survey-compositions","dir":"Articles","previous_headings":"Observation Models and Equations > Observation Likelihoods","what":"Fishery and Survey Compositions","title":"Description of Model Equations","text":"present, total 3 multivariate likelihoods available use fit composition data. include multinomial, Dirichlet-multinomial, logistic-normal likelihoods. case multinomial likelihood, following expression invoked: L((ObsCompositionDatar,y,f)=λObsCompositionData⋅ISS⋅∏b=1nbEbOb L((\\text{ObsCompositionData}_{r,y,f}) = \\lambda_{\\text{ObsCompositionData}} \\cdot ISS \\cdot \\prod_{b = 1}^{n_b} E_b^{O_b}   ISSISS input sample size determines initial weight apply given composition dataset, λObsCompositionData\\lambda_{\\text{ObsCompositionData}} weight apply input sample size form iterative re-weighting process (e.g., Francis). EbE_b describes expected values given bin bb, ObO_b describes observed values. Dirichlet-multinomial likelihood (linear parameterization) assumed, following expression used: L(ObsCompositionDatar,y,f)=λObsCompositionData⋅Γ(ISS+1)∏bISS⋅Ob+1Γ(θ⋅ISS)Γ(ISS+θ⋅ISS)∏b=1nbΓ(ISS⋅Ob+θ⋅ISS⋅Eb)θ⋅ISS⋅Eb L(\\text{ObsCompositionData}_{r,y,f}) = \\lambda_{\\text{ObsCompositionData}} \\cdot \\frac{\\Gamma(ISS + 1)}{\\prod_b ISS \\cdot O_b + 1} \\frac{\\Gamma(\\theta \\cdot ISS)}{\\Gamma(ISS + \\theta \\cdot ISS)} \\prod_{b = 1}^{n_b} \\frac{\\Gamma(ISS \\cdot O_b + \\theta \\cdot ISS \\cdot E_b)}{\\theta \\cdot ISS \\cdot E_b} θ\\theta represents overdispersion parameter input sample size can adjusted obtain effective sample size (ESSESS): ESS=11+θ+ISSθ1+θ ESS = \\frac{1}{1 + \\theta} + ISS \\frac{\\theta}{1 + \\theta} Thus, θ\\theta large (θ>>ISS\\theta >> ISS), ESS−>ISSESS -> ISS, θ\\theta small (θ<<ISS\\theta << ISS) θ\\theta approximate ratio ESSESS ISSISS. Lastly, logistic-normal likelihood can also invoked, several covariance structures can parameterized. ’s simplest form, iid covariance can specified: 𝚺=𝐈⋅θ2 \\boldsymbol{\\Sigma} = \\boldsymbol{} \\cdot \\theta^2 𝚺\\boldsymbol{\\Sigma} covariance structure scaled θ2\\theta^2 allow overdispersion inter-annual variation weighting. 𝐈\\boldsymbol{} identity matrix dimensioned nb−1⋅nb−1n_b - 1 \\cdot n_b - 1. first-order autoregressive process can also specified across ages: 𝚺=𝐑𝐚⋅θ2 \\boldsymbol{\\Sigma} = \\boldsymbol{R_a} \\cdot \\theta^2 𝐑𝐚\\boldsymbol{R_a} matrix representing first-order autoregressive process. Two-dimensional autoregression can also specified across ages sexes: 𝚺=𝐑𝐚⊗𝐑𝐬⋅θ2 \\boldsymbol{\\Sigma} = \\boldsymbol{R_a} \\otimes \\boldsymbol{R_s} \\cdot \\theta^2 𝐑𝐬\\boldsymbol{R_s} case constant correlation matrix sex. Following specification covariance matrix, logistic transformation conducted observed expected compositions, multivariate normal likelihood invoked logistic random variables: Ob′=log(O−nb)−log(Onb)Eb′=log(E−nb)−log(Enb)L(ObsCompositionDatar,y,f)=λObsCompositionData⋅2π−k/2det(𝚺)−1/2exp[−12(Ob′−Eb′)T𝚺−1(Ob′−Eb′)] \\begin{aligned} O^{'}_b = log(O_{-n_b}) - log(O_{n_b}) \\\\ E^{'}_b = log(E_{-n_b}) - log(E_{n_b}) \\\\ L(\\text{ObsCompositionData}_{r,y,f}) = \\lambda_{\\text{ObsCompositionData}} \\cdot 2\\pi^{-k/2} \\text{det}(\\boldsymbol{\\Sigma})^{-1/2} \\exp\\left[-\\frac{1}{2} (O^{'}_b - E^{'}_b)^T \\boldsymbol{\\Sigma}^{-1}(O^{'}_b - E^{'}_b)\\right] \\end{aligned} Ob′O^{'}_b Eb′E^{'}_b observed expected compositions logistic additive transformation.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"structuring-observed-and-expected-compositions","dir":"Articles","previous_headings":"Observation Models and Equations > Observation Likelihoods > Fishery and Survey Compositions","what":"Structuring Observed and Expected Compositions","title":"Description of Model Equations","text":"Four options can used structuring age length compositions. : Aggregated age length compositions across regions sexes, ‘Split’ age length compositions region sex (.e., implicit information region sex-ratios), ‘Split’ age length compositions region, coupled ‘Joint’ compositions across sexes (.e., implicit information sex-ratios, information regional-ratios), first option (termed ‘Aggregated’), observed expected age length compositions within given year fleet (survey fishery) aggregated across sexes regions. simplicity, observed age length compositions denoted ,b,sO_{r,b,s} expected age length compositions denoted Er,b,sE_{r,b,s}. , bb represents either age length bins. Note observed compositions need aggregated prior modelling process (need normalized, normalized within modeling process). Expected compositions first normalized dividing sum given region /sex proportions sum 1 within given region given sex. Following , average Er,b,sE_{r,b,s} across regions sexes taken. age compositions ageing error associated , expected age compositions multiplied ageing-error matrix derive compositions fit . Note non-square (e.g., rectangular) ageing-error matrix can provided reduce number modelled ages align number observed composition ages. approach common many rockfish species Alaska, model includes greater number ages represented observed compositions. allows accurate representation population dynamics (modelling ages), even though age estimates older fish often unreliable. process described equations : Ob=Ob∑bObEb=1ns⋅nr∑=1ns⋅nrEr,b,s∑bEr,b,s𝐄=𝐄𝐀𝐠𝐞𝐄𝐫𝐫𝐨𝐫𝐎={Ob|b=1,…,nb}𝐄={Eb|b=1,…,nb} \\begin{aligned} O_b = \\frac{O_b}{\\sum_b O_b} \\\\ E_b = \\frac{1}{n_s \\cdot n_r} \\sum_{= 1}^{n_s \\cdot n_r} \\frac{E_{r,b,s}}{\\sum_b E_{r,b,s}} \\\\ \\boldsymbol{E} = \\boldsymbol{E} \\textbf{AgeError} \\\\ \\boldsymbol{O} = \\left\\{ O_b \\;\\middle|\\; b = 1, \\ldots, n_b \\right\\} \\\\ \\boldsymbol{E} = \\left\\{ E_b \\;\\middle|\\; b = 1, \\ldots, n_b \\right\\} \\end{aligned} second option (termed ‘SplitRegionSplitSex’), observed expected compositions given year fleet normalized sum 1 within given sex region. age compositions, ageing-error matrix can applied given region sex. process mathematically described following equation: ,b,s=,b,s∑bOr,b,sEr,b,s=Er,b,s∑bEr,b,s𝐄r,s=𝐄r,s𝐀𝐠𝐞𝐄𝐫𝐫𝐨𝐫𝐎r,s={,b,s|b=1,…,nb}𝐄r,s={Er,b,s|b=1,…,nb} \\begin{aligned} O_{r,b,s} = \\frac{O_{r,b,s}}{\\sum_b O_{r,b,s}} \\\\ E_{r,b,s} = \\frac{E_{r,b,s}}{\\sum_b E_{r,b,s}} \\\\ \\boldsymbol{E}_{r,s} = \\boldsymbol{E}_{r,s} \\textbf{AgeError} \\\\ \\boldsymbol{O}_{r,s} = \\left\\{ O_{r,b,s} \\;\\middle|\\; b = 1, \\ldots, n_b \\right\\} \\\\ \\boldsymbol{E}_{r,s} = \\left\\{ E_{r,b,s} \\;\\middle|\\; b = 1, \\ldots, n_b \\right\\}  \\end{aligned} third option (termed ‘SplitRegionJointSex’), observed expected compositions given year fleet normalized sum 1 within given region, jointly across sexes. age compositions, ageing-error matrix can extended accommodate dimensioned nbns⋅nbnsn_bn_s \\cdot n_bn_s, given following equations: ,b,s=,b,s∑b,sOr,b,sEr,b,s=Er,b,s∑b,sEr,b,s𝐄r=(𝐄r)T(𝐈⊗𝐀𝐠𝐞𝐄𝐫𝐫𝐨𝐫)𝐎r={,b,s|b=1,…,nb;s=1,2}𝐄r={Er,b,s|b=1,…,nb;s=1,2} \\begin{aligned} O_{r,b,s} = \\frac{O_{r,b,s}}{\\sum_{b,s} O_{r,b,s}} \\\\ E_{r,b,s} = \\frac{E_{r,b,s}}{\\sum_{b,s} E_{r,b,s}} \\\\ \\boldsymbol{E}_{r} = (\\boldsymbol{E}_r)^T (\\textbf{} \\otimes \\textbf{AgeError}) \\\\ \\boldsymbol{O}_r = \\left\\{ O_{r,b,s} \\;\\middle|\\; b = 1,\\ldots,n_b;\\; s = 1,2 \\right\\} \\\\ \\boldsymbol{E}_r = \\left\\{ E_{r,b,s} \\;\\middle|\\; b = 1,\\ldots,n_b;\\; s = 1,2 \\right\\}  \\end{aligned}","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"tagging","dir":"Articles","previous_headings":"Observation Models and Equations > Observation Likelihoods","what":"Tagging","title":"Description of Model Equations","text":"generalized assessment model option fit tagging data, tracks tag cohort across regions, ages, sexes. However, many cases, age sex information may available given species. Thus, tagging data include age sex information, user must specify tagged individuals occupy first age class first sex category starting point. Users also specify tagging data fit via pooling across ages sexes using move_age_tag_pool move_sex_tag_pool data inputs scenario information available distinguish age-sex-specific tag recaptures. Given tagging data highly multi-dimensional, use data can greatly increase computational demand model. Therefore, partially reduce demands, model allows pooling data across age sex partitions. process groups observations expected values respective age blocks. recommended age-varying movement estimated age-blocks, pooling tag data align age-blocks. Moreover, important note tag recoveries fit pooling observations expected values, likelihood values alternative pooling parameterizations directly comparable. Additionally, central tenant using tagging data tagged individuals representative overall population individuals need well-mixed. address well-mixed assumption, model allows specification mixing period, specifies time--liberty tags fit . example, individuals well-mixed followed release, mixing period specified value 1. contrast, individuals well-mixed 2 years, mixing period specified value 2. Therefore, model requires entire history given tag cohort input (starting initial release recapture year). Currently, several tag likelihoods can utilized describe tag recapture data. options : 1) Poisson likelihood, 2) Negative Binomial likelihood, 3) Multinomial likelihood, assuming release conditioned dynamics, 4) Multinomial likelihood, assuming recapture conditioned dynamics Poisson likelihood tag recaptures given following expression: L(ObsRecapr,y,,s)=exp(−Recapr,y,,sk)(Recapr,y,,sk)ObsRecapr,y,,sObsRecapr,y,,s! L(\\text{ObsRecap}_{r,y,,s}) = \\frac{\\exp(-\\text{Recap}^k_{r,y,,s})(\\text{Recap}^k_{r,y,,s})^{\\text{ObsRecap}_{r,y,,s}}}{\\text{ObsRecap}_{r,y,,s}!} Recapr,y,,sk\\text{Recap}^k_{r,y,,s} observed tag recaptures. pooling specified, observed recoveries fit summing observed expected tag recoveries across respective age sex groups. model, likelihood specified log space, factorial term denominator specified gamma function, allowing recoveries fit non-integer terms (case age-length key used convert observed lengths ages). negative binomial likelihood tag recaptures given expression: L(ObsRecapr,y,,sk)=Γ(ObsRecapr,y,,s+η)Γ(η)Γ(ObsRecapr,y,,s+1)(Recapr,y,,sRecapr,y,,s+η)ObsRecapr,y,,s(ηRecapr,y,,sk+η)η L(\\text{ObsRecap}^k_{r,y,,s}) = \\frac{\\Gamma(\\text{ObsRecap}_{r,y,,s} + \\eta)}{\\Gamma(\\eta)\\Gamma(\\text{ObsRecap}_{r,y,,s} + 1)} \\left(\\frac{\\text{Recap}_{r,y,,s}}{\\text{Recap}_{r,y,,s} + \\eta}\\right)^{\\text{ObsRecap}_{r,y,,s}} \\left(\\frac{\\eta}{\\text{Recap}_{r,y,,s}^k + \\eta}\\right)^\\eta η\\eta represents overdispersion parameter tagging data. multinomial release conditioned likelihood tag recoveries fits recaptured non-recaptured states. Proportions observed (PObsRecapr,y,,sk\\text{PObsRecap}^k_{r,y,,s}) expected recaptured (PRecapr,y,,sk\\text{PRecap}^k_{r,y,,s}) individuals given : PRecapr,y,,sk=Recapr,y,,skInitTagkPObsRecapr,y,,sk=ObsRecapr,y,,skInitTagK \\begin{aligned} \\text{PRecap}^k_{r,y,,s} = \\frac{\\text{Recap}^k_{r,y,,s}}{\\text{InitTag}^k} \\\\  \\text{PObsRecap}^k_{r,y,,s} = \\frac{\\text{ObsRecap}^k_{r,y,,s}}{\\text{InitTag}^K}  \\end{aligned} InitTagk\\text{InitTag}^k total tags released given tag cohort given release region year. Non-recaptured states can written : PNonRecapk=1−∑r∑y∑∑sPRecapr,y,,skPObsNonRecapk=1−∑r∑y∑∑sPObsNonRecapr,y,,sk \\begin{aligned} \\text{PNonRecap}^k = 1 - \\sum_r \\sum_y \\sum_a \\sum_s \\text{PRecap}^k_{r,y,,s} \\\\  \\text{PObsNonRecap}^k = 1 - \\sum_r \\sum_y \\sum_a \\sum_s \\text{PObsNonRecap}^k_{r,y,,s} \\end{aligned} PNonRecapk\\text{PNonRecap}^k PObsNonRecapk\\text{PObsNonRecap}^k expected observed non-recapture proportions, respectively. Rewriting recaptured non-recaptured states observed expected values gives: 𝐄Taggingk={𝐏𝐑𝐞𝐜𝐚𝐩k,PNonRecapk}𝐎Taggingk={𝐏𝐎𝐛𝐬𝐑𝐞𝐜𝐚𝐩k,PObsNonRecapk} \\begin{aligned} \\boldsymbol{E}^k_{\\text{Tagging}} = \\{\\textbf{PRecap}^k, \\text{PNonRecap}^k \\} \\\\ \\boldsymbol{O}^k_{\\text{Tagging}} = \\{\\textbf{PObsRecap}^k, \\text{PObsNonRecap}^k \\} \\end{aligned} Following , standard multinomial likelihood aforementioned vectors can written : L(ObsRecapr,y,,sk)=InitTagk∏(Ei,Taggingk)Oi,Taggingk L(\\text{ObsRecap}^k_{r,y,,s}) = \\text{InitTag}^k \\prod_i (E^k_{,\\text{Tagging}})^{O^k_{,\\text{Tagging}}} ii indexes given element Ei,TaggingkE^k_{,\\text{Tagging}} Oi,TaggingkO^k_{,\\text{Tagging}}. multinomial recapture conditioned likelihood tag recoveries assumes tag shedding, tag induced mortality, tag reporting rates spatially-invariant, given terms cancel denominator. Thus, terms need specified estimated assuming likelihood. following expression used transform observed expected recaptured individuals proportions: PRecapr,y,,sk=Recapr,y,,sk∑r∑∑sRecapr,y,,skPObsRecapr,y,,sk=ObsRecapr,y,,sk∑r∑∑sObsRecapr,y,,skTotRecapyk=∑r∑∑sObsRecapr,y,,sk \\begin{aligned} \\text{PRecap}^k_{r,y,,s} = \\frac{\\text{Recap}^k_{r,y,,s}}{\\sum_r\\sum_a\\sum_s \\text{Recap}^k_{r,y,,s}} \\\\ \\text{PObsRecap}^k_{r,y,,s} = \\frac{\\text{ObsRecap}^k_{r,y,,s}}{\\sum_r\\sum_a\\sum_s \\text{ObsRecap}^k_{r,y,,s}} \\\\ \\text{TotRecap}_y^k = \\sum_r\\sum_a\\sum_s \\text{ObsRecap}^k_{r,y,,s}  \\end{aligned} recapture probabilities normalized sum recaptures given year TotRecapyk\\text{TotRecap}_y^k total number observed recaptures within given year. multinomial likelihood expressed : L(ObsRecapr,y,,sk)=TotRecapyk∏(PRecapr,y,,sk)PObsRecapr,y,,sk L(\\text{ObsRecap}^k_{r,y,,s}) = \\text{TotRecap}_y^k \\prod_i (\\text{PRecap}^k_{r,y,,s})^{\\text{PObsRecap}^k_{r,y,,s}}","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"priors","dir":"Articles","previous_headings":"Observation Models and Equations","what":"Priors","title":"Description of Model Equations","text":"Several priors available help inform estimation parameters. particular, priors available natural mortality, catchability, steepness, movement, tag reporting rates.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"natural-mortality","dir":"Articles","previous_headings":"Observation Models and Equations > Priors","what":"Natural Mortality","title":"Description of Model Equations","text":"natural mortality, lognormal prior can invoked: P(log(NatMorts=1)=12πσNatMortPriorexp(−[log(NatMorts=1)−log(Natmorts=1Prior)]22σ2NatMortPrior) P(log(NatMort_{s = 1}) = \\frac{1}{\\sqrt{2\\pi} \\sigma^{\\text{NatMortPrior}}} \\exp(-\\frac{[log(NatMort_{s = 1}) - log(Natmort_{s = 1}^{\\text{Prior}})]^2}{2\\sigma^{2^{\\text{NatMortPrior}}}}) lognormal prior invoked first sex (female sex-structured), σ2NatMortPrior\\sigma^{2^{\\text{NatMortPrior}}} represents variance prior, Natmorts=1PriorNatmort_{s = 1}^{\\text{Prior}} represents prior value .","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishery-and-survey-catchability","dir":"Articles","previous_headings":"Observation Models and Equations > Priors","what":"Fishery and Survey Catchability","title":"Description of Model Equations","text":"fishery survey catchability, lognormal prior can similarly used: P(log(qr,y,f))=12πσr,y,fqPriorexp(−[log(qr,y,f)−log(qr,y,fPrior)]22σr,y,f2qPrior) P(log(q_{r,y,f})) = \\frac{1}{\\sqrt{2\\pi} \\sigma_{r,y,f}^{\\text{qPrior}}} \\exp(-\\frac{[log(q_{r,y,f}) - log(q_{r,y,f}^{\\text{Prior}})]^2}{2\\sigma^{2^{\\text{qPrior}}}_{r,y,f}}) σ2qPrior\\sigma^{2^{\\text{qPrior}}} represents variance prior, qr,y,fqPriorq_{r,y,f}^{\\text{qPrior}} represents prior value .","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"steepness","dir":"Articles","previous_headings":"Observation Models and Equations > Priors","what":"Steepness","title":"Description of Model Equations","text":"Beverton-Holt stock recruitment relationship assumed, priors steepness can imposed. Currently, scaled beta prior (bounded 0.2 1) can invoked: =(hrPriorMu−0.21−0.2)(hrPriorSD1−0.2)2b=[1−(hrPriorMu−0.21−0.2)][(hrPriorSD1−0.2)2]P(hr)=Γ()Γ(b)Γ(+b)hra−1(1−hr)b−1 \\begin{aligned} = \\left(\\frac{h^{\\text{PriorMu}}_r - 0.2}{1 - 0.2}\\right) \\left(\\frac{h^{\\text{PriorSD}}_r }{1 - 0.2}\\right)^2 \\\\  b = \\left[1 - \\left(\\frac{h^{\\text{PriorMu}}_r - 0.2}{1 - 0.2}\\right)\\right] \\left[\\left(\\frac{h^{\\text{PriorSD}}_r }{1 - 0.2}\\right)^2\\right] \\\\  P(h_r) = \\frac{\\Gamma()\\Gamma(b)}{\\Gamma(+b)}h^{-1}_r(1-h_r)^{b-1} \\end{aligned} hrPriorMuh^{\\text{PriorMu}}_r represents prior mean steepness value given region (bounded 0.2 1) hrPriorSDh^{\\text{PriorSD}}_r standard deviation priors. aa bb shape parameters beta distribution.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"movement","dir":"Articles","previous_headings":"Observation Models and Equations > Priors","what":"Movement","title":"Description of Model Equations","text":"Priors movement parameters can also invoked, priors imposed rows movement matrix (opposed multinomial logit parameters). Dirichlet prior can invoked: P(Mk,y,,s)=Γ(∑j=1nrαj,y,,s)∏j=1nrΓ(αj,y,,s)∏j=1nrMk,j,y,,sαj,y,,s−1 P(M_{k,y,,s}) = \\frac{\\Gamma(\\sum_{j=1}^{n_r} \\alpha_{j,y,,s})}{\\prod_{j=1}^{n_r}\\Gamma(\\alpha_{j,y,,s})} \\prod_{j=1}^{n_r}M_{k,j,y,,s}^{\\alpha_{j,y,,s}-1} jj indexes movement towards given region αj,y,,s\\alpha_{j,y,,s} Dirichlet prior parameters. priors flexibility specified movement individuals towards region j year, age, sex partition. user specify uniform prior, values αj,y,,s\\alpha_{j,y,,s} values. Increasing values αj,y,,s\\alpha_{j,y,,s} increases concentration (.e., weight prior).","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"tag-reporting-rates","dir":"Articles","previous_headings":"Observation Models and Equations > Priors","what":"Tag Reporting Rates","title":"Description of Model Equations","text":"Two types priors can specified facilitating estimation tag reporting rates. particular, first type prior includes symmetric beta parameterization, given following: P(βr,y)=(βr,y+1e−4)βPriorScale(1−βr,y+1e−4)βPriorScale P(\\beta_{r,y}) = (\\beta_{r,y} + 1e-4)^{\\beta^{\\text{PriorScale}} } (1 - \\beta_{r,y} + 1e-4)^{\\beta^{\\text{PriorScale}}} βPriorScale\\beta^{\\text{PriorScale}} determines scale tag reporting parameter controls strongly penalize estimates approach bounds (0,1)(0,1). Larger values βPriorScale\\beta^{\\text{PriorScale}} result larger penalties. contrast, standard beta distribution can also specified, shape parameters aa bb. given following expression: =βPriorMu(βPriorSD)2b=[1−βPriorMu(βPriorSD)2]P(βr,y)=Γ()Γ(b)Γ(+b)βr,ya−1(1−βr,y)b−1 \\begin{aligned} = \\frac{\\beta^{\\text{PriorMu}}}{\\left(\\beta^{\\text{PriorSD}}\\right)^2} \\\\ b = \\left[\\frac{1 - \\beta^{\\text{PriorMu}}}{\\left(\\beta^{\\text{PriorSD}}\\right)^2}\\right] \\\\ P(\\beta_{r,y}) = \\frac{\\Gamma()\\Gamma(b)}{\\Gamma(+b)} \\, \\beta_{r,y}^{-1} \\left(1 - \\beta_{r,y}\\right)^{b-1} \\end{aligned} βPriorMu\\beta^{\\text{PriorMu}} defines mean distribution, βPriorSD\\beta^{\\text{PriorSD}} defines standard deviation beta distribution. Currently, tag reporting rate priors region year-specific (.e., value applied across regions years).","code":""},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"initpen","dir":"Articles","previous_headings":"Observation Models and Equations > Penalties (Process Error)","what":"Initial Age Deviations","title":"Description of Model Equations","text":"Estimation initial age deviations constrained normal distribution: ϵr,yInit∼N(0,σInit2) \\epsilon_{r,y}^{Init} \\sim N\\left(0,\\sigma^2_{Init}\\right) mean 0 variance σInit2\\sigma^2_{Init}. SPoCK, can either estimated penalized likelihood framework, variance parameter fixed known value ϵr,yInit\\epsilon_{r,y}^{Init} estimated fixed-effects. Conversely, random effects framework can also used ϵr,yInit\\epsilon_{r,y}^{Init} treated random effects integrated using Laplace approximation.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"recruitmentpen","dir":"Articles","previous_headings":"Observation Models and Equations > Penalties (Process Error)","what":"Recruitment","title":"Description of Model Equations","text":"Similarly, estimation recruitment deviations constrained normal distribution: ϵr,yRec∼N(0,σRec2) \\epsilon_{r,y}^{Rec} \\sim N\\left(0,\\sigma^2_{Rec}\\right) mean 0 variance σRec2\\sigma^2_{Rec}. , recruitment deviations can either estimated penalized likelihood framework, variance parameter fixed known value ϵr,yRec\\epsilon_{r,y}^{Rec} estimated fixed-effects. Conversely, ϵr,yRec\\epsilon_{r,y}^{Rec} can also treated random effects integrated using Laplace approximation.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"fishmortpen","dir":"Articles","previous_headings":"Observation Models and Equations > Penalties (Process Error)","what":"Fishing Mortality","title":"Description of Model Equations","text":"Fishing mortality deviations also constrained normal distribution: ϵr,y,fFmort∼N(0,σFmort2) \\epsilon_{r,y,f}^{Fmort} \\sim N\\left(0,\\sigma^2_{Fmort}\\right) σFmort2\\sigma^2_{Fmort} fixed arbitrary value ensure observed catches fit adequately. Given values observed catch generally known negligible error, value specified σFmort2\\sigma^2_{Fmort} inconsequential. generally necessary constrain fishing mortality deviations ensure parameters identifiable.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"selpen","dir":"Articles","previous_headings":"Observation Models and Equations > Penalties (Process Error)","what":"Selectivity (Fishery and Survey)","title":"Description of Model Equations","text":"Several options can specified parameterize continuous time-varying selectivity. forms, users can specify deviations occur penalized likelihood framework, random effects framework. simplest form represents iid deviations selectivity parameter ii given functional form: ϵr,y,,s,fSel∼N(0,σi,Sel2) \\epsilon_{r,y,,s,f}^{Sel} \\sim N\\left(0,\\sigma^2_{,Sel}\\right)  σi,Sel2\\sigma^2_{,Sel} variance selectivity parameter ii (e.g., a50a^{50}). Using form, selectivity assumed vary across time parametric manner. Parametric selectivity deviations can also specified assuming random walk process: ϵr,y,,s,fSel{∼N(0,25),y=1∼N(ϵr,y−1,,s,fSel,σi,Sel2)y>1  \\begin{aligned} \\epsilon_{r,y,,s,f}^{Sel} \\begin{cases} \\sim N\\left(0,25\\right), & \\text{} y = 1 \\\\ \\sim N\\left(\\epsilon_{r,y-1,,s,f}^{Sel},\\sigma^2_{,Sel}\\right) & \\text{} y > 1 \\end{cases} \\end{aligned} first parameter deviation initialized broad distribution (essentially fixed effect parameter), subsequent deviations dependent previous time point, constrained estimable variance given selectivity parameter (σi,Sel2\\sigma^2_{,Sel}). iid random walk deviations, smoothness penalty applied onto selectivity values induce temporal stability: Pyear smoothness=∑s=1S∑y=2Y∑=1A(log(Sely,,s)−log(Sely−1,,s))2 P_{\\text{year smoothness}} = \\sum_{s=1}^S\\sum_{y=2}^{Y} \\sum_{=1}^{} (log(Sel_{y,,s}) - log(Sel_{y-1,,s}))^2 Semi-parametric deviations can also specified, deviations can occur across years, ages, cohorts. semi-parametric deviations, curvature penalty applied selectivity values across ages across years regularity: Page curvature=∑s=1S∑y=1Y∑=2A−1(log(Sely,+1,s)−2log(Sely,,s)−log(Sely,−1,s))2Pyear curvature=∑s=1S∑y=2Y−1∑=1A(log(Sely+1,,s)−2log(Sely,,s)−log(Sely−1,,s))2 \\begin{aligned} P_{\\text{age curvature}} = \\sum_{s=1}^S\\sum_{y=1}^{Y} \\sum_{=2}^{-1} (log(Sel_{y,+1,s}) - 2log(Sel_{y,,s}) - log(Sel_{y,-1,s}))^2 \\\\ P_{\\text{year curvature}} = \\sum_{s=1}^S\\sum_{y=2}^{Y-1} \\sum_{=1}^{} (log(Sel_{y+1,,s}) - 2log(Sel_{y,,s}) - log(Sel_{y-1,,s}))^2 \\\\ \\end{aligned} Two options can specified allow deviations across three dimensions, include marginal stationary conditional non-stationary variance option. primary difference two marginal variance version closed form solution 𝛀\\boldsymbol{\\Omega} (see equations ) needs iteratively solved, conditional variance version closed form solution. following equations describe conditional variance version: 𝛜r,s,fSel∼MVN(0,𝐐) \\boldsymbol{\\epsilon}_{r,s,f}^{Sel} \\sim \\text{MVN}(0,\\textbf{Q}) process error arises multivariate normal distribution precision matrix (QQ; inverse covariance). , QQ constructed : 𝐐=(𝐈−(𝐁)T)𝛀(𝐈−𝐁)diag(𝛀)=σSel−2 \\begin{aligned} \\textbf{Q} = (\\textbf{} - (\\textbf{B})^T) \\boldsymbol{\\Omega} (\\textbf{} - \\textbf{B}) \\\\ \\text{diag}(\\boldsymbol{\\Omega}) = \\sigma_{Sel}^{-2} \\end{aligned} 𝐈\\textbf{} identity matrix 𝛀\\boldsymbol{\\Omega} diagonal matrix determines variance multivariate normal process. 𝐁\\textbf{B} square matrix representing partial effect 𝛜r,s,fSel\\boldsymbol{\\epsilon}_{r,s,f}^{Sel} preceeding ages /years, governing partial correlation coefficients ages, years, cohorts. demonstrate formulation 𝐁\\textbf{B}, simplified example provided rows representing ages aϵ{1,2}\\epsilon \\{1,2\\} columns representing years tϵ{1,2}t \\epsilon \\{1,2\\}. example, 𝐁\\textbf{B} 4x44 x 4 matrix, rows columns represent combinations age year. instance, B1,2B_{1,2} captures correlation within year age 1 year 1, age 2 year 1, whereas B4,1B_{4,1} constructs correlation within cohort age 1 year 1, age 2 year 2: 𝐁=[1000ρy000ρa000ρcρaρy0] \\begin{aligned} \\mathbf{B} = \\begin{bmatrix}  1 & 0 & 0 & 0 \\\\ \\rho_y & 0 & 0 & 0 \\\\ \\rho_a & 0 & 0 & 0 \\\\ \\rho_c & \\rho_a & \\rho_y & 0 \\end{bmatrix} \\end{aligned} , ρy\\rho_y, ρa\\rho_a, ρc\\rho_c parameters describing partial autocorrelation among years within given age, among ages within given year, years within cohort, respectively. Lastly, semi-parametric deviations can also specified vary across years ages (.e., two-dimensional manner). Similar process described , selectivity deviations constrained precision matrix QQ, following multivarite normal process: 𝛜r,s,fSel∼MVN(0,𝐐−1)𝐐−1=σSel2(1−ρy)2(1−ρa)2𝐑y⊗𝐑a \\begin{aligned} \\boldsymbol{\\epsilon}_{r,s,f}^{Sel} \\sim \\text{MVN}(0,\\textbf{Q}^{-1}) \\\\ \\textbf{Q}^{-1} = \\frac{\\sigma^2_{Sel}}{(1-\\rho_y)^2(1-\\rho_a)^2}\\textbf{R}_y \\otimes \\textbf{R}_a \\\\  \\end{aligned} determined Kronecker product first-order autoregressive process across ages 𝐑a\\textbf{R}_a across years 𝐑y\\textbf{R}_y.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/c_model_equations.html","id":"movepen","dir":"Articles","previous_headings":"Observation Models and Equations > Penalties (Process Error)","what":"Movement Deviations","title":"Description of Model Equations","text":"Continuous movement deviations can also estimated random effects penalized likelihood framework. Currently, iid deviations allowed, deviations placed upon fixed-effects movement parameters logit space: ωk,−1,y,,s=ωk,−1,s+ϵk,j,y,,sMoveϵk,−1,y,,sMove∼N(0,σk,,s2) \\begin{aligned} \\omega_{k,-1,y,,s} = \\omega_{k,-1,s} + \\epsilon^{\\text{Move}}_{k,j,y,,s} \\\\ \\epsilon^{\\text{Move}}_{k,-1,y,,s} \\sim N(0,\\sigma^2_{k,,s}) \\end{aligned} ϵk,−1,y,,sMove\\epsilon^{\\text{Move}}_{k,-1,y,,s} movement deviatons logit space. sum 1 constraint, movement deviations estimated nr−1n_r - 1. Deviations arise normal distribution process variation constrained σk,,s2\\sigma^2_{k,,s}. Thus, process variance can distinct origin region age (although parameterizations share parameters across origin region, ages, sexes also allowed). Similarly, process deviations can invoked across years, ages, years ages, years, ages, sexes, etc. flexibility maintained given computational demand estimating random effects movement.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-model-dimensions","dir":"Articles","previous_headings":"","what":"Setup Model Dimensions","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"initially set model , input list containing data list, parameter list, mapping list needs constructed. aided function Setup_Mod_Dim, users specify vector years, ages, lengths. Additionally, users need specify number regions modelled (n_regions), number sexes modelled (n_sexes), number fishery fleets (n_fish_fleets), number survey fleets (n_srv_fleets)","code":"input_list <- Setup_Mod_Dim(years = 1:65, # vector of years                              # (corresponds to year 1960 - 2024)                             ages = 1:30, # vector of ages                             lens = seq(41,99,2), # number of lengths                             n_regions = 1, # number of regions                             n_sexes = 2, # number of sexes == 1,                             # female, == 2 male                             n_fish_fleets = 2, # number of fishery                             # fleet == 1, fixed gear, == 2 trawl gear                             n_srv_fleets = 3, # number of survey fleets                             verbose = FALSE                             )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-recruitment-dynamics","dir":"Articles","previous_headings":"","what":"Setup Recruitment Dynamics","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"Following initialization input_list, can pass created object next function (Setup_Mod_Rec) parameterize recruitment dynamics. case Alaska sablefish, recruitment parameterized : Mean Recruitment, stock recruitment relationship assumed, recruitment bias ramp used, following methods Methot Taylor 2011 (do_bias_ramp = 1), Two values sigmaR used, first value represents early period sigmaR, fixed 0.4, second value represents late period sigmaR, freely estimated (although fixed). Recruitment deviations estimated penalized likelihood framework, Recruitment deviations estimated years, except terminal year, Recruitment sex-ratios fixed 0.5 sex, Initial age structure derived assuming geometric series (init_age_strc = 1; alternative iterating age structure equilibrium init_age_strc = 0), 10% fraction mean fishing mortality rate assumed initalizing age structure.","code":"input_list <- Setup_Mod_Rec(input_list = input_list, # input data list from above                             # Model options                             do_rec_bias_ramp = 1, # do bias ramp                              # (0 == don't do bias ramp, 1 == do bias ramp)                             # breakpoints for bias ramp                              # (1 == no bias ramp - 1960 - 1980,                              # 2 == ascending limb of bias ramp - 1980 - 1990,                             # 3 == full bias correction - 1990 - 2022, == 4                              # no bias correction - terminal year of                              # recruitment estimate)                             bias_year = c(length(1960:1979),                                           length(1960:1989),                                            (length(1960:2023) - 5),                                            length(1960:2024) - 2) + 1,                             sigmaR_switch = as.integer(length(1960:1975)),                              # when to switch from early to late sigmaR                             dont_est_recdev_last = 1,                              # don't estimate last recruitment deviate                             ln_sigmaR = log(c(0.4, 1.2)),                             rec_model = \"mean_rec\", # recruitment model                             sigmaR_spec = \"fix_early_est_late\",                              # fix early sigmaR, estiamte late sigmaR                             sexratio = as.vector(c(0.5, 0.5)),                              # recruitment sex ratio                             init_age_strc = 1, # how to derive inital age strc                             init_F_prop = 0.1 # fraction of mean F from                              # dominant fleet to apply to initial age strc                             )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-biological-dynamics","dir":"Articles","previous_headings":"","what":"Setup Biological Dynamics","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"Passing input_list updated previous helper function, can parameterize biological dynamics model. Setup_Mod_Biologicals requires data inputs weight--age (WAA) maturity--age (MatAA), dimensioned n_regions, n_years, n_ages, n_sexes. Optional model inputs include single ageing-error matrix AgeingError, dimensioned n_ages, n_ages. can left NULL ageing-error matrix available, model assume identity matrix ageing-error age-composition data. Additionally, size-age transition matrix can supplied length data fit fit_lengths = 1, dimensioned n_regions, n_years, n_lens, n_ages, n_sexes. natural mortality often poorly estimated, Alaska sablefish utilizes priors natural mortality, can specifed using Use_M_prior = 1 argument conjunction M_prior argument. M_prior argument expects vector length 2, first value represents mean prior value second value represents standard deviation prior (lognormal). M_spec argument specifies natural mortality estimated, several options included. case, estimating log natural mortality females, fixing natural mortlaity offset parameter males (accidentally jittered original assessment). Starting values fixed parameters can specified using ..., parameter name supplied, values provided parameter name represent starting value.","code":"input_list <- Setup_Mod_Biologicals(input_list = input_list,                                                                          # Data inputs                                     WAA = sgl_rg_sable_data$WAA,                                      # weight-at-age                                     MatAA = sgl_rg_sable_data$MatAA,                                      # maturity at age                                     AgeingError = as.matrix(sgl_rg_sable_data$age_error),                                     # ageing error                                     SizeAgeTrans = sgl_rg_sable_data$SizeAgeTrans,                                      # size age transition matrix                                                                          # Model options                                     fit_lengths = 1,                                      # fitting length compositions                                     Use_M_prior = 1,                                      # use natural mortality prior                                     M_prior = c(0.1, 0.1),                                     # mean and sd for M prior                                     M_spec = \"est_ln_M_only\",                                     ln_M = log(0.1143034), # starting value for M                                     M_offset = -0.00819813327864                                      # starting value /                                      # fixing Male M offset (accidently jittered                                      # from original assessment)                                     )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-movement-and-tagging-dynamics","dir":"Articles","previous_headings":"","what":"Setup Movement and Tagging Dynamics","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"Given Alaska sablefish assessment single region model, movement dynamics specified. However, users still need define movement dynamics parameterized. case, following code chunk specifies movement estimated (use_fixed_movement = 1), movement identity matrix (Fixed_Movement = NA), recruits move (do_recruits_move = 0). Specification tagging dynamics follow similar fashion since single-region model. necessary updating input_list setting UseTagging argument value 0.","code":"input_list <- Setup_Mod_Movement(input_list = input_list,                                  use_fixed_movement = 1, # don't est move                                  Fixed_Movement = NA, # use identity move                                  do_recruits_move = 0 # recruits don't move                                  ) input_list <- Setup_Mod_Tagging(input_list = input_list,                                 UseTagging = 0                                 )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-catch-and-fishing-mortality","dir":"Articles","previous_headings":"","what":"Setup Catch and Fishing Mortality","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"Following parameterization biological dynamics, fishery dynamics can specified set using Setup_Mod_Catch_and_F function. , input_list gets updated previous helper functions. Users need supply function array observed catches ObsCatch, dimensioned n_regions, n_years, n_fish_fleets. Similarly, users also need specify catch type observations Catch_Type argument. argument expects matrix dimensioned n_years n_fish_fleets, really applicable spatial model (values 0 indicate catch aggregated across regions periods fleets, values 1 indicate catch specific region periods fleets). Thus, single region model, values 1 always supplied. function also expects UseCatch argument specified, dimensioned n_regions, n_years, n_fish_fleets. Essentially, users need fill whether catch fit particular partitions. use cases argument scenarios catch observed value 0, helper function automatically turns estimation fishing mortality deviations partitions. Additional model options specified case study include: 1) whether fishing mortality penalties utilized help estimate deviations Use_F_pen = 1, fix standard deviation catches (sigmaC_spec = 'fix'), constants add catch Catch_Constant = c(0.01, 0.8), length n_fish_fleets. Ideally, Catch_Constant argument needed, since necessary fit catch values 0. cases, users can leave argument NULL, function automatically populate Catch_Constant <- rep(0, input_list$data$n_fish_fleets).","code":"input_list <- Setup_Mod_Catch_and_F(input_list = input_list,                                     # Data inputs                                     ObsCatch = sgl_rg_sable_data$ObsCatch,                                     Catch_Type =                                        array(1, dim = c(length(input_list$data$years),                                                         input_list$data$n_fish_fleets)),                                     UseCatch = sgl_rg_sable_data$UseCatch,                                     # Model options                                     Use_F_pen = 1,                                      # whether to use f penalty, == 0 don't use, == 1 use                                     sigmaC_spec = 'fix',                                     Catch_Constant = c(0.01, 0.8)                                     )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-index-and-composition-data-fishery-and-survey","dir":"Articles","previous_headings":"","what":"Setup Index and Composition Data (Fishery and Survey)","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"involved helper functions used set single region model Setup_Mod_FishIdx_and_Comps, Setup_Mod_SrvIdx_and_Comps, Setup_Mod_Fishsel_and_Q, Setup_Mod_Srvsel_and_Q functions. helper functions essentially facilitate parameterization selectivity catchability fishery survey, compositional likelihood types, composition data structured, types indices used (biomass vs. abundance). fishery survey helper functions described following sections essentially equivalent respect data arguments inputs expected, specified independently fisheries surveys. set fishery indices composition data, users need supply arrays observed fishery indices associated standard errors (ObsFishIdx ObsFishIdx_SE), dimensioned n_regions, n_years, n_fish_fleets. fleets data, can input NA UseFishIdx argument (also dimensioned n_regions, n_years, n_fish_fleets) can used ensure data fit . Similarly, users need supply fishery age composition data length composition data. ObsFishAgeComps ObsFishLenComps dimensioned n_regions, n_years, n_bins (n_ages | n_lens), n_sexes, n_fish_fleets. Data inputs also required denote whether composition data used available thos regions, years, fleets. can specified using UseFishAgeComps UseFishLenComps, expects values 0 (don’t fit) 1 (fit), dimensioned n_regions, n_years, n_fish_fleets. Users can optionally supply ISS_FishAgeComps ISS_FishLenComps data inputs specify input sample size composition data, dimensioned n_regions, n_years, n_sexes, n_fish_fleets. specified (.e., left NULL), helper function automatically sum ObsFishAgeComps ObsFishLenComps partitions use sums input sample size. Thus, observed composition data input proportions, model potentially incorrectly assume input sample size 1 data. Alaska sablefish, fishery indices currently utilized fixed-gear fleet (dominant fleet), biomass based, trawl fleet fit fishery indices. can specified using fish_idx_type argument, biom represents biomass indices, none indicates fishery indices available. Multinomial likelihoods also assumed fishery ages, specified FishAgeComps_LikeType. However, fixed-gear fleet fishery age compositions available. Thus, FishAgeComps_LikeType specified c(\"Multinomial\", \"none\"). Fishery length compositions FishLenComps_LikeType available fleets specified Multinomial. Currently, Alaska sablefish sex-structured model age-compositions sex-specific. specified using FishAgeComps_Type = c(\"agg_Year_1-terminal_Fleet_1\", \"none_Year_1-terminal_Fleet_2\"), indicates model data fit aggregated across sexes years fleet 1 (fixed-gear) (.e., Multinomial expected proportions summed across sexes). none_Year_1-terminal_Fleet_2 character indicates anything age compositions trawl fishery, since availiable. fishery length compositions, specified FishLenComps_Type = c(\"spltRspltS_Year_1-terminal_Fleet_1\", \"spltRspltS_Year_1-terminal_Fleet_2\") fleets length composition data sex-specific. , spltRspltS character indicates model data sum 1 sex region, implicit sex-ratios can inferred using composition data model. Lastly, ADMB aggregation quirks specific Alaska sablefish can ignored user (removed later version model). arguments expected survey indices compositions. , 3 survey fleets specified, abundance based survey fleet 1 3, biomass based survey fleet 2. Age compositions aggregated sex survey fleet 1 3, availiable survey fleet 2, length compositions split sex survey fleets. compositions survey fleets assume Mulinomial likelihood.","code":"input_list <- Setup_Mod_FishIdx_and_Comps(input_list = input_list,                                           # data inputs                                           ObsFishIdx = sgl_rg_sable_data$ObsFishIdx,                                           ObsFishIdx_SE = sgl_rg_sable_data$ObsFishIdx_SE,                                           UseFishIdx =  sgl_rg_sable_data$UseFishIdx,                                           ObsFishAgeComps = sgl_rg_sable_data$ObsFishAgeComps,                                           UseFishAgeComps = sgl_rg_sable_data$UseFishAgeComps,                                           ISS_FishAgeComps = sgl_rg_sable_data$ISS_FishAgeComps,                                           ObsFishLenComps = sgl_rg_sable_data$ObsFishLenComps,                                           UseFishLenComps = sgl_rg_sable_data$UseFishLenComps,                                           ISS_FishLenComps = sgl_rg_sable_data$ISS_FishLenComps,                                            # Model options                                           fish_idx_type =                                              c(\"biom\", \"none\"),                                            # biomass indices for fishery fleet 1 and 2                                           FishAgeComps_LikeType =                                              c(\"Multinomial\", \"none\"),                                            # age comp likelihoods for fishery fleet 1 and 2                                           FishLenComps_LikeType =                                              c(\"Multinomial\", \"Multinomial\"),                                            # length comp likelihoods for fishery fleet 1 and 2                                           FishAgeComps_Type =                                               c(\"agg_Year_1-terminal_Fleet_1\",                                               \"none_Year_1-terminal_Fleet_2\"),                                            # age comp structure for fishery fleet 1 and 2                                           FishLenComps_Type =                                               c(\"spltRspltS_Year_1-terminal_Fleet_1\",                                               \"spltRspltS_Year_1-terminal_Fleet_2\"),                                             # length comp structure for fishery fleet 1 and 2                                           FishAge_comp_agg_type = c(0,NA),                                            # ADMB aggregation quirks, ideally get rid of this                                           FishLen_comp_agg_type = c(1,1)                                            # ADMB aggregation quirks, ideally get rid of this                                           ) input_list <- Setup_Mod_SrvIdx_and_Comps(input_list = input_list,                                          # data inputs                                          ObsSrvIdx = sgl_rg_sable_data$ObsSrvIdx,                                          ObsSrvIdx_SE = sgl_rg_sable_data$ObsSrvIdx_SE,                                          UseSrvIdx =  sgl_rg_sable_data$UseSrvIdx,                                          ObsSrvAgeComps = sgl_rg_sable_data$ObsSrvAgeComps,                                          ISS_SrvAgeComps = sgl_rg_sable_data$ISS_SrvAgeComps,                                          UseSrvAgeComps = sgl_rg_sable_data$UseSrvAgeComps,                                          ObsSrvLenComps = sgl_rg_sable_data$ObsSrvLenComps,                                          UseSrvLenComps = sgl_rg_sable_data$UseSrvLenComps,                                          ISS_SrvLenComps = sgl_rg_sable_data$ISS_SrvLenComps,                                           # Model options                                          srv_idx_type = c(\"abd\", \"biom\", \"abd\"),                                          # abundance and biomass for survey fleet 1, 2, and 3                                          SrvAgeComps_LikeType =                                             c(\"Multinomial\", \"none\", \"Multinomial\"),                                           # survey age composition likelihood for survey fleet                                           # 1, 2, and 3                                          SrvLenComps_LikeType =                                             c(\"Multinomial\", \"Multinomial\", \"Multinomial\"),                                           #  survey length composition likelihood for survey fleet                                           # 1, 2, and 3                                          SrvAgeComps_Type = c(\"agg_Year_1-terminal_Fleet_1\",                                                               \"none_Year_1-terminal_Fleet_2\",                                                               \"agg_Year_1-terminal_Fleet_3\"),                                           # survey age comp type                                          SrvLenComps_Type = c(\"spltRspltS_Year_1-terminal_Fleet_1\",                                                               \"spltRspltS_Year_1-terminal_Fleet_2\",                                                               \"spltRspltS_Year_1-terminal_Fleet_3\"),                                           # survey length comp type                                          SrvAge_comp_agg_type = c(1,NA,1),                                           # ADMB aggregation quirks, ideally get rid of this                                          SrvLen_comp_agg_type = c(0,0,0)                                          # ADMB aggregation quirks, ideally get rid of this )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-selectivity-and-catchability-fishery-and-survey","dir":"Articles","previous_headings":"","what":"Setup Selectivity and Catchability (Fishery and Survey)","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"Specifying fishery/survey selectivity catchability options (function arguments fishery survey) can bit involved well. SPoCK, several selectivity options, include: Whether continuous time-varying selectivity processes (cont_tv_fish_sel cont_tv_srv_sel). sablefish, continuous time-varying selectivity used specified none_Fleet_x, Whether selectivity blocks (fish_sel_blocks srv_sel_blocks). Sablefish assumes 3 time-blocks fixed-gear fleet time-invariant selectivity trawl fishery. general, time-blocks can specified Block_v_Year_x-y_Fleet_z, Block_v represents block number, Year_x-y represents year range (x-y) block number applies , Fleet_z represents fleet time-block . time-blocks specified, can left none_Fleet_z, type parametric selectivity form specify different fleets (fish_sel_model srv_sel_model). Sablefish assumes logist1 fixed-gear fleet (logistic specified a50 k), gamma dome-shaped selectivity trawl fleet, number catchability blocks specified (fish_q_blocks srv_q_blocks). specified identical manner selectivity blocks (point 2), fishery survey selectivity parameters estimated (fish_fixed_sel_pars). case sablefish, first specifying selectivity parameters (time-blocks sexes) estimated. However, nuanced parameter sharing across sexes time-blocks used sablefish help stabilize model (last part code chunk), easily generalized. Thus, users can manually extract map list updated input_list object modify parameters fixed shared, Lastly, fishery survey catchability estimated (fish_q_spec srv_q_spec). fishery, catchability estimated regions (est_all, since single-region model) fixed-gear fleet, specified fix trawl fishery (since indices available). , arguments expected setting survey selectivity, similarly nuanced parameter fixing sharing help facilitate model stability.","code":"input_list <- Setup_Mod_Fishsel_and_Q(input_list = input_list,                                                                              # Model options                                       cont_tv_fish_sel = c(\"none_Fleet_1\", \"none_Fleet_2\"),                                       # fishery selectivity, whether continuous time-varying                                        # fishery selectivity blocks                                       fish_sel_blocks =                                          c(\"Block_1_Year_1-35_Fleet_1\",                                            # block 1, fishery ll selex                                           \"Block_2_Year_36-56_Fleet_1\",                                            # block 2 fishery ll selex                                           \"Block_3_Year_57-terminal_Fleet_1\",                                             # block 3 fishery ll selex                                           \"none_Fleet_2\"),                                            # no blocks for trawl fishery                                        # fishery selectivity form                                       fish_sel_model =                                          c(\"logist1_Fleet_1\",                                            \"gamma_Fleet_2\"),                                        # fishery catchability blocks                                       fish_q_blocks =                                          c(\"Block_1_Year_1-35_Fleet_1\",                                            # block 1, fishery ll selex                                           \"Block_2_Year_36-56_Fleet_1\",                                            # block 2 fishery ll selex                                           \"Block_3_Year_57-terminal_Fleet_1\",                                             # block 3 fishery ll selex                                           \"none_Fleet_2\"),                                           # no blocks for trawl fishery                                        # whether to estimate all fixed effects                                        # for fishery selectivity and later modify                                       # to fix and share parameters                                        fish_fixed_sel_pars =                                          c(\"est_all\", \"est_all\"),                                        # whether to estimate all fixed effects                                        # for fishery catchability                                       fish_q_spec =                                          c(\"est_all\", \"fix\")                                        # estimate fishery q for fleet 1, not for fleet 2                                       )  # additional mapping for fishery selectivity # sharing delta across sexes from early domestic fishery (first time block) input_list$map$ln_fish_fixed_sel_pars <- factor(c(1:7, 2, 8:11, rep(12:13,3), rep(c(14,13),3))) input_list <- Setup_Mod_Srvsel_and_Q(input_list = input_list,                                       # Model options                                      # survey selectivity, whether continuous time-varying                                      cont_tv_srv_sel =                                        c(\"none_Fleet_1\",                                           \"none_Fleet_2\",                                           \"none_Fleet_3\"),                                       # survey selectivity blocks                                      srv_sel_blocks =                                         c(\"Block_1_Year_1-56_Fleet_1\",                                           # block 1 for domestic ll survey                                          \"Block_2_Year_57-terminal_Fleet_1\",                                           # block 2 for domestic ll survey                                          \"none_Fleet_2\",                                          \"none_Fleet_3\"                                          ), # no blocks for trawl and jp survey                                       # survey selectivity form                                      srv_sel_model =                                         c(\"logist1_Fleet_1\",                                          \"exponential_Fleet_2\",                                           \"logist1_Fleet_3\"),                                       # survey catchability blocks                                      srv_q_blocks =                                         c(\"none_Fleet_1\",                                           \"none_Fleet_2\",                                           \"none_Fleet_3\"),                                       # whether to estiamte all fixed effects                                       # for survey selectivity and later                                      # modify to fix/share parameters                                      srv_fixed_sel_pars_spec =                                         c(\"est_all\",                                           \"est_all\",                                           \"est_all\"),                                       # whether to estiamte all                                       # fixed effects for survey catchability                                      srv_q_spec =                                         c(\"est_all\",                                           \"est_all\",                                           \"est_all\")                                      )  # ll survey, share delta female (index 2) across time blocks and to the coop jp ll survey delta # ll survey, share delta male (index 5) across time blocks and to the coop jp ll survey delta # coop jp survey does not estimate parameters and shares deltas with longline survey # single time block with trawl survey and only one parameter hence,  # only one parameter estimated across blocks (indices 7 and 8) input_list$map$ln_srv_fixed_sel_pars <-    factor(c(1:3, 2, 4:6, 5,rep(7,4),             rep(8, 4), rep(c(NA,2), 2), rep(c(NA, 5), 2)))  # Coop JP Survey (Logistic) Single time block (these estimates are fixed!) input_list$par$ln_srv_fixed_sel_pars[1,,,1,3] <- c(0.980660760456, 0.9295241) input_list$par$ln_srv_fixed_sel_pars[1,,,2,3] <- c(1.22224502478, 0.8821623)"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"setup-model-weighting","dir":"Articles","previous_headings":"","what":"Setup Model Weighting","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"last helper function needs utilized setup run model Setup_Mod_Weighting function. function helps specify different data sources weighted whether ADMB (likelihoods = 0) TMB-style likelihoods used (likelihoods = 1). general, ADMB-style likelihoods used, data sources weighted combination λ\\lambda (weights entiree data source likelihood, e.g., λ*CatchnLL\\lambda*Catch_{nLL}) specified “observed” standard errors / input sample sizes . context composition data, λ\\lambda values determined using Francis reweighting right-weight data. Francis-reweighting used, values 1 can input weights data. Moreover, using ADMB-style likelihoods, standard errors indices expected (.e.,ObsFishIdx_SE ObsSrvIdx_SE): (2*(SEr,y,f/ObsIdxr,y,f)2(2 * (SE_{r,y,f}/ ObsIdx_{r,y,f})^2. Fitting catch data using ADMB-style likelihoods assumes sum squares calculation observed predicted catch, following large λ\\lambda value applied overall catch data source ensure data closely fit . context TMB-style likelihoods (likelihoods = 1), data sources ideally weighted using σ\\sigma values, conjunction λ\\lambda values. Thus, users can leave arguments Wt_Catch, Wt_FishIdx, Wt_SrvIdx, Wt_Rec, Wt_F blank (NULL), get automatically filled 1. Francis-reweighting conducted using TMB-style likelihoods, process described , users need fill weights determined Francis-reweighitng. , users can specify value 1. Thus, contrast ADMB-style likelihoods, indices weighted : (2*SEr,y,f)2(2 * SE_{r,y,f})^2. Moreover, recommended fit catch data high λ\\lambda value using TMB-style likelihoods (.e., Wt_Catch set 1) users weight catch data using sigmaC_spec ln_sigmaC arguments Setup_Mod_Catch_and_F function. single region pollock vignette demonstrates use TMB-style likelihoods. Finally, sablefish_ADMB specific Alaska sablefish specifies order operations size-age transition matrices, well indices calculated (e.g., using mid-year mortality vs ). following iterations package, option likely removed.","code":"# set up data weighting stuff Wt_FishAgeComps <- array(NA, dim = c(input_list$data$n_regions,                                      length(input_list$data$years),                                      input_list$data$n_sexes,                                       input_list$data$n_fish_fleets))  # weights for fishery age comps Wt_FishAgeComps[1,,1,1] <- 0.826107286513784 # Weight for fixed gear age comps  # Fishery length comps Wt_FishLenComps <- array(NA, dim = c(input_list$data$n_regions,                                       length(input_list$data$years),                                       input_list$data$n_sexes,                                       input_list$data$n_fish_fleets))  Wt_FishLenComps[1,,1,1] <- 4.1837057381917  # Weight for fixed gear len comps females Wt_FishLenComps[1,,2,1] <- 4.26969350917589  # Weight for fixed gear len comps males Wt_FishLenComps[1,,1,2] <- 0.316485920691651 # Weight for trawl gear len comps females Wt_FishLenComps[1,,2,2] <- 0.229396580680981  # Weight for trawl gear len comps males  # survey age comps Wt_SrvAgeComps <- array(NA, dim = c(input_list$data$n_regions,                                      length(input_list$data$years),                                      input_list$data$n_sexes,                                      input_list$data$n_srv_fleets))  # weights for survey age comps Wt_SrvAgeComps[1,,1,1] <- 3.79224544725927  # Weight for domestic survey ll gear age comps Wt_SrvAgeComps[1,,1,3] <- 1.31681114024037 # Weight for coop jp survey ll gear age comps  # Survey length comps Wt_SrvLenComps <- array(0, dim = c(input_list$data$n_regions,                                     length(input_list$data$years),                                     input_list$data$n_sexes,                                     input_list$data$n_srv_fleets))  Wt_SrvLenComps[1,,1,1] <- 1.43792019016567  # Weight for domestic ll survey len comps females Wt_SrvLenComps[1,,2,1] <- 1.07053763450712 # Weight for domestic ll survey len comps males Wt_SrvLenComps[1,,1,2] <- 0.670883273592302  # Weight for domestic trawl survey len comps females Wt_SrvLenComps[1,,2,2] <- 0.465207132450763 # Weight for domestic trawl survey len comps males Wt_SrvLenComps[1,,1,3] <- 1.27772810174693 # Weight for coop jp ll survey len comps females Wt_SrvLenComps[1,,2,3] <- 0.857519546948587  # Weight for coop jp ll survey len comps males  input_list <- Setup_Mod_Weighting(input_list = input_list,                                   sablefish_ADMB = 1,                                   likelihoods = 0,                                   Wt_Catch = 50,                                   Wt_FishIdx = 0.448,                                   Wt_SrvIdx = 0.448,                                   Wt_Rec = 1.5,                                   Wt_F = 0.1,                                   Wt_Tagging = 0,                                   Wt_FishAgeComps = Wt_FishAgeComps,                                   Wt_FishLenComps = Wt_FishLenComps,                                   Wt_SrvAgeComps = Wt_SrvAgeComps,                                   Wt_SrvLenComps = Wt_SrvLenComps                                   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/e_single_region_sablefish_case_study.html","id":"fit-model-and-plot","dir":"Articles","previous_headings":"","what":"Fit Model and Plot","title":"Setting up a Single Region Model (Alaska Sablefish)","text":"finally done setup! Now, can run model. aided fit_model function, expects data, mapping, parameters list uses MakeADFUN function internally. lists can extracted input_list constructed. users want utilize integrate random effects using Laplace Approximation, can supply character vector random argument. instance, wanted integrate recruitment deviations , set: random = c(\"ln_RecDevs\"). newton_loops argument indicates whether user wants take additional newton steps ensure model achieved local minimum, uses Hessian gradients compute (thus, serves additional check model convergence). report file extracted internally fit_model standard errors can extracted using RTMB::sdreport function. Finally, can compare outputs ADMB RTMB. brevity, show comparisons spawning biomass recruitment two models.","code":"# extract out lists updated with helper functions data <- input_list$data parameters <- input_list$par mapping <- input_list$map  # Fit model sabie_rtmb_model <- fit_model(data,                               parameters,                               mapping,                               random = NULL,                               newton_loops = 3,                               silent = TRUE                               )  # Get standard error report sabie_rtmb_model$sd_rep <- RTMB::sdreport(sabie_rtmb_model) # Get recruitment time-series rec_series <- data.frame(Par = \"Recruitment\",                          Year = 1960:2024,                          RTMB = t(sabie_rtmb_model$rep$Rec),                          ADMB = sgl_rg_sable_data$admb_recr)  # Get SSB time-series ssb_series <- data.frame(Par = \"SSB\",                          Year = 1960:2024,                          RTMB = t(sabie_rtmb_model$rep$SSB),                          ADMB = sgl_rg_sable_data$admb_spbiom)  ts_df <- rbind(ssb_series,rec_series) # bind together ggplot(ts_df, aes(x = Year, y = ((RTMB - ADMB) / ADMB))) +   geom_line(size = 2) +   geom_hline(yintercept = 0, lty = 2, size = 1.3) +   facet_wrap(~Par, scales = \"free_y\") +   labs(y = \"Relative difference (%)\")  +   SPoCK::theme_sablefish() ggplot() +   geom_line(ts_df, mapping = aes(x = Year, y = RTMB, color = 'RTMB'), size = 1.3, lty = 1) +   geom_line(ts_df, mapping = aes(x = Year, y = ADMB, color = 'ADMB'), size = 1.3, lty = 2) +   facet_wrap(~Par, scales = \"free_y\") +   scale_color_manual(values = c('RTMB' = 'black', 'ADMB' = 'red')) +   labs(x = \"Year\", color = 'Model', y = \"Value\") +   SPoCK::theme_sablefish()"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-model-dimensions","dir":"Articles","previous_headings":"","what":"Setup Model Dimensions","title":"Setting up a Single Region Model (BSAI Pollock)","text":"initially set model , input list containing data list, parameter list, mapping list needs constructed. aided function Setup_Mod_Dim, users specify vector years, ages, lengths. Additionally, users need specify number regions modelled (n_regions), number sexes modeled (n_sexes), number fishery fleets (n_fish_fleets), number survey fleets (n_srv_fleets)","code":"input_list <- Setup_Mod_Dim(     years = sgl_rg_ebswp_data$years,     # vector of years     ages = sgl_rg_ebswp_data$ages,     # vector of ages     lens = NA,     # number of lengths     n_regions = 1,     # number of regions     n_sexes = 1,     # number of sexes     n_fish_fleets = 1,     # number of fishery fleets     n_srv_fleets = 3 # number of survey fleets   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-recruitment-dynamics","dir":"Articles","previous_headings":"","what":"Setup Recruitment Dynamics","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Following initialization input_list, can pass created object next function (Setup_Mod_Rec) parameterize recruitment dynamics. case Bering Sea Pollock, recruitment parameterized : Beverton-Holt Recruitment, steepness fixed 2024 assessment estiamted value, Recruitment deviations estimated penalized likelihood framework, Recruitment deviations estimated years, Initial age deviations ln_sigmaR = 2, later deviations (year 1) ln_sigmaR = 1. done mimic current assessment, different mean parameter estimated early age deviations later recruitment deviations. Initial age structure derived assuming geometric series (init_age_strc = 1; alternative iterating age structure equilibrium init_age_strc = 0), Individuals assumed spawn March (t_spawn = 0.25)","code":"inv_steepness <- function(s) qlogis((s - 0.2) / 0.8)    input_list <- Setup_Mod_Rec(     input_list = input_list,      # Model options     do_rec_bias_ramp = 0,     # do bias ramp (0 == don't do bias ramp, 1 == do bias ramp)     sigmaR_switch = 1,     # when to switch from early to late sigmaR (switch in first year)     ln_sigmaR = log(c(2, 1)),     # Starting values for early and late sigmaR     rec_model = \"bh_rec\",     # recruitment model     steepness_h = inv_steepness(0.623013),     h_spec = \"fix\",     # fixing steepness     sigmaR_spec = \"fix\",     # fix early sigmaR and late sigmaR     sexratio = as.vector(c(1.0)),     # recruitment sex ratio     init_age_strc = 1,     ln_global_R0 = 10,     t_spawn = 0.25     # starting value for r0   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-biological-dynamics","dir":"Articles","previous_headings":"","what":"Setup Biological Dynamics","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Passing input_list updated previous helper function, can parameterize biological dynamics model. Setup_Mod_Biologicals requires data inputs weight--age (WAA) maturity--age (MatAA), dimensioned n_regions, n_years, n_ages, n_sexes. case Bering Sea pollock, natural mortality age-specific fixed. Thus, natural mortality array constructed passed function, also dimensioned n_regions, n_years, n_ages, n_sexes.","code":"# Setup a fixed natural mortality array for use   fix_natmort <- array(0, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$ages), 1))   fix_natmort[,,1,] <- 0.9 # age 1 M   fix_natmort[,,2,] <- 0.45 # age 2 M   fix_natmort[,,-c(1,2),] <- 0.3 # age 3+ M      input_list <- Setup_Mod_Biologicals(     input_list = input_list,      # Data inputs     WAA = sgl_rg_ebswp_data$WAA,     MatAA = sgl_rg_ebswp_data$MatAA,      # Model options     # mean and sd for M prior     fit_lengths = 0,     # don't fit length compositions     M_spec = \"fix\",     # fixing natural mortality     Fixed_natmort = fix_natmort   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-movement-and-tagging","dir":"Articles","previous_headings":"","what":"Setup Movement and Tagging","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Given vignette demonstrates single-region model, movement dynamics specified. However, users still need define movement dynamics parameterized. case, following code chunk specifies movement estimated (use_fixed_movement = 1), movement identity matrix (Fixed_Movement = NA), recruits move (do_recruits_move = 0). Specification tagging dynamics follow similar fashion since single-region model. necessary updating input_list setting UseTagging argument value 0.","code":"# setup movement   input_list <- Setup_Mod_Movement(     input_list = input_list,     use_fixed_movement = 1,     Fixed_Movement = NA,     do_recruits_move = 0   )  # setup tagging   input_list <- Setup_Mod_Tagging(     input_list = input_list,      UseTagging = 0)"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-catch-and-fishing-mortality","dir":"Articles","previous_headings":"","what":"Setup Catch and Fishing Mortality","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Following parameterization biological dynamics, fishery dynamics can specified set using Setup_Mod_Catch_and_F function. , input_list gets updated previous helper functions. Users need supply function array observed catches ObsCatch, dimensioned n_regions, n_years, n_fish_fleets. Similarly, users also need specify catch type observations Catch_Type argument. argument expects matrix dimensioned n_years n_fish_fleets, really applicable spatial model (values 0 indicate catch aggregated across regions periods fleets, values 1 indicate catch specific region periods fleets). Thus, single region model, values 1 always supplied. function also expects UseCatch argument specified, dimensioned n_regions, n_years, n_fish_fleets. Essentially, users need fill whether catch fit particular partitions. use cases argument scenarios catch observed value 0, helper function automatically turns estimation fishing mortality deviations partitions. Additional model options specified case study include whether fishing mortality penalties utilized help estimate deviations Use_F_pen = 1, ln_sigmaC values fix .","code":"input_list <- Setup_Mod_Catch_and_F(     input_list = input_list,      # Data inputs     ObsCatch = sgl_rg_ebswp_data$ObsCatch,     Catch_Type = sgl_rg_ebswp_data$Catch_Type,     UseCatch = sgl_rg_ebswp_data$UseCatch,      # Model options     Use_F_pen = 1,     # whether to use f penalty, == 0 don't use, == 1 use     sigmaC_spec = \"fix\",     # fixing catch standard deviation     ln_sigmaC = matrix(log(0.05), 1, 1)     # starting / fixed value for catch standard deviation   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-fishery-indices-and-compositions","dir":"Articles","previous_headings":"","what":"Setup Fishery Indices and Compositions","title":"Setting up a Single Region Model (BSAI Pollock)","text":"set fishery indices composition data, supply arrays fishery indices associated standard errors (ObsFishIdx ObsFishIdx_SE), dimensioned n_regions, n_years, n_fish_fleets. Additionally, supply fishery age composition data length composition data. ObsFishAgeComps ObsFishLenComps dimensioned n_regions, n_years, n_bins (n_ages | n_lens), n_sexes, n_fish_fleets. Bering Sea pollock model fit length composition data, ObsFishLenComps specified NA UseFishLenComps specified 0s. Additionally, specify fishery index biomass-based, multinomial likelihoods utilized age composition data, fishery age compositions aggregatted across regions sexes (single-region single-sex model).","code":"input_list <- Setup_Mod_FishIdx_and_Comps(     input_list = input_list,     # data inputs     ObsFishIdx = sgl_rg_ebswp_data$ObsFishIdx,     ObsFishIdx_SE = sgl_rg_ebswp_data$ObsFishIdx_SE,     UseFishIdx = sgl_rg_ebswp_data$UseFishIdx,     ObsFishAgeComps = sgl_rg_ebswp_data$ObsFishAgeComps,     UseFishAgeComps = sgl_rg_ebswp_data$UseFishAgeComps,     ISS_FishAgeComps = sgl_rg_ebswp_data$ISS_FishAgeComps,     ObsFishLenComps = array(NA_real_, dim = c(1, length(input_list$data$years), length(input_list$data$lens), 1, 1)),     UseFishLenComps = array(0, dim = c(1, length(input_list$data$years), 1)),      # Model options     fish_idx_type = c(\"biom\"),     # indices for fishery     FishAgeComps_LikeType = c(\"Multinomial\"),     # age comp likelihoods for fishery fleet     FishLenComps_LikeType = c(\"none\"),     # length comp likelihoods for fishery     FishAgeComps_Type = c(\"agg_Year_1-terminal_Fleet_1\"),     # age comp structure for fishery     FishLenComps_Type = c(\"none_Year_1-terminal_Fleet_1\"),     # length comp structure for fishery     FishAge_comp_agg_type = c(1),     # ADMB aggregation quirks, ideally get rid of this     FishLen_comp_agg_type = c(0)     # ADMB aggregation quirks, ideally get rid of this   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-survey-indices-and-compositions","dir":"Articles","previous_headings":"","what":"Setup Survey Indices and Compositions","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Setting survey indices compositions follows similar fashion. , supply arrays survey indices associated standard errors (ObsSrvIdx ObsSrvIdx_SE), dimensioned n_regions, n_years, n_srv_fleets. case, modelling three survey fleets, fleet 1 bottom trawl survey, fleet 2 acoustic trawl survey, fleet 3 acoustic vessel opportunity survey. also input survey age composition data length composition data. ObsSrvAgeComps ObsSrvLenComps dimensioned n_regions, n_years, n_bins (n_ages | n_lens), n_sexes, n_srv_fleets. three survey indices biomass-based multinomial likelihoods used fit age-compositions fleets 1 2. However, acoustic vessel oppurtunity survey composition data, fit (hence specified none).","code":"# Setup survey indices and compositions   input_list <- Setup_Mod_SrvIdx_and_Comps(     input_list = input_list,      # data inputs     ObsSrvIdx = sgl_rg_ebswp_data$ObsSrvIdx,     ObsSrvIdx_SE = sgl_rg_ebswp_data$ObsSrvIdx_SE,     UseSrvIdx = sgl_rg_ebswp_data$UseSrvIdx,     ObsSrvAgeComps = sgl_rg_ebswp_data$ObsSrvAgeComps,     ISS_SrvAgeComps = sgl_rg_ebswp_data$ISS_SrvAgeComps,     UseSrvAgeComps = sgl_rg_ebswp_data$UseSrvAgeComps,     ObsSrvLenComps = array(NA_real_, dim = c(1, length(input_list$data$years), length(input_list$data$lens), 1, 3)),     UseSrvLenComps = array(0, dim = c(1, length(input_list$data$years), 3)),     ISS_SrvLenComps = NULL,      # Model options     srv_idx_type = c(\"biom\", \"biom\", \"biom\"),     # abundance and biomass for survey fleet 1, 2, and 3     SrvAgeComps_LikeType = c(\"Multinomial\", \"Multinomial\", \"none\"),     # survey age composition likelihood for survey fleet 1, 2, and 3     SrvLenComps_LikeType = c(\"none\", \"none\", \"none\"),     #  survey length composition likelihood for survey fleet 1, 2, and 3     SrvAgeComps_Type = c(       \"agg_Year_1-terminal_Fleet_1\",       \"agg_Year_1-terminal_Fleet_2\",       \"none_Year_1-terminal_Fleet_3\"     ),     # survey age comp type      SrvLenComps_Type = c(       \"none_Year_1-terminal_Fleet_1\",       \"none_Year_1-terminal_Fleet_2\",       \"none_Year_1-terminal_Fleet_3\"     ),     # survey length comp type      SrvAge_comp_agg_type = c(1, 1, 1),     # ADMB aggregation quirks, ideally get rid of this     SrvLen_comp_agg_type = c(0, 0, 0)     # ADMB aggregation quirks, ideally get rid of this   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setting-up-fishery-selectivity-and-catchability","dir":"Articles","previous_headings":"","what":"Setting up Fishery Selectivity and Catchability","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Fishery selectivity specified vary semi-parametrically pollock model, 2dar1 option specified. , estiamte selectivity deviations penalized framework fix variance values priori fishsel_pe_pars_spec = \"fix\". Moreover, estiamte fishery selectivity deviations dimensions, specify correlations set 0 (corr_opt_semipar = \"corr_zero_y_a_c\"). Thus, semi-parametric deviations collapse simple iid formulation. Additionally, specify underlying selectivity form fishery logistic function. Lastly, single catchability term estimated fit early fishery index utilized model (fish_q_spec = c(\"est_all\")). Fit Model section, demonstrate variance parameters can fixed allow estimation penalized likelihood framework.","code":"# Setup fishery selectivity and catchability   input_list <- Setup_Mod_Fishsel_and_Q(      input_list = input_list,      # Model options     # fishery selectivity, whether continuous time-varying     cont_tv_fish_sel = c(\"2dar1_Fleet_1\"),     fishsel_pe_pars_spec = \"fix\", # doing penalized likelihood for selex devs     fish_sel_devs_spec = \"est_all\", # estimating all sel devs     corr_opt_semipar = \"corr_zero_y_a_c\", # making sure 2d correaltions are 0, collapses to a simple iid case     # fishery selectivity blocks     fish_sel_blocks = c(\"none_Fleet_1\"),     # fishery selectivity form     fish_sel_model = c(\"logist1_Fleet_1\"),     # fishery catchability blocks     fish_q_blocks = c(\"none_Fleet_1\"),     # whether to estiamte all fixed effects for fishery selectivity     fish_fixed_sel_pars = c(\"est_all\"),     # whether to estiamte all fixed effects for fishery catchability     fish_q_spec = c(\"est_all\")   )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setting-up-survey-selectivity-and-catchability","dir":"Articles","previous_headings":"","what":"Setting up Survey Selectivity and Catchability","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Survey selectivity setup similar way. , specify first survey fleet iid parametric deviations selectivity form, second survey fleet 2dar1 semi-parametric deviations. Selectivity survey fleet 3 estimated age composition data available. Therefore, selectivity survey fleet 2 3 shared. , specify selectivity deviations estimated penalized likelihood framework argument srvsel_pe_pars_spec = c(\"fix\", \"fix\", \"fix\") specify set 2dar1 correlations 0, semi-parametric deviations collapse iid formulation (corr_opt_semipar = c(NA, \"corr_zero_y_a_c\", \"corr_zero_y_a_c\")).","code":"# Setup survey selectivity and catchability   input_list <- Setup_Mod_Srvsel_and_Q(     input_list = input_list,      # Model options     # survey selectivity, whether continuous time-varying     cont_tv_srv_sel = c(\"iid_Fleet_1\", \"2dar1_Fleet_2\", \"2dar1_Fleet_3\"),     srvsel_pe_pars_spec = c(\"fix\", \"fix\", \"fix\"), # penalize survey selex devs     srv_sel_devs_spec = c(\"est_all\", \"est_all\", \"none\"), # estimating all srv selex devs     corr_opt_semipar = c(NA, \"corr_zero_y_a_c\", \"corr_zero_y_a_c\"), # setting corelations at 0, so 2dar1 collapses to simple iid semi-parametric devs      # survey selectivity blocks     srv_sel_blocks = c(\"none_Fleet_1\", \"none_Fleet_2\", \"none_Fleet_3\"),     # survey selectivity form     srv_sel_model = c(       \"logist1_Fleet_1\",       \"logist1_Fleet_2\",       \"logist1_Fleet_3\"     ),     # survey catchability blocks     srv_q_blocks = c(\"none_Fleet_1\", \"none_Fleet_2\", \"none_Fleet_3\"),     # whether to estiamte all fixed effects for survey selectivity     srv_fixed_sel_pars_spec = c(\"est_all\", \"est_all\", \"est_all\"),     # whether to estiamte all fixed effects for survey catchability     srv_q_spec = c(\"est_all\", \"est_all\", \"est_all\")   )    # note that AVO (fleet 3) does not have any comp data, and needs to share selectivity with ATS (fleet 2)   input_list$map$ln_srv_fixed_sel_pars <- factor(c(1, 2, 3, 4, 3, 4))    # share ATS and AVO selex devs   map_srvsel_devs[,,,,3] <- map_srvsel_devs[,,,,2]   input_list$map$ln_srvsel_devs <- factor(map_srvsel_devs)"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"setup-model-weighting","dir":"Articles","previous_headings":"","what":"Setup Model Weighting","title":"Setting up a Single Region Model (BSAI Pollock)","text":"set data weighted λ\\lambda model. , λ\\lambda values set 1 TMB likelihoods utilized. Thus, data sources weighted either using specified input sample sizes (composition data) specified variances (catch abundance indices).","code":"input_list <- Setup_Mod_Weighting(   input_list = input_list,   sablefish_ADMB = 0,   likelihoods = 1, # using TMB likelihoods   Wt_Catch = 1,   Wt_FishIdx = 1,   Wt_SrvIdx = 1,   Wt_Rec = 1,   Wt_F = 1,   Wt_Tagging = 0,   Wt_FishAgeComps = array(1, dim = c(input_list$data$n_regions,                                      length(input_list$data$years),                                      input_list$data$n_sexes,                                      input_list$data$n_srv_fleets)),   Wt_FishLenComps = array(1, dim = c(input_list$data$n_regions,                                      length(input_list$data$years),                                      input_list$data$n_sexes,                                      input_list$data$n_srv_fleets)),   Wt_SrvAgeComps = array(1, dim = c(input_list$data$n_regions,                                     length(input_list$data$years),                                     input_list$data$n_sexes,                                     input_list$data$n_srv_fleets)),   Wt_SrvLenComps = array(1, dim = c(input_list$data$n_regions,                                     length(input_list$data$years),                                     input_list$data$n_sexes,                                     input_list$data$n_srv_fleets)) )"},{"path":"https://chengmatt.github.io/SPoCK/articles/f_single_region_bsai_pollock_case_study.html","id":"fit-model-and-plot","dir":"Articles","previous_headings":"","what":"Fit Model and Plot","title":"Setting up a Single Region Model (BSAI Pollock)","text":"Next, can extract elements created input_list object. specify values fix selectivity variances . first case, fishery selectivity variance fixed value 0.075 second case, bottom trawl survey a50 k selectivity variances logistic function fixed 0.075 Lastly, acoustic trawl vessel opportunity surveys specified variance 0.15. details dimensionality fishsel_pe_pars srvsel_pe_pars, please refer Description Model Parameters page. Next, can extract parameter estimates recruitment spawning biomass compare 2024 pollock model. general, see trends recruitment spawning stock biomass align relatively well. However, slight discrepancies estimates, likely due factors discussed start vignette.  Lastly, can also inspect estimates fishery selectivity SPoCK. , show relative selectivity estimates ages 3 - 11 (panels). Note selectivity model can exceed 1, normalize values figure improve interpretability","code":"# extract out lists updated with helper functions data <- input_list$data parameters <- input_list$par mapping <- input_list$map  # selex sigma to fix at, given penalized likelihood parameters$fishsel_pe_pars[,4,,] <- log(0.075) # fishery selex variance parameters$srvsel_pe_pars[,1:2,,1] <- log(0.075) # survey BTS - a50 and delta variance parameters$srvsel_pe_pars[,4,,2] <- log(0.15) # survey ATS and ato variance  # Fit model ebswp_rtmb_model <- fit_model(data,                               parameters,                               mapping,                               random = NULL,                               newton_loops = 3,                               silent = TRUE                               )  # Get standard error report ebswp_rtmb_model$sd_rep <- RTMB::sdreport(ebswp_rtmb_model) # Get recruitment rec_series <- reshape2::melt((ebswp_rtmb_model$rep$Rec)) %>%   mutate(se = ebswp_rtmb_model$sdrep$sd[names(ebswp_rtmb_model$sdrep$value) == 'Rec']) rec_series$Par <- \"Recruitment\"  # Get SSB time-series ssb_series <- reshape2::melt((ebswp_rtmb_model$rep$SSB)) %>%   mutate(se = ebswp_rtmb_model$sdrep$sd[names(ebswp_rtmb_model$sdrep$value) == 'SSB']) ssb_series$Par <- \"Spawning Biomass\"  # bind together ts_df <- rbind(ssb_series,rec_series) %>%   dplyr::rename(Region = Var1, Year = Var2) %>%   dplyr::mutate(Year = Year + 1963, type = 'SPoCK')  # Get actual assessment results ssb_ass <- data.frame(   Region = 1,   Year = 1964:2024,   value = sgl_rg_ebswp_data$SSB[,2],   se = sgl_rg_ebswp_data$SSB[,3],   Par = 'Spawning Biomass',   type = '2024 Pollock Assessment' )  # recruitment rec_ass <- data.frame(   Region = 1,   Year = 1964:2024,   value = sgl_rg_ebswp_data$R[,2],   se = sgl_rg_ebswp_data$R[,3],   Par = 'Recruitment',   type = '2024 Pollock Assessment' )  # bind ts_df <- ts_df %>% bind_rows(ssb_ass, rec_ass) ggplot(ts_df, aes(x = Year, y = value, ymin = value - (1.96 * se),                   ymax = value + (1.96 * se), color = type, fill = type)) +   geom_point(size = 3) +   geom_line() +   facet_wrap(~Par, scales = 'free') +   geom_ribbon(alpha = 0.3, color = NA) +   ggthemes::scale_color_colorblind() +   ggthemes::scale_fill_colorblind() +   labs(y = \"Value\")  +   theme_bw(base_size = 13) +   ylim(0, NA) +   labs(x = 'Year', y = 'Value', color = 'Type', fill = 'Type') reshape2::melt(ebswp_rtmb_model$rep$fish_sel) %>%   mutate(value = value/max(value)) %>%   rename(Region = Var1, Year = Var2, Age = Var3, Sex = Var4, Fleet = Var5) %>%   filter(Age %in% 3:11) %>%   ggplot(aes(x = Year + 1963, y = value)) +   geom_point() +   geom_line() +   facet_wrap(~Age) +   theme_bw(base_size = 15) +   labs(x = 'Year', y = 'Relative Selectivity')"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-model-dimensions","dir":"Articles","previous_headings":"","what":"Setup Model Dimensions","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"initially set model , input list containing data list, parameter list, mapping list needs constructed. aided function Setup_Mod_Dim, users specify vector years, ages, lengths. Additionally, users need specify number regions modeled (n_regions), number sexes modelled (n_sexes), number fishery fleets (n_fish_fleets), number survey fleets (n_srv_fleets)","code":"# Initialize model dimensions and data list input_list <- Setup_Mod_Dim(years = 1:length(mlt_rg_sable_data$years),                             # vector of years (1 - 62)                             ages = 1:length(mlt_rg_sable_data$ages),                             # vector of ages (1 - 30)                             lens = mlt_rg_sable_data$lens,                             # number of lengths (41 - 99)                             n_regions = mlt_rg_sable_data$n_regions,                             # number of regions (5)                             n_sexes = mlt_rg_sable_data$n_sexes,                             # number of sexes (2)                             n_fish_fleets = mlt_rg_sable_data$n_fish_fleets,                             # number of fishery fleet (2)                             n_srv_fleets = mlt_rg_sable_data$n_srv_fleets,                             # number of survey fleets (2)                             verbose = TRUE )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-recruitment-dynamics","dir":"Articles","previous_headings":"","what":"Setup Recruitment Dynamics","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"Following initialization input_list, can pass created object next function (Setup_Mod_Rec) parameterize recruitment dynamics. case spatial model Alaska sablefish, recruitment parameterized : Mean Recruitment, stock recruitment relationship assumed, recruitment bias ramp used (do_bias_ramp = 1), Two values sigmaR used, first value represents early period sigmaR, fixed 0.4, second value represents late period sigmaR, fixed value 1.2. Recruitment deviations estimated penalized likelihood framework, Recruitment deviations estimated years regions, except terminal year, Recruitment sex-ratios fixed 0.5 sex, Initial age structure derived iterating age structure equilibrium, Initial age deviations shared across regions facilitate model convergence","code":"# Setup recruitment stuff (using defaults for other stuff) input_list <- Setup_Mod_Rec(input_list = input_list, # input data list from above                             do_rec_bias_ramp = 0, # not using bias ramp                             sigmaR_switch = 16, # switch to using late sigma in year 16                             dont_est_recdev_last = 1, # don't estimate last rec dev                             sexratio = c(0.5, 0.5), # fix sex ratio at 0.5                              # Model options                             rec_model = \"mean_rec\", # recruitment model                             sigmaR_spec = \"fix\", # fixing                             InitDevs_spec = \"est_shared_r\",                             # initial deviations are shared across regions,                             # but recruitment deviations are region specific                             ln_sigmaR = log(c(0.4, 1.2)),                             # values to fix sigmaR at, or starting values                             ln_global_R0 = log(20),                             # starting value for global R0                             R0_prop = array(c(0.2, 0.2, 0.2, 0.2),                                             dim = c(input_list$data$n_regions - 1))                             # starting value for R0 proportions in multinomial logit space )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-biological-dynamics","dir":"Articles","previous_headings":"","what":"Setup Biological Dynamics","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"Passing input_list updated previous helper function, can parameterize biological dynamics model. Setup_Mod_Biologicals requires data inputs weight--age (WAA) maturity--age (MatAA), dimensioned n_regions, n_years, n_ages, n_sexes. Optional model inputs include single ageing-error matrix AgeingError, dimensioned n_ages, n_ages, size-age transition matrix, whichn dimensioned n_regions, n_years, n_lens, n_ages, n_sexes. case, supplying ageing error matrix size-age transition matrix, given spatial sablefish model incorporates ageing error also fits length composition data (fit_lengths = 1). Given spatial models heavily parameterized natural mortality often poorly estimated, fixing natural mortality M_spec = \"fix\" value 0.104884, specified sex-invariant.","code":"# Setup biological stuff (using defaults for other stuff) input_list <- Setup_Mod_Biologicals(input_list = input_list,                                     WAA = mlt_rg_sable_data$WAA, # weight at age                                     MatAA = mlt_rg_sable_data$MatAA, # maturity at age                                     AgeingError = mlt_rg_sable_data$AgeingError,                                     # ageing error matrix                                     fit_lengths = 1, # fitting lengths                                     SizeAgeTrans = mlt_rg_sable_data$SizeAgeTrans,                                     # size age transition matrix                                     M_spec = \"fix\", # fix natural mortality                                     Fixed_natmort = array(0.104884, dim = c(mlt_rg_sable_data$n_regions,                                                                             length(mlt_rg_sable_data$years),                                                                             length(mlt_rg_sable_data$ages),                                                                             mlt_rg_sable_data$n_sexes))                                     # values to fix natural mortality at )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-movement-and-tagging-dynamics","dir":"Articles","previous_headings":"","what":"Setup Movement and Tagging Dynamics","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"Various options available parameterizing movement dynamics. particular, users can specify number age, year, sex blocks movement. users wish specify blocks aforementioned partitions, list needs supplied detailing blocking structure, number elements list represents number blocks estiamte, elements within list specify range block. instance, spatial model sablefish estimates 3 age blocks, (Movement_ageblk_spec = list(c(1:6), c(7:15), c(16:30))), first element specifies first age block, ranges ages 1 - 6, second element specifies second age block, ranges ages 7 - 15, third element specifies third age block, ranges ages 16 - 30. year sex blocks specified application. Thus, Movement_yearblk_spec Movement_sexblk_spec set \"constant\". Additionally, recruits allowed move, given potential severe confounding recruitment movement allowed (do_recruits_move = 0). Fixed movement used case (use_fixed_movement = 0) vague Dirichlet prior movement (Use_Movement_Prior = 1 Movement_prior = 1.5) used penalize movement away extremes (.e, away 0s 1s). Specification tagging dynamics can bit cumbersome given myriad options available. current application, tagging data longline survey utilized UseTagging = 1 maximum tag liberty 15 years specified max_tag_liberty = 15 tag cohort tracking. cut used minimize computational demands, providing reasonable level movement information. Next, need specify data inputs. primarily include: tag_release_indicator, indicates release year release region given tag cohort, Tagged_Fish, contains number tagged fish tag cohort, Obs_Tag_Recap, contains observed tag recaptures Following specification data inputs, can specify several model options. , can specify likelihood type utilized tagging data (Tag_LikeType = \"NegBin\"), specified negative binomial, overdispersion parameter estimated. can also specify tag mixing period (mixing_period = 2), indicates model fit tag recapture data release_year + 1, given tagged individuals fully mixed. Additionally, function also takes time tagging argument t_tagging, specified value 0.5 indicate tagging happens midway year, movement occur tag release year. Users can also specify tagging fishing natural mortality occurs. application, tagging fishing mortality / selectivity specified tag_selex = \"SexSp_AllFleet\", indicates selectivity curve utilized fit tag data sex-specific derived weighting fishery fleet-specific selectivity fishing mortality. option tag_natmort = \"AgeSp_SexSp\" specifies tagged individuals experience age-sex-specific natural mortality. options, users can inspect ?Setup_Mod_Tagging. Next, can specify whether tag reporting rate priors used (Use_TagRep_Prior = 1) type prior used (TagRep_PriorType = 0). , tag reporting priors fact used, symmetric beta prior specified. Given , symmetric beta prior require input mean value tag reporting (TagRep_mu = NA), require input standard deviation (TagRep_sd = 5), larger values penalize extremes . specify move_age_tag_pool move_sex_tag_pool arguments indicate model tagging data fit. case, fitting tag data respective age sex-blocks reduce computational demand. users wish fit tag data individual ages sexes, move_age_tag_pool specified list(1,2,3,4 ..., n_ages) move_sex_tag_pool list(1,2). initial tagging mortality chronic tag shedding often confounded mortality processes difficult estiamte, fix parameters application (Init_Tag_Mort_spec = \"fix\" Tag_Shed_spec = \"fix\"). Lastly, specify estimation tag reporting rates, time-varying (estimated 2 blocks; see input supplied Tag_Reporting_blocks argument) shared across regions (TagRep_spec = \"est_shared_r\").","code":"# setting up movement parameterization input_list <- Setup_Mod_Movement(input_list = input_list,                                  # Model options                                  Movement_ageblk_spec = list(c(1:6), c(7:15), c(16:30)),                                  # estimating movement in 3 age blocks                                  # (ages 1-6, ages 7-15, ages 16-30)                                  Movement_yearblk_spec = \"constant\", # time-invariant movement                                  Movement_sexblk_spec = \"constant\", # sex-invariant movement                                  do_recruits_move = 0, # recruits do not move                                  use_fixed_movement = 0, # estimating movement                                  Use_Movement_Prior = 1, # priors used for movement                                  Movement_prior = 1.5                                  # vague prior to penalize movement away from the extremes                                  ) # setting up tagging parameterization input_list <- Setup_Mod_Tagging(input_list = input_list,                                 UseTagging = 1, # using tagging data                                 max_tag_liberty = 15, # maximum number of years to track a cohort                                  # Data Inputs                                 tag_release_indicator = mlt_rg_sable_data$tag_release_indicator,                                 # tag release indicator (first col = tag region,                                 # second col = tag year),                                 # total number of rows = number of tagged cohorts                                 Tagged_Fish = mlt_rg_sable_data$Tagged_Fish, # Released fish                                 # dimensioned by total number of tagged cohorts, (implicitly                                 # tracks the release year and region), age, and sex                                 Obs_Tag_Recap = mlt_rg_sable_data$Obs_Tag_Recap,                                 # dimensioned by max tag liberty, tagged cohorts, regions,                                 # ages, and sexes                                  # Model options                                 Tag_LikeType = \"NegBin\", # Negative Binomial                                 mixing_period = 2, # Don't fit tagging until release year + 1                                 t_tagging = 0.5, # tagging happens midway through the year,                                 # movement does not occur within that year                                 tag_selex = \"SexSp_AllFleet\", # tagging recapture selectivity                                 # is a weighted average of fishery selectivity of two fleets                                 tag_natmort = \"AgeSp_SexSp\", # tagging natural mortality is                                 # age and sex-specific                                 Use_TagRep_Prior = 1, # tag reporting rate priors are used                                 TagRep_PriorType = 0, # symmetric beta is used                                 # for tag reporting prior                                 TagRep_mu = NA, # Tag reporting mean                                 TagRep_sd = 5, # tag reporting sd controlling symmetric beta                                 move_age_tag_pool = list(c(1:6), c(7:15), c(16:30)), # whether or                                 # not to pool tagging data when fitting (for computational cost)                                 move_sex_tag_pool = list(c(1:2)), # whether or not to pool                                 # sex-specific data when fitting                                 Init_Tag_Mort_spec = \"fix\", # fixing initial tag mortality                                 Tag_Shed_spec = \"fix\", # fixing chronic shedding                                 TagRep_spec = \"est_shared_r\", # tag reporting rates are                                 # not region specific                                 # Time blocks for tag reporting rates                                 Tag_Reporting_blocks = c(                                   paste(\"Block_1_Year_1-35_Region_\",                                         c(1:input_list$data$n_regions), sep = ''),                                   paste(\"Block_2_Year_36-terminal_Region_\",                                         c(1:input_list$data$n_regions), sep = '')                                 ),                                  # Specify starting values or fixing values                                 ln_Init_Tag_Mort = log(0.1), # fixing initial tag mortality                                 ln_Tag_Shed = log(0.02),  # fixing tag shedding                                 ln_tag_theta = log(0.5),                                 # starting value for tagging overdispersion                                 Tag_Reporting_Pars = array(log(0.2 / (1-0.2)),                                                            dim = c(input_list$data$n_regions, 3))                                 # starting values for tag reporting pars  )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-catch-and-fishing-mortality","dir":"Articles","previous_headings":"","what":"Setup Catch and Fishing Mortality","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"general, specifying catch fishing mortality relatively straightforward. Users need supply several data inputs, include array observed catches ObsCatch, catch type (Catch_Type), indicates gave region-specific region-aggregated catch, UseCatch, indicates whether fit catch data given region year. Users can inspect mlt_rg_sable_data data object understand dimensions data inputs, refer Description Model Data Dimensions vignette. Given going using TMB-style likelihoods, also specifying sigma catch fixed (sigmaC_spec = 'fix') value 0.02 fleets regions (ln_sigmaC = array(log(0.02), dim = c(input_list$data$n_regions, input_list$data$n_fish_fleets))).","code":"input_list <- Setup_Mod_Catch_and_F(input_list = input_list,                                     # Data inputs                                     ObsCatch = mlt_rg_sable_data$ObsCatch,                                     Catch_Type = mlt_rg_sable_data$Catch_Type,                                     UseCatch = mlt_rg_sable_data$UseCatch,                                     # Model options                                     Use_F_pen = 1,                                     # whether to use f penalty, == 0 don't use, == 1 use                                     sigmaC_spec = 'fix',                                     ln_sigmaC =                                       array(log(0.02), dim = c(input_list$data$n_regions,                                                                input_list$data$n_fish_fleets)),                                     # fixing catch sd at small value                                     ln_F_mean = array(-2, dim = c(input_list$data$n_regions,                                                                   input_list$data$n_fish_fleets))                                     # some starting values for fishing mortality )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-index-and-composition-data-fishery-and-survey","dir":"Articles","previous_headings":"","what":"Setup Index and Composition Data (Fishery and Survey)","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"Setting fishery (survey) index composition data can similarly bit cumbersome, given number data inputs may required. Users can inspect mlt_rg_sable_data data object understand dimensions data inputs, refer Description Model Data Dimensions vignette. data inputs include following: 1. ObsFishIdx ObsSrvIdx, specifies observed indices 2. ObsFishIdx_SE ObsSrvIdx_SE, specifies standard errors observed indices 3. UseFishIdx UseSrvIdx, indicate whether indices fit 4. ObsFishAgeComps ObsSrvAgeComps contains observed age compositions 5. UseFishAgeComps UseSrvAgeComps indicates whether age compositions fit 6. ISS_FishAgeComps ISS_SrvAgeComps indicates input sample sizes used weight age compositions 7. ObsFishLenComps ObsSrvLenComps contains observed length compositions 8. UseFishLenComps UseSrvLenComps indicates whether length compositions fit 9. ISS_FishLenComps ISS_SrvLenComps indicates input sample sizes used weight length compositions Model options available similar described Setting Single Region Model (Alaska Sablefish) vignette. case fishery indices, fish_idx_type specified none given used. Age composition likelihoods specified FishAgeComps_LikeType = c(\"Multinomial\", \"none\"), indicating first fleet uses Multinomial second fleet age compositions. Fishery length compositions specified Multinomial fleets. respect FishAgeComps_Type FishLenComps_Type, specified spltRjntS availiable indicate compositions sum 1 jointly across sexes, split given region. arguments expected survey indices compositions. , 2 survey fleets specified, abundance based fleets. Age compositions fleets joint sex, split region, length compositions used. compositions survey fleets assume Mulinomial likelihood.","code":"input_list <- Setup_Mod_FishIdx_and_Comps(input_list = input_list,                                           # data inputs                                           ObsFishIdx = mlt_rg_sable_data$ObsFishIdx,                                           ObsFishIdx_SE = mlt_rg_sable_data$ObsFishIdx_SE,                                           UseFishIdx =  mlt_rg_sable_data$UseFishIdx,                                           ObsFishAgeComps = mlt_rg_sable_data$ObsFishAgeComps,                                           UseFishAgeComps = mlt_rg_sable_data$UseFishAgeComps,                                           ISS_FishAgeComps = mlt_rg_sable_data$ISS_FishAgeComps,                                           ObsFishLenComps = mlt_rg_sable_data$ObsFishLenComps,                                           UseFishLenComps = mlt_rg_sable_data$UseFishLenComps,                                           ISS_FishLenComps = mlt_rg_sable_data$ISS_FishLenComps,                                            # Model options                                           fish_idx_type = c(\"none\", \"none\"),                                           # fishery indices not used                                           FishAgeComps_LikeType =                                             c(\"Multinomial\", \"none\"),                                           # age comp likelihoods for fishery fleet 1 and 2                                           FishLenComps_LikeType =                                             c(\"Multinomial\", \"Multinomial\"),                                           # length comp likelihoods for fishery fleet 1 and 2                                           FishAgeComps_Type =                                             c(\"spltRjntS_Year_1-terminal_Fleet_1\",                                               \"none_Year_1-terminal_Fleet_2\"),                                           # age comp structure for fishery fleet 1 and 2                                           FishLenComps_Type =                                             c(\"spltRjntS_Year_1-terminal_Fleet_1\",                                               \"spltRjntS_Year_1-terminal_Fleet_2\"),                                           # length comp structure for fishery fleet 1 and 2                                           FishAge_comp_agg_type = c(NA,NA),                                           # ADMB aggregation quirks, ideally get rid of this                                           FishLen_comp_agg_type = c(NA,NA)                                           # ADMB aggregation quirks, ideally get rid of this ) # Survey Indices and Compositions input_list <- Setup_Mod_SrvIdx_and_Comps(input_list = input_list,                                          # data inputs                                          ObsSrvIdx = mlt_rg_sable_data$ObsSrvIdx,                                          ObsSrvIdx_SE = mlt_rg_sable_data$ObsSrvIdx_SE,                                          UseSrvIdx =  mlt_rg_sable_data$UseSrvIdx,                                          ObsSrvAgeComps = mlt_rg_sable_data$ObsSrvAgeComps,                                          ISS_SrvAgeComps = mlt_rg_sable_data$ISS_SrvAgeComps,                                          UseSrvAgeComps = mlt_rg_sable_data$UseSrvAgeComps,                                          ObsSrvLenComps = mlt_rg_sable_data$ObsSrvLenComps,                                          UseSrvLenComps = mlt_rg_sable_data$UseSrvLenComps,                                          ISS_SrvLenComps = mlt_rg_sable_data$ISS_SrvLenComps,                                           # Model options                                          srv_idx_type = c(\"abd\", \"abd\"),                                          # abundance and biomass for survey fleet 1 and 2                                          SrvAgeComps_LikeType =                                            c(\"Multinomial\", \"Multinomial\"),                                          # survey age composition likelihood for survey fleet                                          # 1, and 2                                          SrvLenComps_LikeType =                                            c(\"none\", \"none\"),                                          #  no length compositions used for survey                                          SrvAgeComps_Type = c(\"spltRjntS_Year_1-terminal_Fleet_1\",                                                               \"spltRjntS_Year_1-terminal_Fleet_2\"),                                          # survey age comp type                                          SrvLenComps_Type = c(\"none_Year_1-terminal_Fleet_1\",                                                               \"none_Year_1-terminal_Fleet_2\"),                                          # survey length comp type                                          SrvAge_comp_agg_type = c(NA, NA),                                          # ADMB aggregation quirks, ideally get rid of this                                          SrvLen_comp_agg_type = c(NA, NA)                                          # ADMB aggregation quirks, ideally get rid of this )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-selectivity-and-catchability-fishery-and-survey","dir":"Articles","previous_headings":"","what":"Setup Selectivity and Catchability (Fishery and Survey)","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"spatial sablefish application, fishery/survey selectivity catchability processes assumed spatially-invariant. Similar single region case, users need specify several selectivity options, include: Whether continuous time-varying selectivity processes (cont_tv_fish_sel cont_tv_srv_sel). case study, continuous time-varying selectivity used specified none_Fleet_x, Whether selectivity blocks (fish_sel_blocks srv_sel_blocks). application assumes 2 time-blocks fixed-gear fleet time-invariant selectivity trawl fishery, type parametric selectivity form specify different fleets (fish_sel_model srv_sel_model). , assume logist1 fixed-gear fleet (logistic specified a50 k), gamma dome-shaped selectivity trawl fleet, number catchability blocks specified (fish_q_blocks srv_q_blocks). Given fishery indices used, fishery catchability blocks estimated (fish_q_blocks = c(\"none_Fleet_1\", \"none_Fleet_2\")), fishery survey selectivity parameters estimated (fish_fixed_sel_pars). case sablefish, first specifying selectivity parameters (regions, time-blocks, sexes) estimated. However, nuanced parameter sharing across regions, sexes, time-blocks used help stabilize model (last part code chunk), easily generalized. Thus, users can manually extract map list updated input_list object modify parameters fixed shared, Lastly, fishery survey catchability estimated (fish_q_spec srv_q_spec). fishery, catchability estimated fishery indices utilized (fix). , arguments expected setting survey selectivity, similarly nuanced parameter fixing sharing help facilitate model stability.","code":"# Fishery Selectivity and Catchability input_list <- Setup_Mod_Fishsel_and_Q(input_list = input_list,                                        # Model options                                       cont_tv_fish_sel = c(\"none_Fleet_1\", \"none_Fleet_2\"),                                       # fishery selectivity, whether continuous time-varying                                        # fishery selectivity blocks                                       fish_sel_blocks =                                         c(\"Block_1_Year_1-56_Fleet_1\",                                           # block 1, fishery ll selex                                           \"Block_2_Year_57-terminal_Fleet_1\",                                           # block 3 fishery ll selex                                           \"none_Fleet_2\"),                                       # no blocks for trawl fishery                                        # fishery selectivity form                                       fish_sel_model =                                         c(\"logist1_Fleet_1\",                                           \"gamma_Fleet_2\"),                                        # fishery catchability blocks                                       fish_q_blocks =                                         c(\"none_Fleet_1\",                                           \"none_Fleet_2\"),                                       # no blocks since q is not estimated                                        # whether to estimate all fixed effects                                       # for fishery selectivity and later modify                                       # to fix and share parameters                                       fish_fixed_sel_pars =                                         c(\"est_all\", \"est_all\"),                                        # whether to estimate all fixed effects                                       # for fishery catchability                                       fish_q_spec =                                         c(\"fix\", \"fix\")                                       # fix fishery q since not used )   # Custom parameter sharing for fishery selectivity map_ln_fish_fixed_sel_pars <- input_list$par$ln_fish_fixed_sel_pars # mapping fishery selectivity  # Fixed gear fleet, unique parameters for each sex (time block 1) map_ln_fish_fixed_sel_pars[,1,1,1,1] <- 1 # a50, female, time block 1, fixed gear map_ln_fish_fixed_sel_pars[,2,1,1,1] <- 2 # delta, female, time block 1, fixed gear # (shared with time block 2 and sex) map_ln_fish_fixed_sel_pars[,1,1,2,1] <- 3 # a50, male, time block 1, fixed gear map_ln_fish_fixed_sel_pars[,2,1,2,1] <- 2 # delta, male, time block 1, fixed gear # (shared with time block 2 and sex)  # time block 2, fixed gear fishery map_ln_fish_fixed_sel_pars[,1,2,1,1] <- 4 # a50, female, time block 2, fixed gear map_ln_fish_fixed_sel_pars[,2,2,1,1] <- 2 # delta, female, time block 2, fixed gear # (shared with time block 1 and sex) map_ln_fish_fixed_sel_pars[,1,2,2,1] <- 5 # a50, male, time block 2, fixed gear map_ln_fish_fixed_sel_pars[,2,2,2,1] <- 2 # delta, male, time block 2, fixed gear # (shared with time block 1 and sex)  # time block 1 and 2, trawl gear fishery map_ln_fish_fixed_sel_pars[,1,1,1,2] <- 6 # amax, female, time block 1, trawl gear map_ln_fish_fixed_sel_pars[,2,1,1,2] <- 7 # delta, female, time block 1, trawl gear # (shared by sex) map_ln_fish_fixed_sel_pars[,1,1,2,2] <- 8 # amax, male, time block 1, trawl gear map_ln_fish_fixed_sel_pars[,2,1,2,2] <- 7 # delta, male, time block 1, trawl gear # (shared by sex) map_ln_fish_fixed_sel_pars[,,2,,2] <- NA # no parameters estimated for time block 2 trawl gear  input_list$map$ln_fish_fixed_sel_pars <- factor(map_ln_fish_fixed_sel_pars) # input into map list input_list$par$ln_fish_fixed_sel_pars[] <- log(5) # some more inforamtive starting values input_list <- Setup_Mod_Srvsel_and_Q(input_list = input_list,                                       # Model options                                      # survey selectivity, whether continuous time-varying                                      cont_tv_srv_sel =                                        c(\"none_Fleet_1\",                                          \"none_Fleet_2\"),                                       # survey selectivity blocks                                      srv_sel_blocks =                                        c(\"none_Fleet_1\",                                          \"none_Fleet_2\"                                        ), # no blocks for jp and domestic survey                                       # survey selectivity form                                      srv_sel_model =                                        c(\"logist1_Fleet_1\",                                          \"logist1_Fleet_2\"),                                       # survey catchability blocks                                      srv_q_blocks =                                        c(\"none_Fleet_1\",                                          \"none_Fleet_2\"),                                       # whether to estiamte all fixed effects                                      # for survey selectivity and later                                      # modify to fix/share parameters                                      srv_fixed_sel_pars_spec =                                        c(\"est_all\",                                          \"est_all\"),                                       # whether to estiamte all                                      # fixed effects for survey catchability                                      # spatially-invariant q                                      srv_q_spec =                                        c(\"est_shared_r\",                                          \"est_shared_r\"),                                       # Starting values for survey catchability                                      ln_srv_q = array(9,                                                       dim = c(input_list$data$n_regions, 1,                                                               input_list$data$n_srv_fleets)) )  # Custom mapping survey selectivity stuff map_ln_srv_fixed_sel_pars <- input_list$par$ln_srv_fixed_sel_pars # set up mapping factor stuff  # Coop survey (japanese) map_ln_srv_fixed_sel_pars[,1,1,1,1] <- 1 # a50, coop survey, time block 1, female map_ln_srv_fixed_sel_pars[,2,1,1,1] <- 2 # delta, coop survey, time block 1, female # (sharing with domestic survey) map_ln_srv_fixed_sel_pars[,1,1,2,1] <- 3 # a50, coop survey, time block 1, male map_ln_srv_fixed_sel_pars[,2,1,2,1] <- 4 # delta, coop survey, time block 1, male # (sharing with domestic survey)  # domestic survey map_ln_srv_fixed_sel_pars[,1,1,1,2] <- 5 # a50, domestic survey, time block 1, female map_ln_srv_fixed_sel_pars[,2,1,1,2] <- 2 # delta, domestic survey, time block 1, female # (sharing with coop survey) map_ln_srv_fixed_sel_pars[,1,1,2,2] <- 6 # a50, domestic survey, time block 1, male map_ln_srv_fixed_sel_pars[,2,1,2,2] <- 4 # delta, domestic survey, time block 1, male # (sharing with coop survey)  input_list$map$ln_srv_fixed_sel_pars <- factor(map_ln_srv_fixed_sel_pars)  # input into map list input_list$par$ln_srv_fixed_sel_pars[] <- log(5) # some more informative starting values"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"setup-model-weighting","dir":"Articles","previous_headings":"","what":"Setup Model Weighting","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"Finally, can specify want model weighting conducted. case, using TMB-style likelihoods (likelihoods = 1) data sources weighted user specified sigmas standard errors. Thus, remaining arguments Wt_Catch, Wt_FishIdx, Wt_SrvIdx, Wt_Rec, Wt_F specified 1. Additionally, Francis re-weighting used case study composition weights similarly specified values 1 (Wt_FishAgeComps, Wt_FishLenComps, Wt_SrvAgeComps, Wt_SrvLenComps).","code":"# set up model weighting stuff input_list <- Setup_Mod_Weighting(input_list = input_list,                                   sablefish_ADMB = 0,                                   # don't use sablefish single region ADMB quirks                                   likelihoods = 1, # using TMB-style likelihoods,                                   # and weight using sigmas, instead of lambdas                                   # and sigmas together                                   Wt_Catch = 1,                                   Wt_FishIdx = 1,                                   Wt_SrvIdx = 1,                                   Wt_Rec = 1,                                   Wt_F = 1,                                   Wt_Tagging = 1,                                   # Composition model weighting                                   Wt_FishAgeComps =                                     array(1, dim = c(input_list$data$n_regions,                                                      length(input_list$data$years),                                                      input_list$data$n_sexes,                                                      input_list$data$n_fish_fleets)),                                   Wt_FishLenComps =                                     array(1, dim = c(input_list$data$n_regions,                                                      length(input_list$data$years),                                                      input_list$data$n_sexes,                                                      input_list$data$n_fish_fleets)),                                   Wt_SrvAgeComps =                                     array(1, dim = c(input_list$data$n_regions,                                                      length(input_list$data$years),                                                      input_list$data$n_sexes,                                                      input_list$data$n_srv_fleets)),                                   Wt_SrvLenComps =                                     array(1, dim = c(input_list$data$n_regions,                                                      length(input_list$data$years),                                                      input_list$data$n_sexes,                                                      input_list$data$n_srv_fleets)) )"},{"path":"https://chengmatt.github.io/SPoCK/articles/g_spatial_sablefish_case_study.html","id":"fit-model-and-plot","dir":"Articles","previous_headings":"","what":"Fit Model and Plot","title":"Setting up a Spatial Model (Alaska Sablefish)","text":"done setup! Now, can run model. aided fit_model function, expects data, mapping, parameters list uses MakeADFUN function internally. lists can extracted input_list constructed. report file extracted internally fit_model standard errors can extracted using RTMB::sdreport function. word caution, take run! Inspecting results spatial model, appears highest spawning biomass occurs CGOA, followed EGOA. Western regions generally demonstrate relatively comparable levels spawning biomass. Additionally, western regions (BS AI) along CGOA appear exhibit highest recruitment levels.","code":"# extract out lists updated with helper functions data <- input_list$data parameters <- input_list$par mapping <- input_list$map  # Fit model sabie_rtmb_model <- fit_model(data,                               parameters,                               mapping,                               random = NULL,                               newton_loops = 5,                               silent = TRUE                               )  # Get standard error report sabie_rtmb_model$sd_rep <- RTMB::sdreport(sabie_rtmb_model) # Get recruitment time-series rec_series <- reshape2::melt((sabie_rtmb_model$rep$Rec)) rec_series$Par <- \"Recruitment\"  # Get SSB time-series ssb_series <- reshape2::melt((sabie_rtmb_model$rep$SSB)) ssb_series$Par <- \"Spawning Biomass\"  ts_df <- rbind(ssb_series,rec_series) # bind together  # Do some data munging here ts_df <- ts_df %>% dplyr::rename(Region = Var1, Year = Var2) %>%    dplyr::mutate(Region = dplyr::case_when(     Region == 1 ~ 'BS',     Region == 2 ~ 'AI',     Region == 3 ~ 'WGOA',     Region == 4 ~ 'CGOA',     Region == 5 ~ 'EGOA'   ),   Region = factor(Region, levels = c(\"BS\", \"AI\", \"WGOA\", \"CGOA\", \"EGOA\")),   Year = Year + 1959)  # plot! ggplot(ts_df, aes(x = Year, y = value, color = Region)) +   geom_line(size = 1.3) +   facet_grid(Par~Region, scales = \"free_y\") +   ggthemes::scale_color_colorblind() +   labs(y = \"Value\")  +   theme_bw(base_size = 13) +   theme(legend.position = 'none')"},{"path":"https://chengmatt.github.io/SPoCK/articles/h_closed_loop_simulations.html","id":"define-operating-model","dir":"Articles","previous_headings":"","what":"Define Operating Model","title":"Run Closed Loop Simulations","text":"can define operating model want condition population . Parameter estimates used purely hypothetical generally represents short-lived species. Operating model simulation can defined following code: can create variety simulation objects store results : Initial values fishing mortality need supplied. case, array Fmort gets populated values according specified fishing mortality patterns, remaining values following feedback_start_yr = 25 left zeros, populated closed-loop simulation. Fishery selectivity dynamics can specified following function: Similarly, survey dynamics can defined, user can define observation error survey, survey catchability, survey selectivity: Recruitment dynamics can defined code chunk , various options available, including whether recruits move, recruitment sex-ratio, recruitment parameters recruitment functional forms, well whether recruitment occurs globally locally (applicable spatial context). , region 1 assumed productive region 2. Biological features population can defined code chunk , ability define natural mortality values, weight--age, maturity--age, patterns biological dynamics. movement dynamics can incredibly complex, designed users supply defined movement “matrix”. matrix needs input sim_list object use. , defining movement individuals move productive region (region 1) less Lastly, observation processes need defined simulation, includes observations tagging data, survey indices, fishery survey age compositions. done following functions: operating model specifications now saved sim_list, can later used within closed-loop simulation. Following operating model specification, can define want estimation model . demonstration purposes, directly mimicking operating model specification (self-test).","code":"# Set up model dimensions sim_list <- Setup_Sim_Dim(n_sims = 5, # number of simulations to conduct                           n_yrs = 50, # number of years                           n_regions = 2, # number of regions                           n_ages = 8, # number of ages                           n_sexes = 1, # number of sexes                           n_fish_fleets = 1, # number of fishery fleets                           n_srv_fleets = 1, # number of survey fleets                           run_feedback = T, # specifies whether to run this as a closed-loop                           feedback_start_yr = 25 # when the closed loop starts                           ) # set up containers sim_list <- Setup_Sim_Containers(sim_list) # Setup fishing mortality sim_list <- Setup_Sim_FishMort(sim_list = sim_list, # simulation list defined from above                                sigmaC = 1e-3, # observation error for catch                                init_F_vals = matrix(0, nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets), # initial F values to impose on initial age structure                                Fmort_pattern = matrix(c('one-way', \"one-way\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets), # fishing mortality pattern                                Fmort_start = matrix(c(0.01, 0.01), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets), # start value of fishing mortality                                Fmort_fct = matrix(c(50, 50), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets), # factor to multiply fmort_start by to reach apicial F                                proc_error = FALSE, # whether or not to have fishing mortality process error                                proc_error_sd = 0 # process error on fishing mortality ) sim_list <- Setup_Sim_FishSel(sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets), # selex model                               # a50, k for logistic shared across regions                               fixed_fish_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_fish_fleets, 2)),                               sim_list = sim_list # simulation list from previous code chunk ) sim_list <- Setup_Sim_Survey(sim_list = sim_list,                              sigmaSrvIdx = array(0.05, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # survey observation error                              base_srv_q = array(1, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # base survey catchability value                              srv_q_pattern = matrix(c('constant', \"constant\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # catchability pattern                              sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # selectivity model                              # a50, k, for logistic shared across regions                              fixed_srv_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_srv_fleets, 2)) ) # Setup recruitment stuff sim_list <- Setup_Sim_Rec(   sim_list = sim_list,   do_recruits_move = \"dont_move\", # == 0, recruits don't move , == 1 recruits move   base_rec_sexratio = 1, # single sex   rec_sexratio_vary = \"constant\", # sex ratio type   base_r0 = c(100, 50),   r0_vary = \"constant\", # R0 type   base_h = c(0.8, 0.8), # base steepness values   init_sigmaR = 0.5, # inital deviations variability   sigmaR = 0.5, # sigma R   recruitment_opt = \"bh_rec\", # recruitment option   rec_dd = \"global\", # recruitment deviations density dependence   init_dd = \"global\", # initial age deviations density dependence   rec_lag = 1 # recruitment ssb lag ) sim_list <- Setup_Sim_Biologicals(   sim_list = sim_list,   base_M_value = array(0.5, dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sims)), # base M value   M_pattern = \"constant\", # M pattern   base_WAA_values = array(rep(5 / (1 + exp(-1 * (1:sim_list$n_ages - 5))), each = sim_list$n_regions * sim_list$n_sexes),                           dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)), # weight-at-age values   WAA_pattern = \"constant\", # weight-at-age patterns   base_Maturity_AA_values = array(rep(1 / (1 + exp(-2 * (1:sim_list$n_ages - 5))), each = sim_list$n_regions * sim_list$n_sexes),                                   dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)), # matrutiy at age values   Maturity_AA_pattern = \"constant\" # maturity at age patterns ) ref <- 1 movement_matrix <- array(0, dim = c(sim_list$n_regions, sim_list$n_regions, sim_list$n_yrs, sim_list$n_ages, sim_list$n_sexes, sim_list$n_sims)) # From, To base <- matrix(c(0, 1), sim_list$n_regions, sim_list$n_regions, byrow = TRUE)  # Plug in movement process error for(sim in 1:sim_list$n_sims) {   for(a in 1:sim_list$n_ages) {     for(s in 1:sim_list$n_sexes) {       for(y in 1:sim_list$n_yrs) {         for(r in 1:sim_list$n_regions) {           tmp_move <- base[r,]           tmp_move[-ref] <- tmp_move[-ref]           movement_matrix[r,,y,a,s,sim] <- exp(tmp_move) / sum(exp(tmp_move))         } # end r loop       } # end y loop     } # end s loop   } # end a loop } # end sim loop  sim_list$movement_matrix <- movement_matrix sim_list <- Setup_Sim_Tagging(   sim_list = sim_list,   n_tags = 5000, # number of total tags to release in a year   max_liberty = 30, # maximum number of years to track a cohort   tag_years = seq(1, sim_list$n_yrs, 1), # number of years tagging occurs   t_tagging = 0.5, # time of tagging   base_Tag_Reporting = c(0.2, 0.2), # base tag reporting rates   Tag_Reporting_pattern = \"constant\", # tag reporting rate pattern   Tag_Ind_Mort = 0, # initial tag induced mortality   Tag_Shed = 0 # chronic tag shedding )  # Setup observation processes sim_list <- Setup_Sim_Observation_Proc(   sim_list = sim_list,   Comp_Structure = \"spltR_jntS\", # how compositions should be structured   Comp_Srv_Like = \"Multinomial\", # survey comp likelihood   Comp_Fish_Like = \"Multinomial\", # fishery comp likelihood   ISS_FishAge_Pattern = 'constant', # input sample size pattern (should be constant in closed loop)   FishAgeTheta = NA, # optional parameters for dirichlet-multinomial   SrvAgeTheta = NA, # optional parameters for dirichlet-multinomial   Srv_Like_Pars = NA, # optional parameters for dirichlet-multinomial   base_ISS_FishAge = 500, # base sample size for fishery ages   base_ISS_SrvAge = 500, # base sample size for survey ages   Tag_Like = \"Poisson\", # tag likelihood   Tag_Like_Pars = NA # tag likelihood parameters )"},{"path":"https://chengmatt.github.io/SPoCK/articles/h_closed_loop_simulations.html","id":"define-estimation-model","dir":"Articles","previous_headings":"","what":"Define Estimation Model","title":"Run Closed Loop Simulations","text":"define estimation model, creating skeleton data, parameter, mapping lists using maximum number years simulation (int case, specified 100), get truncated year total number simulation years using Get_Feedback_Data function. Note specifications described , almost data objects specified either 0s NAs. get replaced later , using Get_Feedback_Data function. , first set general model dimensions: can setup modeled recruitment dynamics. , specifying Beverton-Holt stock recruitment function, global density-dependence. Moreover, fixing steepness values specified operating model. Biological values similarly specified values defined operating model following function. , weight--age maturity--age fixed true values, natural mortality freely estimated. also estimate movement, given tagging data simulated. Movement specified constant across ages, years, sexes. Fishery survey data, along associated observation processes need specified. includes catch composition data. Note fishery survey composition data, input sample size provided left NA 0s. almost ! need specify fishery survey selectivity catchability processes. case, single fishery survey fleet operates, selectivity specified logistic fishery survey. Selectivity time-spatially-invariant. Catchability estimated survey (since isn’t fishery index simulated) also time- spatially-invariant. Observation processes tagging data need defined. , assuming Poisson tag likelihood (operating model), constant tag reporting rates freely estimated. Note tag release indicator must defined (indicates tag cohort (rows), tag region (first column), tag release year (second column)). Lastly, can set model weights estimation model following function. , λ\\lambda weights used, thus specified value 1. Now, can create skeleton data, parameters, mapping lists, define estimationg model. dimensions lists get adjusted, get adjusted later . defining operating estimation model, can now setup closed-loop simulation. closed-loop simulation requires harvest control rule defined user. case, using threshold control rule, type rule can defined. Note harvest control rule defined must function arguments x takes spawning biomass input, frp, takes fishery reference point, brp, takes biological reference point. additional arguments specified defaults used. can setup simulation environment (external global) can used store simulation outputs Setup_sim_env function.","code":"# Initialize model dimensions and data list input_list <- Setup_Mod_Dim(years = 1:sim_list$n_yrs, # vector of years                             ages = 1:sim_list$n_ages, # vector of ages                             lens = 1, # number of lengths                             n_regions = sim_list$n_regions, # number of regions                             n_sexes = sim_list$n_sexes, # number of sexes                             n_fish_fleets = sim_list$n_fish_fleets, # number of fishery fleet                             n_srv_fleets = sim_list$n_srv_fleets, # number of survey fleets                             verbose = F # whether or not to return messages                             ) # helper to define steepness starting values inv_steepness <- function(s) qlogis((s - 0.2) / 0.8)  # Setup recruitment stuff (using defaults for other stuff) input_list <- Setup_Mod_Rec(input_list = input_list, # input data list from above                             # Model options                             ln_sigmaR = log(c(0.5, 0.5)), # sigmaR for model                             rec_model = \"bh_rec\", # recruitment model                             sigmaR_spec = \"fix\", # fix sigmaR                             InitDevs_spec = \"est_shared_r\", # estimated global initial deviations                             RecDevs_spec = \"est_shared_r\", # estimate global recruitment deviations                             rec_dd = \"global\", # global recruitment density dependence                             rec_lag = 1, # recruitment ssb lag                             h_spec = \"fix\", # fixing steepness                             steepness_h = inv_steepness(c(0.8, 0.8)) # steepness values in bounded logit space                             ) input_list <- Setup_Mod_Biologicals(input_list = input_list,                                     WAA = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$ages), input_list$data$n_sexes)), # weight at age                                      MatAA = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$ages))), # maturity at age input_list$data$n_sexes)),                                     ln_M = log(0.5) # natural mortality value                                     ) input_list <- Setup_Mod_Movement(input_list = input_list,                                  # Model options                                  Movement_ageblk_spec = 'constant', # constant age movement                                  Movement_yearblk_spec = 'constant', # constant year movement                                  Movement_sexblk_spec = \"constant\", # constant sex movement                                  do_recruits_move = 0, # recruits dont move                                  cont_vary_movement = 'none' # no continously varying movement                                  ) input_list <- Setup_Mod_Catch_and_F(input_list = input_list,                                     ObsCatch = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # observed catches                                     Catch_Type = array(1, dim = c(length(input_list$data$years), input_list$data$n_fish_fleets)), # catch type                                     UseCatch = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether catch is used                                      # Model options                                     sigmaC_spec = 'fix', # sigma catch specification                                     sigmaF_spec = \"fix\" # sigma for F specification )  # Setup fishery indices and compositions input_list <- Setup_Mod_FishIdx_and_Comps(input_list = input_list,                                           ObsFishIdx = array(NA, c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # fishery index (not used)                                           ObsFishIdx_SE = array(NA, c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # fishery index SE (not used)                                           UseFishIdx = array(0, c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether fishery index is used                                           ObsFishAgeComps = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$ages), input_list$data$n_sexes, input_list$data$n_fish_fleets)), # observed fishery age comps                                           UseFishAgeComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether fishery ages are used                                           ObsFishLenComps = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$lens), input_list$data$n_sexes, input_list$data$n_fish_fleets)), # observed fishery lengths                                           UseFishLenComps = array(0, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether fishery lengths are used                                           ISS_FishAgeComps = array(500, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_fish_fleets)), # fishery input sample size. NOTE: This is specified at 500, as in the OM, and is not left blank!                                            # Model options                                           fish_idx_type = \"none\", # fishery index type                                           FishAgeComps_LikeType = \"Multinomial\", # composition likelihood                                           FishLenComps_LikeType = \"none\", # composition likelihood                                           FishAgeComps_Type =  \"spltRjntS_Year_1-terminal_Fleet_1\", # age composition type                                           FishLenComps_Type =  \"none_Year_1-terminal_Fleet_1\" # length composition type                                           )  # Setup survey indices and compositions input_list <- Setup_Mod_SrvIdx_and_Comps(input_list = input_list,                                          ObsSrvIdx = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_srv_fleets)), # observed survey index                                          ObsSrvIdx_SE = array(0.05, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_srv_fleets)), # observed susrvey index SE                                          UseSrvIdx =  array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether survey indices are used                                          ObsSrvAgeComps = array(NA,  dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$ages), input_list$data$n_sexes, input_list$data$n_srv_fleets)), # observed survey ages                                          UseSrvAgeComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_fish_fleets)), # whether survey ages are used                                          ObsSrvLenComps = array(NA, dim = c(input_list$data$n_regions, length(input_list$data$years), length(input_list$data$lens), input_list$data$n_sexes, input_list$data$n_srv_fleets)), # survey length comps                                          UseSrvLenComps = array(0, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_srv_fleets)), # whether survey lengths are used                                          ISS_SrvAgeComps = array(500, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_srv_fleets)), # survey input sample size. NOTE: This is specified at 500, as in the OM, and is not left blank!                                           # Model options                                          srv_idx_type = \"abd\", # survey index type                                          SrvAgeComps_LikeType = \"Multinomial\", # composition likelihood                                          SrvLenComps_LikeType = \"none\", # composition likelihood                                          SrvAgeComps_Type = \"spltRjntS_Year_1-terminal_Fleet_1\", # age composition type                                          SrvLenComps_Type = \"none_Year_1-terminal_Fleet_1\" # length composition type                                          ) # Setup fishery selectivity and catchability input_list <- Setup_Mod_Fishsel_and_Q(input_list = input_list,                                       # Model options                                       cont_tv_fish_sel = \"none_Fleet_1\", # whether selex is continously varying                                       fish_sel_blocks = \"none_Fleet_1\", # fishery selex blocks                                       fish_sel_model = \"logist1_Fleet_1\", # fishery selex model                                       fish_q_blocks = \"none_Fleet_1\", # fishery catchability blocks                                       fish_fixed_sel_pars = \"est_shared_r\" # whether parameters are spatially varying )  # Setup survey selectivity and catchability input_list <- Setup_Mod_Srvsel_and_Q(input_list = input_list,                                      cont_tv_srv_sel = \"none_Fleet_1\",  # whether selex is continously varying                                      srv_sel_blocks = \"none_Fleet_1\", # survey selex blocks                                      srv_sel_model = \"logist1_Fleet_1\", # survey selex model                                      srv_q_blocks = \"none_Fleet_1\", # survey catchability blocks                                      srv_fixed_sel_pars_spec = \"est_shared_r\", # whether parameters are spatially varying                                      srv_q_spec = \"est_shared_r\" # estimate survey q, and spatially-invariant                                      ) # Setup tagging stuff input_list <- Setup_Mod_Tagging(input_list = input_list,                                 tag_release_indicator = as.matrix(sim_list$tag_rel_indicator), # tag release indicator (this MUST BE DEFINED!)                                 Tagged_Fish = array(NA, dim = c(dim(sim_list$Tag_Fish[1:nrow(as.matrix(sim_list$tag_rel_indicator)),,,1]), input_list$data$n_sexes)), # tagged fish                                 Obs_Tag_Recap = array(NA, dim = c(dim(sim_list$Obs_Tag_Recap[,1:nrow(as.matrix(sim_list$tag_rel_indicator)),,,,1]), input_list$data$n_sexes)), # tag recaptures                                  # Model options                                 UseTagging = 1, # whether tagging are used                                 t_tagging = 0.5, # time tagging occurs                                 max_tag_liberty = 30, # max tag liberty to track ohorts                                 Tag_LikeType = 'Poisson', # possion likelihood                                 tag_selex = \"SexSp_DomFleet\", # sex-specific and weighted sum of fleet selex                                 tag_natmort = \"AgeSp_SexSp\", # age and sex-specific natural mortailty                                 move_age_tag_pool = \"all\", # pooling all tag age data to fit                                 move_sex_tag_pool = \"all\", # pooling all sex data tp fit                                 Init_Tag_Mort_spec = \"fix\", # don't estimate inital tag mortliaty                                 Tag_Shed_spec = \"fix\", # don't estimate tag shedding                                 TagRep_spec = \"est_shared_r\", # spatially-invariant tag reporting                                 Tag_Reporting_blocks = c(\"none_Region_1\", \"none_Region_2\") # no tag reporting time blocks ) # setup model weighting input_list <- Setup_Mod_Weighting(input_list = input_list,                                   sablefish_ADMB = 0, # not using sablefish weirdness                                   likelihoods = 1, # tmb likelihoods                                   Wt_Catch = 1, # catch weight                                   Wt_FishIdx = 1, # fishery idx weight                                   Wt_SrvIdx = 1, # survey idx weight                                   Wt_Rec = 1, # recruitment penatly weight                                   Wt_F = 1, # fishing mortality weight                                   Wt_Tagging = 1, # tagging weight                                                                      # composition data weights                                   Wt_FishAgeComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_fish_fleets)),                                   Wt_FishLenComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_fish_fleets)),                                   Wt_SrvAgeComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_srv_fleets)),                                   Wt_SrvLenComps = array(1, dim = c(input_list$data$n_regions, length(input_list$data$years), input_list$data$n_sexes, input_list$data$n_srv_fleets)) ) skeleton_data <- input_list$data skeleton_parameters <- input_list$par skeleton_mapping <- input_list$map HCR_function <- function(x, frp, brp, alpha = 0.05) {   stock_status <- x / brp # define stock status   # If stock status is > 1   if(stock_status >= 1) f <- frp   # If stock status is between brp and alpha   if(stock_status > alpha && stock_status < 1) f <- frp * (stock_status - alpha) / (1 - alpha)   # If stock status is less than alpha   if(stock_status < alpha) f <- 0   return(f) } sim_env <- Setup_sim_env(sim_list)"},{"path":"https://chengmatt.github.io/SPoCK/articles/h_closed_loop_simulations.html","id":"run-closed-loop","dir":"Articles","previous_headings":"","what":"Run Closed Loop","title":"Run Closed Loop Simulations","text":"closed loop can defined following code chunk. first loop characterizes given simulation, second loop characterizes given year simulation. run_annual_cycle function utilized run population dynamics given year. Following , year want begin management feedback, first obtain necessary data years 1:y given simulation using function Get_Feedback_Data, truncates skeleton data, parameters, mapping list correct years. feed lists estimation model using fit_model function. Next, extract necessary inputs reference point functions projection functions. Reference points can derived using Get_Reference_Points associated catch said reference point derived using 1 year population projection using Do_Population_Projection function. Lastly, catch associated reference point input back simulated population. converting estimated catch fishing mortality rates using bisection_F function, based true underlying population dynamics simulated operating model. can inspect outputs MSE. Plotted trajectories regional fishing mortality spawning stock biomass given simulation. dotted vertical line indicates feedback loop first started.","code":"set.seed(123) # to reproduce # Start Simulation for (sim in 1:sim_env$n_sims) {   for (y in 1:sim_env$n_yrs) {      ### Run Annual Cycle --------------------------------------------------------     run_annual_cycle(y, sim, sim_env)      # Start Feedback Loop     if(y >= sim_env$feedback_start_yr) {        # Get feedback data (aligning year index)       feedback <- Get_Feedback_Data(sim_env = sim_env, sim_list = sim_list,                                     y = y, sim = sim,                                     skeleton_data = skeleton_data,                                     skeleton_parameters = skeleton_parameters,                                     skeleton_mapping = skeleton_mapping                                     )        # Extract out data, parameters, and mapping       data <- feedback$retro_data       parameters <- feedback$retro_parameters       mapping <- feedback$retro_mapping        ### Run Assessment ----------------------------------------------------------       obj <- fit_model(data,                        parameters,                        mapping,                        random = NULL,                        newton_loops = 3,                        silent = T                        )        # Get necessary data inputs for later functions       n_proj_yrs <- 2       tmp_terminal_NAA <- array(obj$rep$NAA[,y,,], dim = c(sim_env$n_regions, sim_env$n_ages, sim_env$n_sexes)) # terminal numbers at age       tmp_WAA <- array(rep(data$WAA[,y,,], each = n_proj_yrs), dim = c(sim_env$n_regions, n_proj_yrs, sim_env$n_ages, sim_env$n_sexes)) # weight at age       tmp_MatAA <- array(rep(data$MatAA[,y,,], each = n_proj_yrs), dim = c(sim_env$n_regions, n_proj_yrs, sim_env$n_ages, sim_env$n_sexes)) # maturity at age       tmp_fish_sel <- array(rep(obj$rep$fish_sel[,y,,,], each = n_proj_yrs), dim = c(sim_env$n_regions, n_proj_yrs, sim_env$n_ages, sim_env$n_sexes, sim_env$n_fish_fleets)) # selectivity       tmp_Movement <- array(rep(obj$rep$Movement[,,y,,,drop=FALSE], n_proj_yrs), dim = c(sim_env$n_regions, sim_env$n_regions, n_proj_yrs, sim_env$n_ages, sim_env$n_sexes))       tmp_terminal_F <- array(obj$rep$Fmort[,y,], dim = c(sim_env$n_regions, sim_env$n_fish_fleets)) # terminal fishing mortality       tmp_natmort <- array(obj$rep$natmort[,y,,], dim = c(sim_env$n_regions, n_proj_yrs, sim_env$n_ages, sim_env$n_sexes)) # natural mortality       tmp_recruitment <- array(obj$rep$Rec[,1:(y - 1)], dim = c(sim_env$n_regions, length(1:(y - 1)))) # recruitment to use for projections        ### Run reference point module ----------------------------------------------       reference_points <- Get_Reference_Points(data = data,                                                rep = obj$rep,                                                SPR_x = 0.4,                                                 t_spwn = 0,                                                sex_ratio_f = 0.5,                                                calc_rec_st_yr = 1,                                                rec_age = 1,                                                type = 'multi_region',                                                what = 'independent_SPR'                                                )        # extract fishery and biological reference points       tmp_f_ref_pt <- array(reference_points$f_ref_pt, dim = c(sim_env$n_regions, n_proj_yrs)) # fishery reference points       tmp_b_ref_pt <- array(reference_points$b_ref_pt, dim = c(sim_env$n_regions, n_proj_yrs)) # biological reference points       ### Run Projection Module ---------------------------------------------------       # Do projection to get TAC      proj <- Do_Population_Projection(n_proj_yrs = 2,                                       n_regions = sim_env$n_regions,                                       n_ages = sim_env$n_ages,                                       n_sexes = sim_env$n_sexes,                                       sexratio = 1,                                       n_fish_fleets = sim_env$n_fish_fleets,                                       do_recruits_move = 0,                                       recruitment = tmp_recruitment,                                       terminal_NAA = tmp_terminal_NAA,                                       terminal_F = tmp_terminal_F,                                       natmort = tmp_natmort,                                       WAA = tmp_WAA,                                       MatAA = tmp_MatAA,                                       fish_sel = tmp_fish_sel,                                       Movement = tmp_Movement,                                       f_ref_pt = tmp_f_ref_pt,                                       b_ref_pt = tmp_b_ref_pt,                                       HCR_function = HCR_function,                                       recruitment_opt = \"mean_rec\",                                       fmort_opt = \"HCR\",                                       t_spawn = 0                                       )        # Get TAC       tmp_TAC <- proj$proj_Catch[,2,,drop = FALSE] # get TAC from projected year        ### TAC to Fishing Mortality ------------------------------------------------       # Only run till last year       if(y < sim_env$n_yrs) {         for(r in 1:sim_env$n_regions) {           for(f in 1:sim_env$n_fish_fleets) {              # Go from TAC to Fishing mortality (using true values from simulation)             tmp_F <- bisection_F(f_guess = 0.05,                                  catch = tmp_TAC[r,1,f],                                  NAA = sim_env$NAA[r,y+1,,,sim],                                  WAA = sim_env$WAA[r,y+1,,,sim],                                  natmort = sim_env$M[r,y+1,,,sim],                                  fish_sel = sim_env$fish_sel[r,y+1,,,f,sim]                                  )              sim_env$Fmort[r,y+1,f,sim] <- tmp_F            } # end r loop         } # end f loop       } # end if      } # end if for feedback loop    } # end y loop } # end sim loop # Trajectories of spawning biomass reshape2::melt(sim_env$SSB) %>%   dplyr::rename(Region = Var1, Year = Var2, Sim = Var3) %>%   ggplot(aes(x = Year, y = value, group = Sim)) +   geom_line() +   geom_vline(xintercept = sim_env$feedback_start_yr, lty = 2) +   facet_wrap(~Region) +   theme_bw(base_size = 15) +   labs(y = 'SSB') +   ylim(0, NA)  # Trajectories of observed catches reshape2::melt(sim_env$Obs_Catch) %>%   dplyr::rename(Region = Var1, Year = Var2, Fleet = Var3, Sim = Var4) %>%   dplyr::filter(Year != 36) %>%   ggplot(aes(x = Year, y = value, group = Sim)) +   geom_line() +   geom_vline(xintercept = sim_env$feedback_start_yr, lty = 2) +   facet_wrap(~Region) +   theme_bw(base_size = 15) +   labs(y = 'Catch') +   ylim(0, NA)"},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"reference-points","dir":"Articles","previous_headings":"","what":"Reference Points","title":"Deriving Reference Points and Catch Advice","text":"Management reference points SPoCK divided single-region spatial reference points. Single-region reference points include: Spawning potential ratio (SPR) reference points, estimate fishing mortality rate reduces spawning biomass per recruit x% unfished level. Maximum sustainable yield (MSY) reference points, based Beverton-Holt relationship, estimate fishing mortality rate maximizes long-term yield. Spatial reference points also include SPR MSY-based metrics, divided : Independent SPR reference points, estimate region-specific fishing mortality rates reduce spawning biomass per recruit x% unfished level, ignoring movement. Independent MSY reference points, estimate region-specific fishing mortality rates maximize yield within given region. Global SPR reference points, estimate global fishing mortality rate reduces total spawning biomass per recruit x% unfished level, accounting movement. Global MSY reference points, estimate global fishing mortality rate maximizes long-term yield across regions.","code":""},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"sglregionspr","dir":"Articles","previous_headings":"Reference Points > Single Region","what":"Spawning Potential Ratio Reference Points","title":"Deriving Reference Points and Catch Advice","text":"derive SPR reference points, users must specify target percentage representing spawning biomass per recruit fishing relative unfished level. Following , several additional quantities needed compute reference points. includes: relative fishing mortality fleets (Fratf=Fmorty=term,f/∑fFmorty=term,fFrat_f = Fmort_{y = term,f} / \\sum_f Fmort_{y = term,f}), fleet-specific fishery selectivity (Sely=term,,s=1,fFshSel_{y = term,,s = 1,f}^{Fsh}), natural mortality females (=1,,s=1M_{y=1,,s=1}), weight age females (Wy=1,,s=1W_{y=1,,s=1}), maturity age females (Maty=1,,s=1Mat_{y=1,,s=1}), spawn timing (tspwnt_{spwn}), vector recruitment values (Recy,sRec_{y,s}), recruitment sex ratio (ψs\\psi_s), recruitment age (RecAgeRecAge), first year recruitment vector (RecYearRecYear) used mean recruitment calculations. relative fishing mortality fleets fleet-specific fishery selectivity, terminal year utilized calculations. contrast, estimates first model year utilized natural mortality, weight age, maturity age. SPR reference points derived following process: $$ N_{= 1}^{fished} = 1 \\\\ N_{= 1}^{unfished} = 1 $$ Na=1fishedN_{= 1}^{fished} Na=1unfishedN_{= 1}^{unfished} fished unfished numbers age per-recruit, respectively, first age class. Subsequent numbers age per-recruit computed exponential mortality model, fished numbers age per-recruit decremented natural fishing mortality, unfished numbers age per-recruit decremented natural mortality: Nafished={Na−1fished⋅exp(−(=1,−1,s=1+∑fFratf⋅Fx⋅Sely=term,−1,s=1,fFsh))2<<nagesNa−1fished⋅exp(−(=1,nages−1,s=1+∑fFratf⋅Fx⋅Sely=term,nages−1,s=1,fFsh))1−exp(−(=1,nages,s=1+∑fFratf⋅Fx⋅Sely=term,nages,s=1,fFsh))=nages N_{}^{\\text{fished}} =  \\begin{cases} N_{- 1}^{\\text{fished}} \\cdot \\exp\\left(-\\left(M_{y=1,-1,s=1} + \\sum_f \\text{Frat}_f \\cdot F_x \\cdot \\text{Sel}_{y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right)\\right) & \\text{} 2 < < n_{\\text{ages}} \\\\ \\\\ N_{- 1}^{\\text{fished}} \\cdot  \\frac{ \\exp\\left(-\\left(M_{y=1,n_{\\text{ages}}-1,s=1} + \\sum_f \\text{Frat}_f \\cdot F_x \\cdot \\text{Sel}_{y=\\text{term},n_{\\text{ages}}-1,s=1,f}^{\\text{Fsh}}\\right)\\right) }{ 1 - \\exp\\left(-\\left(M_{y=1,n_{\\text{ages}},s=1} + \\sum_f \\text{Frat}_f \\cdot F_x \\cdot \\text{Sel}_{y=\\text{term},n_{\\text{ages}},s=1,f}^{\\text{Fsh}}\\right)\\right) } & \\text{} = n_{\\text{ages}} \\end{cases} Naunfished={Na−1unfished⋅exp(−=1,−1,s=1)2<<nagesNa−1unfished⋅exp(−=1,nages−1,s=1)1−exp(−=1,nages,s=1)=nages N_{}^{\\text{unfished}} =  \\begin{cases} N_{- 1}^{\\text{unfished}} \\cdot \\exp\\left(-M_{y=1,-1,s=1}\\right) & \\text{} 2 < < n_{\\text{ages}} \\\\ \\\\ N_{- 1}^{\\text{unfished}} \\cdot  \\frac{ \\exp\\left(-M_{y=1,n_{\\text{ages}}-1,s=1}\\right) }{ 1 - \\exp\\left(-M_{y=1,n_{\\text{ages}},s=1}\\right) } & \\text{} = n_{\\text{ages}} \\end{cases} FxF_x represents estimated fishing mortality rate reduces spawning biomass per recruit x%, relative unfished level. Fished unfished numbers age per recruit can converted spawning biomass per recruit quantities (SSBSSB) following equations: SSBfished=∑aNafished⋅Wy=1,,s=1⋅Maty=1,,s=1⋅exp(−tspwn⋅=1,,s=1+∑fFratf⋅Fx⋅Sely=term,,s=1,fFsh) SSB^{\\text{fished}} = \\sum_a N_{}^{\\text{fished}} \\cdot W_{y=1,,s=1} \\cdot \\text{Mat}_{y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{y=1,,s=1} + \\sum_f \\text{Frat}_f \\cdot F_x \\cdot \\text{Sel}_{y=\\text{term},,s=1,f}^{\\text{Fsh}} \\right) SSBunfished=∑aNaunfished⋅Wy=1,,s=1⋅Maty=1,,s=1⋅exp(−tspwn⋅=1,,s=1) SSB^{\\text{unfished}} = \\sum_a N_{}^{\\text{unfished}} \\cdot W_{y=1,,s=1} \\cdot \\text{Mat}_{y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{y=1,,s=1} \\right) SPR defined fraction fished unfished spawning biomass per recruit: SPR=SSBfishedSSBunfished SPR = \\frac{SSB^{fished}}{SSB^{unfished}} FxF_x solved using non-linear function minimizer minimizing following criteria: Fx=argminF{100⋅(SPR(F)−x%)2} F_x = \\arg\\min_{F} \\left\\{ 100 \\cdot \\left( \\text{SPR}(F) - \\text{x%} \\right)^2 \\right\\} Biological SPR-based reference points (BxB_x) can derived multiplying fished spawning biomass per recruit mean recruitment user-defined period recruitment sex-ratio: Bx=SSBfished⋅∑RecYearY−RecAgeRecy,sY−RecAge−RecYearψs B_x = SSB^{\\text{fished}} \\cdot \\frac{\\sum_{RecYear}^{Y - RecAge} Rec_{y,s}}{Y - RecAge - RecYear} \\psi_s","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"sglregionmsy","dir":"Articles","previous_headings":"Reference Points > Single Region","what":"Maximum Sustainable Yield Reference Points (Beverton-Holt)","title":"Deriving Reference Points and Catch Advice","text":"Deriving MSY based reference points using Beverton-Holt stock recruitment relationship involves maximizing equilibrium yield per recruit requires several additional inputs. completeness, summarize required inputs derive MSY based reference points assuming Beverton-Holt relationship. inputs include: relative fishing mortality fleets (Fratf=Fmorty=term,f/∑fFmorty=term,fFrat_f = Fmort_{y = term,f} / \\sum_f Fmort_{y = term,f}), fleet-specific fishery selectivity (Sely=term,,s=1,fFshSel_{y = term,,s = 1,f}^{Fsh}), natural mortality females (=1,,s=1M_{y=1,,s=1}), weight age females (Wy=1,,s=1W_{y=1,,s=1}), maturity age females (Maty=1,,s=1Mat_{y=1,,s=1}), estimate virgin recruitment (R0R_0), estimate steepness (hh), recruitment sex ratio (ψs\\psi_s). Similarly, relative fishing mortality fleets fleet-specific fishery selectivity, terminal year estimates utilized calculations. contrast, estimates first model year utilized natural mortality, weight age, maturity age. MSY reference points can derived using standard per-recruit calculations, initial number fished unfished individuals can set arbitrary value: $$ N_{= 1}^{fished} = 1 \\\\ N_{= 1}^{unfished} = 1 $$ following numbers--age per recruit decremented exponential mortality model: Nafished={Na−1fished⋅exp(−(=1,−1,s=1+∑fFratf⋅Fmsy⋅Sely=term,−1,s=1,fFsh))2<<nagesNa−1fished⋅exp(−(=1,nages−1,s=1+∑fFratf⋅Fmsy⋅Sely=term,nages−1,s=1,fFsh))1−exp(−(=1,nages,s=1+∑fFratf⋅Fmsy⋅Sely=term,nages,s=1,fFsh))=nages   N_{}^{\\text{fished}} =      \\begin{cases}   N_{- 1}^{\\text{fished}} \\cdot \\exp\\left(-\\left(M_{y=1,-1,s=1} + \\sum_f \\text{Frat}_f \\cdot F_{msy} \\cdot \\text{Sel}_{y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right)\\right) & \\text{} 2 < < n_{\\text{ages}} \\\\   \\\\   N_{- 1}^{\\text{fished}} \\cdot    \\frac{     \\exp\\left(-\\left(M_{y=1,n_{\\text{ages}}-1,s=1} + \\sum_f \\text{Frat}_f \\cdot F_{msy} \\cdot \\text{Sel}_{y=\\text{term},n_{\\text{ages}}-1,s=1,f}^{\\text{Fsh}}\\right)\\right)   }{     1 - \\exp\\left(-\\left(M_{y=1,n_{\\text{ages}},s=1} + \\sum_f \\text{Frat}_f \\cdot F_{msy} \\cdot \\text{Sel}_{y=\\text{term},n_{\\text{ages}},s=1,f}^{\\text{Fsh}}\\right)\\right)   } & \\text{} = n_{\\text{ages}}   \\end{cases} Naunfished={Na−1unfished⋅exp(−=1,−1,s=1)2<<nagesNa−1unfished⋅exp(−=1,nages−1,s=1)1−exp(−=1,nages,s=1)=nages   N_{}^{\\text{unfished}} =      \\begin{cases}   N_{- 1}^{\\text{unfished}} \\cdot \\exp\\left(-M_{y=1,-1,s=1}\\right) & \\text{} 2 < < n_{\\text{ages}} \\\\   \\\\   N_{- 1}^{\\text{unfished}} \\cdot    \\frac{     \\exp\\left(-M_{y=1,n_{\\text{ages}}-1,s=1}\\right)   }{     1 - \\exp\\left(-M_{y=1,n_{\\text{ages}},s=1}\\right)   } & \\text{} = n_{\\text{ages}}   \\end{cases} FmsyF_{msy} represents fishing mortality result equilibrium yield maximized. Yield per recruit quantities can computed using Baranov’s catch equation: Ca=∑fFratf⋅Fmsy⋅Sely=term,−1,s=1,fFsh(=1,−1,s=1+∑fFratf⋅Fmsy⋅Sely=term,−1,s=1,fFsh)⋅Nafished⋅(1−exp[−(=1,nages,s=1+∑fFratf⋅Fmsy⋅Sely=term,nages,s=1,fFsh)]) C_{} =  \\frac{   \\sum_f \\text{Frat}_f \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{y=\\text{term},-1,s=1,f}^{\\text{Fsh}} }{   \\left(M_{y=1,-1,s=1} + \\sum_f \\text{Frat}_f \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right) } \\cdot N_a^{\\text{fished}} \\cdot  \\left(   1 - \\exp\\left[     -\\left(       M_{y=1,n_{\\text{ages}},s=1} + \\sum_f \\text{Frat}_f \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{y=\\text{term},n_{\\text{ages}},s=1,f}^{\\text{Fsh}}     \\right)   \\right] \\right) Values equilibrium recruitment calculated using Beverton-Holt stock recruitment relationship. Estimates equilibrium recruitment needed convert per recruit quantities yield BmsyB_{msy}. , first derive fished unfished spawning biomass per recruit: $$ SSB^{\\text{fished}} = \\sum_a N_{}^{\\text{fished}} \\cdot W_{y=1,,s=1} \\cdot \\text{Mat}_{y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{y=1,,s=1} + \\sum_f \\text{Frat}_f \\cdot F_x \\cdot \\text{Sel}_{y=\\text{term},,s=1,f}^{\\text{Fsh}} \\right) \\\\ $$ SSBunfished=∑aNaunfished⋅Wy=1,,s=1⋅Maty=1,,s=1⋅exp(−tspwn⋅=1,,s=1) SSB^{\\text{unfished}} = \\sum_a N_{}^{\\text{unfished}} \\cdot W_{y=1,,s=1} \\cdot \\text{Mat}_{y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{y=1,,s=1} \\right) Equilibrium recruitment can derived following: Req=4⋅h⋅R0⋅SSBfishedSSBunfished⋅(1−h)+SSBfished⋅(5⋅h−1) Req = \\frac{4\\cdot h \\cdot R_0 \\cdot SSB^{\\text{fished}}}{SSB^{\\text{unfished}} \\cdot (1 - h) + SSB^{\\text{fished}} \\cdot (5 \\cdot h - 1)} ReqReq equilibrium recruitment. Yield BmsyB_{msy} can computed multiplying yield per recruit spawning biomass per recruit estimate equilibrium recruitment: $$ Yield = \\sum_a C_a \\cdot Req \\\\ B_{msy} = SSB^{\\text{fished}} \\cdot Req $$ Lastly, FmsyF_{msy} solved using non-linear function minimizer minimizing following criteria (maximizing yield): Fmsy=argminFYield F_{msy} = \\arg\\min_{F} Yield","code":""},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"spawning-potential-ratio-reference-points","dir":"Articles","previous_headings":"Reference Points > Multi Region","what":"Spawning Potential Ratio Reference Points","title":"Deriving Reference Points and Catch Advice","text":"general, multi region SPR reference points can computed similar manner single region SPR reference points. additional complication calculating spatial reference points includes additional region subscript quantities, well potential need account movement processes.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"independent","dir":"Articles","previous_headings":"Reference Points > Multi Region > Spawning Potential Ratio Reference Points","what":"Independent","title":"Deriving Reference Points and Catch Advice","text":"case users assume movement occurs among regions, SPR rates can calculated independently region, results region-specific Fr,xF_{r,x} Br,xB_{r,x} estimates. Thus, region unique Fr,xF_{r,x} estimate can applied. calculations computed manner equations described computing SPR rates single region case except additional subscript added demographic rates. Following , Fr,xF_{r,x} can solved minimizing following criteria region: Fr,x=argminFr{100⋅(SPR(Fr)−x%)2} F_{r,x} = \\arg\\min_{F_r} \\left\\{ 100 \\cdot \\left( \\text{SPR}(F_r) - \\text{x%} \\right)^2 \\right\\} Regional biological SPR-based reference points (BxB_x) can derived multiplying fished spawning biomass per recruit regional mean recruitment user-defined period recruitment sex-ratio: Br,x=SSBrfished⋅∑RecYearY−RecAgeRecr,y,sY−RecAge−RecYearψs B_{r,x} = SSB_r^{\\text{fished}} \\cdot \\frac{\\sum_{RecYear}^{Y - RecAge} Rec_{r,y,s}}{Y - RecAge - RecYear} \\psi_s","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"global","dir":"Articles","previous_headings":"Reference Points > Multi Region > Spawning Potential Ratio Reference Points","what":"Global","title":"Deriving Reference Points and Catch Advice","text":"contrast computing reference points assuming independent populations, SPR rates can also computed globally, movement occurs among regions. Given assumption global SPR rates, results global FxF_x estimate, regional estimates Br,xB_{r,x} mean recruitment estimates defined regionally. Thus, global SPR solution results FxF_x reduces global spawning biomass per recruit x% unfished value, aggregate spawning biomass reaches equilibrium ∑rBr,x\\sum_r B_{r,x} applied long-term. However, solution result region reaching equilibrium Br,xB_{r,x}. Note value FxF_x applied region global SPR case. Deriving global SPR reference points requires different set inputs. include: relative fishing mortality fleets (Fratr,f=Fmortr,y=term,f/∑fFmortr,y=term,fFrat_{r,f} = Fmort_{r,y = term,f} / \\sum_f Fmort_{r,y = term,f}), fleet-specific fishery selectivity (Selr,y=term,,s=1,fFshSel_{r,y = term,,s = 1,f}^{Fsh}), natural mortality females (Mr,y=1,,s=1M_{r,y=1,,s=1}), weight age females (Wr,y=1,,s=1W_{r,y=1,,s=1}), maturity age females (Matr,y=1,,s=1Mat_{r,y=1,,s=1}), spawn timing (tspwnt_{spwn}), vector recruitment values (Recr,y,sRec_{r,y,s}), matrix movement values (\\boldsymbol{M}{_{y = term,,s = 1}) recruitment sex ratio (ψs\\psi_s), recruitment age (RecAgeRecAge), first year recruitment vector (RecYearRecYear) used mean recruitment calculations, recruitment proportions (apportionment) area (ζr\\zeta_r). Global SPR reference points calculated first setting regional numbers--age per-recruit model equal estimated recruitment apportionment parameters (ζr\\zeta_r), sum 1: $$ N_{r,= 1}^{\\text{fished}} = \\zeta_r \\\\ N_{r,= 1}^{\\text{unfished}} = \\zeta_r $$ , Nr,=1fishedN_{r,=1}^{\\text{fished}} Nr,=1unfishedN_{r,=1}^{\\text{unfished}} represent regional numbers--age per recruit (first age class) fished unfished conditions, respectively. Subsequently, movement applied. recruits allowed move, movement matrix applied starting age 1; otherwise, applied starting age 2: 𝐍afished=(𝐍afished)⊤𝐌y=term,,s=1for =amin,…,,amin={1if recruits move2otherwise \\boldsymbol{N}_a^{\\text{fished}} = (\\boldsymbol{N}_a^{\\text{fished}})^\\top \\boldsymbol{M}_{y = \\text{term}, , s = 1} \\quad \\text{} = a_{\\min}, \\dots, , \\quad a_{\\min} =  \\begin{cases}  1 & \\text{recruits move} \\\\ 2 & \\text{otherwise} \\end{cases} 𝐍aunfished=(𝐍aunfished)⊤𝐌y=term,,s=1for =amin,…,,amin={1if recruits move2otherwise \\boldsymbol{N}_a^{\\text{unfished}} = (\\boldsymbol{N}_a^{\\text{unfished}})^\\top \\boldsymbol{M}_{y = \\text{term}, , s = 1} \\quad \\text{} = a_{\\min}, \\dots, , \\quad a_{\\min} =  \\begin{cases}  1 & \\text{recruits move} \\\\ 2 & \\text{otherwise} \\end{cases} expressions, AA denotes number modeled ages (nagesn_{ages}) SPoCK multiplied 10. example, 30 ages modeled, =300A = 300. extension enables iterative propagation plus group movement, given closed-form solution exists. >nagesa > n_{ages} SPoCK, demographic fishery parameters held constant values terminal modeled age (nagesn_{ages}). Following movement processes, exponential mortality model applied: Nr,afished=Nr,−1fished⋅exp(−(Mr,y=1,−1,s=1+∑fFratr,f⋅Fx⋅Selr,y=term,−1,s=1,fFsh))2<<N_{r,}^{\\text{fished}} = N_{r,- 1}^{\\text{fished}} \\cdot \\exp\\left(-\\left(M_{r,y=1,-1,s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_{x} \\cdot \\text{Sel}_{r,y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right)\\right) \\quad \\text{} 2 < < Nr,aunfished=Nr,−1unfished⋅exp(−(Mr,y=1,−1,s=1))2<<N_{r,}^{\\text{unfished}} = N_{r,- 1}^{\\text{unfished}} \\cdot \\exp\\left(-\\left(M_{r,y=1,-1,s=1}\\right)\\right) \\quad \\text{} 2 < < , fished unfished numbers age per recruit can converted spawning biomass per recruit quantities: SSBrfished=∑aNr,afished⋅Wr,y=1,,s=1⋅Matr,y=1,,s=1⋅exp(−tspwn⋅Mr,y=1,,s=1+∑fFratr,f⋅Fx⋅Selr,y=term,,s=1,fFsh) SSB^{\\text{fished}}_r = \\sum_a N_{r,}^{\\text{fished}} \\cdot W_{r,y=1,,s=1} \\cdot \\text{Mat}_{r,y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{r,y=1,,s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_x \\cdot \\text{Sel}_{r,y=\\text{term},,s=1,f}^{\\text{Fsh}} \\right) SSBrunfished=∑aNr,aunfished⋅Wr,y=1,,s=1⋅Matr,y=1,,s=1⋅exp(−tspwn⋅Mr,y=1,,s=1) SSB^{\\text{unfished}}_r = \\sum_a N_{r,}^{\\text{unfished}} \\cdot W_{r,y=1,,s=1} \\cdot \\text{Mat}_{r,y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{r,y=1,,s=1} \\right) global spawning potential ratio can computed : SPR=∑rSSBrfished∑rSSBrfished SPR = \\frac{\\sum_r SSB^{\\text{fished}}_r}{\\sum_r SSB^{\\text{fished}}_r} FxF_x solved using non-linear function minimzer minimizing following criteria global SPR: Fx=argminF{100⋅(SPR(F)−x%)2} F_x = \\arg\\min_{F} \\left\\{ 100 \\cdot \\left( \\text{SPR}(F) - \\text{x%} \\right)^2 \\right\\} , biological SPR-based reference points assumed regional (Br,xB_{r,x}) derived multiplying fished spawning biomass per recruit regional mean recruitment user-defined period recruitment sex-ratio: Br,x=SSBrfished⋅∑RecYearY−RecAgeRecr,y,sY−RecAge−RecYearψs B_{r,x} = SSB^{\\text{fished}}_r \\cdot \\frac{\\sum_{RecYear}^{Y - RecAge} Rec_{r,y,s}}{Y - RecAge - RecYear} \\psi_s Thus, global SPR calculations result global FxF_x regional Br,xB_{r,x} estimates.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"maximum-sustainble-yield-reference-points-beverton-holt","dir":"Articles","previous_headings":"Reference Points > Multi Region","what":"Maximum Sustainble Yield Reference Points (Beverton-Holt)","title":"Deriving Reference Points and Catch Advice","text":"MSY-based reference points assuming Beverton-Holt stock recruitment relationship can derived either assuming independent populations without movement global population movement processes incorporated.","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"independent-1","dir":"Articles","previous_headings":"Reference Points > Multi Region > Maximum Sustainble Yield Reference Points (Beverton-Holt)","what":"Independent","title":"Deriving Reference Points and Catch Advice","text":"Deriving MSY reference points assuming independent populations similar single-region case, results region-specific Fr,msyF_{r,msy} Br,msyB_{r,msy} estimates, can applied region conducting catch projections determine management advice.general, calcualtions computed manner equations described computing MSY single region case, exception demographic rates fishery selectivity include region subscript. Notably, virgin recruitment considered regional compute equilibrium recruitment calculations derived following manner: Rr,0=R0ζr R_{r,0} = R_0 \\zeta_r Reqr=4⋅hr⋅Rr,0⋅SSBrfishedSSBrunfished⋅(1−hr)+SSBrfished⋅(5⋅hr−1) Req_r = \\frac{4\\cdot h_r \\cdot R_{r,0} \\cdot SSB_r^{\\text{fished}}}{SSB_r^{\\text{unfished}} \\cdot (1 - h_r) + SSB_r^{\\text{fished}} \\cdot (5 \\cdot h_r - 1)} Fr,msyF_{r,msy} derived minimizing (maximizing) yield region independently: Fr,msy=argminFrYieldr F_{r,msy} = \\arg\\min_{F_r} Yield_r Br,msyB_{r,msy} can derived : Br,msy=SSBrfishedReqr B_{r,msy} = SSB_r^{fished} Req_r","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"global-1","dir":"Articles","previous_headings":"Reference Points > Multi Region > Maximum Sustainble Yield Reference Points (Beverton-Holt)","what":"Global","title":"Deriving Reference Points and Catch Advice","text":"Deriving global MSY spatial cointext requires movement among regions accounted . Similar global SPR case, results global FmsyF_{msy} estimate, regional estiamtes Br,msyB_{r,msy} recruitment parameters defined regionally. results reference point achieves ∑rBr,msy\\sum_r B_{r,msy} entire population FmsyF_{msy} applied region, ensure region Br,msyB_{r,msy}. Global MSY reference points requires following inputs: relative fishing mortality fleets (Fratr,f=Fmortr,y=term,f/∑fFmortr,y=term,fFrat_{r,f} = Fmort_{r,y = term,f} / \\sum_f Fmort_{r,y = term,f}), fleet-specific fishery selectivity (Selr,y=term,,s=1,fFshSel_{r,y = term,,s = 1,f}^{Fsh}), natural mortality females (Mr,y=1,,s=1M_{r,y=1,,s=1}), weight age females (Wr,y=1,,s=1W_{r,y=1,,s=1}), maturity age females (Matr,y=1,,s=1Mat_{r,y=1,,s=1}), spawn timing (tspwnt_{spwn}), vector recruitment values (Recr,y,sRec_{r,y,s}), matrix movement values (\\boldsymbol{M}{_{y = term,,s = 1}) recruitment sex ratio (ψs\\psi_s), recruitment age (RecAgeRecAge), first year recruitment vector (RecYearRecYear) used mean recruitment calculations, global steepness value used, taken mean across regions steepness estimated regional (h=∑rhrnregionsh = \\frac{\\sum_r h_r}{n_{regions}}), recruitment proportions (apportionment) area (ζr\\zeta_r). Using standard per-recruit calculations, first define initial number fished unfished individuals based recruitment proportions area: $$ N_{r,= 1}^{\\text{fished}} = \\zeta_r \\\\ N_{r,= 1}^{\\text{unfished}} = \\zeta_r $$ , Nr,=1fishedN_{r,=1}^{\\text{fished}} Nr,=1unfishedN_{r,=1}^{\\text{unfished}} represent regional numbers--age per recruit (first age class) fished unfished conditions, respectively. can apply movement dynamics. recruits allowed move, movement matrix applied starting age 1; otherwise, applied starting age 2: 𝐍afished=(𝐍afished)⊤𝐌y=term,,s=1for =amin,…,,amin={1if recruits move2otherwise \\boldsymbol{N}_a^{\\text{fished}} = (\\boldsymbol{N}_a^{\\text{fished}})^\\top \\boldsymbol{M}_{y = \\text{term}, , s = 1} \\quad \\text{} = a_{\\min}, \\dots, , \\quad a_{\\min} =  \\begin{cases}  1 & \\text{recruits move} \\\\ 2 & \\text{otherwise} \\end{cases} 𝐍aunfished=(𝐍aunfished)⊤𝐌y=term,,s=1for =amin,…,,amin={1if recruits move2otherwise \\boldsymbol{N}_a^{\\text{unfished}} = (\\boldsymbol{N}_a^{\\text{unfished}})^\\top \\boldsymbol{M}_{y = \\text{term}, , s = 1} \\quad \\text{} = a_{\\min}, \\dots, , \\quad a_{\\min} =  \\begin{cases}  1 & \\text{recruits move} \\\\ 2 & \\text{otherwise} \\end{cases} expressions, AA denotes number modeled ages (nagesn_{ages}) SPoCK multiplied 10. example, 30 ages modeled, =300A = 300. extension enables iterative propagation plus group movement, given closed-form solution exists. >nagesa > n_{ages} SPoCK, demographic fishery parameters held constant values terminal modeled age (nagesn_{ages}). movement processes occur, exponential mortality model applied: Nr,afished=Nr,−1fished⋅exp(−(Mr,y=1,−1,s=1+∑fFratr,f⋅Fmsy⋅Selr,y=term,−1,s=1,fFsh))2<<N_{r,}^{\\text{fished}} = N_{r,- 1}^{\\text{fished}} \\cdot \\exp\\left(-\\left(M_{r,y=1,-1,s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_{msy} \\cdot \\text{Sel}_{r,y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right)\\right) \\quad \\text{} 2 < < Nr,aunfished=Nr,−1unfished⋅exp(−(Mr,y=1,−1,s=1))2<<N_{r,}^{\\text{unfished}} = N_{r,- 1}^{\\text{unfished}} \\cdot \\exp\\left(-\\left(M_{r,y=1,-1,s=1}\\right)\\right) \\quad \\text{} 2 < < Baranov’s catch equation invoked compute yield per recruit regio: Cr,=∑fFratr,f⋅Fmsy⋅Selr,y=term,−1,s=1,fFsh(Mr,y=1,−1,s=1+∑fFratr,f⋅Fmsy⋅Selr,y=term,−1,s=1,fFsh)⋅Nr,afished⋅(1−exp[−(Mr,y=1,nages,s=1+∑fFratr,f⋅Fmsy⋅Selr,y=term,nages,s=1,fFsh)]) C_{r,} =  \\frac{   \\sum_f \\text{Frat}_{r,f} \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{r,y=\\text{term},-1,s=1,f}^{\\text{Fsh}} }{   \\left(M_{r,y=1,-1,s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{r,y=\\text{term},-1,s=1,f}^{\\text{Fsh}}\\right) } \\cdot N_{r,}^{\\text{fished}} \\cdot  \\left(   1 - \\exp\\left[     -\\left(       M_{r,y=1,n_{\\text{ages}},s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_{\\text{msy}} \\cdot \\text{Sel}_{r,y=\\text{term},n_{\\text{ages}},s=1,f}^{\\text{Fsh}}     \\right)   \\right] \\right) Equilibrium recruitment computed using Beverton-Holt stock recruitment relationship, first need derive quantities fished unfished spawning biomass per recruit: SSBrfished=∑aNr,afished⋅Wr,y=1,,s=1⋅Matr,y=1,,s=1⋅exp(−tspwn⋅Mr,y=1,,s=1+∑fFratr,f⋅Fmsy⋅Selr,y=term,,s=1,fFsh) SSB_r^{\\text{fished}} = \\sum_a N_{r,}^{\\text{fished}} \\cdot W_{r,y=1,,s=1} \\cdot \\text{Mat}_{r,y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{r,y=1,,s=1} + \\sum_f \\text{Frat}_{r,f} \\cdot F_{msy} \\cdot \\text{Sel}_{r,y=\\text{term},,s=1,f}^{\\text{Fsh}} \\right) SSBrunfished=∑aNr,aunfished⋅Wr,y=1,,s=1⋅Matr,y=1,,s=1⋅exp(−tspwn⋅Mr,y=1,,s=1) SSB_r^{\\text{unfished}} = \\sum_a N_{r,}^{\\text{unfished}} \\cdot W_{r,y=1,,s=1} \\cdot \\text{Mat}_{r,y=1,,s=1} \\cdot \\exp\\left(-t_{\\text{spwn}} \\cdot M_{r,y=1,,s=1} \\right) Calculations equilibrium recruitment follow : Reqr=4⋅hr⋅R0ζr⋅SSBrfishedSSBrunfished⋅(1−h)+SSBrfished⋅(5⋅h−1) Req_r = \\frac{4\\cdot h_r \\cdot R_{0} \\zeta_r \\cdot SSB_r^{\\text{fished}}}{SSB_r^{\\text{unfished}} \\cdot (1 - h) + SSB_r^{\\text{fished}} \\cdot (5 \\cdot h - 1)} Lastly, yield Br,msyB_{r,msy} can calculated multiplying per recruit quantities equilibrium recruitment: Yieldr=∑∑rCr,⋅ReqrBr,msy=SSBrfished⋅Reqr Yield_r = \\sum_a \\sum_r C_{r,} \\cdot Req_r B_{r,msy} = SSB_r^{fished} \\cdot Req_r FmsyF_{msy} solved minimizing (maximizing) system wide yield: Fmsy=argminFYield F_{msy} = \\arg\\min_{F} Yield","code":""},{"path":"https://chengmatt.github.io/SPoCK/articles/i_reference_points.html","id":"deriving-catch-advice","dir":"Articles","previous_headings":"","what":"Deriving Catch Advice","title":"Deriving Reference Points and Catch Advice","text":"core part assessment process convert reference point estimates catch advice. following sections, mathematically describe catch advice derived, proceed provide code examples demonstration. conduct projection terminal year, users need following quantities: Terminal year estimates numbers--age, user defined period recruitment values use, user defined period weight--age values use projections, user defined period natural mortality-atage values use projections, user defined period maturity--age values use projections, user defined period fishery selectivity values use projections, user defined period movement values use projections, Terminal year estimates fishing mortality, Fishing mortality rate use decrement population, Optionally, biological reference points use, harvest control rule utilized,function describing harvest control rule.","code":""},{"path":"https://chengmatt.github.io/SPoCK/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Matthew Cheng. Author, maintainer.","code":""},{"path":"https://chengmatt.github.io/SPoCK/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Cheng M (2025). SPoCK: Spatial (S) Population (Po) Model Connectivity (C) across generalized Komponents (K). R package version 0.1.0, https://chengmatt.github.io/SPoCK.","code":"@Manual{,   title = {SPoCK: Spatial (S) Population (Po) Model with Connectivity (C) across generalized Komponents (K)},   author = {Matthew Cheng},   year = {2025},   note = {R package version 0.1.0},   url = {https://chengmatt.github.io/SPoCK}, }"},{"path":[]},{"path":"https://chengmatt.github.io/SPoCK/index.html","id":"matt-cheng-dan-goethel-pete-hulson-curry-cunningham","dir":"","previous_headings":"","what":"Matt Cheng, Dan Goethel, Pete Hulson, Curry Cunningham","title":"Spatial (S) Population (Po) Model with Connectivity (C) across generalized Komponents (K)","text":"generalized stock assessment model written RTMB, can extended represent number regions, ages, sexes, fleets.","code":""},{"path":"https://chengmatt.github.io/SPoCK/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Spatial (S) Population (Po) Model with Connectivity (C) across generalized Komponents (K)","text":"SPoCK package written RTMB optionally relies several packages plotting model diagnostics purposes. install package, users devtools installed. also generally recommended install packages listed , need users want functionality one-step ahead residuals. users may experience installation issues regarding permissions. can potentially circumvented following code: package still much active development. Use risk!","code":"install.packages(\"devtools\") # install dev tools install.packages(\"TMB\") # install TMB install.packages(\"RTMB\") # install RTMB TMB:::install.contrib(\"https://github.com/vtrijoulet/OSA_multivariate_dists/archive/main.zip\") # get multivariate OSA distributions  # optional packages to install devtools::install_github(\"fishfollower/compResidual/compResidual\") devtools::install_github(\"noaa-afsc/afscOSA\", dependencies = TRUE)  # install SPoCK devtools::install_github(\"chengmatt/SPoCK\", dependencies = TRUE) devtools::install_github(\"chengmatt/SPoCK\", dependencies = TRUE, lib = Sys.getenv(\"R_LIBS_USER\"))"},{"path":"https://chengmatt.github.io/SPoCK/reference/Do_Population_Projection.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Do Population Projections — Do_Population_Projection","title":"Title Do Population Projections — Do_Population_Projection","text":"Title Population Projections","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Do_Population_Projection.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Do Population Projections — Do_Population_Projection","text":"","code":"Do_Population_Projection(   n_proj_yrs = 2,   n_regions,   n_ages,   n_sexes,   sexratio,   n_fish_fleets,   do_recruits_move = 0,   recruitment,   terminal_NAA,   terminal_F,   natmort,   WAA,   MatAA,   fish_sel,   Movement,   f_ref_pt = NULL,   b_ref_pt = NULL,   HCR_function = NULL,   recruitment_opt = \"inv_gauss\",   fmort_opt = \"HCR\",   t_spawn,   bh_rec_opt = NULL )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Do_Population_Projection.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Do Population Projections — Do_Population_Projection","text":"n_proj_yrs Number projection years n_regions Number regions n_ages Number ages n_sexes Number sexes sexratio Recruitment sex ratio n_fish_fleets Number fishery fleets do_recruits_move Whether recruits move (0 == move, 1 == move) recruitment Recruitment matrix dimensioned n_regions, n_yrs want summarize across, condition projection terminal_NAA Terminal Numbers Age dimensioned n_regions, n_ages, n_sexes terminal_F Terminal fishing mortality rate, dimensioned n_regions, n_fish_fleets natmort Natural mortality, dimensioned n_regions, n_proj_yrs, n_ages, n_sexes WAA Weight age, dimensioned n_regions, n_proj_yrs, n_ages, n_sexes MatAA Maturity age, dimensioned n_regions, n_proj_yrs, n_ages, n_sexes fish_sel Fishery selectivity, dimensioned n_regions, n_proj_yrs, n_ages, n_sexes, n_fish_fleets Movement Movement, dimensioned n_regions, n_regions, n_proj_yrs, n_ages, n_sexes f_ref_pt Fishing mortality reference point dimensioned n_regions n_proj_yrs b_ref_pt Biological reference point dimensioned n_regions n_proj_yrs HCR_function Function describing harvest control rule. function always following arguments: x, represents SSB, frp, takes inputs fishery reference points, brp, takes inputs biological reference points. additional arguments specified defaults hard coded / fixed within function. e recruitment_opt Recruitment simulation option, options \"inv_gauss\", simulates future recruitment based recruitment values supplied using inverse gaussian distribution, \"mean_rec\", takes mean recruitment values supplied given region, \"zero\", assumes future recruitment occur fmort_opt Fishing Mortality option, includes \"HCR\", modifies F reference point using user supplied HCR_function, \"Input\", uses projected F values supplied user. t_spawn Fraction time spawning used compute projected SSB bh_rec_opt list object containing following arguments: recruitment_dd value (0 1) indicating global (1) local density dependence (0). case single region model, either local global give results rec_lag value indicating number years lagged given year's SSB produces recruits R0 virgin recruitment parameter Rec_Prop Recruitment apportionment values. single region model, set value 1. Dimensioned n_regions h Steepness values stock recruitment curve. Dimensioned n_regions WAA weight--age array dimensioned n_regions, n_ages, n_sexes, reference year utilize values first year MatAA maturity age array dimensioned n_regions, n_ages, n_sexes, reference year utilize values first year natmort natural mortality age array dimensioned n_regions, n_ages, n_sexes, reference year utilize values first year SSB SSB values estimated given model, dimensioned n_regions n_yrs","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Do_Population_Projection.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Do Population Projections — Do_Population_Projection","text":"list containing projected F, catch, SSB, Numbers Age. (Objects generally dimensioned following order: n_regions, n_yrs, n_ages, n_sexes, n_fleets)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Do_Population_Projection.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Do Population Projections — Do_Population_Projection","text":"","code":"if (FALSE) { # \\dontrun{ # Define HCR to use HCR_function <- function(x, frp, brp, alpha = 0.05) {   stock_status <- x / brp # define stock status   # If stock status is > 1   if(stock_status >= 1) f <- frp   # If stock status is between brp and alpha   if(stock_status > alpha && stock_status < 1) f <- frp * (stock_status - alpha) / (1 - alpha)   # If stock status is less than alpha   if(stock_status < alpha) f <- 0   return(f) } rep <- obj$report(obj$env$last.par.best) # need to have an RTMB object first # Setup necessary inputs n_sims <- 1000 t_spawn <- 0 sexratio <- 0.5 n_proj_yrs <- 15 n_regions <- 1 n_ages <- length(data$ages) n_sexes <- data$n_sexes n_fish_fleets <- 2 do_recruits_move <- 0 terminal_NAA <- array(obj$rep$NAA[,length(data$years),,], dim = c(n_regions, n_ages, n_sexes)) WAA <- array(rep(data$WAA[,length(data$years),,], each = n_proj_yrs), dim = c(n_regions, n_proj_yrs, n_ages, n_sexes)) # weight at age MatAA <- array(rep(data$MatAA[,length(data$years),,], each = n_proj_yrs), dim = c(n_regions, n_proj_yrs, n_ages, n_sexes)) # maturity at age fish_sel <- array(rep(obj$rep$fish_sel[,length(data$years),,,], each = n_proj_yrs), dim = c(n_regions, n_proj_yrs, n_ages, n_sexes, n_fish_fleets)) # selectivity Movement <- array(rep(obj$rep$Movement[,,length(data$years),,], each = n_proj_yrs), dim = c(n_regions, n_regions, n_proj_yrs, n_ages, n_sexes)) terminal_F <- array(obj$rep$Fmort[,length(data$years),], dim = c(n_regions, n_fish_fleets)) natmort <- array(obj$rep$natmort[,length(data$years),,], dim = c(n_regions, n_proj_yrs, n_ages, n_sexes)) recruitment <- array(obj$rep$Rec[,20:(length(data$years) - 2)], dim = c(n_regions, length(20:length(data$years) - 2)))  # Define reference points spr_35 <- Get_Reference_Points(data = data,                                rep = rep,                                SPR_x = 0.35, t_spwn = 0, sex_ratio_f = 0.5,                                calc_rec_st_yr = 20, rec_age = 2)  spr_40 <- Get_Reference_Points(data = data,                                rep = rep,                                SPR_x = 0.4, t_spwn = 0, sex_ratio_f = 0.5,                                calc_rec_st_yr = 20, rec_age = 2)  spr_60 <- Get_Reference_Points(data = data,                                rep = rep,                                SPR_x = 0.6, t_spwn = 0, sex_ratio_f = 0.5,                                calc_rec_st_yr = 20, rec_age = 2)  # Extract reference points b40 <- spr_40$b_ref_pt b60 <- spr_60$b_ref_pt f40 <- spr_40$f_ref_pt f35 <- spr_35$f_ref_pt f60 <- spr_60$f_ref_pt # Define the F used for each scenario (Based on BSAI Intro Report) proj_inputs <- list(   # Scenario 1 - Using HCR to adjust maxFABC   list(f_ref_pt = array(f40, dim = c(n_regions, n_proj_yrs)),        b_ref_pt = array(b40, dim = c(n_regions, n_proj_yrs)),        fmort_opt = 'HCR'   ),   # Scenario 2 - Using HCR to adjust maxFABC based on last year's value (constant fraction - author specified F)   list(f_ref_pt = array(f40 * (f40 / 0.086), dim = c(n_regions, n_proj_yrs)),        b_ref_pt = array(b40, dim = c(n_regions, n_proj_yrs)),        fmort_opt = 'HCR'   ),   # Scenario 3 - Using an F input of last 5 years average F, and   list(f_ref_pt = array(mean(rowSums(sabie_rtmb_model$rep$Fmort[1, 60:64, ])), dim = c(n_regions, n_proj_yrs)),        b_ref_pt = NULL,        fmort_opt = 'Input'   ),   # Scenario 4 - Using HCR to adjust F60   list(f_ref_pt = array(f60, dim = c(n_regions, n_proj_yrs)),        b_ref_pt = array(b40, dim = c(n_regions, n_proj_yrs)),        fmort_opt = 'HCR'   ),   # Scenario 5 - F is set at 0   list(f_ref_pt = array(0, dim = c(n_regions, n_proj_yrs)),        b_ref_pt = NULL,        fmort_opt = 'Input'   ),   # Scenario 6 - Using HCR to adjust FOFL   list(f_ref_pt = array(f35, dim = c(n_regions, n_proj_yrs)),        b_ref_pt = array(b40, dim = c(n_regions, n_proj_yrs)),        fmort_opt = 'HCR'   ),   # Scenario 7 - Using HCR to adjust FABC in first 2 projection years, and then later years are adjusting FOFL   list(f_ref_pt = array(c(rep(f40, 2), rep(f35, n_proj_yrs - 2)), dim = c(n_regions, n_proj_yrs)),        b_ref_pt = array(b40, dim = c(n_regions, n_proj_yrs)),        fmort_opt = 'HCR'   ) )  # store outputs all_scenarios_f <- array(0, dim = c(n_regions, n_proj_yrs, n_sims, length(proj_inputs))) all_scenarios_ssb <- array(0, dim = c(n_regions, n_proj_yrs, n_sims, length(proj_inputs))) all_scenarios_catch <- array(0, dim = c(n_regions, n_proj_yrs, n_fish_fleets, n_sims, length(proj_inputs)))  for (i in seq_along(proj_inputs)) {   for (sim in 1:n_sims) {      # do population projection     out <- Do_Population_Projection(n_proj_yrs = n_proj_yrs,                                     n_regions = n_regions,                                     n_ages = n_ages,                                     n_sexes = n_sexes,                                     sexratio = sexratio,                                     n_fish_fleets = n_fish_fleets,                                     do_recruits_move = do_recruits_move,                                     recruitment = recruitment,                                     terminal_NAA = terminal_NAA,                                     terminal_F = terminal_F,                                     natmort = natmort,                                     WAA = WAA,                                     MatAA = MatAA,                                     fish_sel = fish_sel,                                     Movement = Movement,                                     f_ref_pt = proj_inputs[[i]]$f_ref_pt,                                     b_ref_pt = proj_inputs[[i]]$b_ref_pt,                                     HCR_function = HCR_function,                                     recruitment_opt = \"inv_gauss\",                                     fmort_opt = proj_inputs[[i]]$fmort_opt,                                     t_spawn = t_spawn     )      all_scenarios_ssb[,,sim,i] <- out$proj_SSB     all_scenarios_catch[,,,sim,i] <- out$proj_Catch     all_scenarios_f[,,sim,i] <- out$proj_F[,-(n_proj_yrs+1)] # remove last year, since it's not used   } # end sim loop   print(i) } # end i loop  # If users were to specify \"bh_rec\" for recruitment_opt, a list of specifications for projecting deterministic recruitment is required. An example # of this is provided below: bh_rec_opt <- list(   recruitment_dd = 1,   rec_lag = 1,   R0 = rep$R0,   h = rep$h_trans,   Rec_Prop = 1,   WAA = array(data$WAA[,1,,], dim = c(1, n_ages, n_sexes)),   MatAA = array(data$MatAA[,1,,], dim = c(1, n_ages, n_sexes)),   natmort = array(data$Fixed_natmort[,1,,], dim = c(1, n_ages, n_sexes)),   SSB = rep$SSB ) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/Equilibrium_PopSim_Iter.html","id":null,"dir":"Reference","previous_headings":"","what":"Get equilibrium age structure for simulation via n iterations — Equilibrium_PopSim_Iter","title":"Get equilibrium age structure for simulation via n iterations — Equilibrium_PopSim_Iter","text":"Get equilibrium age structure simulation via n iterations","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Equilibrium_PopSim_Iter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get equilibrium age structure for simulation via n iterations — Equilibrium_PopSim_Iter","text":"","code":"Equilibrium_PopSim_Iter(   n_regions = n_regions,   n_sexes = n_sexes,   n_ages = n_ages,   init_iter = init_iter,   NAA,   M,   init_F,   fish_sel,   r0,   rec_sexratio,   movement_matrix )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Equilibrium_PopSim_Iter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get equilibrium age structure for simulation via n iterations — Equilibrium_PopSim_Iter","text":"n_regions Number reginos n_sexes Number sexes n_ages Number ages init_iter Number initial iterations NAA Initial numbers age array dimensioned year, region, age, sex, 1 M Natural mortality array dimensioned year, region, age, sex, 1 init_F Initial fishing mortality array dimensioned year, region, fleet, 1 fish_sel Fishery selectivity array dimensioned year, region, age, sex, fleet, 1 r0 virgin mean recruitment array dimensioned year, region, 1 rec_sexratio Recruitment sexratio array dimensioned year, region, sex, 1 movement_matrix Movement array, dimensioned region , region , year, age, sex, 1","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_3d_precision.html","id":null,"dir":"Reference","previous_headings":"","what":"Constructor algorithin for correlations within ages, years, and cohort (Work in Progress) — Get_3d_precision","title":"Constructor algorithin for correlations within ages, years, and cohort (Work in Progress) — Get_3d_precision","text":"Constructor algorithin correlations within ages, years, cohort (Work Progress)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_3d_precision.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Constructor algorithin for correlations within ages, years, and cohort (Work in Progress) — Get_3d_precision","text":"","code":"Get_3d_precision(   n_ages,   n_yrs,   pcorr_age,   pcorr_year,   pcorr_cohort,   ln_var_value,   Var_Type )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_3d_precision.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Constructor algorithin for correlations within ages, years, and cohort (Work in Progress) — Get_3d_precision","text":"n_ages Number ages n_yrs Number years pcorr_age correlations age pcorr_year correaltions year pcorr_cohort correlaitons cohort ln_var_value log space variance Var_Type variance type == 0, marginal (stationary slower run time), == 1 conditional (non-statationary, faster run time)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_3d_precision.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Constructor algorithin for correlations within ages, years, and cohort (Work in Progress) — Get_3d_precision","text":"Sparse precision matrix dimensioned n_ages * n_years, n_ages * n_years","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Comp_Likelihoods.html","id":null,"dir":"Reference","previous_headings":"","what":"Gives negative log liklelihood values for composition data for a given year and a given fleet (fishery or survey) — Get_Comp_Likelihoods","title":"Gives negative log liklelihood values for composition data for a given year and a given fleet (fishery or survey) — Get_Comp_Likelihoods","text":"Gives negative log liklelihood values composition data given year given fleet (fishery survey)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Comp_Likelihoods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Gives negative log liklelihood values for composition data for a given year and a given fleet (fishery or survey) — Get_Comp_Likelihoods","text":"","code":"Get_Comp_Likelihoods(   Exp,   Obs,   ISS,   Wt_Mltnml,   ln_theta_agg,   ln_theta,   LN_corr_pars = 0,   LN_corr_pars_agg = 0,   Comp_Type,   Likelihood_Type,   n_regions,   n_model_bins,   n_obs_bins,   n_sexes,   age_or_len,   AgeingError,   use,   comp_agg_type )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Comp_Likelihoods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Gives negative log liklelihood values for composition data for a given year and a given fleet (fishery or survey) — Get_Comp_Likelihoods","text":"Exp Expected values (catch age survey index age) indexed given year fleet (structured matrix age sex) Obs Observed values (catch age survey index age) indexed given year fleet (structured matrix age sex) ISS Input sample size indexed given year fleet (structured vector w/ sexes) Wt_Mltnml Mutlinomial weight () given fleet (structured vector w/ sexes) ln_theta_agg Log overdispersion parameter comp_type == 0, want estsimate either dirichlet multinomial ln_theta Log theta overdispersion Dirichlet mutlinomial (scalar vector depending 'Split' 'Joint') LN_corr_pars Logistic normal correlation parameters (dimensioned n_regions, n_sexes, 3 parameters) LN_corr_pars_agg Logistic normal correlation parameters comps aggregated (just dimensioned length 1 value) Comp_Type Composition Parameterization Type (== 0, aggregated comps sex, == 1, split comps sex region (implicit sex region ratio information), == 2, joint comps across sexes split region (implicit sex ratio information, region information)) Likelihood_Type Composition Likelihood Type (== 0, Multinomial, == 1 Dirichlet Multinomial) n_regions number regions modeled n_model_bins Number bins used model n_obs_bins Number observed composition bins n_sexes Number sexes modeled age_or_len Age length comps (== 0, Age, == 1, Length) AgeingError Ageing Error matrix use Vector 0s 1s corresponding regions (==0, obs dont' use, ==1, obs use) comp_agg_type aggregate data (aggregating)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Comp_Likelihoods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Gives negative log liklelihood values for composition data for a given year and a given fleet (fishery or survey) — Get_Comp_Likelihoods","text":"Returns negative log likelihood composition data (age /length)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Det_Recruitment.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Deterministic Recruitment — Get_Det_Recruitment","title":"Get Deterministic Recruitment — Get_Det_Recruitment","text":"Get Deterministic Recruitment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Det_Recruitment.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Deterministic Recruitment — Get_Det_Recruitment","text":"","code":"Get_Det_Recruitment(   recruitment_model,   recruitment_dd,   y,   rec_lag,   R0,   Rec_Prop,   h,   n_regions,   n_ages,   WAA,   MatAA,   natmort,   SSB_vals )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Det_Recruitment.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Deterministic Recruitment — Get_Det_Recruitment","text":"recruitment_model == 0, mean recruitment, == 1 beverton holt recruitment steepness recruitment_dd Recruitment density dependence (0 == local, 1 == global) y year rec_lag recruitment lag indexing SSB year R0 virgin mean recruitment (global) Rec_Prop Recruitment proportions allocate global R0 local density dependence h Vector steepness values n_regions n_regions Number regions n_ages number ages WAA Weight age region age MatAA Maturity region age natmort Natural moratliaty region age SSB_vals SSB matrix regiona year","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Det_Recruitment.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Deterministic Recruitment — Get_Det_Recruitment","text":"Vector n_regions deterministic recruitment values mean recruitment beverton holt","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Feedback_Data.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Truncates data to feedback simulation loop year — Get_Feedback_Data","title":"Title Truncates data to feedback simulation loop year — Get_Feedback_Data","text":"Title Truncates data feedback simulation loop year","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Feedback_Data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Truncates data to feedback simulation loop year — Get_Feedback_Data","text":"","code":"Get_Feedback_Data(   sim_env,   sim_list,   y,   sim,   skeleton_data,   skeleton_parameters,   skeleton_mapping )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Feedback_Data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Truncates data to feedback simulation loop year — Get_Feedback_Data","text":"sim_env Simulation environment defined using Simulate_Pop_Feedback sim_list Simulation list defines operating model options y y index used annual cycle sim sim index used annual cycle skeleton_data Skeleton data list estimation method (SPoCK) dimensions defined using total number simulation years skeleton_parameters Skeleton parameters list estimation method (SPoCK) dimensions defined using total number simulation years skeleton_mapping Skeleton mapping list estimation method (SPoCK) dimensions defined using total number simulation years","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Feedback_Data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Truncates data to feedback simulation loop year — Get_Feedback_Data","text":"Returns data, parameters, mapping list truncated match feedback year","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Reference_Points.html","id":null,"dir":"Reference","previous_headings":"","what":"Wrapper function to get reference points — Get_Reference_Points","title":"Wrapper function to get reference points — Get_Reference_Points","text":"Wrapper function get reference points","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Reference_Points.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Wrapper function to get reference points — Get_Reference_Points","text":"","code":"Get_Reference_Points(   data,   rep,   SPR_x = NULL,   t_spwn = 0,   sex_ratio_f = 0.5,   calc_rec_st_yr = 1,   rec_age = 1,   type,   what )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Reference_Points.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Wrapper function to get reference points — Get_Reference_Points","text":"data Data list RTMB rep Report list RTMB SPR_x SPR percentage target t_spwn specified mortality time spawning sex_ratio_f Sex ratio females used compute biological reference points calc_rec_st_yr first year mean recruitment computed rec_age Actual recruitment age value type Whether \"single_region\" reference point \"multi_region\" kind reference point use: SPR Spawning Potential Ratio single region model independent_SPR Spawning Potential Ratio multi region model, without movement global_SPR Global Spawning Potential Ratio multi region model, movement BH_MSY MSY reference points derived Beverton-Holt single region model independent_BH_MSY MSY reference points derived Beverton-Holt, without movement global_BH_MSY MSY reference points derived Beverton-Holt, movement","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Reference_Points.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Wrapper function to get reference points — Get_Reference_Points","text":"list object fishing biological reference points","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Reference_Points.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Wrapper function to get reference points — Get_Reference_Points","text":"","code":"if (FALSE) { # \\dontrun{ f_40 <- Get_Reference_Points(data = data, rep = rep, SPR_x = 0.4, t_spwn = 0, type = \"single_region\", what = \"SPR\") f_40$F_x # estimated reference point } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Selex.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Selectivity — Get_Selex","title":"Get Selectivity — Get_Selex","text":"Get Selectivity","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Selex.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Selectivity — Get_Selex","text":"","code":"Get_Selex(   Selex_Model,   TimeVary_Model,   ln_Pars,   ln_seldevs,   Region,   Year,   Age,   Sex )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Selex.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Selectivity — Get_Selex","text":"Selex_Model integer selectivity model TimeVary_Model Time-varying selectivity model == 0, constant blocked, == 1 iid, == 2 random walk, == 3 3dar1 marginal, == 4 3dar1 conditional, ==5 2dar1 ln_Pars log selectivity parameters ln_seldevs selectivity deviations array dimensioned n_regions, n_years, n_ages, n_sexes, 1 Region Region index value Year Year index value Age vector Ages Sex Sex index value","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Tagging_Mortality.html","id":null,"dir":"Reference","previous_headings":"","what":"Get values for total tag mortality and tag fishing mortality — Get_Tagging_Mortality","title":"Get values for total tag mortality and tag fishing mortality — Get_Tagging_Mortality","text":"Get values total tag mortality tag fishing mortality","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Tagging_Mortality.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get values for total tag mortality and tag fishing mortality — Get_Tagging_Mortality","text":"","code":"Get_Tagging_Mortality(   tag_selex,   tag_natmort,   Fmort,   natmort,   Tag_Shed,   fish_sel,   n_regions,   n_ages,   n_sexes,   n_fish_fleets,   y,   what )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Tagging_Mortality.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get values for total tag mortality and tag fishing mortality — Get_Tagging_Mortality","text":"tag_selex Tag selectivity options, == 0 (uniform, F fleet 1 (dominant fleet)), == 1 (sex-averaged selectivity, F fleet 1 (dominant fleet)), == 2 (sex-specific selectivity, F fleet 1 (dominant fleet)), 3 (uniform F summed across fleets), 4 (sex averaged F summed across fleets, weighted sum), 5 (sex-specific F summed across fleets, weighted sum) tag_natmort Tag natural mortality options == 0 (averaged across sexes ages), == 1 (averaged across sexes, unique ages), == 2 (sex-specific, averaged across ages), == 3 (sex-age-specific) Fmort Array fishing mortality, dimensioned n_region, n_years, n_fish_fleets natmort Array fishing mortality, dimensioned n_region, n_years, n_ages, n_sexes Tag_Shed Scalar chronic tag shedding rate fish_sel Array fishery selectivity, dimensioned n_region, n_years, n_ages, n_sexes, n_fish_fleetss n_regions Number regions n_ages Number ages n_sexes Number sexes n_fish_fleets Number fishery fleets y Year index Whether return Z F (total fishing mortality)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_Tagging_Mortality.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get values for total tag mortality and tag fishing mortality — Get_Tagging_Mortality","text":"Z F values tagging specifications","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_move_PE_loglik.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Movement Process Error Likelihoods — Get_move_PE_loglik","title":"Title Get Movement Process Error Likelihoods — Get_move_PE_loglik","text":"Title Get Movement Process Error Likelihoods","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_move_PE_loglik.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Movement Process Error Likelihoods — Get_move_PE_loglik","text":"","code":"Get_move_PE_loglik(   PE_model,   PE_pars,   logit_devs,   map_move_devs,   do_recruits_move )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_move_PE_loglik.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Movement Process Error Likelihoods — Get_move_PE_loglik","text":"PE_model Process error model values PE_pars Process error parameters logit_devs Deviations map_move_devs movement deviations share do_recruits_move Whether recruits move (0, move, 1 move)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_move_PE_loglik.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Movement Process Error Likelihoods — Get_move_PE_loglik","text":"numeric value log likelihood (positive space)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_sel_PE_loglik.html","id":null,"dir":"Reference","previous_headings":"","what":"Get selectivity process error log likelihoods (positive) — Get_sel_PE_loglik","title":"Get selectivity process error log likelihoods (positive) — Get_sel_PE_loglik","text":"Get selectivity process error log likelihoods (positive)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_sel_PE_loglik.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get selectivity process error log likelihoods (positive) — Get_sel_PE_loglik","text":"","code":"Get_sel_PE_loglik(PE_model, PE_pars, ln_devs, map_sel_devs, sel_vals)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_sel_PE_loglik.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get selectivity process error log likelihoods (positive) — Get_sel_PE_loglik","text":"PE_model Process error model values (1, 2, 3, 4, 5) (iid, random walk, 3d marginal, 3d conditional, 2dar1) PE_pars Process error parameters ln_devs Deviations map_sel_devs selectivity deviations share sel_vals Selectivity values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Get_sel_PE_loglik.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get selectivity process error log likelihoods (positive) — Get_sel_PE_loglik","text":"numeric value log likelihood (positive space)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Restrc_Comps.html","id":null,"dir":"Reference","previous_headings":"","what":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","title":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","text":"Restructure composition values, used within variety functions either Francis reweighting get observed expected composition values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Restrc_Comps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","text":"","code":"Restrc_Comps(Exp, Obs, Comp_Type, age_or_len, AgeingError, comp_agg_type)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Restrc_Comps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","text":"Exp Expected values (catch age survey index age) indexed given year fleet (structured matrix age sex) Obs Observed values (catch age survey index age) indexed given year fleet (structured matrix age sex) Comp_Type Composition Parameterization Type (== 0, aggregated comps sex, == 1, split comps sex (implicit sex ratio information), == 2, joint comps across sexes (implicit sex ratio information) age_or_len Age length comps (== 0, Age, == 1, Length) AgeingError Ageing Error matrix comp_agg_type Composition aggregation type mimic sablefish ADMB assessment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Restrc_Comps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","text":"Returns list array observed expected values given year fleet","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Restrc_Comps.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Restructure composition values, used within a variety of functions to either do Francis reweighting or get observed and expected composition values — Restrc_Comps","text":"","code":"if (FALSE) { # \\dontrun{ comps <- Restrc_Comps(Exp, Obs, Comp_Type, age_or_len, AgeingError) comps$Exp; comps$Obs } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/SPoCK_rtmb.html","id":null,"dir":"Reference","previous_headings":"","what":"Generalized RTMB model — SPoCK_rtmb","title":"Generalized RTMB model — SPoCK_rtmb","text":"Generalized RTMB model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/SPoCK_rtmb.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generalized RTMB model — SPoCK_rtmb","text":"","code":"SPoCK_rtmb(pars, data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/SPoCK_rtmb.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generalized RTMB model — SPoCK_rtmb","text":"pars Parameter List data Data List","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Biologicals.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup biological inputs for estimation model — Setup_Mod_Biologicals","title":"Setup biological inputs for estimation model — Setup_Mod_Biologicals","text":"Setup biological inputs estimation model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Biologicals.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup biological inputs for estimation model — Setup_Mod_Biologicals","text":"","code":"Setup_Mod_Biologicals(   input_list,   WAA,   MatAA,   AgeingError = NULL,   Use_M_prior = 0,   M_prior = NA,   fit_lengths = 0,   SizeAgeTrans = NA,   M_spec = NULL,   Fixed_natmort = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Biologicals.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup biological inputs for estimation model — Setup_Mod_Biologicals","text":"input_list List containing data list, parameter list, map list WAA Inputs weight age dimensioned n_region, n_year, n_ages, n_sexes MatAA Inputs maturity age dimensioned n_region, n_year, n_ages, n_sexes AgeingError Inputs ageing error matrix dimensioned number modelled ages, number observed composition ages Default behavior uses identity matrix (ageing error) Use_M_prior Whether use natural mortality prior, == 0 use, == 1 use M_prior Vector natural mortality priors first element representing mean normal space, second element representing sd. fit_lengths Whether fit length data, == 0 dont fit, == 1 fit SizeAgeTrans Size age transition matrix dimensioned n_regions, n_years, n_lens, n_ages, n_sexes M_spec Character specifying options estimate natural mortality. Default NULL estimated 2 sexes estimated single sex single sex model. options include \"est_shared_s\" estimates natural mortality rate n_sexes == 2. option \"fix\" fixes natural mortality parameters. Fixed_natmort Fixed natural mortality array, dimensionsed n_regions, n_yrs, n_ages, n_sexes ... Additional arguments starting values ln_M M_offset (note M_spec specified 'fix', used. Instead, user must supply fixed natural mortality array using Fixed_natmort)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Catch_and_F.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup fishing mortality and catch observations — Setup_Mod_Catch_and_F","title":"Setup fishing mortality and catch observations — Setup_Mod_Catch_and_F","text":"Setup fishing mortality catch observations","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Catch_and_F.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup fishing mortality and catch observations — Setup_Mod_Catch_and_F","text":"","code":"Setup_Mod_Catch_and_F(   input_list,   ObsCatch,   Catch_Type,   UseCatch,   Use_F_pen = 1,   est_all_regional_F = 1,   Catch_Constant = NULL,   sigmaC_spec = \"fix\",   sigmaF_spec = \"fix\",   sigmaF_agg_spec = \"fix\",   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Catch_and_F.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup fishing mortality and catch observations — Setup_Mod_Catch_and_F","text":"input_list List containing data list, parameter list, map list ObsCatch Array observed catches dimensioned n_regions, n_years, n_fish_fleets Catch_Type Matrix catch types dimensioned n_years, n_fish_fleets, == 0 indicates years use aggregated catch, == 1 indicates years use region specific catch UseCatch Array indicator variables dimensioned n_regions, n_years, n_fish_fleets, == 0 use catch, == 1 use catch fit Use_F_pen Indicator number specifying whether f penalty applied == 0, apply, == 1 apply est_all_regional_F Indicator number specifying whether regional fishing mortality deviates estimated, == 0 F's regional aggregated, == 1 fishing mortality deviates regional Catch_Constant vector dimensioned n_fish_fleets specifying constant add catch observations sigmaC_spec Observation error specificaiotn catch. Default behavior fix regions fishery fleets. options include: \"est_shared_f\" estimates shares across fishery fleets, \"est_shared_r\" estimates shares across regions (unique fleet), \"est_shared_r_f estimates shares across regions fleets, \"fix\" fixes starting value, \"est_all\", estimates sigmaF_spec Process error specificaiotn fishing mortality Default behavior fix regions fishery fleets. options include: \"est_shared_f\" estimates shares across fishery fleets, \"est_shared_r\" estimates shares across regions (unique fleet), \"est_shared_r_f estimates shares across regions fleets, \"fix\" fixes starting value, \"est_all\", estimates sigmaF_agg_spec Process error specificaiotn fishing mortality aggregated. Default behavior fix fishery fleets. options include: \"est_shared_f\" estimates shares across fishery fleets, \"fix\" fixes starting value, \"est_all\", estimates ... Additional arguments specifying starting values ln_sigmaC ln_sigmaF","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Dim.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up model dimensions — Setup_Mod_Dim","title":"Set up model dimensions — Setup_Mod_Dim","text":"Set model dimensions","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Dim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up model dimensions — Setup_Mod_Dim","text":"","code":"Setup_Mod_Dim(   years,   ages,   lens,   n_regions,   n_sexes,   n_fish_fleets,   n_srv_fleets,   verbose = FALSE )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Dim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up model dimensions — Setup_Mod_Dim","text":"years vector years ages vector ages lens vector lengths (can just input 1 fitting lengths) n_regions Number regions n_sexes Number sexes n_fish_fleets Number fishery fleets n_srv_fleets Number survey fleets verbose Whether print messages","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Dim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Set up model dimensions — Setup_Mod_Dim","text":"Returns list object length 3, data list, par list, map list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_FishIdx_and_Comps.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup observed fishery indices and composition data (age and length comps) — Setup_Mod_FishIdx_and_Comps","title":"Setup observed fishery indices and composition data (age and length comps) — Setup_Mod_FishIdx_and_Comps","text":"Setup observed fishery indices composition data (age length comps)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_FishIdx_and_Comps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup observed fishery indices and composition data (age and length comps) — Setup_Mod_FishIdx_and_Comps","text":"","code":"Setup_Mod_FishIdx_and_Comps(   input_list,   ObsFishIdx,   ObsFishIdx_SE,   fish_idx_type,   UseFishIdx,   ObsFishAgeComps,   UseFishAgeComps,   ISS_FishAgeComps = NULL,   ObsFishLenComps,   UseFishLenComps,   ISS_FishLenComps = NULL,   FishAgeComps_LikeType,   FishLenComps_LikeType,   FishAgeComps_Type,   FishLenComps_Type,   FishAge_comp_agg_type = NULL,   FishLen_comp_agg_type = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_FishIdx_and_Comps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup observed fishery indices and composition data (age and length comps) — Setup_Mod_FishIdx_and_Comps","text":"input_list List containing data list, parameter list, map list ObsFishIdx Observed fishery indices array dimensioned n_regions, n_years, n_fish_fleets ObsFishIdx_SE Observed standard errors fishery indices array dimensioned n_regions, n_years, n_fish_fleets fish_idx_type Fishery index type dimensioned n_fish_fleets, character string abundance (abd) biomass (biom), \"none\" availabile used UseFishIdx Indicator variables specifying whether fit fishery indices array imensioned n_regions, n_years, n_fish_fleets, == 0 fit, == 1 fit ObsFishAgeComps Observed fishery age compositions array dimensioned n_regions, n_years, number composition ages, n_sexes, n_fish_fleets (numbers, although need whole numbers) UseFishAgeComps Indicator variables specifying whether fit fishery ages array imensioned n_regions, n_years, n_fish_fleets, == 0 fit, == 1 fit ISS_FishAgeComps Input sample size fishery comps dimensioned n_regions, n_years, n_sexes, n_fleets. sample sizes already defined observed comps (.e., numbers sum 1, can leave , sum 1, need sure define ISS comps correctly weighted (given ISS weight 1)) ObsFishLenComps Observed fishery age compositions array dimensioned n_regions, n_years, n_lens, n_sexes, n_fish_fleets (numbers, although need whole numbers) UseFishLenComps Indicator variables specifying whether fit fishery lengths array imensioned n_regions, n_years, n_fish_fleets, == 0 fit, == 1 fit ISS_FishLenComps Input sample size fishery comps dimensioned n_regions, n_years, n_sexes, n_fleets. sample sizes already defined observed comps (.e., numbers sum 1, can leave , sum 1, need sure define ISS comps correctly weighted (given ISS weight 1)) FishAgeComps_LikeType Vector character strings dimensioned n_fish_fleets, options include Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal. Can specify \"none\" likelihoods used. FishLenComps_LikeType Vector character strings dimensioned n_fish_fleets, options include Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal. Can specify \"none\" likelihoods used. FishAgeComps_Type Defines age composition data fit sex region, four possible options (agg, spltRspltS, spltRjntS, none). Option agg indicates compositions aggregated across regions sexes, option spltRspltS indicates compositions split region split sex (compositions sum 1 within given region sex), option spltRjntS indicates compositions split region sum 1 jointly across sexes, option none specifies composition data available. defining composition type, users need specify year range want composition type , well fleet number composition type belongs . example, (\"agg_Year_1-10_Fleet_1\", \"spltRjntS_Year_11-terminal_Fleet_1\") specifies compositions aggregated years 1 - 10 fleet 1, split region sex years 11 - terminal fleet 1. FishLenComps_Type Defines length composition data fit sex region, four possible options (agg, spltRspltS, spltRjntS, none). Option agg indicates compositions aggregated across regions sexes, option spltRspltS indicates compositions split region split sex (compositions sum 1 within given region sex), option spltRjntS indicates compositions split region sum 1 jointly across sexes, option none specifies composition data available. defining composition type, users need specify year range want composition type , well fleet number composition type belongs . example, (\"agg_Year_1-10_Fleet_1\", \"spltRjntS_Year_11-terminal_Fleet_1\") specifies compositions aggregated years 1 - 10 fleet 1, split region sex years 11 - terminal fleet 1. FishAge_comp_agg_type Vector dimensioned n_fish_fleets specifying aggregate age composition data FishAgeComps_Type == 0, comp_agg_type == 0 normalize, aggregate, ageing erorr normalize, == 1 aggregate, normalize, ageing error (age compositions). Default specify NULL FishLen_comp_agg_type Vector dimensioned n_fish_fleets specifying aggregate age composition data FishLenComps_Type == 1, comp_agg_type == 0 length compositions normalized prior application size age transition, == 1 length compositions normalized size-age transition applied (length compositions). Default specify NULL ... Additional arguments specifying starting values survey age length overdispersion parameters (ln_FishAge_theta, ln_FishLen_theta, ln_FishAge_theta_agg, ln_FishLen_theta_agg)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Fishsel_and_Q.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup fishery selectivity and catchability specifications — Setup_Mod_Fishsel_and_Q","title":"Setup fishery selectivity and catchability specifications — Setup_Mod_Fishsel_and_Q","text":"Setup fishery selectivity catchability specifications","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Fishsel_and_Q.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup fishery selectivity and catchability specifications — Setup_Mod_Fishsel_and_Q","text":"","code":"Setup_Mod_Fishsel_and_Q(   input_list,   cont_tv_fish_sel,   fish_sel_blocks,   fish_sel_model,   Use_fish_q_prior = 0,   fish_q_prior = NA,   fish_q_blocks,   fishsel_pe_pars_spec = NULL,   fish_fixed_sel_pars_spec = NULL,   fish_q_spec = NULL,   fish_sel_devs_spec = NULL,   corr_opt_semipar = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Fishsel_and_Q.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup fishery selectivity and catchability specifications — Setup_Mod_Fishsel_and_Q","text":"input_list List containing data list, parameter list, map list cont_tv_fish_sel Specificaiton continuous time-varying selectivity, character vector dimensioned n_fish_fleets, character time variation type, _, Fleet, fleet number. time variation types include (none, iid, rw, 3dmarg, 3dcond, 2dar1), specify iid fleet 1, iid_Fleet_1. fish_sel_blocks Specification fishery selectivity blocks unique numbers given region fleet, array dimensioned n_regions, n_years, n_fish_fleets fish_sel_model Specification fishery selectivity model given region fleet, array dimensioned n_regions, n_years, n_fish_fleets, == 0 a50, k, logistic, == 1 gamma dome shaped, == 2, exponential, == 3 a50, a95 logistic Use_fish_q_prior Integer specifying whether use fishery q prior (0 dont use) (1 use) fish_q_prior Fishery q priors normal space, dimensioned region, block,  fishery fleet, 2 (mean, sd 4 dimension array) fish_q_blocks Specification fishery catchability blocks unique numbers given region fleet, array dimensioned n_regions, n_years, n_fish_fleets fishsel_pe_pars_spec Specification fishery selectivity process error parameters. cont_tv_fish_sel = 0, fixed estimated. Otherwise, options : est_all, estiamtes parameters, est_shared_r, estiamtes parameters shared across regions, est_shared_s, estiamtes parameters shared across sexes, est_shared_r_s, estimates paraemters shared across regions sexes, options fix none indicate estimate seletivity process error parameters treat fixed. fish_fixed_sel_pars_spec Specification fishery selectivity fixed effects parameters. Options est_all, estiamtes parameters, est_shared_r, estiamtes parameters shared across regions, est_shared_s, estiamtes parameters shared across sexes, est_shared_r_s, estimates paraemters shared across regions sexes fish_q_spec Specification fishery catchability. Options est_all, estiamtes parameters across regions, est_shared_r, estimates parameters shared across regions. fish_sel_devs_spec Specificaiton selectivity process error dviations. Options est_all, estimates deviations, est_shared_r, shares across regions, est_shared_s, shares across sexes, est_shared_r_s, shares across regions sexes corr_opt_semipar used cont_tv_sel 3,4,5. Allows users turn estimation certain correlation parameters ot 0. Options include corr_zero_y, turns year correlations 0, corr_zero_a turns age correaltions 0, corr_zero_y_a turns year age correaltions 0. options can used cont_tv_sel 3,4,5. Additional options include corr_zero_c, turns cohort correaltions 0, corr_zero_y_c, turns cohort year correaltions 0, corr_zero_a_c turns age cohort correaltions 0, well corr_zero_y_a_c, turns correlations 0, effectively collapses iid. latter options available cont_tv_sel 3,4. ... Additional arguments specifying starting values fishery selectivity catchability parameters (fishsel_pe_pars, ln_fishsel_devs, ln_fish_fixed_sel_pars, ln_fish_q)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Movement.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup Movement Processes for SPoCK — Setup_Mod_Movement","title":"Setup Movement Processes for SPoCK — Setup_Mod_Movement","text":"Setup Movement Processes SPoCK","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Movement.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup Movement Processes for SPoCK — Setup_Mod_Movement","text":"","code":"Setup_Mod_Movement(   input_list,   do_recruits_move = 0,   use_fixed_movement = 0,   Fixed_Movement = NA,   Use_Movement_Prior = 0,   Movement_prior = NULL,   Movement_ageblk_spec = NULL,   Movement_yearblk_spec = NULL,   Movement_sexblk_spec = NULL,   cont_vary_movement = \"none\",   Movement_cont_pe_pars_spec = \"none\",   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Movement.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup Movement Processes for SPoCK — Setup_Mod_Movement","text":"input_list List containing data list, parameter list, map list do_recruits_move Whether recruits move, 1 (move), 0 (move), default 0 use_fixed_movement Whether use fixed movement matrix, == 0 use, == 1 use Fixed_Movement Input fixed movement matrix dimensioned n_regions, n_regions, n_years, n_ages, n_sexes Use_Movement_Prior Whether use movement priors == 0 use, == 1 use Movement_prior Movement prior values, can dimension vector (results constant prior across regions , years, ages, sexes), array n_regions, n_regions, n_years, n_ages, n_sexes Movement_ageblk_spec Either character string specifiying \"constant\" age movement, ist object specifying ages group together block (.e., ages share parameters ). element list vector specifying range ages share block parameters . example, list(c(1:6), c(7:10), c(11:n_ages)) 3 age blocks, ages 1-6 paraemters, 7:10 parameters (diffeerent 1:6), 11:n_ages haave parameters (different 1:6 7:10). default behavior estimate unique movement parmaeters ages. estimate age-invariant movement list specified : list(c(1:n_ages)). Movement_yearblk_spec Either character string specifiying \"constant\" year movement, list object specifying years group together block (.e., years share parameters ). element list vector specifying range years share block parameters . example, list(c(1:6), c(7:10), c(11:n_years)) 3 year blocks, years 1-6 paraemters, 7:10 parameters (diffeerent 1:6), 11:n_years haave parameters (different 1:6 7:10). default behavior estimate unique movement parameters years estimate time-invariant movement list specified : list(c(1:n_years)). Movement_sexblk_spec Either character string specifiying \"constant\" sex movement, list object specifying sexes group together block (.e., sexes share parameters ). element list vector specifying range sexes share block parameters . example, list(1, 2) 2 sex blocks, sex unique parameters default behavior estimate unique movement parameters sexes. estimate sex-invariant movement list specified : list(c(1:n_sexes)). cont_vary_movement Continuous varying movement: \"none\", \"iid_y\", \"iid_a\", \"iid_y_a\", 'iid_y_s', 'iid_a_s', \"iid_y_a_s\" Movement_cont_pe_pars_spec Specification process error parameters. Character string options 'est_shared_r', 'est_shared_a', \"est_shared_s\", 'est_shared_r_a', 'est_shared_a_s', \"est_shared_r_s\", 'est_shared_r_a_s', 'est_all', 'fix', 'none' ... Additional inputs starting values movement parameters (move_pars)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Rec.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup model objects for specifying recruitment module and associated processes — Setup_Mod_Rec","title":"Setup model objects for specifying recruitment module and associated processes — Setup_Mod_Rec","text":"Setup model objects specifying recruitment module associated processes","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Rec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup model objects for specifying recruitment module and associated processes — Setup_Mod_Rec","text":"","code":"Setup_Mod_Rec(   input_list,   rec_model,   rec_dd = NULL,   rec_lag = 1,   Use_h_prior = 0,   h_mu = NA,   h_sd = NA,   do_rec_bias_ramp = 0,   bias_year = NA,   sigmaR_switch = 1,   dont_est_recdev_last = 0,   sexratio = 1,   init_age_strc = 0,   init_F_prop = 0,   sigmaR_spec = NULL,   InitDevs_spec = NULL,   RecDevs_spec = NULL,   h_spec = NULL,   t_spawn = 0,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Rec.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup model objects for specifying recruitment module and associated processes — Setup_Mod_Rec","text":"input_list List containing data list, parameter list, map list rec_model recruitment model, options mean_rec, bh_rec rec_dd Recruitment density dependence, Options \"local\", \"global\", NULL rec_lag duration recruitment lag SSB Use_h_prior whether use steepness prior == 0 (use), == 1 (use) h_mu vector steepness mean priors used (dimensioned n_region) h_sd vector steepness sd priors used (dimensioned n_region) do_rec_bias_ramp whether recruitment bias ramp == 0 (use), == 1(use) bias_year vector years bias ramp invoked changes. total 4 values, first describing period bias correction applied ends, second describing period ascending limb ends, third describing period full bias correction last applied, fourth describing period bias ramp applied, following period full bias correction. example, 65 years assessment model, specifying c(21, 31, 60, 64) indicates years 1 - 21 0 bias correction, years 22 - 31 ascending limb bias correction, years 32 - 60 full bias correction period, years 61 - 63 descending limb ramp, years 64 - 65 zero bias correction periods. sigmaR_switch year sigmaR switches early value late (set 0 switching occurs) dont_est_recdev_last Numeric indicating last x years estimate rec devs . Default 0. sexratio vector recruitment sex ratio dimensioned n_sexes init_age_strc whether initial age structure initialized via == 0 (iteration) via == 1 (geometric series) init_F_prop Initial F proportion relative mean F value initializing age structure sigmaR_spec Specification sigmaR. Default NULL estimated early late periods. options include \"est_shared\" estiamtes sigmaR shares value early late period \"fix\" fixes values. InitDevs_spec Specification initial age dviations. Default NULL estimated ages regions. options include \"est_shared_r\" estimates deviations ages shares across regions, \"fix\" fixeds values. RecDevs_spec Specification recruitment deviations. Default NULL estimated regions years. options include \"est_shared_r\" estimates deviations years, shares across regions (global recruitment deviaitons), \"fix\" fixes values. h_spec Specification steepness. Default NULL, estimated reigons rec_model == 1 (Beverton-Holt). options include \"est_shared_r\" estimates h shares across regions, \"fix\" fixes steepness values. rec_model == 0, h fixed. t_spawn Spawn timing fraction ... Additional arguments starting values recruitment parameters (ln_global_R0, Rec_prop, h, ln_InitDevs, ln_RecDevs, ln_sigmaR)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_SrvIdx_and_Comps.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup observed survey indices and composition data (age and length comps) — Setup_Mod_SrvIdx_and_Comps","title":"Setup observed survey indices and composition data (age and length comps) — Setup_Mod_SrvIdx_and_Comps","text":"Setup observed survey indices composition data (age length comps)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_SrvIdx_and_Comps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup observed survey indices and composition data (age and length comps) — Setup_Mod_SrvIdx_and_Comps","text":"","code":"Setup_Mod_SrvIdx_and_Comps(   input_list,   ObsSrvIdx,   ObsSrvIdx_SE,   UseSrvIdx,   srv_idx_type,   ObsSrvAgeComps,   UseSrvAgeComps,   ObsSrvLenComps,   UseSrvLenComps,   ISS_SrvAgeComps = NULL,   ISS_SrvLenComps = NULL,   SrvAgeComps_LikeType,   SrvLenComps_LikeType,   SrvAgeComps_Type,   SrvLenComps_Type,   SrvAge_comp_agg_type = NULL,   SrvLen_comp_agg_type = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_SrvIdx_and_Comps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup observed survey indices and composition data (age and length comps) — Setup_Mod_SrvIdx_and_Comps","text":"input_list List containing data list, parameter list, map list ObsSrvIdx Observed survey indices array dimensioned n_regions, n_years, n_srv_fleets ObsSrvIdx_SE Observed standard errors survey indices array dimensioned n_regions, n_years, n_srv_fleets UseSrvIdx Indicator variables specifying whether fit survey indices array imensioned n_regions, n_years, n_srv_fleets, == 0 fit, == 1 fit srv_idx_type Survey index type dimensioned n_srv_fleets, character string abundance (abd) biomass (biom), \"none\" availabile used ObsSrvAgeComps Observed survey age compositions array dimensioned n_regions, n_years, number observed composition ages, n_sexes, n_srv_fleets (numbers, although need whole numbers) UseSrvAgeComps Indicator variables specifying whether fit survey ages array imensioned n_regions, n_years, n_srv_fleets, == 0 fit, == 1 fit ObsSrvLenComps Observed survey age compositions array dimensioned n_regions, n_years, n_lens, n_sexes, n_srv_fleets (numbers, although need whole numbers) UseSrvLenComps Indicator variables specifying whether fit survey lengths array imensioned n_regions, n_years, n_srv_fleets, == 0 fit, == 1 fit ISS_SrvAgeComps Input sample size survey comps. Dimensioned n_regions, n_years, n_sexes, n_fleets. Can left numbers defined observed comps function sums interally get ISS. However, observed comps input proportions, sure specify ISS model incorrectly weight value ISS = 1. ISS_SrvLenComps Input sample size survey comps. Dimensioned n_regions, n_years, n_sexes, n_fleets. Can left numbers defined observed comps function sums interally get ISS. However, observed comps input proportions, sure specify ISS model incorrectly weight value ISS = 1. SrvAgeComps_LikeType Vector character strings dimensioned n_srv_fleets, options include Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal. Can specify \"none\" likelihoods used. SrvLenComps_LikeType Vector character strings dimensioned n_srv_fleets, options include Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal. Can specify \"none\" likelihoods used. SrvAgeComps_Type Defines age composition data fit sex region, four possible options (agg, spltRspltS, spltRjntS, none). Option agg indicates compositions aggregated across regions sexes, option spltRspltS indicates compositions split region split sex (compositions sum 1 within given region sex), option spltRjntS indicates compositions split region sum 1 jointly across sexes, option none specifies composition data available. defining composition type, users need specify year range want composition type , well fleet number composition type belongs . example, (\"agg_Year_1-10_Fleet_1\", \"spltRjntS_Year_11-terminal_Fleet_1\") specifies compositions aggregated years 1 - 10 fleet 1, split region sex years 11 - terminal fleet 1. SrvLenComps_Type Defines length composition data fit sex region, four possible options (agg, spltRspltS, spltRjntS, none). Option agg indicates compositions aggregated across regions sexes, option spltRspltS indicates compositions split region split sex (compositions sum 1 within given region sex), option spltRjntS indicates compositions split region sum 1 jointly across sexes, option none specifies composition data available. defining composition type, users need specify year range want composition type , well fleet number composition type belongs . example, (\"agg_Year_1-10_Fleet_1\", \"spltRjntS_Year_11-terminal_Fleet_1\") specifies compositions aggregated years 1 - 10 fleet 1, split region sex years 11 - terminal fleet 1. SrvAge_comp_agg_type Vector dimensioned n_srv_fleets specifying aggregate age composition data SrvAgeComps_Type == 0, comp_agg_type == 0 normalize, aggregate, ageing erorr normalize, == 1 aggregate, normalize, ageing error (age compositions). Default specify NULL SrvLen_comp_agg_type Vector dimensioned n_srv_fleets specifying aggregate age composition data SrvLenComps_Type == 1, comp_agg_type == 0 length compositions normalized prior application size age transition, == 1 length compositions normalized size-age transition applied (length compositions). Default specify NULL ... Additional arguments specifying starting values survey age length overdispersion parameters (ln_SrvAge_theta. ln_SrvLen_theta, ln_SrvAge_theta_agg, ln_SrvLen_theta_agg)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Srvsel_and_Q.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup survey selectivity and catchability specifications — Setup_Mod_Srvsel_and_Q","title":"Setup survey selectivity and catchability specifications — Setup_Mod_Srvsel_and_Q","text":"Setup survey selectivity catchability specifications","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Srvsel_and_Q.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup survey selectivity and catchability specifications — Setup_Mod_Srvsel_and_Q","text":"","code":"Setup_Mod_Srvsel_and_Q(   input_list,   cont_tv_srv_sel,   srv_sel_blocks,   srv_sel_model,   Use_srv_q_prior = 0,   srv_q_prior = NA,   srv_q_blocks,   srvsel_pe_pars_spec = NULL,   srv_fixed_sel_pars_spec,   srv_q_spec = NULL,   srv_sel_devs_spec = NULL,   corr_opt_semipar = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Srvsel_and_Q.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup survey selectivity and catchability specifications — Setup_Mod_Srvsel_and_Q","text":"input_list List containing data list, parameter list, map list cont_tv_srv_sel Specificaiton continuous time-varying selectivity, character vector dimensioned n_srv_fleets, character time variation type, _, Fleet, fleet number. time variation types include (none, iid, rw, 3dmarg, 3dcond, 2dar1), specify iid fleet 1, iid_Fleet_1. srv_sel_blocks Specification survey selectivity blocks unique numbers given region fleet, array dimensioned n_regions, n_years, n_srv_fleets srv_sel_model Specification survey selectivity model given region fleet, array dimensioned n_regions, n_years, n_srv_fleets, == 0 a50, k, logistic, == 1 gamma dome shaped, == 3, exponential, == 4 a50, a95 logistic Use_srv_q_prior Integer specifying whether use survey q prior (0 dont use) (1 use) srv_q_prior Survey q priors normal space, dimensioned region, block, survey fleet, 2 (mean, sd 4 dimension array) srv_q_blocks Specification survey catchability blocks unique numbers given region fleet, array dimensioned n_regions, n_years, n_srv_fleets srvsel_pe_pars_spec Specification survey selectivity process error parameters. cont_tv_srv_sel = 0, fixed estimated. Otherwise, options : est_all, estiamtes parameters, est_shared_r, estiamtes parameters shared across regions, est_shared_s, estiamtes parameters shared across sexes, est_shared_r_s, estimates paraemters shared across regions sexes. options fix none indicate estimate parameters srv_fixed_sel_pars_spec Specification survey selectivity fixed effects parameters. Options est_all, estiamtes parameters, est_shared_r, estiamtes parameters shared across regions, est_shared_s, estiamtes parameters shared across sexes, est_shared_r_s, estimates paraemters shared across regions sexes srv_q_spec Specification survey catchability. Options est_all, estiamtes parameters across regions, est_shared_r, estimates parameters shared across regions. srv_sel_devs_spec Specificaiton selectivity process error dviations. Options est_all, estimates deviations, est_shared_r, shares across regions, est_shared_s, shares across sexes, est_shared_r_s, shares across regions sexes corr_opt_semipar used cont_tv_sel 3,4,5. Allows users turn estimation certain correlation parameters ot 0. Options include corr_zero_y, turns year correlations 0, corr_zero_a turns age correaltions 0, corr_zero_y_a turns year age correaltions 0. options can used cont_tv_sel 3,4,5. Additional options include corr_zero_c, turns cohort correaltions 0, corr_zero_y_c, turns cohort year correlations 0, corr_zero_a_c turns age cohort correaltions 0, well corr_zero_y_a_c, turns correlations 0, effectively collapses iid. latter options available cont_tv_sel 3,4. ... Additional arguments specifying starting values survey selectivity catchability parameters (ln_srv_fixed_sel_pars, ln_srv_q)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Tagging.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup tagging processes and parameters — Setup_Mod_Tagging","title":"Setup tagging processes and parameters — Setup_Mod_Tagging","text":"Setup tagging processes parameters","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Tagging.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup tagging processes and parameters — Setup_Mod_Tagging","text":"","code":"Setup_Mod_Tagging(   input_list,   UseTagging = 0,   tag_release_indicator = NULL,   max_tag_liberty = 0,   Tagged_Fish = NA,   Obs_Tag_Recap = NA,   Tag_LikeType = NA,   mixing_period = 1,   t_tagging = 0,   tag_selex = NA,   tag_natmort = NA,   Use_TagRep_Prior = 0,   TagRep_PriorType = NA,   TagRep_mu = NA,   TagRep_sd = NA,   move_age_tag_pool = NA,   move_sex_tag_pool = NA,   Init_Tag_Mort_spec = NULL,   Tag_Shed_spec = NULL,   TagRep_spec = NULL,   Tag_Reporting_blocks = NULL,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Tagging.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup tagging processes and parameters — Setup_Mod_Tagging","text":"input_list List containing data list, parameter list, map list UseTagging Numeric indicating whether use tagging data (1) (0) tag_release_indicator Matrix dimensioned n_tag_cohorts, 2 (first column release region, second column release year) describing release region year given tag cohort max_tag_liberty Maximum number years track tagged cohort Tagged_Fish Array dimensioned n_tag_cohorts, n_ages, n_sexes describing tag released fish Obs_Tag_Recap Observed tag recaptures dimensioned max_tag_liberty, n_tag_cohorts, n_regions, n_ages, n_sexes Tag_LikeType Numeric indicating tag likelihood type, == 0 Poisson, == 1 Negative Binomial, == 2 Multinomial Release Conditioned, == 3 Multinomial recapture conditioned, == 4 Dirichlet-Multinomial_Release, == 5 Dirichlet-Multinomial_Recapture mixing_period Numeric indicating mixing period year < mixing period given tag cohort fit t_tagging Fractional year tag releases happen tag_selex Numeric indicating tag recovery selectivity parameterized, == 0 uniform selectivity, == 1 sex-averaged fishery selectivity dominant fleet (fleet 1), == 2 sex-specific selectivity dominant fleet (fleet 1) tag_natmort Numeric indicating tag natural mortality parameterized, == 0 age- sex-averaged, == 1 unique age, sex-averaged natural mortality, == 2 unique sex, age-aggregated natural mortality, == 3 unique sex-age natural mortality Use_TagRep_Prior Numeric indicating whether use tag reporting rate prior == 0, use, == 1 use TagRep_PriorType Numeric indicating type tag reporting prior use, == 0 Symmetric beta, extremes penalized heaviest, == 1 Regular Beta TagRep_mu Numeric value indicating mean tag reporting rate prior (normal space), can specified NA using symmetric beta TagRep_sd Numeric value indicating sd tag reporting rate prior (normal space), symmetric beta, smaller values impose larger penalty along edges move_age_tag_pool List indicating fit tagging age-specific data. example, age-specific data avalialble, list dimensioned lenght 1, first elmeent 1:n_ages, however, ageing data want pool fit data, element ages want pool. want fit age uniquely, list unique elements representing age e.g., list(1,2,3,4, ... n_ages) move_sex_tag_pool List indicating fit tagging sex-specific data. example, sex-specific data avalialble, list dimensioned lenght 1, first elmeent 1:n_sexes. However, sex-specific data, can dimensioned length 2 want fit sex-specific data (e.g., list(1, 2)) Init_Tag_Mort_spec Specificaiotn initial tag mortality. Options include fix, fixes parameter, est, estiamtes parameter Tag_Shed_spec Specificaiotn chronic tag shedding. Options include fix, fixes parameter, est, estiamtes parameter TagRep_spec Specification tag reporting rates. Options include est_all, estiamtes regions blocks specified, est_shared_r, estamites blocks, shares across regions. Tag_Reporting_blocks Tag reporting blocks want specify. Character vector region \"Block_1_Year_1-15_Region_1\", \"Block_2_Year_16-30_Region_1\", \"none_Region_2 specify example. ... Additional arguments specifying starting values tagging parameters (ln_Init_Tag_Mort, ln_Tag_Shed, ln_tag_theta, Tag_Reporting_Pars)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Weighting.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — Setup_Mod_Weighting","title":"Title — Setup_Mod_Weighting","text":"Title","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Weighting.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — Setup_Mod_Weighting","text":"","code":"Setup_Mod_Weighting(   input_list,   sablefish_ADMB,   likelihoods,   Wt_Catch = 1,   Wt_FishIdx = 1,   Wt_SrvIdx = 1,   Wt_Rec = 1,   Wt_F = 1,   Wt_Tagging = 1,   Wt_FishAgeComps,   Wt_SrvAgeComps,   Wt_FishLenComps,   Wt_SrvLenComps )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Mod_Weighting.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — Setup_Mod_Weighting","text":"input_list List containing data list, parameter list, map list sablefish_ADMB Numeric indicating whether mimic calculations sablefish ADMB model (1) (0) likelihoods Numeric indicating whether use ADMB likelihoods (0) TMB likelihoods (1) Wt_Catch Weight (lambda) applied overall catch dataset Wt_FishIdx Weight (lambda) applied overall fishery index dataset Wt_SrvIdx Weight (lambda) applied overall survey index dataset Wt_Rec Weight (lambda) applied recruitment penalty Wt_F Weight (lambda) applied fishing mortality penalty Wt_Tagging Weight (lambda) applied tagging data Wt_FishAgeComps Weight (lambda) applied fishery age compositions Wt_SrvAgeComps Weight (lambda) applied survey age compositions Wt_FishLenComps Weight (lambda) applied fishery length compositions Wt_SrvLenComps Weight (lambda) applied survey length compositions","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Biologicals.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up simulation stuff for biologicals — Setup_Sim_Biologicals","title":"Set up simulation stuff for biologicals — Setup_Sim_Biologicals","text":"Set simulation stuff biologicals","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Biologicals.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up simulation stuff for biologicals — Setup_Sim_Biologicals","text":"","code":"Setup_Sim_Biologicals(   base_M_value,   M_pattern,   base_WAA_values,   WAA_pattern,   base_Maturity_AA_values,   Maturity_AA_pattern,   sim_list )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Biologicals.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up simulation stuff for biologicals — Setup_Sim_Biologicals","text":"base_M_value Base natural mortality value dimensioned regions, ages, sexes M_pattern Natural mortality pattern. Options include: constant base_WAA_values Base weight--age values dimensioned regions, ages, sexes WAA_pattern Weight--age pattern. Options include: constant base_Maturity_AA_values Base maturity values dimensioned regions, ages, sexes Maturity_AA_pattern Maturity pattern. Options include: constant sim_list Simulation list objects","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Containers.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup containers for simulation and output into global environment — Setup_Sim_Containers","title":"Setup containers for simulation and output into global environment — Setup_Sim_Containers","text":"Setup containers simulation output global environment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Containers.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup containers for simulation and output into global environment — Setup_Sim_Containers","text":"","code":"Setup_Sim_Containers(sim_list)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Containers.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup containers for simulation and output into global environment — Setup_Sim_Containers","text":"sim_list List object containing simulation components (n_regions, n_ages, n_sexes, n_sims, sim_list$n_fish_fleets, sim_list$n_srv_fleets)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Dim.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up simulation dimensions — Setup_Sim_Dim","title":"Set up simulation dimensions — Setup_Sim_Dim","text":"Set simulation dimensions","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Dim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up simulation dimensions — Setup_Sim_Dim","text":"","code":"Setup_Sim_Dim(   n_sims,   n_yrs,   n_regions,   n_ages,   n_sexes,   n_fish_fleets,   n_srv_fleets,   run_feedback,   feedback_start_yr )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Dim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up simulation dimensions — Setup_Sim_Dim","text":"n_sims Number simulations n_yrs Number years n_regions Number regions n_ages Number ages n_sexes Number sexes n_fish_fleets Number fishery fleets n_srv_fleets Number survey fleets run_feedback Boolean whether run run feedback management loop feedback_start_yr MSE run, first year feedback starts","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishMort.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup values and dimensions of fishing mortality — Setup_Sim_FishMort","title":"Setup values and dimensions of fishing mortality — Setup_Sim_FishMort","text":"Setup values dimensions fishing mortality","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishMort.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup values and dimensions of fishing mortality — Setup_Sim_FishMort","text":"","code":"Setup_Sim_FishMort(   sim_list,   sigmaC,   init_F_vals,   Fmort_pattern,   Fmort_start,   Fmort_fct,   proc_error,   proc_error_sd )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishMort.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup values and dimensions of fishing mortality — Setup_Sim_FishMort","text":"sim_list Simulation list objects sigmaC Observation error catch init_F_vals Initial F values dimensioend region fleet Fmort_pattern Fishing mortality pattern matrix dimensioned region fleet (constant, linear, one-way, two-way) Fmort_start Fishing mortality start values matrix dimensioned region fleet Fmort_fct Fishing mortality values factor increases decreases matrix dimensioned region fleet proc_error want add process error fishing mortality proc_error_sd value logrnomal sd process error fishing mortality","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishSel.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup fishery selectivity — Setup_Sim_FishSel","title":"Setup fishery selectivity — Setup_Sim_FishSel","text":"Setup fishery selectivity","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishSel.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup fishery selectivity — Setup_Sim_FishSel","text":"","code":"Setup_Sim_FishSel(sim_list, sel_model, fixed_fish_sel_pars)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_FishSel.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup fishery selectivity — Setup_Sim_FishSel","text":"sim_list Simulation list sel_model Fishery selectivity model dimensioned region fleet. Options include: logistic fixed_fish_sel_pars Fixed parameters fishery selectivity, dimensioned region, sex, fishery fleet, max number parameters needed defined fishery selectivity functional form defined functional forms fishery","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Observation_Proc.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up simulation observaiton processes — Setup_Sim_Observation_Proc","title":"Set up simulation observaiton processes — Setup_Sim_Observation_Proc","text":"Set simulation observaiton processes","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Observation_Proc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up simulation observaiton processes — Setup_Sim_Observation_Proc","text":"","code":"Setup_Sim_Observation_Proc(   Comp_Structure,   Comp_Srv_Like,   base_ISS_SrvAge,   Srv_Like_Pars,   Comp_Fish_Like,   base_ISS_FishAge,   ISS_FishAge_Pattern,   Tag_Like,   Tag_Like_Pars,   SrvAgeTheta,   FishAgeTheta,   sim_list )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Observation_Proc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up simulation observaiton processes — Setup_Sim_Observation_Proc","text":"Comp_Structure Composition Structure (spltR_spltS, spltR_jntS) Comp_Srv_Like Survey Composition Likelihoods (Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal) base_ISS_SrvAge Input sample size survey ages Srv_Like_Pars Parameters Survey Composition Likelihoods Comp_Fish_Like Fishery Composition Likelihoods (Multinomial, Dirichlet-Multinomial, iid-Logistic-Normal) base_ISS_FishAge Base Input sample size fishery ages ISS_FishAge_Pattern Input sample size pattern fishery ages. Either \"constant\" follows f pattern (\"F_pattern\") Tag_Like Tag Likelihoods (Poisson, NegBin, Multinomial_Release, Multinomial_Recapture) Tag_Like_Pars Tag Likelihood Parameters SrvAgeTheta Survey Age Composition Overdispersion Parameter FishAgeTheta Fishery Age Composition Overdispersion Parameter sim_list Simulation list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Rec.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up recruitment dynamics for simulation — Setup_Sim_Rec","title":"Set up recruitment dynamics for simulation — Setup_Sim_Rec","text":"Set recruitment dynamics simulation","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Rec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up recruitment dynamics for simulation — Setup_Sim_Rec","text":"","code":"Setup_Sim_Rec(   do_recruits_move,   base_rec_sexratio,   rec_sexratio_vary,   base_r0,   r0_vary,   base_h,   init_sigmaR,   sigmaR,   recruitment_opt,   rec_dd,   init_dd,   sim_list,   rec_lag )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Rec.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up recruitment dynamics for simulation — Setup_Sim_Rec","text":"do_recruits_move whether recruits move. Character string either specified 'dont_move', 'move' base_rec_sexratio base recruitment sex-ratio value rec_sexratio_vary whether recruitment sex-ratio varies. Options include: constant base_r0 base R0 mean recruitment value r0_vary whether r0 mean recruitment varies. Options include: constant base_h base steepness value init_sigmaR Sigma R initial devs sigmaR Sigma R everything else recruitment_opt character string either \"mean_rec\" \"bh_rec\" rec_dd recruitment density dependence; character string either \"global\" \"local\" init_dd initial age density dependence; character string either \"global\" \"local\" sim_list Simulation list rec_lag Numeric, recruitment lag value","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Survey.html","id":null,"dir":"Reference","previous_headings":"","what":"Setup values for survey parameterization — Setup_Sim_Survey","title":"Setup values for survey parameterization — Setup_Sim_Survey","text":"Setup values survey parameterization","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Survey.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Setup values for survey parameterization — Setup_Sim_Survey","text":"","code":"Setup_Sim_Survey(   sigmaSrvIdx,   base_srv_q,   srv_q_pattern,   sel_model,   fixed_srv_sel_pars,   sim_list )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Survey.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Setup values for survey parameterization — Setup_Sim_Survey","text":"sigmaSrvIdx Survey index observation error, dimensioned region fleet base_srv_q Base survey catchability value, dimensioned region fleet srv_q_pattern Survey catchability pattern, dimensioned region fleet. Options include: constant sel_model Survey selectivity model dimensioned region fleet. Options include: logistic fixed_srv_sel_pars Fixed parameters survey selectivity, dimensioned region, sex, survey fleet, max number parameters needed defined survey selectivity functional form defined functional forms survey. sim_list Simulation list object","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Tagging.html","id":null,"dir":"Reference","previous_headings":"","what":"Set up simulated tagging dynamics — Setup_Sim_Tagging","title":"Set up simulated tagging dynamics — Setup_Sim_Tagging","text":"Set simulated tagging dynamics","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Tagging.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set up simulated tagging dynamics — Setup_Sim_Tagging","text":"","code":"Setup_Sim_Tagging(   n_tags,   max_liberty,   tag_years,   t_tagging,   base_Tag_Reporting,   Tag_Reporting_pattern,   Tag_Ind_Mort,   Tag_Shed,   sim_list )"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_Sim_Tagging.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set up simulated tagging dynamics — Setup_Sim_Tagging","text":"n_tags Number tags release given year max_liberty Maximum liberty track cohorts tag_years Years release tags t_tagging Time tagging (e.g., start year == 0, mid year == 0.5) base_Tag_Reporting Base tag reporting rate region Tag_Reporting_pattern Tag reporting pattern. Options include: constant Tag_Ind_Mort Initial tag induced mortality Tag_Shed Chronic tag shedding rate sim_list Simulation list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_sim_env.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","title":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","text":"Title Constructs simulation objects new simulation environment use simulation functions","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_sim_env.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","text":"","code":"Setup_sim_env(sim_list)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_sim_env.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","text":"sim_list Simulation list objects","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_sim_env.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","text":"new simulation environment objects sim_list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Setup_sim_env.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Constructs simulation objects in a new simulation environment for use in simulation functions — Setup_sim_env","text":"","code":"if (FALSE) { # \\dontrun{ sim_env <- Setup_sim_env(sim_list) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","title":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","text":"Simulates spatial, sex, age-structured population","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","text":"","code":"Simulate_Pop(sim_list, output_path)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","text":"sim_list Simulation list objects output_path path output simulation objects","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","text":"list object bunch simulated values outputs","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simulates a spatial, sex, and age-structured population — Simulate_Pop","text":"","code":"if (FALSE) { # \\dontrun{   # Set up model dimensions  sim_list <- Setup_Sim_Dim(n_sims = 100,                            n_yrs = 10,                            n_regions = 2,                            n_ages = 8,                            n_sexes = 1,                            n_fish_fleets = 1,                            n_srv_fleets = 1  )   # set up containers  sim_list <- Setup_Sim_Containers(sim_list)   # Setup fishing mortality  sim_list <- Setup_Sim_FishMort(sim_list = sim_list,                                 sigmaC = 1e-3,                                 init_F = matrix(0, nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_pattern = matrix(c('two-way', \"two-way\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_start = matrix(c(0.01, 0.01), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_fct = matrix(c(15, 15), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 proc_error = TRUE,                                 proc_error_sd = 0.1)   # Setup fishery selectivity  sim_list <- Setup_Sim_FishSel(sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                # a50, k for logistic shared across regions                                fixed_fish_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_fish_fleets, 2)),                                sim_list = sim_list  )   # Setup survey catchability and selectivity  sim_list <- Setup_Sim_Survey(    sim_list = sim_list,    sigmaSrvIdx = array(0.2, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # survey observation error    base_srv_q = array(1, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # base survey catchability value    srv_q_pattern = matrix(c('constant', \"constant\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # catchability pattern    sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # selectivity model    # a50, k, for logistic shared across regions    fixed_srv_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_srv_fleets, 2))  )   # Setup recruitment stuff  sim_list <- Setup_Sim_Rec(    sim_list = sim_list,    do_recruits_move = \"dont_move\", # == 0, recruits don't move , == 1 recruits move    base_rec_sexratio = 1, # single sex    rec_sexratio_vary = \"constant\",    base_r0 = c(50, 50),    r0_vary = \"constant\",    base_h = c(0.8, 0.8),    init_sigmaR = 0.5,    sigmaR = 0.5,    recruitment_opt = \"bh_rec\",    rec_dd = \"global\",    init_dd = \"global\",    rec_lag = 1  )   # Setup biologicals  sim_list <- Setup_Sim_Biologicals(    sim_list = sim_list,    base_M_value = array(0.5, dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sims)),    M_pattern = \"constant\",    base_WAA_values = array(rep(5 * (1 - exp(-0.1 * 1:sim_list$n_ages)), each = sim_list$n_regions * sim_list$n_sexes),                            dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)),    WAA_pattern = \"constant\",    base_Maturity_AA_values = array(rep(1 / (1 + exp(-0.3 * 1:sim_list$n_ages)), each = sim_list$n_regions * sim_list$n_sexes),                                    dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)),    Maturity_AA_pattern = \"constant\"  )   # Setup tagging stuff  sim_list <- Setup_Sim_Tagging(    sim_list = sim_list,    n_tags = 5000,    max_liberty = 30,    tag_years = seq(1, sim_list$n_yrs, 3),    t_tagging = 0.5,    base_Tag_Reporting = c(0.2, 0.2),    Tag_Reporting_pattern = \"constant\",    Tag_Ind_Mort = 0,    Tag_Shed = 0  )   # Setup observation processes  sim_list <- Setup_Sim_Observation_Proc(    sim_list = sim_list,    Comp_Structure = \"spltR_jntS\",    Comp_Srv_Like = \"Multinomial\",    Comp_Fish_Like = \"Multinomial\",    ISS_FishAge_Pattern = 'F_pattern',    FishAgeTheta = 3,    SrvAgeTheta = 2,    Srv_Like_Pars = NA,    base_ISS_FishAge = 200,    base_ISS_SrvAge = 200,    Fish_Like_Pars = NA,    Tag_Like = \"Poisson\",    Tag_Like_Pars = NA  )   # IID Movement Matrix across years and ages  ref <- 1  movement_matrix <- array(0, dim = c(sim_list$n_regions, sim_list$n_regions, sim_list$n_yrs, sim_list$n_ages, sim_list$n_sexes, sim_list$n_sims)) # From, To  base <- matrix(0, sim_list$n_regions, sim_list$n_regions)   # Plug in movement process error  for(sim in 1:sim_list$n_sims) {    for(a in 1:sim_list$n_ages) {      for(s in 1:sim_list$n_sexes) {        for(y in 1:sim_list$n_yrs) {          for(r in 1:sim_list$n_regions) {            if(a > 1) pe_err <- rnorm(length(tmp_move[-ref]), 0, 0.4) # logit proces error            else pe_err <- 0            tmp_move <- base[r,]            tmp_move[-ref] <- tmp_move[-ref] + pe_err            movement_matrix[r,,y,a,s,sim] <- exp(tmp_move) / sum(exp(tmp_move))          }        } # end y loop      } # end s loop    } # end a loop  } # end sim loop   sim_list$movement_matrix <- movement_matrix   # Run Simulation ----------------------------------------------------------  Simulate_Pop(sim_list = sim_list, output_path = here(\"sim_out.RDS\")) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop_Static.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","title":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","text":"Simulates static spatial, sex, age-structured population (feedback loop)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop_Static.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","text":"","code":"Simulate_Pop_Static(sim_list, output_path)"},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop_Static.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","text":"sim_list Simulation list objects output_path path output simulation objects","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop_Static.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","text":"list object bunch simulated values outputs","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/Simulate_Pop_Static.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Simulates a static spatial, sex, and age-structured population (no feedback loop) — Simulate_Pop_Static","text":"","code":"if (FALSE) { # \\dontrun{   # Set up model dimensions  sim_list <- Setup_Sim_Dim(n_sims = 100,                            n_yrs = 10,                            n_regions = 2,                            n_ages = 8,                            n_sexes = 1,                            n_fish_fleets = 1,                            n_srv_fleets = 1  )   # set up containers  sim_list <- Setup_Sim_Containers(sim_list)   # Setup fishing mortality  sim_list <- Setup_Sim_FishMort(sim_list = sim_list,                                 sigmaC = 1e-3,                                 init_F = matrix(0, nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_pattern = matrix(c('two-way', \"two-way\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_start = matrix(c(0.01, 0.01), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 Fmort_fct = matrix(c(15, 15), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                 proc_error = TRUE,                                 proc_error_sd = 0.1)   # Setup fishery selectivity  sim_list <- Setup_Sim_FishSel(sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_fish_fleets),                                # a50, k for logistic shared across regions                                fixed_fish_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_fish_fleets, 2)),                                sim_list = sim_list  )   # Setup survey catchability and selectivity  sim_list <- Setup_Sim_Survey(    sim_list = sim_list,    sigmaSrvIdx = array(0.2, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # survey observation error    base_srv_q = array(1, dim = c(sim_list$n_regions, sim_list$n_srv_fleets)), # base survey catchability value    srv_q_pattern = matrix(c('constant', \"constant\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # catchability pattern    sel_model = matrix(c('logistic', \"logistic\"), nrow = sim_list$n_regions, ncol = sim_list$n_srv_fleets), # selectivity model    # a50, k, for logistic shared across regions    fixed_srv_sel_pars = array(c(3,3,1,1), dim = c(sim_list$n_regions, sim_list$n_sexes, sim_list$n_srv_fleets, 2))  )   # Setup recruitment stuff  sim_list <- Setup_Sim_Rec(    sim_list = sim_list,    do_recruits_move = \"dont_move\", # == 0, recruits don't move , == 1 recruits move    base_rec_sexratio = 1, # single sex    rec_sexratio_vary = \"constant\",    base_r0 = c(50, 50),    r0_vary = \"constant\",    base_h = c(0.8, 0.8),    init_sigmaR = 0.5,    sigmaR = 0.5,    recruitment_opt = \"bh_rec\",    rec_dd = \"global\",    init_dd = \"global\",    rec_lag = 1  )   # Setup biologicals  sim_list <- Setup_Sim_Biologicals(    sim_list = sim_list,    base_M_value = array(0.5, dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sims)),    M_pattern = \"constant\",    base_WAA_values = array(rep(5 * (1 - exp(-0.1 * 1:sim_list$n_ages)), each = sim_list$n_regions * sim_list$n_sexes),                            dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)),    WAA_pattern = \"constant\",    base_Maturity_AA_values = array(rep(1 / (1 + exp(-0.3 * 1:sim_list$n_ages)), each = sim_list$n_regions * sim_list$n_sexes),                                    dim = c(sim_list$n_regions, sim_list$n_ages, sim_list$n_sexes)),    Maturity_AA_pattern = \"constant\"  )   # Setup tagging stuff  sim_list <- Setup_Sim_Tagging(    sim_list = sim_list,    n_tags = 5000,    max_liberty = 30,    tag_years = seq(1, sim_list$n_yrs, 3),    t_tagging = 0.5,    base_Tag_Reporting = c(0.2, 0.2),    Tag_Reporting_pattern = \"constant\",    Tag_Ind_Mort = 0,    Tag_Shed = 0  )   # Setup observation processes  sim_list <- Setup_Sim_Observation_Proc(    sim_list = sim_list,    Comp_Structure = \"spltR_jntS\",    Comp_Srv_Like = \"Multinomial\",    Comp_Fish_Like = \"Multinomial\",    ISS_FishAge_Pattern = 'F_pattern',    FishAgeTheta = 3,    SrvAgeTheta = 2,    Srv_Like_Pars = NA,    base_ISS_FishAge = 200,    base_ISS_SrvAge = 200,    Tag_Like = \"Poisson\",    Tag_Like_Pars = NA  )   # IID Movement Matrix across years and ages  ref <- 1  movement_matrix <- array(0, dim = c(sim_list$n_regions, sim_list$n_regions, sim_list$n_yrs, sim_list$n_ages, sim_list$n_sexes, sim_list$n_sims)) # From, To  base <- matrix(0, sim_list$n_regions, sim_list$n_regions)   # Plug in movement process error  for(sim in 1:sim_list$n_sims) {    for(a in 1:sim_list$n_ages) {      for(s in 1:sim_list$n_sexes) {        for(y in 1:sim_list$n_yrs) {          for(r in 1:sim_list$n_regions) {            if(a > 1) pe_err <- rnorm(length(tmp_move[-ref]), 0, 0.4) # logit proces error            else pe_err <- 0            tmp_move <- base[r,]            tmp_move[-ref] <- tmp_move[-ref] + pe_err            movement_matrix[r,,y,a,s,sim] <- exp(tmp_move) / sum(exp(tmp_move))          }        } # end y loop      } # end s loop    } # end a loop  } # end sim loop   sim_list$movement_matrix <- movement_matrix   # Run Simulation ----------------------------------------------------------  Simulate_Pop_Static(sim_list = sim_list, output_path = here(\"sim_out.RDS\")) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/bisection_F.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Go from TAC to Fishing Mortality using bisection — bisection_F","title":"Title Go from TAC to Fishing Mortality using bisection — bisection_F","text":"Title Go TAC Fishing Mortality using bisection","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/bisection_F.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Go from TAC to Fishing Mortality using bisection — bisection_F","text":"","code":"bisection_F(   f_guess,   catch,   NAA,   WAA,   natmort,   fish_sel,   n.iter = 20,   lb = 0,   ub = 2 )"},{"path":"https://chengmatt.github.io/SPoCK/reference/bisection_F.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Go from TAC to Fishing Mortality using bisection — bisection_F","text":"f_guess Initial guess F catch Provided catch values NAA Numbers, dimensioned ages, sexes WAA Weight, dimensioned ages sexes natmort Natural mortality dimensioned ages sex fish_sel Fishery selectivity, dimesnioned ages sex n.iter Number iterations bisection lb Lower bound F ub Upper bound F","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/bisection_F.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Go from TAC to Fishing Mortality using bisection — bisection_F","text":"Fishing mortality values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/check_data_dimensions.html","id":null,"dir":"Reference","previous_headings":"","what":"Helper function used to check data dimensions to ensure they are correct — check_data_dimensions","title":"Helper function used to check data dimensions to ensure they are correct — check_data_dimensions","text":"Helper function used check data dimensions ensure correct","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/check_data_dimensions.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Helper function used to check data dimensions to ensure they are correct — check_data_dimensions","text":"","code":"check_data_dimensions(   x,   n_regions = NULL,   n_years = NULL,   n_ages = NULL,   n_lens = NULL,   n_sexes = NULL,   n_fish_fleets = NULL,   n_srv_fleets = NULL,   what )"},{"path":"https://chengmatt.github.io/SPoCK/reference/check_data_dimensions.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Helper function used to check data dimensions to ensure they are correct — check_data_dimensions","text":"x Object evaluate n_regions Number regions n_years Number years n_ages Number ages n_lens Number lengths n_sexes Number sexes n_fish_fleets Number fishery fleets n_srv_fleets Number survey fleets charcter specifying evaluated","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/cmb.html","id":null,"dir":"Reference","previous_headings":"","what":"For combining a parameter and data list in RTMB so a data object can be explicitly defined — cmb","title":"For combining a parameter and data list in RTMB so a data object can be explicitly defined — cmb","text":"combining parameter data list RTMB data object can explicitly defined","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/cmb.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"For combining a parameter and data list in RTMB so a data object can be explicitly defined — cmb","text":"","code":"cmb(f, d)"},{"path":"https://chengmatt.github.io/SPoCK/reference/cmb.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"For combining a parameter and data list in RTMB so a data object can be explicitly defined — cmb","text":"f Parameter list d Data list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/cmb.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"For combining a parameter and data list in RTMB so a data object can be explicitly defined — cmb","text":"","code":"if (FALSE) { # \\dontrun{   obj <- RTMB::MakeADFun(cmb(sabie_RTMB, data), parameters = parameters, map = mapping, random = random, silent = TRUE) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/collect_message.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Helper function to collect messages — collect_message","title":"Title Helper function to collect messages — collect_message","text":"Title Helper function collect messages","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/collect_message.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Helper function to collect messages — collect_message","text":"","code":"collect_message(...)"},{"path":"https://chengmatt.github.io/SPoCK/reference/collect_message.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Helper function to collect messages — collect_message","text":"... character vector messages","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dbeta_symmetric.html","id":null,"dir":"Reference","previous_headings":"","what":"Symmetric Beta Function — dbeta_symmetric","title":"Symmetric Beta Function — dbeta_symmetric","text":"Symmetric Beta Function","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dbeta_symmetric.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Symmetric Beta Function — dbeta_symmetric","text":"","code":"dbeta_symmetric(p_val, p_ub, p_lb, p_prsd, log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/dbeta_symmetric.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Symmetric Beta Function — dbeta_symmetric","text":"p_val Parameter value p_ub Upper Bound Parameter p_lb Lower Bound Parameter p_prsd SD parameter, higher values stronger penalty bounds, lower values difuse penalty bounds log whether return log likelihood","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dbeta_symmetric.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Symmetric Beta Function — dbeta_symmetric","text":"Returns likelihood values symmetric beta","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirichlet.html","id":null,"dir":"Reference","previous_headings":"","what":"Dirichlet Likelihood — ddirichlet","title":"Dirichlet Likelihood — ddirichlet","text":"Dirichlet Likelihood","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirichlet.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Dirichlet Likelihood — ddirichlet","text":"","code":"ddirichlet(x, alpha, log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirichlet.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Dirichlet Likelihood — ddirichlet","text":"x vector values alpha Expected values w/ concentration sum(alpha) log Whether give log ","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirichlet.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Dirichlet Likelihood — ddirichlet","text":"Returns likelihood values form dirichlet","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirmult.html","id":null,"dir":"Reference","previous_headings":"","what":"Dirichlet Mutlinomial Likelihood From https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp — ddirmult","title":"Dirichlet Mutlinomial Likelihood From https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp — ddirmult","text":"Dirichlet Mutlinomial Likelihood https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirmult.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Dirichlet Mutlinomial Likelihood From https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp — ddirmult","text":"","code":"ddirmult(obs, pred, Ntotal, ln_theta, give_log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirmult.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Dirichlet Mutlinomial Likelihood From https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp — ddirmult","text":"obs Vector observed values proportions pred Vector predicted values proportions Ntotal Input sample size scalar ln_theta Weighting parameter log space give_log Whether likelihood log space","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/ddirmult.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Dirichlet Mutlinomial Likelihood From https://github.com/James-Thorson/CCSRA/blob/main/inst/executables/CCSRA_v9.cpp — ddirmult","text":"returns likelihood values dirihclet multinomial","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dlogistnormal.html","id":null,"dir":"Reference","previous_headings":"","what":"Logistic Normal Likelihood — dlogistnormal","title":"Logistic Normal Likelihood — dlogistnormal","text":"Logistic Normal Likelihood","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dlogistnormal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Logistic Normal Likelihood — dlogistnormal","text":"","code":"dlogistnormal(obs, pred, Sigma, give_log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/dlogistnormal.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Logistic Normal Likelihood — dlogistnormal","text":"obs Vector observed values numbers (can integers non-integers - vector length n_bins) pred Vector predicted values proportions (vector length n_bins) Sigma Covariance matrix give_log whether use log space likelihood","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dlogistnormal.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Logistic Normal Likelihood — dlogistnormal","text":"Returns likelihood values logistic normal","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dnbinom_robust_noint.html","id":null,"dir":"Reference","previous_headings":"","what":"Negative binomial that can take non-integer values — dnbinom_robust_noint","title":"Negative binomial that can take non-integer values — dnbinom_robust_noint","text":"Negative binomial can take non-integer values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dnbinom_robust_noint.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Negative binomial that can take non-integer values — dnbinom_robust_noint","text":"","code":"dnbinom_robust_noint(x, log_mu, log_var_minus_mu, give_log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/dnbinom_robust_noint.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Negative binomial that can take non-integer values — dnbinom_robust_noint","text":"x observations log_mu log mu log_var_minus_mu log var minus mu - reparameterize negbin give_log whether give log","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dnbinom_robust_noint.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Negative binomial that can take non-integer values — dnbinom_robust_noint","text":"Returns likelihood values robust negative binomial","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_francis_reweighting.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Francis Reweighting — do_francis_reweighting","title":"Run Francis Reweighting — do_francis_reweighting","text":"Run Francis Reweighting","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_francis_reweighting.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Francis Reweighting — do_francis_reweighting","text":"","code":"do_francis_reweighting(data, rep, age_labels, len_labels, year_labels)"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_francis_reweighting.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Francis Reweighting — do_francis_reweighting","text":"data List data inputs rep Report file list age_labels Age labels len_labels Length labels year_labels Year labels","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_francis_reweighting.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Francis Reweighting — do_francis_reweighting","text":"list object francis weights (note NAs , using jnt composition approaches - .e., uses one dimension)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_francis_reweighting.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run Francis Reweighting — do_francis_reweighting","text":"","code":"if (FALSE) { # \\dontrun{ for(j in 1:5) {    if(j == 1) { # reset weights at 1     data$Wt_FishAgeComps[] <- 1     data$Wt_FishLenComps[] <- 1     data$Wt_SrvAgeComps[] <- 1     data$Wt_SrvLenComps[] <- 1   } else {     data$Wt_FishAgeComps[] <- wts$new_fish_age_wts     data$Wt_FishLenComps[] <- wts$new_fish_len_wts     data$Wt_SrvAgeComps[] <- wts$new_srv_age_wts     data$Wt_SrvLenComps[] <- wts$new_srv_len_wts   }    sabie_rtmb_model <- fit_model(data,                                 parameters,                                 mapping,                                 random = NULL,                                 newton_loops = 3,                                 silent = TRUE   )    rep <- sabie_rtmb_model$report(sabie_rtmb_model$env$last.par.best) # Get report   wts <- do_francis_reweighting(data = data, rep = rep, age_labels = 2:31,                                 len_labels = seq(41, 99, 2), year_labels = 1960:2021) } } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_jitter.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Jitter Analysis — do_jitter","title":"Run Jitter Analysis — do_jitter","text":"Run Jitter Analysis","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_jitter.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Jitter Analysis — do_jitter","text":"","code":"do_jitter(   data,   parameters,   mapping,   random = NULL,   sd,   n_jitter,   n_newton_loops,   do_par,   n_cores )"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_jitter.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Jitter Analysis — do_jitter","text":"data Data list make obj parameters Parameter list make obj mapping Mapping list make obj random Character random effects sd sd jitter (additive) n_jitter Number jitters n_newton_loops Number newton loops do_par Whether paralleizaiton (boolean) n_cores Number cores use","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_jitter.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Jitter Analysis — do_jitter","text":"Dataframe jitter values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_jitter.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run Jitter Analysis — do_jitter","text":"","code":"if (FALSE) { # \\dontrun{    library(ggplot2)    # get jitter values    jit <- do_jitter(data = data,                  parameters = parameters,                  mapping = mapping,                  random = NULL,                  sd = 0.1,                  n_jitter = 100,                  n_newton_loops = 3,                  do_par = TRUE,                  n_cores = 8)     # get proportion converged    prop_converged <- jit %>%    filter(Year == 1, Type == 'Recruitment') %>%      summarize(prop_conv = sum(Hessian) / length(Hessian))     # get final model results    final_mod <- reshape2::melt(sabie_rtmb_model$rep$SSB) %>% rename(Region = Var1, Year = Var2) %>%    mutate(Type = 'SSB') %>%      bind_rows(reshape2::melt(sabie_rtmb_model$rep$Rec) %>%      rename(Region = Var1, Year = Var2) %>% mutate(Type = 'Recruitment'))     # comparison of SSB and recruitment   ggplot() +     geom_line(jit, mapping = aes(x = Year + 1959, y = value, group = jitter, color = Hessian), lwd = 1) +     geom_line(final_mod, mapping = aes(x = Year + 1959, y = value), color = \"black\", lwd = 1.3 , lty = 2) +     facet_grid(Type~Region, scales = 'free',                labeller = labeller(Region = function(x) paste0(\"Region \", x),                                    Type = c(\"Recruitment\" = \"Age 2 Recruitment (millions)\", \"SSB\" = 'SSB (kt)'))) +     labs(x = \"Year\", y = \"Value\") +     theme_bw(base_size = 20) +     scale_color_manual(values = c(\"red\", 'grey')) +     geom_text(data = jit %>% filter(Type == 'SSB', Year == 1, jitter == 1),               aes(x = Inf, y = Inf, label = paste(\"Proportion Converged: \", round(prop_converged$prop_conv, 3))),               hjust = 1.1, vjust = 1.9, size = 6, color = \"black\")     # compare jitter of max gradient and hessian PD    ggplot(jit, aes(x = jitter, y = jnLL, color = Max_Gradient, shape = Hessian)) +      geom_point(size = 5, alpha = 0.3) +      geom_hline(yintercept = min(sabie_rtmb_model$rep$jnLL), lty = 2, size = 2, color = \"blue\") +      facet_wrap(~Hessian, labeller = labeller(        Hessian = c(\"FALSE\" = \"non-PD Hessian\", \"TRUE\" = 'PD Hessian')      )) +      scale_color_viridis_c() +      theme_bw(base_size = 20) +      theme(legend.position = \"bottom\") +      guides(color = guide_colorbar(barwidth = 15, barheight = 0.5)) +      labs(x = 'Jitter') +      geom_text(data = jit %>% filter(Hessian == TRUE, Year == 1, jitter == 1),                aes(x = Inf, y = Inf, label = paste(\"Proportion Converged: \", round(prop_converged$prop_conv, 3))),                hjust = 1.1, vjust = 1.9, size = 6, color = \"black\") } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_likelihood_profile.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Likelihood Profile — do_likelihood_profile","title":"Run Likelihood Profile — do_likelihood_profile","text":"Run Likelihood Profile","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_likelihood_profile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Likelihood Profile — do_likelihood_profile","text":"","code":"do_likelihood_profile(   data,   parameters,   mapping,   random = NULL,   what,   idx = NULL,   min_val,   max_val,   inc = 0.05 )"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_likelihood_profile.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Likelihood Profile — do_likelihood_profile","text":"data data list model parameters parameter list model mapping mapping list model random character vector random effects estimate parameter name want profile idx Index parameter array, pointing value want map (index relative flattened array) min_val minimum value profile max_val maximum value profile inc increment value min max value","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_likelihood_profile.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Likelihood Profile — do_likelihood_profile","text":"Returns list likelihood profiled values data component respective dimensions (e.g., likelihood profiles fleet, region, year, etc.) well likelihood profiles data component, aggregated across respective dimensions.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_mcmc.html","id":null,"dir":"Reference","previous_headings":"","what":"Run MCMC using rtmbstan — do_mcmc","title":"Run MCMC using rtmbstan — do_mcmc","text":"Run MCMC using rtmbstan","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_mcmc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run MCMC using rtmbstan — do_mcmc","text":"","code":"do_mcmc(obj, chains, cores, iter, thin, bounds = Inf, laplace = FALSE, ...)"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_mcmc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run MCMC using rtmbstan — do_mcmc","text":"obj Object built ADFUN via RTMB chains Number chains run cores Number cores use iter Number MCMC iterations run thin Thinning rate bounds Uniform bounds constrain parameter bounds laplace Whether laplace approximation random effects MCMC fixed effects ... Additional arguments tmbstan (e.g., adapt_delta)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_mcmc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run MCMC using rtmbstan — do_mcmc","text":"MCMC list object rtmbstan","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_mcmc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run MCMC using rtmbstan — do_mcmc","text":"","code":"if (FALSE) { # \\dontrun{ obj <- RTMB::MakeADFun(cmb(SPoCK_rtmb, data), parameters = parameters, map = mapping) mcmc <- do_mcmc(obj = obj,                 chains = 4,                 cores = 4,                 iter = 10000,                 thin = 10,                 bounds = 1.5,                 laplace = FALSE,                 adapt_delta = 0.99) saveRDS(mcmc, here('output', 'MCMC_Model_23.5.rds')) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_retrospective.html","id":null,"dir":"Reference","previous_headings":"","what":"Functino to run retrospective analyses — do_retrospective","title":"Functino to run retrospective analyses — do_retrospective","text":"Functino run retrospective analyses","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_retrospective.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Functino to run retrospective analyses — do_retrospective","text":"","code":"do_retrospective(   n_retro,   data,   parameters,   mapping,   random = NULL,   do_par,   n_cores,   do_francis,   n_francis_iter = NULL )"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_retrospective.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Functino to run retrospective analyses — do_retrospective","text":"n_retro Number retrospective peels data Data list RTMB model parameters Parameter list RTMB model mapping Mapping list RTMB model random Random effects character vector - default NULL do_par Whether parrallelization, boolean n_cores Number cores use parrallelization do_francis Whether francis reweighitng within given retrospective peel, boolean n_francis_iter Number francis iterations ","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_retrospective.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Functino to run retrospective analyses — do_retrospective","text":"Dataframe retrospective estiamtes SSB recruitment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_retrospective.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Functino to run retrospective analyses — do_retrospective","text":"","code":"if (FALSE) { # \\dontrun{  # Do retrospective here  ret <- do_retrospective(n_retro = 7, data, parameters, mapping, random = NULL, do_par = TRUE, n_cores = 7, do_francis = TRUE, n_francis_iter = 5)  ggplot(ret, aes(x = Year + 1959, y = value, group = peel, color = 2024 - peel)) +    geom_line(lwd = 1.3) +    facet_wrap(~Type) +    guides (color = guide_colourbar(barwidth = 10, barheight = 1.3)) +    labs(x = 'Year', y = 'Value', color = 'Retrospective Year') +    scale_color_viridis_c() +    theme_bw(base_size = 15) +    theme(legend.position = 'top')   ret %>%    dplyr::mutate(Year = Year + 1959, terminal = 2024 - peel, cohort = Year - 2, years_est = terminal-Year) %>%    filter(Type == 'Recruitment', cohort %in% c(2014:2022), terminal != Year) %>%    ggplot(aes(x = years_est - 1, y = value, group = Year, color = factor(cohort))) +    geom_line(lwd = 1.3) +    geom_point(size = 4) +    theme_bw(base_size = 15) +    labs(x = 'Years since cohort was last estimated', y = 'Recruitment (millions)', color = 'Cohort') } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_runs_test.html","id":null,"dir":"Reference","previous_headings":"","what":"Runs test function taken from SS3 diags. — do_runs_test","title":"Runs test function taken from SS3 diags. — do_runs_test","text":"Runs test function taken SS3 diags.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_runs_test.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Runs test function taken from SS3 diags. — do_runs_test","text":"","code":"do_runs_test(x, type = NULL, mixing = \"two.sided\")"},{"path":"https://chengmatt.github.io/SPoCK/reference/do_runs_test.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Runs test function taken from SS3 diags. — do_runs_test","text":"x Vector residuals type Whether use mean 0 assumption mean residuals (default = use mean 0) mixing Type test , less = left tailed test detects positive autocorrelation, two.sided = two sided test tests whether positive /negative autocorrealtion. null , rejecting null (<0.05) indictes non-randomness.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_runs_test.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Runs test function taken from SS3 diags. — do_runs_test","text":"List object p value limits three-sigma limit - (potential data outlier, residual > 3 standard deviations away mean 0)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/do_runs_test.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Runs test function taken from SS3 diags. — do_runs_test","text":"","code":"if (FALSE) { # \\dontrun{  idx_fits <- get_idx_fits(data = data, rep = rep, year_labs = seq(1960, 2024, 1))   idx_fits <- idx_fits %>%     mutate(       Idx = case_when(         Type == \"Fishery\" & Year < 1995 ~ \"Japanese Fishery CPUE Index\",         Type == \"Fishery\" & Year >= 1995 ~ \"Domestic Fishery CPUE Index\",         Type == 'Survey' & Fleet == 1 ~ \"Domestic LL Survey Relative Population Numbers\",         Type == 'Survey' & Fleet == 2 ~ \"GOA Trawl Survey Biomass (kt)\",         Type == 'Survey' & Fleet == 3 ~ 'Japanese LL Survey Relative Population Numbers'       )     )    unique_idx <- unique(idx_fits$Idx)   runs_all <- data.frame()   for(i in 1:length(unique(idx_fits$Idx))) {     tmp <- idx_fits %>% filter(Idx == unique_idx[i])     runstest <- do_runs_test(x=as.numeric(tmp$resid),type=\"resid\", mixing = \"less\")     tmp_runs <- data.frame(p = runstest$p.runs, lwr = runstest$sig3lim[1], upr = runstest$sig3lim[2], Idx = unique_idx[i])     runs_all <- rbind(runs_all, tmp_runs)   } # end i    ggplot() +     geom_point(idx_fits, mapping = aes(x = Year, y = resid)) +     geom_segment(idx_fits, mapping = aes(x = Year, xend = Year, y = 0, yend = resid)) +     geom_smooth(idx_fits, mapping = aes(x = Year, y = resid), se = F) +     geom_hline(yintercept = 0, lty = 2) +     geom_hline(runs_all, mapping = aes(yintercept = upr), lty = 2) +     geom_hline(runs_all, mapping = aes(yintercept = lwr), lty = 2) +     geom_text(data = runs_all, aes(x = -Inf, y = Inf, label = paste(\"p = \", round(p, 3))), hjust = -0.5, vjust = 8.2, size = 7)+     labs(x = \"Year\", y = 'Residuals') +     theme_bw(base_size = 20) +     facet_wrap(~Idx, scales = 'free', ncol = 2) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/dpois_noint.html","id":null,"dir":"Reference","previous_headings":"","what":"Poisson that can take non-integer values — dpois_noint","title":"Poisson that can take non-integer values — dpois_noint","text":"Poisson can take non-integer values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dpois_noint.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Poisson that can take non-integer values — dpois_noint","text":"","code":"dpois_noint(x, pred, give_log = TRUE)"},{"path":"https://chengmatt.github.io/SPoCK/reference/dpois_noint.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Poisson that can take non-integer values — dpois_noint","text":"x observations pred predicted give_log giving log likelihood","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/dpois_noint.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Poisson that can take non-integer values — dpois_noint","text":"Returns likelihood values poisson","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/fit_model.html","id":null,"dir":"Reference","previous_headings":"","what":"Run RTMB model — fit_model","title":"Run RTMB model — fit_model","text":"Run RTMB model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/fit_model.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run RTMB model — fit_model","text":"","code":"fit_model(   data,   parameters,   mapping,   random = NULL,   newton_loops = 3,   silent = FALSE,   ... )"},{"path":"https://chengmatt.github.io/SPoCK/reference/fit_model.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run RTMB model — fit_model","text":"data Data list parameters Parameter list mapping Mapping list random Character random effects integrate newton_loops Number newton loops run get gradients silent Boolean whether model run silent ... additional arguments taken MakeADFUN","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/fit_model.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run RTMB model — fit_model","text":"Returns list object optimized, results outputted RTMB model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/fit_model.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run RTMB model — fit_model","text":"","code":"if (FALSE) { # \\dontrun{ model <- fit_model(data,                  parameters,                  mapping,                  random = NULL,                  newton_loops = 3) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_AR1_CorrMat.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","title":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","text":"Function fill n x n correlation AR(1) matrix","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_AR1_CorrMat.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","text":"","code":"get_AR1_CorrMat(n, rho)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_AR1_CorrMat.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","text":"n Number bins rho correaltion parameter","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_AR1_CorrMat.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","text":"correlation matrix ar1 process","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_AR1_CorrMat.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to fill in an n x n correlation AR(1) matrix — get_AR1_CorrMat","text":"","code":"if (FALSE) { # \\dontrun{ mat <- get_AR1_CorrMat(10, 0.5) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_Constant_CorrMat.html","id":null,"dir":"Reference","previous_headings":"","what":"Constant correlation matrix — get_Constant_CorrMat","title":"Constant correlation matrix — get_Constant_CorrMat","text":"Constant correlation matrix","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_Constant_CorrMat.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Constant correlation matrix — get_Constant_CorrMat","text":"","code":"get_Constant_CorrMat(n, rho)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_Constant_CorrMat.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Constant correlation matrix — get_Constant_CorrMat","text":"n Number bins rho correaltion parameter","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_Constant_CorrMat.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Constant correlation matrix — get_Constant_CorrMat","text":"constant correlation matrix","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_Constant_CorrMat.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Constant correlation matrix — get_Constant_CorrMat","text":"","code":"if (FALSE) { # \\dontrun{ mat <- get_Constant_CorrMat(10, 0.5) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_beta_scaled_pars.html","id":null,"dir":"Reference","previous_headings":"","what":"Get scaled alpha beta parameters for a scaled beta distribution (for steepness) from https://stackoverflow.com/questions/75165770/beta-distribution-with-bounds-at-0-1-0-5 — get_beta_scaled_pars","title":"Get scaled alpha beta parameters for a scaled beta distribution (for steepness) from https://stackoverflow.com/questions/75165770/beta-distribution-with-bounds-at-0-1-0-5 — get_beta_scaled_pars","text":"Get scaled alpha beta parameters scaled beta distribution (steepness) https://stackoverflow.com/questions/75165770/beta-distribution--bounds--0-1-0-5","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_beta_scaled_pars.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get scaled alpha beta parameters for a scaled beta distribution (for steepness) from https://stackoverflow.com/questions/75165770/beta-distribution-with-bounds-at-0-1-0-5 — get_beta_scaled_pars","text":"","code":"get_beta_scaled_pars(low, high, mu, sigma)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_beta_scaled_pars.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get scaled alpha beta parameters for a scaled beta distribution (for steepness) from https://stackoverflow.com/questions/75165770/beta-distribution-with-bounds-at-0-1-0-5 — get_beta_scaled_pars","text":"low lower bound high upper bound mu mean normal space sigma sigma normal space","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_beta_scaled_pars.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get scaled alpha beta parameters for a scaled beta distribution (for steepness) from https://stackoverflow.com/questions/75165770/beta-distribution-with-bounds-at-0-1-0-5 — get_beta_scaled_pars","text":"Returns beta distribution parmeters bounds","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_biological_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Plots of Biological Quantities — get_biological_plot","title":"Title Get Plots of Biological Quantities — get_biological_plot","text":"Title Get Plots Biological Quantities","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_biological_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Plots of Biological Quantities — get_biological_plot","text":"","code":"get_biological_plot(data, rep)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_biological_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Plots of Biological Quantities — get_biological_plot","text":"data data list used SPoCK rep report list used SPoCK","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_biological_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Plots of Biological Quantities — get_biological_plot","text":"list plots movement, natural mortality, weight--age, maturity age","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_biological_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Plots of Biological Quantities — get_biological_plot","text":"","code":"if (FALSE) { # \\dontrun{ get_biological_plot(data, rep) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_comp_prop.html","id":null,"dir":"Reference","previous_headings":"","what":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","title":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","text":"Gets composition data proportions normalized according assessment specifications RTMB","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_comp_prop.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","text":"","code":"get_comp_prop(data, rep, age_labels, len_labels, year_labels)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_comp_prop.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","text":"data list data inputs rep report file RTMB age_labels vector observed age labels assessment len_labels vector length labels assessment year_labels vector years","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_comp_prop.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","text":"List fishery age, lengths, survey age, lengths dataframe well matrix form (dimensioned region, year, bin, sex, fleet)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_comp_prop.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Gets composition data proportions normalized according to the assessment specifications from RTMB — get_comp_prop","text":"","code":"if (FALSE) { # \\dontrun{ comp_props <- get_comp_prop(data = data, rep = rep, age_labels = 2:31, len_labels = seq(41, 99, 2), year_labels = 1960:2024) comp_props$Fishery_Ages %>%   filter(Fleet == 1, Sex == 1) %>%   ggplot() +   geom_col(aes(x = Age, y = obs)) +   geom_line(aes(x = Age, y = pred)) +   facet_wrap(~Year, ncol = 3)    comp_props$Survey_Ages %>%     group_by(Region, Age, Sex, Fleet) %>%     summarize(lwr_obs = quantile(obs, 0.1),               upr_obs = quantile(obs, 0.9),               lwr_pred = quantile(pred, 0.1),               upr_pred = quantile(pred, 0.9),               obs = mean(obs),               pred = mean(pred)) %>%     ggplot() +     geom_line(mapping = aes(x = Age, y = obs, color = 'Obs', lty = 'Obs'), lwd = 1.3) +     geom_ribbon(mapping = aes(x = Age, y = obs, ymin = lwr_obs, ymax = upr_obs, fill = 'Obs'), alpha = 0.3) +     geom_line(mapping = aes(x = Age, y = pred, color = 'Pred', lty = 'Pred'), lwd = 1.3) +     geom_ribbon(mapping = aes(x = Age, y = pred, ymin = lwr_pred, ymax = upr_pred, fill = 'Pred'), alpha = 0.3) +     facet_grid(Region~Fleet, labeller = labeller(       Region = c('1' = \"Region 1\"),       Fleet = c('1' = 'Domestic LL Survey', '3' = 'JP LL Survey')     )) +     labs(x = 'Age', y = 'Proportion', color = '', linetype = '', fill = '') +     theme_bw(base_size = 20) +     theme(legend.position = 'top') } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_data_fitted_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Data Fitted to Plot — get_data_fitted_plot","title":"Title Get Data Fitted to Plot — get_data_fitted_plot","text":"Title Get Data Fitted Plot","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_data_fitted_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Data Fitted to Plot — get_data_fitted_plot","text":"","code":"get_data_fitted_plot(data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_data_fitted_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Data Fitted to Plot — get_data_fitted_plot","text":"data data list fed SPoCK","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_data_fitted_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Data Fitted to Plot — get_data_fitted_plot","text":"plot data fitted ","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_data_fitted_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Data Fitted to Plot — get_data_fitted_plot","text":"","code":"if (FALSE) { # \\dontrun{ get_data_fitted_plot(data) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_francis_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","title":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","text":"Computes Francis weights, used internally do_francis_reweighting","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_francis_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","text":"","code":"get_francis_weights(   n_regions,   n_sexes,   n_fleets,   Use,   ISS,   Pred_array,   Obs_array,   weights,   bins,   comp_type )"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_francis_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","text":"n_regions Number regions n_sexes Number sexes n_fleets Number fleets (fishery survey) Use Array data list specifies whether use data year ISS Input sample size array Pred_array Predicted values array dimensioned n_regions, n_years, n_ages, n_sexes, n_fleets Obs_array Observed values array dimensioned n_regions, n_years, n_ages, n_sexes, n_fleets weights Array francis weights (NAs) apply dimensioned n_regions, n_years, n_sexes, n_fleets bins Vector bins used (age length) comp_type Matrix composition structure types dimensioned year fleet","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_francis_weights.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","text":"Value calculated francis weight","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_francis_weights.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Computes Francis weights, which is used internally by do_francis_reweighting — get_francis_weights","text":"","code":"if (FALSE) { # \\dontrun{ # Function is used within do_francis_reweighting get_francis_weights(n_regions, n_sexes, n_fleets, Use, ISS, Pred_arry, Obs_array, weights, bins, comp_type) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits.html","id":null,"dir":"Reference","previous_headings":"","what":"Gets index fits results — get_idx_fits","title":"Gets index fits results — get_idx_fits","text":"Gets index fits results","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Gets index fits results — get_idx_fits","text":"","code":"get_idx_fits(data, rep, year_labs)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Gets index fits results — get_idx_fits","text":"data Data list fed RTMB rep Report list output RTMB year_labs Year labels use (vector)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Gets index fits results — get_idx_fits","text":"Fits indices dataframe","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Gets index fits results — get_idx_fits","text":"","code":"if (FALSE) { # \\dontrun{ idx_fits <- get_idx_fits(data = data, rep = rep, year_labs = seq(1960, 2024, 1))  idx_fits <- idx_fits %>%   mutate(     Idx = case_when(       Type == \"Fishery\" & Year < 1995 ~ \"Japanese Fishery CPUE Index\",       Type == \"Fishery\" & Year >= 1995 ~ \"Domestic Fishery CPUE Index\",       Type == 'Survey' & Fleet == 1 ~ \"Domestic LL Survey Relative Population Numbers\",       Type == 'Survey' & Fleet == 2 ~ \"GOA Trawl Survey Biomass (kt)\",       Type == 'Survey' & Fleet == 3 ~ 'Japanese LL Survey Relative Population Numbers'     )   ) ggplot() +   geom_line(idx_fits, mapping = aes(x = Year, y = value), lwd = 1.3, col = 'red') +   geom_pointrange(idx_fits, mapping = aes(x = Year, y = obs, ymin = lci, ymax = uci), color = 'blue', pch = 1) +   labs(x = \"Year\", y = 'Index') +   theme_bw(base_size = 20) +   facet_wrap(~Idx, scales = 'free', ncol = 2)  } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Index Fits Plot — get_idx_fits_plot","title":"Title Get Index Fits Plot — get_idx_fits_plot","text":"Title Get Index Fits Plot","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Index Fits Plot — get_idx_fits_plot","text":"","code":"get_idx_fits_plot(data, rep)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Index Fits Plot — get_idx_fits_plot","text":"data data list SPoCK rep report list SPoCK","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Index Fits Plot — get_idx_fits_plot","text":"plot fitted values various indices","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_idx_fits_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Index Fits Plot — get_idx_fits_plot","text":"","code":"if (FALSE) { # \\dontrun{ get_idx_fits_plot(data,rep) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_mcmc_ssb_rec.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive SSB and Recruitment from MCMC using posterior samples — get_mcmc_ssb_rec","title":"Derive SSB and Recruitment from MCMC using posterior samples — get_mcmc_ssb_rec","text":"Derive SSB Recruitment MCMC using posterior samples","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_mcmc_ssb_rec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive SSB and Recruitment from MCMC using posterior samples — get_mcmc_ssb_rec","text":"","code":"get_mcmc_ssb_rec(mcmc_obj, tmb_obj)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_mcmc_ssb_rec.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive SSB and Recruitment from MCMC using posterior samples — get_mcmc_ssb_rec","text":"mcmc_obj MCMC object tmbstan tmb_obj RTMB object MakeADFUN","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_mcmc_ssb_rec.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive SSB and Recruitment from MCMC using posterior samples — get_mcmc_ssb_rec","text":"returns dataframe recruitment ssb posterior samples plot ssb recruitment mean, lwr 95 quantile, upr 95 quantile.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_nLL_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get plot of negative log likelihood values — get_nLL_plot","title":"Title Get plot of negative log likelihood values — get_nLL_plot","text":"Title Get plot negative log likelihood values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_nLL_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get plot of negative log likelihood values — get_nLL_plot","text":"","code":"get_nLL_plot(rep, sd_rep)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_nLL_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get plot of negative log likelihood values — get_nLL_plot","text":"rep Report list SPoCK sd_rep sdreport list SPoCK","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_nLL_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get plot of negative log likelihood values — get_nLL_plot","text":"Plot negative log likelihood values","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_nLL_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get plot of negative log likelihood values — get_nLL_plot","text":"","code":"if (FALSE) { # \\dontrun{ get_nLL_plot(rep, sd_rep) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_osa.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","title":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","text":"Function format comp data get OSA residuals afscOSA (uses afscOSA compresid backend get OSA residuals)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_osa.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","text":"","code":"get_osa(obs_mat, exp_mat, N, years, fleet, bins, comp_type, bin_label)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_osa.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","text":"obs_mat Matrix observed values, can NAs - gets removed years arge (dimensioned region, year, age, sex, fleet) exp_mat Matrix expceted values, can NAs - gets removed years arg (dimensioned region, year, age, sex, fleet) N Input effective sample size. aggregated (comp_type == 0), vector n_years provided. split region, split sex (comp_type == 1), provide matrix dimensioned n_regions x n_years x n_sexes. joint sex, split region (comp_type == 2), provide matrix n_regions x n_years years Years want point filter fleet Fleet want filter bins Vector age length bins comp_type Composition type - whether aggregated == 0, split region sex == 1, split region joint sex = =2, joint region sex == 3 bin_label Bin label whether ages lengths","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_osa.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","text":"OSA residuals","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_osa.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to format comp data and get OSA residuals from afscOSA (uses afscOSA and compresid as backend to get OSA residuals) — get_osa","text":"","code":"if (FALSE) { # \\dontrun{ comp_props <- get_comp_prop(data = data, rep = rep, age_labels = 2:31, len_labels = seq(41, 99, 2), year_labels = 1960:2024) osa_results <- get_osa(obs_mat = comp_props$Obs_FishAge_mat,                       exp_mat = comp_props$Pred_FishAge_mat,                       N = 20 * data$Wt_FishAgeComps[1,1,1],                       years = 1999:2023,                       fleet = 1,                       bins = 2:31,                       comp_type = 0,                       bin_label = \"Age\") } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Retrospective Plot — get_retrospective_plot","title":"Title Get Retrospective Plot — get_retrospective_plot","text":"Title Get Retrospective Plot","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Retrospective Plot — get_retrospective_plot","text":"","code":"get_retrospective_plot(retro_output)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Retrospective Plot — get_retrospective_plot","text":"retro_output Dataframe generated do_retrospective","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Retrospective Plot — get_retrospective_plot","text":"retrospective plot recruitment SSB","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Retrospective Plot — get_retrospective_plot","text":"","code":"if (FALSE) { # \\dontrun{ # do retrospective retro <- do_retrospective(n_retro = 7, # number of retro peels to run data = data, # rtmb data parameters = parameters, # rtmb parameters mapping = mapping, # rtmb mapping random = NULL, # if random effects are used do_par = TRUE, # whether or not to parralleize n_cores = 7, # if parallel, number of cores to use do_francis = F, # if we want tod o Francis n_francis_iter = NULL # Number of francis iterations to do ) get_retrospective_plot(retro) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_relative_difference.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","title":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","text":"Derive relative difference terminal year retrospective analysis.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_relative_difference.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","text":"","code":"get_retrospective_relative_difference(retro_data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_relative_difference.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","text":"retro_data Dataframe outputted do_retrospective function","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_relative_difference.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","text":"Returns data frame relative difference SSB recruitment terminal year","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_retrospective_relative_difference.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Derive relative difference from terminal year from a retrospective analysis. — get_retrospective_relative_difference","text":"","code":"if (FALSE) { # \\dontrun{  ret <- do_retrospective(7, data, parameters, mapping, random = NULL, do_par = TRUE, n_cores = 7, do_francis = TRUE, n_francis_iter = 5)  ret_df <- get_retrospective_relative_difference(ret)  ggplot(ret_df %>% filter(Type == 'SSB'), aes(x = Year, y = rd, group = 2024- as.numeric(peel), color = 2024 - as.numeric(peel))) +  geom_hline(yintercept = 0, lty = 2, lwd = 1.3) +    coord_cartesian(ylim = c(-0.4, 0.4)) +    geom_line(lwd = 1.5) +    guides (color = guide_colourbar(barwidth = 15, barheight = 1.3)) +    labs(x = 'Year', y = 'Relative Difference from Terminal Year', color = 'Retrospective Year') +    scale_color_viridis_c() +    theme_bw(base_size = 15) +    theme(legend.position = 'top') } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_selex_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","title":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","text":"Title Get Fishery Survey Selectivity Plots","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_selex_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","text":"","code":"get_selex_plot(rep)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_selex_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","text":"rep RTMB report list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_selex_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","text":"Plots fishery survey selectivity fleet, region, sex","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_selex_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Fishery and Survey Selectivity Plots — get_selex_plot","text":"","code":"if (FALSE) { # \\dontrun{ get_selex_plot(rep) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_ts_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Time Series Plots — get_ts_plot","title":"Title Get Time Series Plots — get_ts_plot","text":"Title Get Time Series Plots","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_ts_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Time Series Plots — get_ts_plot","text":"","code":"get_ts_plot(rep, sd_rep)"},{"path":"https://chengmatt.github.io/SPoCK/reference/get_ts_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Time Series Plots — get_ts_plot","text":"rep RTMB report list sd_rep RTMB sdreport list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_ts_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Get Time Series Plots — get_ts_plot","text":"Plots spawning biomass, total biomass, recruitment, fishing mortality time-series","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/get_ts_plot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Time Series Plots — get_ts_plot","text":"","code":"if (FALSE) { # \\dontrun{   get_ts_plot(rep, sd_rep) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/global_BH_Fmsy.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Global FMSY from a Beverton-Holt (Spatial) — global_BH_Fmsy","title":"Title Get Global FMSY from a Beverton-Holt (Spatial) — global_BH_Fmsy","text":"Title Get Global FMSY Beverton-Holt (Spatial)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/global_BH_Fmsy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Global FMSY from a Beverton-Holt (Spatial) — global_BH_Fmsy","text":"","code":"global_BH_Fmsy(pars, data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/global_BH_Fmsy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Global FMSY from a Beverton-Holt (Spatial) — global_BH_Fmsy","text":"pars Parameter List data Data List","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/global_BH_Fmsy.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Global FMSY from a Beverton-Holt (Spatial) — global_BH_Fmsy","text":"","code":"if (FALSE) { # \\dontrun{ rep <- obj$report(obj$env$last.par.best) # need to have an RTMB object first data_list <- list() # set up data list # Extract out relevant elements n_ages <- length(data$ages) # number of ages n_years <- length(data$years) # number of years data_list$F_fract_flt <- rep$Fmort[1,n_years,] / sum(rep$Fmort[1,n_years,]) # get fleet F fraction data_list$fish_sel <- array(rep$fish_sel[1,n_years,,1,], dim = c(n_ages, data$n_fish_fleets)) data_list$natmort <- rep$natmort[1,1,,1] data_list$t_spwn <- 0 data_list$WAA <- data$WAA[1,1,,1] data_list$MatAA <- data$MatAA[1,1,,1] data_list$h <- rep$h_trans data_list$R0 <- rep$R0  par_list <- list() par_list$log_Fmsy <- log(0.1)  obj <- RTMB::MakeADFun(cmb(single_region_BH_Fmsy, data_list), parameters = par_list, map = NULL, silent = TRUE) obj$optim <- stats::nlminb(obj$par, obj$fn, obj$gr, control = list(iter.max = 1e6, eval.max = 1e6, rel.tol = 1e-15)) obj$rep <- obj$report(obj$env$last.par.best) obj$sdrep <- sdreport(obj) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/global_SPR.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get Global SPR Reference Points (Spatial) — global_SPR","title":"Title Get Global SPR Reference Points (Spatial) — global_SPR","text":"Title Get Global SPR Reference Points (Spatial)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/global_SPR.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get Global SPR Reference Points (Spatial) — global_SPR","text":"","code":"global_SPR(pars, data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/global_SPR.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get Global SPR Reference Points (Spatial) — global_SPR","text":"pars Parameter List RTMB data Data List RTMB","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/global_SPR.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get Global SPR Reference Points (Spatial) — global_SPR","text":"","code":"if (FALSE) { # \\dontrun{ SPR_x <- 0.4 # spr fraction rep <- obj$report(obj$env$last.par.best) # need to have an RTMB object first # Extract out relevant elements n_ages <- length(data$ages) # number of ages n_years <- length(data$years) # number of years data_list$F_fract_flt <- rep$Fmort[1,n_years,] / sum(rep$Fmort[1,n_years,]) # get fleet F fraction to derive population level selectivity data_list$fish_sel <- array(rep$fish_sel[1,n_years,,1,], dim = c(n_ages, data$n_fish_fleets)) # get female selectivity for all fleets data_list$natmort <- rep$natmort[1,1,,1] # get female natural mortality data_list$t_spwn <- t_spwn # specified mortality time up until spawning data_list$WAA <- data$WAA[1,1,,1] # weight-at-age for females data_list$MatAA <- data$MatAA[1,1,,1] # maturity at age for females data_list$Rec_Prop <- rep$Rec_trans_prop # unfished recruitment by region data_list$Movement <- array(rep$Movement[,,n_years,,1], dim = c(n_regions, n_regions, n_ages)) # Movement data_list$do_recruits_move <- data$do_recruits_move # whether recruits move data_list$SPR_x <- SPR_x # SPR fraction par_list <- list() # set up parameter list par_list$log_F_x <- log(0.1) # F_x starting value # Make adfun object obj <- RTMB::MakeADFun(cmb(global_SPR, data_list), parameters = par_list, map = NULL, silent = TRUE) obj$optim <- stats::nlminb(obj$par, obj$fn, obj$gr, control = list(iter.max = 1e6, eval.max = 1e6, rel.tol = 1e-15)) obj$rep <- obj$report(obj$env$last.par.best) # get report } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/is_package_available.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Helper function to check package availbility — is_package_available","title":"Title Helper function to check package availbility — is_package_available","text":"Title Helper function check package availbility","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/is_package_available.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Helper function to check package availbility — is_package_available","text":"","code":"is_package_available(pkg)"},{"path":"https://chengmatt.github.io/SPoCK/reference/is_package_available.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Helper function to check package availbility — is_package_available","text":"pkg package name character","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_diag.html","id":null,"dir":"Reference","previous_headings":"","what":"Model diagnostics for MCMC — mcmc_diag","title":"Model diagnostics for MCMC — mcmc_diag","text":"Model diagnostics MCMC","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_diag.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Model diagnostics for MCMC — mcmc_diag","text":"","code":"mcmc_diag(mcmc_obj, tmb_sdrep, plot = TRUE, pars = NULL)"},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_diag.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Model diagnostics for MCMC — mcmc_diag","text":"mcmc_obj MCMC object tmbstan tmb_sdrep SD report fomr TMB plot Whether plot outputs pars Parameters want plot ","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_diag.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Model diagnostics for MCMC — mcmc_diag","text":"list plots traditional MCMC diagnostics","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_diag.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Model diagnostics for MCMC — mcmc_diag","text":"","code":"if (FALSE) { # \\dontrun{ diagnostic_plots <- mcmc_diag(mcmc_obj, tmb_sdrep, TRUE, pars = 'ln_M') } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_par_names.html","id":null,"dir":"Reference","previous_headings":"","what":"Gets parameter names from mcmc object — mcmc_par_names","title":"Gets parameter names from mcmc object — mcmc_par_names","text":"Gets parameter names mcmc object","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_par_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Gets parameter names from mcmc object — mcmc_par_names","text":"","code":"mcmc_par_names(mcmc_obj)"},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_par_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Gets parameter names from mcmc object — mcmc_par_names","text":"mcmc_obj MCMC object rtmbstan","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_par_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Gets parameter names from mcmc object — mcmc_par_names","text":"Returns character vector parameter names","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mcmc_par_names.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Gets parameter names from mcmc object — mcmc_par_names","text":"","code":"if (FALSE) { # \\dontrun{ par_names <- mcmc_par_names(mcmc_obj) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/mlt_rg_sable_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Sablefish data for multi region (5 area) case study — mlt_rg_sable_data","title":"Sablefish data for multi region (5 area) case study — mlt_rg_sable_data","text":"dataset containing necessary elements Alaska sablefish spatial case study.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mlt_rg_sable_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sablefish data for multi region (5 area) case study — mlt_rg_sable_data","text":"","code":"mlt_rg_sable_data"},{"path":"https://chengmatt.github.io/SPoCK/reference/mlt_rg_sable_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Sablefish data for multi region (5 area) case study — mlt_rg_sable_data","text":"list multiple components needed multi (5) region sablefish model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/mlt_rg_sable_data.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Sablefish data for multi region (5 area) case study — mlt_rg_sable_data","text":"Cheng et al. 2025, review; Panmictic Panacea? Demonstrating Good Practices Developing Spatial Stock Assessments Application Alaska Sablefish (Anoplopoma fimbria)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/plot_resids.html","id":null,"dir":"Reference","previous_headings":"","what":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","title":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","text":"Plots OSA residuals outputs get_osa. Much code taken afscOM package, modificaitons plot features.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/plot_resids.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","text":"","code":"plot_resids(osa_results)"},{"path":"https://chengmatt.github.io/SPoCK/reference/plot_resids.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","text":"osa_results List object obtained get_osa, contains dataframe residuals aggregated fits.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/plot_resids.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","text":"vareity plots OSA residuals (list)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/plot_resids.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plots OSA residuals from outputs from get_osa. Much of this code is taken from the afscOM package, but with modificaitons to plot features. — plot_resids","text":"","code":"if (FALSE) { # \\dontrun{ comp_props <- get_comp_prop(data = data, rep = rep, age_labels = 2:31, len_labels = seq(41, 99, 2), year_labels = 1960:2024) osa_results <- get_osa(obs_mat = comp_props$Obs_FishLen_mat,                        exp_mat = comp_props$Pred_FishLen_mat,                        N = 20 * data$Wt_FishAgeComps[1,1,1],                        years = 1999:2023,                        fleet = 1,                        bins = 2:31,                        comp_type = 1,                        bin_label = \"Age\")  osa_plot <- plot_resids(osa_results) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/rdirM.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Simulate dirichlet multinomial draws — rdirM","title":"Title Simulate dirichlet multinomial draws — rdirM","text":"Title Simulate dirichlet multinomial draws","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/rdirM.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Simulate dirichlet multinomial draws — rdirM","text":"","code":"rdirM(n, N, alpha)"},{"path":"https://chengmatt.github.io/SPoCK/reference/rdirM.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Simulate dirichlet multinomial draws — rdirM","text":"n Number sims N Sum observations alpha Concentration parameter","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/retro_truncate_yr.html","id":null,"dir":"Reference","previous_headings":"","what":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","text":"Helper function truncate data years, parameters, mapping conduct retrospective diagnostics. Called within do_retrospective function.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/retro_truncate_yr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","text":"","code":"retro_truncate_yr(j, data, parameters, mapping)"},{"path":"https://chengmatt.github.io/SPoCK/reference/retro_truncate_yr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","text":"j years truncate terminal year data Data list used RTMB model parameters Parameter list used RTMB model mapping Mapping list used RTMB model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/retro_truncate_yr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","text":"List data, parameters, mapping truncated dimensions original data, parameters, mapping list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/retro_truncate_yr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — retro_truncate_yr","text":"","code":"if (FALSE) { # \\dontrun{ retro_list <- retro_truncate_year(j = 0, data, parameters, mapping) # does not remove any data retro_list <- retro_truncate_year(j = 1, data, parameters, mapping) # removes last year of data } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/rinvgauss_rec.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Generate Recruitment Values based on Inverse Gaussian Distribution — rinvgauss_rec","title":"Title Generate Recruitment Values based on Inverse Gaussian Distribution — rinvgauss_rec","text":"Title Generate Recruitment Values based Inverse Gaussian Distribution","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/rinvgauss_rec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Generate Recruitment Values based on Inverse Gaussian Distribution — rinvgauss_rec","text":"","code":"rinvgauss_rec(sims, recruitment)"},{"path":"https://chengmatt.github.io/SPoCK/reference/rinvgauss_rec.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Generate Recruitment Values based on Inverse Gaussian Distribution — rinvgauss_rec","text":"sims Number Simulations recruitment Recruitment vector","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/rinvgauss_rec.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Title Generate Recruitment Values based on Inverse Gaussian Distribution — rinvgauss_rec","text":"Random variables following inverse gaussian","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/rlogistnormal.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate logistic normal variables — rlogistnormal","title":"Simulate logistic normal variables — rlogistnormal","text":"Simulate logistic normal variables","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/rlogistnormal.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate logistic normal variables — rlogistnormal","text":"","code":"rlogistnormal(exp, pars, comp_like)"},{"path":"https://chengmatt.github.io/SPoCK/reference/rlogistnormal.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate logistic normal variables — rlogistnormal","text":"exp Expected values pars Parameters logistic normal (iid == 1 parameter, AR1 == 2 parameters, 2D, age sex == 3 parameters, 3D, age, sex, region == 4 parameters) comp_like Likelihood structure (iid == 2, ar1 == 3, 2d == 4, 3d == 5)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/run_annual_cycle.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Ruin Annual Cycle in Simulation Environment — run_annual_cycle","title":"Title Ruin Annual Cycle in Simulation Environment — run_annual_cycle","text":"Title Ruin Annual Cycle Simulation Environment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/run_annual_cycle.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Ruin Annual Cycle in Simulation Environment — run_annual_cycle","text":"","code":"run_annual_cycle(y, sim, sim_env)"},{"path":"https://chengmatt.github.io/SPoCK/reference/run_annual_cycle.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Ruin Annual Cycle in Simulation Environment — run_annual_cycle","text":"y Year index sim Simulation index sim_env Simulation environment necessary elements run annual cycle","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_ebswp_data.html","id":null,"dir":"Reference","previous_headings":"","what":"EBS Walleye Pollock data for single region case study — sgl_rg_ebswp_data","title":"EBS Walleye Pollock data for single region case study — sgl_rg_ebswp_data","text":"dataset containing necessary elements EBS Walleye Pollock case study.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_ebswp_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"EBS Walleye Pollock data for single region case study — sgl_rg_ebswp_data","text":"","code":"sgl_rg_ebswp_data"},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_ebswp_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"EBS Walleye Pollock data for single region case study — sgl_rg_ebswp_data","text":"list multiple components needed single region walleye pollock model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_ebswp_data.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"EBS Walleye Pollock data for single region case study — sgl_rg_ebswp_data","text":"2024 Federal EBS Walleye Pollock Assessment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_sable_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Sablefish data for single region case study — sgl_rg_sable_data","title":"Sablefish data for single region case study — sgl_rg_sable_data","text":"dataset containing necessary elements Alaska sablefish case study.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_sable_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sablefish data for single region case study — sgl_rg_sable_data","text":"","code":"sgl_rg_sable_data"},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_sable_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Sablefish data for single region case study — sgl_rg_sable_data","text":"list multiple components needed single region sablefish model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/sgl_rg_sable_data.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Sablefish data for single region case study — sgl_rg_sable_data","text":"2024 Federal Alaska Sablefish Assessment","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_BH_Fmsy.html","id":null,"dir":"Reference","previous_headings":"","what":"Title Get FMSY from a Beverton-Holt function (Single Region) — single_region_BH_Fmsy","title":"Title Get FMSY from a Beverton-Holt function (Single Region) — single_region_BH_Fmsy","text":"Title Get FMSY Beverton-Holt function (Single Region)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_BH_Fmsy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title Get FMSY from a Beverton-Holt function (Single Region) — single_region_BH_Fmsy","text":"","code":"single_region_BH_Fmsy(pars, data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_BH_Fmsy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title Get FMSY from a Beverton-Holt function (Single Region) — single_region_BH_Fmsy","text":"pars Parameter List data Data List","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_BH_Fmsy.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Title Get FMSY from a Beverton-Holt function (Single Region) — single_region_BH_Fmsy","text":"","code":"if (FALSE) { # \\dontrun{ rep <- obj$report(obj$env$last.par.best) # need to have an RTMB object first data_list <- list() # set up data list # Extract out relevant elements n_ages <- length(data$ages) # number of ages n_years <- length(data$years) # number of years data_list$F_fract_flt <- rep$Fmort[1,n_years,] / sum(rep$Fmort[1,n_years,]) # get fleet F fraction to derive population level selectivity data_list$fish_sel <- array(rep$fish_sel[1,n_years,,1,], dim = c(n_ages, data$n_fish_fleets)) # get female selectivity for all fleets data_list$natmort <- rep$natmort[1,1,,1] # get female natural mortality data_list$t_spwn <- 0 # specified mortality time up until spawning data_list$WAA <- data$WAA[1,1,,1] # weight-at-age for females data_list$MatAA <- data$MatAA[1,1,,1] # maturity at age for females data_list$h <- rep$h_trans # steepness data_list$R0 <- rep$R0 # unfished recruitment  par_list <- list() # set up parameter list par_list$log_Fmsy <- log(0.1) # Fmsy starting value  # Make adfun object obj <- RTMB::MakeADFun(cmb(single_region_BH_Fmsy, data_list), parameters = par_list, map = NULL, silent = TRUE) obj$optim <- stats::nlminb(obj$par, obj$fn, obj$gr, control = list(iter.max = 1e6, eval.max = 1e6, rel.tol = 1e-15)) obj$rep <- obj$report(obj$env$last.par.best) # get report obj$sdrep <- sdreport(obj) } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_SPR.html","id":null,"dir":"Reference","previous_headings":"","what":"Get SPR reference points (Single Region) — single_region_SPR","title":"Get SPR reference points (Single Region) — single_region_SPR","text":"Get SPR reference points (Single Region)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_SPR.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get SPR reference points (Single Region) — single_region_SPR","text":"","code":"single_region_SPR(pars, data)"},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_SPR.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get SPR reference points (Single Region) — single_region_SPR","text":"pars Parameter List data Data List","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/single_region_SPR.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get SPR reference points (Single Region) — single_region_SPR","text":"","code":"if (FALSE) { # \\dontrun{ rep <- obj$report(obj$env$last.par.best) # need to have an RTMB object first # Extract out relevant elements n_ages <- length(data$ages) # number of ages n_years <- length(data$years) # number of years data_list$F_fract_flt <- rep$Fmort[1,n_years,] / sum(rep$Fmort[1,n_years,]) # get fleet F fraction to derive population level selectivity data_list$fish_sel <- array(rep$fish_sel[1,n_years,,1,], dim = c(n_ages, data$n_fish_fleets)) # get female selectivity for all fleets data_list$natmort <- rep$natmort[1,1,,1] # get female natural mortality data_list$t_spwn <- t_spwn # specified mortality time up until spawning data_list$WAA <- data$WAA[1,1,,1] # weight-at-age for females data_list$MatAA <- data$MatAA[1,1,,1] # maturity at age for females  data_list$SPR_x <- SPR_x # SPR fraction  par_list <- list() # set up parameter list par_list$log_F_x <- log(0.1) # F_x starting value  # Make adfun object obj <- RTMB::MakeADFun(cmb(single_region_SPR, data_list), parameters = par_list, map = NULL, silent = TRUE) obj$optim <- stats::nlminb(obj$par, obj$fn, obj$gr, control = list(iter.max = 1e6, eval.max = 1e6, rel.tol = 1e-15)) obj$rep <- obj$report(obj$env$last.par.best) # get report } # }"},{"path":"https://chengmatt.github.io/SPoCK/reference/theme_sablefish.html","id":null,"dir":"Reference","previous_headings":"","what":"GGPLOT theme for sablefish — theme_sablefish","title":"GGPLOT theme for sablefish — theme_sablefish","text":"GGPLOT theme sablefish","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/theme_sablefish.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"GGPLOT theme for sablefish — theme_sablefish","text":"","code":"theme_sablefish()"},{"path":"https://chengmatt.github.io/SPoCK/reference/theme_sablefish.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"GGPLOT theme for sablefish — theme_sablefish","text":"ggplot theme","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/three_rg_sable_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Sablefish data for multi region (3 area) case study — three_rg_sable_data","title":"Sablefish data for multi region (3 area) case study — three_rg_sable_data","text":"dataset containing necessary elements Alaska sablefish spatial case study.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/three_rg_sable_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sablefish data for multi region (3 area) case study — three_rg_sable_data","text":"","code":"three_rg_sable_data"},{"path":"https://chengmatt.github.io/SPoCK/reference/three_rg_sable_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Sablefish data for multi region (3 area) case study — three_rg_sable_data","text":"list multiple components needed multi (3) region sablefish model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/three_rg_sable_data.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Sablefish data for multi region (3 area) case study — three_rg_sable_data","text":"Cheng et al. 2025, review; Panmictic Panacea? Demonstrating Good Practices Developing Spatial Stock Assessments Application Alaska Sablefish (Anoplopoma fimbria)","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/truncate_yr.html","id":null,"dir":"Reference","previous_headings":"","what":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","text":"Helper function truncate data years, parameters, mapping conduct retrospective diagnostics. Called within do_retrospective function.","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/truncate_yr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","text":"","code":"truncate_yr(j, data, parameters, mapping)"},{"path":"https://chengmatt.github.io/SPoCK/reference/truncate_yr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","text":"j years truncate terminal year data Data list used RTMB model parameters Parameter list used RTMB model mapping Mapping list used RTMB model","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/truncate_yr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","text":"List data, parameters, mapping truncated dimensions original data, parameters, mapping list","code":""},{"path":"https://chengmatt.github.io/SPoCK/reference/truncate_yr.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Helper function to truncate data years, parameters, and mapping to conduct retrospective diagnostics. Called within do_retrospective function. — truncate_yr","text":"","code":"if (FALSE) { # \\dontrun{ retro_list <- retro_truncate_year(j = 0, data, parameters, mapping) # does not remove any data retro_list <- retro_truncate_year(j = 1, data, parameters, mapping) # removes last year of data } # }"}]
